README for Monotone dumb
=========================

The monotone dumb (or "plain") protocol allows two-way synchronization via sftp or plain files, and one-way (pull) via http(s) and ftp.

Prerequisites:
 python 2.4 
 the urlgrabber module for HTTP support(http://linux.duke.edu/projects/urlgrabber) (TBD: really?)

INSTALLATION
-------------------------

Just invoke 

  python setup.py install

as root/administrator so python will install it for you.

If you want to install as generic user you can try:

  python setup.py install --home $HOME
  
and ensure that you have '$HOME/bin' in PATH and '$HOME/lib/python' in PYTHONPATH.

USAGE
-------------------------

Pull/sync. Currently _ALL_ of the source repository is pulled/synced with.
  mtndumb pull [repository]
  mtndumb sync [repository]
  
Push permits to use branch pattern, so revision on specific branches (and their 
ancestors) are pushed:

  mtndumb push <repository> [branch_pattern]?
  
Repository can be anything like this:

  sftp://user@somewhere/somedirectory
  http://somesite/repo/mtndumb/
  file:d:/repo/mtndumb

TRANSPORTS
-------------------------

Currently there are following transports available
  - local,
  - sftp
  - http  (read-only)
  - dws (experimental, insecure!)
  
Local transport is just "store it on disk". You can try it and see how mtndumb represents monotone database. 
Nothing interesting.

Sample local urls:
  /var/repo/project_name
  file:d:/projects/repo/mtndumb
  
SFTP
Sftp stores repository by SFTP.

Sample repository urls:
  sftp://user@hostname/absolute_path/to_repo
  sftp://user:password@hostname/again_absolute_path_to_repo

CONFIGURATION
-------------------------

Configuration is stored in ini-like file. Configuration file can be changed using '--config' option, default is
$HOME/.mtnplain (USERPROFILE is used instead of HOME if it's not existent - win32).

If "-s|--storeconfig" option is specified then command line settings (repository, local dir etc.) are stored
in config file for future use. WARNING this option rewrites current config file.

All options that are configurable by command line can be configured in file. Configuration is
readed from sections [default] and [DATABASEPATH] in this order. As a result effective precedence of
options is:
 - command line options
 - [DATABASEPATH] section of config file
 - [default] section of config file
 - hardcoded defaults

Example configuration:
------- .mtnplain
[default]
verbose = 1
rsakey = /home/zbigg/id_rsa 

[d:/repo/monotone-dumb.mtn]
verbose = 0
repository = "dws://zzagorski.strony.wi.ps.pl/mtdumb/index.php:monotone-plain/"

[d:/repo/xxx.mtn]
rsakey = /home/zbigg/id_rsa_other
-------

HOW DOES IT WORK
-------------------------

The monotone plain protocol always involves three entities:

 a (local) monotone database
 a (local) transit merkle-directory representing monotone database state (now in memory) 
 a (possibly remote) merkle-directory to sync with
 
The sync directories are called merkle-directories because essentially contain a 
two-level merkle trie plus a datafile with the revision data.

All synchronization is done between the two merkle-directories: the monotone database 
interacts only with the transit merkle-directory.



