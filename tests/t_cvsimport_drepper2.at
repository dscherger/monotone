#  -*- Autoconf -*-

AT_SETUP([a tricky CVS repository with tags])

MONOTONE_SETUP

NEED_UNGZB64

AT_DATA(test.manifest, [format_version "1"

dir ""

dir "t"

dir "t/libasm"

   file "t/libasm/ChangeLog"
content @<:@73c0eabf76cc611c33d821d203a52670b8f6265a@:>@

dir "t/libelf-po"

   file "t/libelf-po/POTFILES.in"
content @<:@411cfd008f4a72e433b48d6421733b6a792ca3b7@:>@
])

AT_DATA(test.tags, [initial 7be6a094cb29307bed5bbacf40b3f3642222f413 tester@test.net
portable-branch-base 32ba3f451dcf277762ca1c328043df2e2ceebc17 tester@test.net
portable-branch-fork-20050601T0139 32ba3f451dcf277762ca1c328043df2e2ceebc17 tester@test.net
])

AT_DATA(e.tar.gz.enc, [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
IUOGDBn6s9B/AByaqK8AUAAA
])

UNGZB64(e.tar.gz.enc, e.tar)
AT_CHECK(tar -xf e.tar)

AT_CHECK(MONOTONE --branch=foo.bar cvs_import e, [], [ignore], [ignore])
AT_CHECK(MONOTONE --branch=foo.bar co)
AT_CHECK(cd foo.bar && MONOTONE automate get_manifest_of, [], [stdout])
AT_CHECK(CANONICALISE(stdout))
AT_CHECK(cmp test.manifest stdout)
AT_CHECK(cd foo.bar && MONOTONE list tags, [], [stdout])
AT_CHECK(CANONICALISE(stdout))
AT_CHECK(cmp test.tags stdout)

AT_CLEANUP
