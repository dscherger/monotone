#  -*- Autoconf -*-

# a test for the abbreviate options (-b, -k, -r, -m)

AT_SETUP([short options work correctly])

MTN_SETUP

AT_DATA(maude, [the file maude
])

AT_DATA(liver, [the file liver
])

# same as MTN macro but without --db and --key
m4_define([SHORT_MTN], [RAW_MTN --rcfile=$_ROOT_DIR/test_hooks.lua --nostd --norc --root=$_ROOT_DIR --keydir=$_ROOT_DIR/keys])

AT_CHECK(SHORT_MTN add maude, [], [ignore], [ignore])

# check it won't work with a bad key
AT_CHECK(SHORT_MTN -k badkey@example.com -b test.branch commit -d test.db -m happy, [1], [ignore], [ignore])

# the failed log will have been saved
AT_CHECK(rm _MTN/log)

# and it does work with a key
AT_CHECK(SHORT_MTN -k tester@test.net -b test.branch commit -d test.db -m happy, [], [ignore], [ignore])

AT_CLEANUP
