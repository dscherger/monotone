#  -*- Autoconf -*-

AT_SETUP([automate get_current_revision_id])
MTN_SETUP

# check an empty base revision id

AT_CHECK(MTN automate get_current_revision_id, [], [stdout], [ignore])
AT_CHECK(cp stdout current, [], [], [])
AT_CHECK(MTN automate get_revision | MTN identify, [], [stdout], [ignore])
AT_CHECK(cmp current stdout, [0], [], [])

# check pending changes against an empty base

ADD_FILE(foo, [this is file foo
])

AT_CHECK(MTN automate get_current_revision_id, [], [stdout], [ignore])
AT_CHECK(cp stdout current, [], [], [])
AT_CHECK(MTN automate get_revision | MTN identify, [], [stdout], [ignore])
AT_CHECK(cmp current stdout, [0], [], [])

COMMIT(testbranch)

# check no changes against a non-empty base

AT_CHECK(MTN automate get_current_revision_id, [], [stdout], [ignore])
AT_CHECK(cp stdout current, [], [], [])
AT_CHECK(MTN automate get_revision | MTN identify, [], [stdout], [ignore])
AT_CHECK(cmp current stdout, [0], [], [])

# check changes against a non-empty base

ADD_FILE(bar, [this is file bar
])

AT_CHECK(MTN automate get_current_revision_id, [], [stdout], [ignore])
AT_CHECK(cp stdout current, [], [], [])
AT_CHECK(MTN automate get_revision | MTN identify, [], [stdout], [ignore])
AT_CHECK(cmp current stdout, [0], [], [])

AT_CLEANUP
