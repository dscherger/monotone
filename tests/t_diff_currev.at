#  -*- Autoconf -*-

AT_SETUP([diffing with explicit rev same as wc rev])

AT_XFAIL_IF(true)

MONOTONE_SETUP

AT_DATA(foo1, [foo file 1
])

AT_CHECK(MONOTONE add foo1, [], [ignore], [ignore])
AT_CHECK(MONOTONE --branch=testbranch commit --message blah, [], [ignore], [ignore])
parent=`BASE_REVISION`

# should return 'no changes' (i.e. same as diff without --revision=<current>)
AT_CHECK(MONOTONE diff --revision=$parent, [], [stdout], [ignore])
AT_CHECK(grep -q 'no changes' stdout)

AT_DATA(foo1, [foo changed file
])

# should show local changes against wc's base rev
AT_CHECK(MONOTONE diff --revision=$parent, [], [stdout], [ignore])
AT_CHECK(grep -q 'foo changed file' stdout)

AT_CLEANUP
