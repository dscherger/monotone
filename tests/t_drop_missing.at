#  -*- Autoconf -*-

AT_SETUP([drop missing and unknown files])

MTN_SETUP

AT_DATA(maude, [the file maude
])
AT_DATA(harold, [the file harold
])
AT_CHECK(mkdir places, [0], [ignore])
AT_DATA(places/cemetery, [the place file cemetery
])

AT_CHECK(MTN add maude, [], [ignore], [ignore])
AT_CHECK(MTN add harold, [], [ignore], [ignore])
AT_CHECK(MTN add places/cemetery, [], [ignore], [ignore])
AT_CHECK(MTN --branch=testbranch commit --message 'committed', [], [ignore], [ignore])

AT_CHECK(rm maude)

AT_CHECK(MTN drop maude, [], [ignore], [stderr])
AT_CHECK(grep 'dropping maude from workspace manifest' stderr, [0], [ignore])

AT_CHECK(MTN status, [], [stdout])
AT_CHECK(grep maude stdout, [0], [ignore])
AT_CHECK(grep harold stdout, [1], [ignore])
AT_CHECK(grep places/cemetery stdout, [1], [ignore])

AT_CHECK(MTN drop foobar, [], [ignore], [stderr])
AT_CHECK(grep 'skipping foobar' stderr, [0], [ignore])

AT_CHECK(rm harold)
AT_CHECK(rm places/cemetery)

AT_CHECK(MTN drop --missing, [], [ignore], [stderr])
AT_CHECK(grep 'dropping harold from workspace manifest' stderr, [0], [ignore])
AT_CHECK(grep 'dropping places/cemetery from workspace manifest' stderr, [0], [ignore])

AT_CHECK(MTN status, [], [stdout])
AT_CHECK(grep maude stdout, [0], [ignore])
AT_CHECK(grep harold stdout, [0], [ignore])
AT_CHECK(grep places/cemetery stdout, [0], [ignore])

AT_CLEANUP
