# -*- Autoconf -*-

AT_SETUP([(imp) do not log the result of hook_get_passphrase])

MTN_SETUP

ADD_FILE(input.txt, [version 0 of the file
])

AT_DATA(hook.lua, [function get_passphrase(keyid)
   if keyid == "quux" then return "xyzzy" end
   return keyid
end
])

AT_CHECK((echo xyzzypassphrasexyzzy; echo xyzzypassphrasexyzzy) | MTN genkey quux, [], [ignore], [ignore])

AT_CHECK(MTN --branch=testbranch --debug commit -m foo --rcfile hook.lua, [], [ignore], [stderr])

AT_CHECK(QGREP xyzzypassphrasexyzzy stderr, [1], [ignore], [ignore])

AT_CLEANUP
