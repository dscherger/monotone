AT_SETUP([test a merge 2])
MONOTONE_SETUP

NEED_UNB64

# Another real merge error. This is the diff between the correct
# result and the file produced by the merge:
#
# --- correct
# +++ testfile
# @@ -336,10 +336,10 @@
#          {
#            L(F("found node %d, ancestor of left %s and right %s\n")
#              % anc % left % right);
# -          return true;
#          }
#      }
#  //      dump_bitset_map("ancestors", ancestors);
# +//      dump_bitset_map("dominators", dominators);
#  //      dump_bitset_map("parents", parents);
#    return false;
#  }

AT_DATA(parent.b64, [Ly8gY29weXJpZ2h0IChDKSAyMDA0IGdyYXlkb24gaG9hcmUgPGdyYXlkb25AcG9ib3guY29tPgov
LyBhbGwgcmlnaHRzIHJlc2VydmVkLgovLyBsaWNlbnNlZCB0byB0aGUgcHVibGljIHVuZGVyIHRo
ZSB0ZXJtcyBvZiB0aGUgR05VIEdQTCAoPj0gMikKLy8gc2VlIHRoZSBmaWxlIENPUFlJTkcgZm9y
IGRldGFpbHMKCiNpbmNsdWRlIDxjY3R5cGU+CiNpbmNsdWRlIDxjc3RkbGliPgojaW5jbHVkZSA8
aW9zdHJlYW0+CiNpbmNsdWRlIDxtYXA+CiNpbmNsdWRlIDxzZXQ+CiNpbmNsdWRlIDxzc3RyZWFt
PgojaW5jbHVkZSA8c3RyaW5nPgoKI2luY2x1ZGUgPGJvb3N0L2xleGljYWxfY2FzdC5ocHA+CiNp
bmNsdWRlIDxib29zdC9keW5hbWljX2JpdHNldC5ocHA+CiNpbmNsdWRlIDxib29zdC9zaGFyZWRf
cHRyLmhwcD4KCiNpbmNsdWRlICJiYXNpY19pby5oaCIKI2luY2x1ZGUgImNoYW5nZV9zZXQuaGgi
CiNpbmNsdWRlICJjb25zdGFudHMuaGgiCiNpbmNsdWRlICJyZXZpc2lvbi5oaCIKI2luY2x1ZGUg
InNhbml0eS5oaCIKI2luY2x1ZGUgInRyYW5zZm9ybXMuaGgiCiNpbmNsdWRlICJ2b2NhYi5oaCIK
CgovLyBjYWxjdWxhdGluZyBsZWFzdCBjb21tb24gYW5jZXN0b3JzIGlzIGEgZGVsaWNhdGUgdGhp
bmcuCi8vIAovLyBpdCB0dXJucyBvdXQgdGhhdCB3ZSBjYW5ub3QgY2hvb3NlIHRoZSBzaW1wbGUg
ImxlYXN0IGNvbW1vbiBhbmNlc3RvciIKLy8gZm9yIHB1cnBvc2VzIG9mIGEgbWVyZ2UsIGJlY2F1
c2UgaXQgaXMgcG9zc2libGUgdGhhdCB0aGVyZSBhcmUgdHdvCi8vIGVxdWFsbHkgcmVhY2hhYmxl
IGNvbW1vbiBhbmNlc3RvcnMsIGFuZCB0aGlzIHByb2R1Y2VzIGFtYmlndWl0eSBpbiB0aGUKLy8g
bWVyZ2UuIHRoZSByZXN1bHQgLS0gaW4gYSBwYXRob2xvZ2ljYWwgY2FzZSAtLSBpcyBzaWxlbnRs
eSBhY2NlcHRpbmcgb25lCi8vIHNldCBvZiBlZGl0cyB3aGlsZSBkaXNjYXJkaW5nIGFub3RoZXI7
IG5vdCBleGFjdGx5IHdoYXQgeW91IHdhbnQgYQovLyB2ZXJzaW9uIGNvbnRyb2wgdG9vbCB0byBk
by4KLy8KLy8gYSBjb25zZXJ2YXRpdmUgYXBwcm94aW1hdGlvbiBpcyB3aGF0IHdlJ2xsIGNhbGwg
YSAic3ViZ3JhcGggcmVjdXJyaW5nIgovLyBMQ0EgYWxnb3JpdGhtLiB0aGlzIGlzIHNvbWV3aGF0
IGxpa2UgbG9jYXRpbmcgdGhlIGxlYXN0IGNvbW1vbiBkb21pbmF0b3IKLy8gbm9kZSwgYnV0IG5v
dCBxdWl0ZS4gaXQgaXMgYWN0dWFsbHkganVzdCBhIHZhbmlsbGEgTENBIHNlYXJjaCwgZXhjZXB0
Ci8vIHRoYXQgYW55IHRpbWUgdGhlcmUncyBhIGZvcmsgKGEgaGlzdG9yaWNhbCBtZXJnZSBsb29r
cyBsaWtlIGEgZm9yayBmcm9tCi8vIG91ciBwZXJzcGVjdGl2ZSwgd29ya2luZyBiYWNrd2FyZHMg
ZnJvbSBjaGlsZHJlbiB0byBwYXJlbnRzKSBpdCByZWR1Y2VzCi8vIHRoZSBmb3JrIHRvIGEgY29t
bW9uIHBhcmVudCB2aWEgYSBzZXF1ZW5jZSBvZiBwYWlyd2lzZSByZWN1cnNpdmUgY2FsbHMKLy8g
dG8gaXRzZWxmIGJlZm9yZSBwcm9jZWVkaW5nLiB0aGlzIHdpbGwgYWx3YXlzIHJlc29sdmUgdG8g
YSBjb21tb24gcGFyZW50Ci8vIHdpdGggbm8gYW1iaWd1aXR5LCB1bmxlc3MgaXQgZmFsbHMgb2Zm
IHRoZSByb290IG9mIHRoZSBncmFwaC4KLy8KLy8gdW5mb3J0dW5hdGVseSB0aGUgc3ViZ3JhcGgg
cmVjdXJyaW5nIGFsZ29yaXRobSBzb21ldGltZXMgZ29lcyB0b28gZmFyCi8vIGJhY2sgaW4gaGlz
dG9yeSAtLSBmb3IgZXhhbXBsZSBpZiB0aGVyZSBpcyBhbiB1bmFtYmlndW91cyBwcm9wYWdhdGUg
ZnJvbQovLyBvbmUgYnJhbmNoIHRvIGFub3RoZXIsIHRoZSBlbnRpcmUgc3ViZ3JhcGggcHJlY2Vl
ZGluZyB0aGUgcHJvcGFnYXRlIG9uCi8vIHRoZSByZWNpcGllbnQgYnJhbmNoIGlzIGVsaWRlZCwg
c2luY2UgaXQgaXMgYSBtZXJnZS4KLy8KLy8gb3VyIGN1cnJlbnQgaHlwb3RoZXNpcyBpcyB0aGF0
IHRoZSAqZXhhY3QqIGNvbmRpdGlvbiB3ZSdyZSBsb29raW5nIGZvciwKLy8gd2hlbiBkb2luZyBh
IG1lcmdlLCBpcyB0aGUgbGVhc3Qgbm9kZSB3aGljaCBkb21pbmF0ZXMgb25lIHNpZGUgb2YgdGhl
Ci8vIG1lcmdlIGFuZCBpcyBhbiBhbmNlc3RvciBvZiB0aGUgb3RoZXIuCgp0eXBlZGVmIHVuc2ln
bmVkIGxvbmcgY3R4Owp0eXBlZGVmIGJvb3N0OjpkeW5hbWljX2JpdHNldDw+IGJpdG1hcDsKdHlw
ZWRlZiBib29zdDo6c2hhcmVkX3B0cjxiaXRtYXA+IHNoYXJlZF9iaXRtYXA7CgpzdGF0aWMgdm9p
ZCAKZW5zdXJlX3BhcmVudHNfbG9hZGVkKGN0eCBjaGlsZCwKICAgICAgICAgICAgICAgICAgICAg
IHN0ZDo6bWFwPGN0eCwgc2hhcmVkX2JpdG1hcD4gJiBwYXJlbnRzLAogICAgICAgICAgICAgICAg
ICAgICAgaW50ZXJuZXI8Y3R4PiAmIGludGVybiwKICAgICAgICAgICAgICAgICAgICAgIGFwcF9z
dGF0ZSAmIGFwcCkKewogIGlmIChwYXJlbnRzLmZpbmQoY2hpbGQpICE9IHBhcmVudHMuZW5kKCkp
CiAgICByZXR1cm47CgogIEwoRigibG9hZGluZyBwYXJlbnRzIGZvciBub2RlICVkXG4iKSAlIGNo
aWxkKTsKCiAgc3RkOjpzZXQ8cmV2aXNpb25faWQ+IGltbV9wYXJlbnRzOwogIGFwcC5kYi5nZXRf
cmV2aXNpb25fcGFyZW50cyhyZXZpc2lvbl9pZChpbnRlcm4ubG9va3VwKGNoaWxkKSksIGltbV9w
YXJlbnRzKTsKCiAgLy8gVGhlIG51bGwgcmV2aXNpb24gaXMgbm90IGEgcGFyZW50IGZvciBwdXJw
b3NlcyBvZiBmaW5kaW5nIGNvbW1vbgogIC8vIGFuY2VzdG9ycy4KICBmb3IgKHN0ZDo6c2V0PHJl
dmlzaW9uX2lkPjo6aXRlcmF0b3IgcCA9IGltbV9wYXJlbnRzLmJlZ2luKCk7CiAgICAgICBwICE9
IGltbV9wYXJlbnRzLmVuZCgpOyArK3ApCiAgICB7CiAgICAgIGlmIChudWxsX2lkKCpwKSkKICAg
ICAgICBpbW1fcGFyZW50cy5lcmFzZShwKTsKICAgIH0KICAgICAgICAgICAgICAKICBzaGFyZWRf
Yml0bWFwIGJpdHMgPSBzaGFyZWRfYml0bWFwKG5ldyBiaXRtYXAocGFyZW50cy5zaXplKCkpKTsK
ICAKICBmb3IgKHN0ZDo6c2V0PHJldmlzaW9uX2lkPjo6Y29uc3RfaXRlcmF0b3IgcCA9IGltbV9w
YXJlbnRzLmJlZ2luKCk7CiAgICAgICBwICE9IGltbV9wYXJlbnRzLmVuZCgpOyArK3ApCiAgICB7
CiAgICAgIGN0eCBwbiA9IGludGVybi5pbnRlcm4ocC0+aW5uZXIoKSgpKTsKICAgICAgTChGKCJw
YXJlbnQgJXMgLT4gbm9kZSAlZFxuIikgJSAqcCAlIHBuKTsKICAgICAgaWYgKHBuID49IGJpdHMt
PnNpemUoKSkgCiAgICAgICAgYml0cy0+cmVzaXplKHBuKzEpOwogICAgICBiaXRzLT5zZXQocG4p
OwogICAgfQogICAgCiAgcGFyZW50cy5pbnNlcnQoc3RkOjptYWtlX3BhaXIoY2hpbGQsIGJpdHMp
KTsKfQoKc3RhdGljIGJvb2wgCmV4cGFuZF9kb21pbmF0b3JzKHN0ZDo6bWFwPGN0eCwgc2hhcmVk
X2JpdG1hcD4gJiBwYXJlbnRzLAogICAgICAgICAgICAgICAgICBzdGQ6Om1hcDxjdHgsIHNoYXJl
ZF9iaXRtYXA+ICYgZG9taW5hdG9ycywKICAgICAgICAgICAgICAgICAgaW50ZXJuZXI8Y3R4PiAm
IGludGVybiwKICAgICAgICAgICAgICAgICAgYXBwX3N0YXRlICYgYXBwKQp7CiAgYm9vbCBzb21l
dGhpbmdfY2hhbmdlZCA9IGZhbHNlOwogIHN0ZDo6dmVjdG9yPGN0eD4gbm9kZXM7CgogIG5vZGVz
LnJlc2VydmUoZG9taW5hdG9ycy5zaXplKCkpOwoKICAvLyBwYXNzIDEsIHB1bGwgb3V0IGFsbCB0
aGUgbm9kZSBudW1iZXJzIHdlJ3JlIGdvaW5nIHRvIHNjYW4gdGhpcyB0aW1lIGFyb3VuZAogIGZv
ciAoc3RkOjptYXA8Y3R4LCBzaGFyZWRfYml0bWFwPjo6Y29uc3RfaXRlcmF0b3IgZSA9IGRvbWlu
YXRvcnMuYmVnaW4oKTsgCiAgICAgICBlICE9IGRvbWluYXRvcnMuZW5kKCk7ICsrZSkKICAgIG5v
ZGVzLnB1c2hfYmFjayhlLT5maXJzdCk7CiAgCiAgLy8gcGFzcyAyLCB1cGRhdGUgYW55IG9mIHRo
ZSBkb21pbmF0b3IgZW50cmllcyB3ZSBjYW4KICBmb3IgKHN0ZDo6dmVjdG9yPGN0eD46OmNvbnN0
X2l0ZXJhdG9yIG4gPSBub2Rlcy5iZWdpbigpOyAKICAgICAgIG4gIT0gbm9kZXMuZW5kKCk7ICsr
bikKICAgIHsKICAgICAgc2hhcmVkX2JpdG1hcCBiaXRzID0gZG9taW5hdG9yc1sqbl07CiAgICAg
IGJpdG1hcCBzYXZlZCgqYml0cyk7CiAgICAgIGlmIChiaXRzLT5zaXplKCkgPD0gKm4pCiAgICAg
ICAgYml0cy0+cmVzaXplKCpuICsgMSk7CiAgICAgIGJpdHMtPnNldCgqbik7CiAgICAgIAogICAg
ICBlbnN1cmVfcGFyZW50c19sb2FkZWQoKm4sIHBhcmVudHMsIGludGVybiwgYXBwKTsKICAgICAg
c2hhcmVkX2JpdG1hcCBuX3BhcmVudHMgPSBwYXJlbnRzWypuXTsKICAgICAgCiAgICAgIGJpdG1h
cCBpbnRlcnNlY3Rpb24oYml0cy0+c2l6ZSgpKTsKICAgICAgCiAgICAgIGJvb2wgZmlyc3QgPSB0
cnVlOwogICAgICBmb3IgKHVuc2lnbmVkIGxvbmcgcGFyZW50ID0gMDsgCiAgICAgICAgICAgcGFy
ZW50ICE9IG5fcGFyZW50cy0+c2l6ZSgpOyArK3BhcmVudCkKICAgICAgICB7CiAgICAgICAgICBp
ZiAoISBuX3BhcmVudHMtPnRlc3QocGFyZW50KSkKICAgICAgICAgICAgY29udGludWU7CgogICAg
ICAgICAgaWYgKGRvbWluYXRvcnMuZmluZChwYXJlbnQpID09IGRvbWluYXRvcnMuZW5kKCkpCiAg
ICAgICAgICAgIGRvbWluYXRvcnMuaW5zZXJ0KHN0ZDo6bWFrZV9wYWlyKHBhcmVudCwgCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYXJlZF9iaXRtYXAobmV3
IGJpdG1hcCgpKSkpOwogICAgICAgICAgc2hhcmVkX2JpdG1hcCBwYml0cyA9IGRvbWluYXRvcnNb
cGFyZW50XTsKCiAgICAgICAgICBpZiAoYml0cy0+c2l6ZSgpID4gcGJpdHMtPnNpemUoKSkKICAg
ICAgICAgICAgcGJpdHMtPnJlc2l6ZShiaXRzLT5zaXplKCkpOwoKICAgICAgICAgIGlmIChwYml0
cy0+c2l6ZSgpID4gYml0cy0+c2l6ZSgpKQogICAgICAgICAgICBiaXRzLT5yZXNpemUocGJpdHMt
PnNpemUoKSk7CgogICAgICAgICAgaWYgKGZpcnN0KQogICAgICAgICAgICB7CiAgICAgICAgICAg
ICAgaW50ZXJzZWN0aW9uID0gKCpwYml0cyk7CiAgICAgICAgICAgICAgZmlyc3QgPSBmYWxzZTsK
ICAgICAgICAgICAgfQogICAgICAgICAgZWxzZQogICAgICAgICAgICBpbnRlcnNlY3Rpb24gJj0g
KCpwYml0cyk7CiAgICAgICAgfQoKICAgICAgKCpiaXRzKSB8PSBpbnRlcnNlY3Rpb247CiAgICAg
IGlmICgqYml0cyAhPSBzYXZlZCkKICAgICAgICBzb21ldGhpbmdfY2hhbmdlZCA9IHRydWU7CiAg
ICB9CiAgcmV0dXJuIHNvbWV0aGluZ19jaGFuZ2VkOwp9CgoKc3RhdGljIGJvb2wgCmV4cGFuZF9h
bmNlc3RvcnMoc3RkOjptYXA8Y3R4LCBzaGFyZWRfYml0bWFwPiAmIHBhcmVudHMsCiAgICAgICAg
ICAgICAgICAgc3RkOjptYXA8Y3R4LCBzaGFyZWRfYml0bWFwPiAmIGFuY2VzdG9ycywKICAgICAg
ICAgICAgICAgICBpbnRlcm5lcjxjdHg+ICYgaW50ZXJuLAogICAgICAgICAgICAgICAgIGFwcF9z
dGF0ZSAmIGFwcCkKewogIGJvb2wgc29tZXRoaW5nX2NoYW5nZWQgPSBmYWxzZTsKICBzdGQ6OnZl
Y3RvcjxjdHg+IG5vZGVzOwoKICBub2Rlcy5yZXNlcnZlKGFuY2VzdG9ycy5zaXplKCkpOwoKICAv
LyBwYXNzIDEsIHB1bGwgb3V0IGFsbCB0aGUgbm9kZSBudW1iZXJzIHdlJ3JlIGdvaW5nIHRvIHNj
YW4gdGhpcyB0aW1lIGFyb3VuZAogIGZvciAoc3RkOjptYXA8Y3R4LCBzaGFyZWRfYml0bWFwPjo6
Y29uc3RfaXRlcmF0b3IgZSA9IGFuY2VzdG9ycy5iZWdpbigpOyAKICAgICAgIGUgIT0gYW5jZXN0
b3JzLmVuZCgpOyArK2UpCiAgICBub2Rlcy5wdXNoX2JhY2soZS0+Zmlyc3QpOwogIAogIC8vIHBh
c3MgMiwgdXBkYXRlIGFueSBvZiB0aGUgYW5jZXN0b3IgZW50cmllcyB3ZSBjYW4KICBmb3IgKHN0
ZDo6dmVjdG9yPGN0eD46OmNvbnN0X2l0ZXJhdG9yIG4gPSBub2Rlcy5iZWdpbigpOyBuICE9IG5v
ZGVzLmVuZCgpOyArK24pCiAgICB7CiAgICAgIHNoYXJlZF9iaXRtYXAgYml0cyA9IGFuY2VzdG9y
c1sqbl07CiAgICAgIGJpdG1hcCBzYXZlZCgqYml0cyk7CiAgICAgIGlmIChiaXRzLT5zaXplKCkg
PD0gKm4pCiAgICAgICAgYml0cy0+cmVzaXplKCpuICsgMSk7CiAgICAgIGJpdHMtPnNldCgqbik7
CgogICAgICBlbnN1cmVfcGFyZW50c19sb2FkZWQoKm4sIHBhcmVudHMsIGludGVybiwgYXBwKTsK
ICAgICAgc2hhcmVkX2JpdG1hcCBuX3BhcmVudHMgPSBwYXJlbnRzWypuXTsKICAgICAgZm9yIChj
dHggcGFyZW50ID0gMDsgcGFyZW50ICE9IG5fcGFyZW50cy0+c2l6ZSgpOyArK3BhcmVudCkKICAg
ICAgICB7CiAgICAgICAgICBpZiAoISBuX3BhcmVudHMtPnRlc3QocGFyZW50KSkKICAgICAgICAg
ICAgY29udGludWU7CgogICAgICAgICAgaWYgKGJpdHMtPnNpemUoKSA8PSBwYXJlbnQpCiAgICAg
ICAgICAgIGJpdHMtPnJlc2l6ZShwYXJlbnQgKyAxKTsKICAgICAgICAgIGJpdHMtPnNldChwYXJl
bnQpOwoKICAgICAgICAgIGlmIChhbmNlc3RvcnMuZmluZChwYXJlbnQpID09IGFuY2VzdG9ycy5l
bmQoKSkKICAgICAgICAgICAgYW5jZXN0b3JzLmluc2VydChtYWtlX3BhaXIocGFyZW50LCAKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYXJlZF9iaXRtYXAobmV3IGJp
dG1hcCgpKSkpOwogICAgICAgICAgc2hhcmVkX2JpdG1hcCBwYml0cyA9IGFuY2VzdG9yc1twYXJl
bnRdOwoKICAgICAgICAgIGlmIChiaXRzLT5zaXplKCkgPiBwYml0cy0+c2l6ZSgpKQogICAgICAg
ICAgICBwYml0cy0+cmVzaXplKGJpdHMtPnNpemUoKSk7CgogICAgICAgICAgaWYgKHBiaXRzLT5z
aXplKCkgPiBiaXRzLT5zaXplKCkpCiAgICAgICAgICAgIGJpdHMtPnJlc2l6ZShwYml0cy0+c2l6
ZSgpKTsKCiAgICAgICAgICAoKmJpdHMpIHw9ICgqcGJpdHMpOwogICAgICAgIH0KICAgICAgaWYg
KCpiaXRzICE9IHNhdmVkKQogICAgICAgIHNvbWV0aGluZ19jaGFuZ2VkID0gdHJ1ZTsKICAgIH0K
ICByZXR1cm4gc29tZXRoaW5nX2NoYW5nZWQ7Cn0KCnN0YXRpYyBib29sIApmaW5kX2ludGVyc2Vj
dGluZ19ub2RlKGJpdG1hcCAmIGZzdCwgCiAgICAgICAgICAgICAgICAgICAgICAgYml0bWFwICYg
c25kLCAKICAgICAgICAgICAgICAgICAgICAgICBpbnRlcm5lcjxjdHg+IGNvbnN0ICYgaW50ZXJu
LCAKICAgICAgICAgICAgICAgICAgICAgICByZXZpc2lvbl9pZCAmIGFuYykKewogIAogIGlmIChm
c3Quc2l6ZSgpID4gc25kLnNpemUoKSkKICAgIHNuZC5yZXNpemUoZnN0LnNpemUoKSk7CiAgZWxz
ZSBpZiAoc25kLnNpemUoKSA+IGZzdC5zaXplKCkpCiAgICBmc3QucmVzaXplKHNuZC5zaXplKCkp
OwogIAogIGJpdG1hcCBpbnRlcnNlY3Rpb24gPSBmc3QgJiBzbmQ7CiAgaWYgKGludGVyc2VjdGlv
bi5hbnkoKSkKICAgIHsKICAgICAgTChGKCJmb3VuZCAlZCBpbnRlcnNlY3Rpbmcgbm9kZXNcbiIp
ICUgaW50ZXJzZWN0aW9uLmNvdW50KCkpOwogICAgICBmb3IgKGN0eCBpID0gMDsgaSA8IGludGVy
c2VjdGlvbi5zaXplKCk7ICsraSkKICAgICAgICB7CiAgICAgICAgICBpZiAoaW50ZXJzZWN0aW9u
LnRlc3QoaSkpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBhbmMgPSByZXZpc2lvbl9pZChp
bnRlcm4ubG9va3VwKGkpKTsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAg
fQogICAgICAgIH0KICAgIH0KICByZXR1cm4gZmFsc2U7Cn0KCi8vICBzdGF0aWMgdm9pZAovLyAg
ZHVtcF9iaXRzZXRfbWFwKHN0cmluZyBjb25zdCAmIGhkciwKLy8gICAgICAgICAgICAgIHN0ZDo6
bWFwPCBjdHgsIHNoYXJlZF9iaXRtYXAgPiBjb25zdCAmIG1tKQovLyAgewovLyAgICBMKEYoImR1
bXBpbmcgWyVzXSAoJWQgZW50cmllcylcbiIpICUgaGRyICUgbW0uc2l6ZSgpKTsKLy8gICAgZm9y
IChzdGQ6Om1hcDwgY3R4LCBzaGFyZWRfYml0bWFwID46OmNvbnN0X2l0ZXJhdG9yIGkgPSBtbS5i
ZWdpbigpOwovLyAgICAgICAgIGkgIT0gbW0uZW5kKCk7ICsraSkKLy8gICAgICB7Ci8vICAgICAg
ICBMKEYoImR1bXAgWyVzXTogJWQgLT4gJXNcbiIpICUgaGRyICUgaS0+Zmlyc3QgJSAoKihpLT5z
ZWNvbmQpKSk7Ci8vICAgICAgfQovLyAgfQoKYm9vbCAKZmluZF9jb21tb25fYW5jZXN0b3IocmV2
aXNpb25faWQgY29uc3QgJiBsZWZ0LAogICAgICAgICAgICAgICAgICAgICByZXZpc2lvbl9pZCBj
b25zdCAmIHJpZ2h0LAogICAgICAgICAgICAgICAgICAgICByZXZpc2lvbl9pZCAmIGFuYywKICAg
ICAgICAgICAgICAgICAgICAgYXBwX3N0YXRlICYgYXBwKQp7CiAgaW50ZXJuZXI8Y3R4PiBpbnRl
cm47CiAgc3RkOjptYXA8IGN0eCwgc2hhcmVkX2JpdG1hcCA+IAogICAgcGFyZW50cywgYW5jZXN0
b3JzLCBkb21pbmF0b3JzOwogIAogIGN0eCBsbiA9IGludGVybi5pbnRlcm4obGVmdC5pbm5lcigp
KCkpOwogIGN0eCBybiA9IGludGVybi5pbnRlcm4ocmlnaHQuaW5uZXIoKSgpKTsKICAKICBzaGFy
ZWRfYml0bWFwIGxhbmMgPSBzaGFyZWRfYml0bWFwKG5ldyBiaXRtYXAoKSk7CiAgc2hhcmVkX2Jp
dG1hcCByYW5jID0gc2hhcmVkX2JpdG1hcChuZXcgYml0bWFwKCkpOwogIHNoYXJlZF9iaXRtYXAg
bGRvbSA9IHNoYXJlZF9iaXRtYXAobmV3IGJpdG1hcCgpKTsKICBzaGFyZWRfYml0bWFwIHJkb20g
PSBzaGFyZWRfYml0bWFwKG5ldyBiaXRtYXAoKSk7CgogIGFuY2VzdG9ycy5pbnNlcnQobWFrZV9w
YWlyKGxuLCBsYW5jKSk7CiAgYW5jZXN0b3JzLmluc2VydChtYWtlX3BhaXIocm4sIHJhbmMpKTsK
ICBkb21pbmF0b3JzLmluc2VydChtYWtlX3BhaXIobG4sIGxkb20pKTsKICBkb21pbmF0b3JzLmlu
c2VydChtYWtlX3BhaXIocm4sIHJkb20pKTsKICAKICBMKEYoInNlYXJjaGluZyBmb3IgY29tbW9u
IGFuY2VzdG9yLCBsZWZ0PSVzIHJpZ2h0PSVzXG4iKSAlIGxlZnQgJSByaWdodCk7CiAgCiAgd2hp
bGUgKGV4cGFuZF9hbmNlc3RvcnMocGFyZW50cywgYW5jZXN0b3JzLCBpbnRlcm4sIGFwcCkgfHwK
ICAgICAgICAgZXhwYW5kX2RvbWluYXRvcnMocGFyZW50cywgZG9taW5hdG9ycywgaW50ZXJuLCBh
cHApKQogICAgewogICAgICBMKEYoImNvbW1vbiBhbmNlc3RvciBzY2FuIFtwYXI9JWQsYW5jPSVk
LGRvbT0lZF1cbiIpICUgCiAgICAgICAgcGFyZW50cy5zaXplKCkgJSBhbmNlc3RvcnMuc2l6ZSgp
ICUgZG9taW5hdG9ycy5zaXplKCkpOwoKICAgICAgaWYgKGZpbmRfaW50ZXJzZWN0aW5nX25vZGUo
KmxhbmMsICpyZG9tLCBpbnRlcm4sIGFuYykpCiAgICAgICAgewogICAgICAgICAgTChGKCJmb3Vu
ZCBub2RlICVkLCBhbmNlc3RvciBvZiBsZWZ0ICVzIGFuZCBkb21pbmF0aW5nIHJpZ2h0ICVzXG4i
KQogICAgICAgICAgICAlIGFuYyAlIGxlZnQgJSByaWdodCk7CiAgICAgICAgICByZXR1cm4gdHJ1
ZTsKICAgICAgICB9CiAgICAgIAogICAgICBlbHNlIGlmIChmaW5kX2ludGVyc2VjdGluZ19ub2Rl
KCpyYW5jLCAqbGRvbSwgaW50ZXJuLCBhbmMpKQogICAgICAgIHsKICAgICAgICAgIEwoRigiZm91
bmQgbm9kZSAlZCwgYW5jZXN0b3Igb2YgcmlnaHQgJXMgYW5kIGRvbWluYXRpbmcgbGVmdCAlc1xu
IikKICAgICAgICAgICAgJSBhbmMgJSByaWdodCAlIGxlZnQpOwogICAgICAgICAgcmV0dXJuIHRy
dWU7CiAgICAgICAgfQogICAgfQovLyAgICAgIGR1bXBfYml0c2V0X21hcCgiYW5jZXN0b3JzIiwg
YW5jZXN0b3JzKTsKLy8gICAgICBkdW1wX2JpdHNldF9tYXAoImRvbWluYXRvcnMiLCBkb21pbmF0
b3JzKTsKLy8gICAgICBkdW1wX2JpdHNldF9tYXAoInBhcmVudHMiLCBwYXJlbnRzKTsKICByZXR1
cm4gZmFsc2U7Cn0KCgovLyAKLy8gVGhlIGlkZWEgd2l0aCB0aGlzIGFsZ29yaXRobSBpcyB0byB3
YWxrIGZyb20gY2hpbGQgdXAgdG8gYW5jZXN0b3IsCi8vIHJlY3Vyc2l2ZWx5LCBhY2N1bXVsYXRp
bmcgYWxsIHRoZSBjaGFuZ2Vfc2V0cyBhc3NvY2lhdGVkIHdpdGgKLy8gaW50ZXJtZWRpYXRlIG5v
ZGVzIGludG8gKm9uZSBiaWcgY2hhbmdlX3NldCouCi8vCi8vIGNsZXZlciByZWFkZXJzIHdpbGwg
cmVhbGl6ZSB0aGlzIGlzIGFuIG92ZXJsYXBwaW5nLXN1YnByb2JsZW0gdHlwZQovLyBzaXR1YXRp
b24gYW5kIHRodXMgbmVlZHMgdG8ga2VlcCBhIGR5bmFtaWMgcHJvZ3JhbW1pbmcgbWFwIHRvIGtl
ZXAKLy8gaXRzZWxmIGluIGxpbmVhciBjb21wbGV4aXR5LgovLwovLyBpbiBmYWN0LCB3ZSBrZWVw
IHR3bzogb25lIHdoaWNoIG1hcHMgdG8gY29tcHV0ZWQgcmVzdWx0cyAocGFydGlhbF9jc2V0cykK
Ly8gYW5kIG9uZSB3aGljaCBqdXN0IGtlZXBzIGEgc2V0IG9mIGFsbCBub2RlcyB3ZSB0cmF2ZXJz
ZWQKLy8gKHZpc2l0ZWRfbm9kZXMpLiBpbiB0aGVvcnkgaXQgY291bGQgYmUgb25lIG1hcCB3aXRo
IGFuIGV4dHJhIGJvb2wgc3R1Y2sKLy8gb24gZWFjaCBlbnRyeSwgYnV0IEkgdGhpbmsgdGhhdCB3
b3VsZCBtYWtlIGl0IGV2ZW4gbGVzcyByZWFkYWJsZS4gaXQncwovLyBhbHJlYWR5IHF1aXRlIHVn
bHkuCi8vCgpzdGF0aWMgYm9vbCAKY2FsY3VsYXRlX2NoYW5nZV9zZXRzX3JlY3Vyc2l2ZShyZXZp
c2lvbl9pZCBjb25zdCAmIGFuY2VzdG9yLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHJldmlzaW9uX2lkIGNvbnN0ICYgY2hpbGQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgYXBwX3N0YXRlICYgYXBwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5n
ZV9zZXQgJiBjdW11bGF0aXZlX2NzZXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
c3RkOjptYXA8cmV2aXNpb25faWQsIGJvb3N0OjpzaGFyZWRfcHRyPGNoYW5nZV9zZXQ+ID4gJiBw
YXJ0aWFsX2NzZXRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZDo6c2V0PHJl
dmlzaW9uX2lkPiAmIHZpc2l0ZWRfbm9kZXMpCnsKCiAgaWYgKGFuY2VzdG9yID09IGNoaWxkKQog
ICAgcmV0dXJuIHRydWU7CgogIHZpc2l0ZWRfbm9kZXMuaW5zZXJ0KGNoaWxkKTsKCiAgYm9vbCBy
ZWxldmFudF9jaGlsZCA9IGZhbHNlOwoKICByZXZpc2lvbl9zZXQgcmV2OwogIGFwcC5kYi5nZXRf
cmV2aXNpb24oY2hpbGQsIHJldik7CgogIEwoRigiZXhwbG9yaW5nIGNoYW5nZXNldHMgZnJvbSBw
YXJlbnRzIG9mICVzLCBzZWVraW5nIHRvd2FyZHMgJXNcbiIpIAogICAgJSBjaGlsZCAlIGFuY2Vz
dG9yKTsKCiAgZm9yKGVkZ2VfbWFwOjpjb25zdF9pdGVyYXRvciBpID0gcmV2LmVkZ2VzLmJlZ2lu
KCk7IGkgIT0gcmV2LmVkZ2VzLmVuZCgpOyArK2kpCiAgICB7CiAgICAgIGJvb2wgcmVsZXZhbnRf
cGFyZW50ID0gZmFsc2U7CiAgICAgIHJldmlzaW9uX2lkIGN1cnJfcGFyZW50ID0gZWRnZV9vbGRf
cmV2aXNpb24oaSk7CgogICAgICBpZiAoY3Vycl9wYXJlbnQuaW5uZXIoKSgpLmVtcHR5KCkpCiAg
ICAgICAgY29udGludWU7CgogICAgICBjaGFuZ2Vfc2V0IGNzZXRfdG9fY3Vycl9wYXJlbnQ7Cgog
ICAgICBMKEYoImNvbnNpZGVyaW5nIHBhcmVudCAlcyBvZiAlc1xuIikgJSBjdXJyX3BhcmVudCAl
IGNoaWxkKTsKCiAgICAgIHN0ZDo6bWFwPHJldmlzaW9uX2lkLCBib29zdDo6c2hhcmVkX3B0cjxj
aGFuZ2Vfc2V0PiA+Ojpjb25zdF9pdGVyYXRvciBqID0gCiAgICAgICAgcGFydGlhbF9jc2V0cy5m
aW5kKGN1cnJfcGFyZW50KTsKICAgICAgaWYgKGogIT0gcGFydGlhbF9jc2V0cy5lbmQoKSkgCiAg
ICAgICAgewogICAgICAgICAgLy8gYSByZWN1cnNpdmUgY2FsbCBoYXMgdHJhdmVyc2VkIHRoaXMg
cGFyZW50IGJlZm9yZSBhbmQgYnVpbHQgYW4KICAgICAgICAgIC8vIGV4aXN0aW5nIGNzZXQuIGp1
c3QgcmV1c2UgdGhhdCByYXRoZXIgdGhhbiByZS10cmF2ZXJzaW5nCiAgICAgICAgICBjc2V0X3Rv
X2N1cnJfcGFyZW50ID0gKihqLT5zZWNvbmQpOwogICAgICAgICAgcmVsZXZhbnRfcGFyZW50ID0g
dHJ1ZTsKICAgICAgICB9CiAgICAgIGVsc2UgaWYgKHZpc2l0ZWRfbm9kZXMuZmluZChjdXJyX3Bh
cmVudCkgIT0gdmlzaXRlZF9ub2Rlcy5lbmQoKSkKICAgICAgICB7CiAgICAgICAgICAvLyBhIHJl
Y3Vyc2l2ZSBjYWxsIGhhcyB0cmF2ZXJzZWQgdGhpcyBwYXJlbnQsIGJ1dCB0aGVyZSB3YXMgbm8K
ICAgICAgICAgIC8vIHBhdGggZnJvbSBpdCB0byB0aGUgcm9vdCwgc28gdGhlIHBhcmVudCBpcyBp
cnJlbGV2YW50LiBza2lwLgogICAgICAgICAgcmVsZXZhbnRfcGFyZW50ID0gZmFsc2U7CiAgICAg
ICAgfQogICAgICBlbHNlCiAgICAgICAgcmVsZXZhbnRfcGFyZW50ID0gY2FsY3VsYXRlX2NoYW5n
ZV9zZXRzX3JlY3Vyc2l2ZShhbmNlc3RvciwgY3Vycl9wYXJlbnQsIGFwcCwgCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjc2V0X3RvX2N1
cnJfcGFyZW50LCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHBhcnRpYWxfY3NldHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXNpdGVkX25vZGVzKTsKCiAgICAgIGlmIChy
ZWxldmFudF9wYXJlbnQpCiAgICAgICAgewogICAgICAgICAgTChGKCJyZXZpc2lvbiAlcyBpcyBy
ZWxldmFudCwgY29tcG9zaW5nIHdpdGggZWRnZSB0byAlc1xuIikgCiAgICAgICAgICAgICUgY3Vy
cl9wYXJlbnQgJSBjaGlsZCk7CiAgICAgICAgICBjb25jYXRlbmF0ZV9jaGFuZ2Vfc2V0cyhjc2V0
X3RvX2N1cnJfcGFyZW50LCBlZGdlX2NoYW5nZXMoaSksIGN1bXVsYXRpdmVfY3NldCk7CiAgICAg
ICAgICByZWxldmFudF9jaGlsZCA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAg
ICAgIGVsc2UKICAgICAgICBMKEYoInBhcmVudCAlcyBvZiAlcyBpcyBub3QgcmVsZXZhbnRcbiIp
ICUgY3Vycl9wYXJlbnQgJSBjaGlsZCk7CiAgICB9CgogIC8vIHN0b3JlIHRoZSBwYXJ0aWFsIGVk
Z2UgZnJvbSBhbmNlc3RvciAtPiBjaGlsZCwgc28gdGhhdCBpZiBhbnlvbmUKICAvLyByZS10cmF2
ZXJzZXMgdGhpcyBlZGdlIHRoZXknbGwganVzdCBmZXRjaCBmcm9tIHRoZSBwYXJ0aWFsX2VkZ2Vz
CiAgLy8gY2FjaGUuCiAgaWYgKHJlbGV2YW50X2NoaWxkKQogICAgcGFydGlhbF9jc2V0cy5pbnNl
cnQoc3RkOjptYWtlX3BhaXIoY2hpbGQsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgYm9vc3Q6OnNoYXJlZF9wdHI8Y2hhbmdlX3NldD4KICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIChuZXcgY2hhbmdlX3NldChjdW11bGF0aXZlX2NzZXQpKSkp
OwogIAogIHJldHVybiByZWxldmFudF9jaGlsZDsKfQoKdm9pZCAKY2FsY3VsYXRlX2NvbXBvc2l0
ZV9jaGFuZ2Vfc2V0KHJldmlzaW9uX2lkIGNvbnN0ICYgYW5jZXN0b3IsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICByZXZpc2lvbl9pZCBjb25zdCAmIGNoaWxkLAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgYXBwX3N0YXRlICYgYXBwLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgY2hhbmdlX3NldCAmIGNvbXBvc2VkKQp7CiAgTChGKCJjYWxjdWxhdGluZyBjb21w
b3NpdGUgY2hhbmdlc2V0IGJldHdlZW4gJXMgYW5kICVzXG4iKQogICAgJSBhbmNlc3RvciAlIGNo
aWxkKTsKICBzdGQ6OnNldDxyZXZpc2lvbl9pZD4gdmlzaXRlZDsKICBzdGQ6Om1hcDxyZXZpc2lv
bl9pZCwgYm9vc3Q6OnNoYXJlZF9wdHI8Y2hhbmdlX3NldD4gPiBwYXJ0aWFsOwogIGNhbGN1bGF0
ZV9jaGFuZ2Vfc2V0c19yZWN1cnNpdmUoYW5jZXN0b3IsIGNoaWxkLCBhcHAsIGNvbXBvc2VkLCBw
YXJ0aWFsLCB2aXNpdGVkKTsKfQoKLy8gbWlncmF0aW9uIHN0dWZmCi8vCi8vIEZJWE1FOiB0aGVz
ZSBhcmUgdGVtcG9yYXJ5IGZ1bmN0aW9ucywgb25jZSB3ZSd2ZSBkb25lIHRoZSBtaWdyYXRpb24g
dG8KLy8gcmV2aXNpb25zIC8gY2hhbmdlc2V0cywgd2UgY2FuIHJlbW92ZSB0aGVtLgoKc3RhdGlj
IHZvaWQgCmFuYWx5emVfbWFuaWZlc3RfY2hhbmdlcyhhcHBfc3RhdGUgJiBhcHAsCiAgICAgICAg
ICAgICAgICAgICAgICAgICBtYW5pZmVzdF9pZCBjb25zdCAmIHBhcmVudCwgCiAgICAgICAgICAg
ICAgICAgICAgICAgICBtYW5pZmVzdF9pZCBjb25zdCAmIGNoaWxkLCAKICAgICAgICAgICAgICAg
ICAgICAgICAgIGNoYW5nZV9zZXQgJiBjcykKewogIG1hbmlmZXN0X21hcCBtX3BhcmVudCwgbV9j
aGlsZDsKICBhcHAuZGIuZ2V0X21hbmlmZXN0KHBhcmVudCwgbV9wYXJlbnQpOwogIGFwcC5kYi5n
ZXRfbWFuaWZlc3QoY2hpbGQsIG1fY2hpbGQpOwoKICBmb3IgKG1hbmlmZXN0X21hcDo6Y29uc3Rf
aXRlcmF0b3IgaSA9IG1fcGFyZW50LmJlZ2luKCk7IAogICAgICAgaSAhPSBtX3BhcmVudC5lbmQo
KTsgKytpKQogICAgewogICAgICBtYW5pZmVzdF9tYXA6OmNvbnN0X2l0ZXJhdG9yIGogPSBtX2No
aWxkLmZpbmQobWFuaWZlc3RfZW50cnlfcGF0aChpKSk7CiAgICAgIGlmIChqID09IG1fY2hpbGQu
ZW5kKCkpCiAgICAgICAgY3MuZGVsZXRlX2ZpbGUobWFuaWZlc3RfZW50cnlfcGF0aChpKSk7CiAg
ICAgIGVsc2UgaWYgKCEgKG1hbmlmZXN0X2VudHJ5X2lkKGkpID09IG1hbmlmZXN0X2VudHJ5X2lk
KGopKSkKICAgICAgICB7CiAgICAgICAgICBjcy5hcHBseV9kZWx0YShtYW5pZmVzdF9lbnRyeV9w
YXRoKGkpLAogICAgICAgICAgICAgICAgICAgICAgICAgbWFuaWZlc3RfZW50cnlfaWQoaSksIAog
ICAgICAgICAgICAgICAgICAgICAgICAgbWFuaWZlc3RfZW50cnlfaWQoaikpOwogICAgICAgIH0g
ICAgICAgCiAgICB9CiAgZm9yIChtYW5pZmVzdF9tYXA6OmNvbnN0X2l0ZXJhdG9yIGkgPSBtX2No
aWxkLmJlZ2luKCk7IAogICAgICAgaSAhPSBtX2NoaWxkLmVuZCgpOyArK2kpCiAgICB7CiAgICAg
IG1hbmlmZXN0X21hcDo6Y29uc3RfaXRlcmF0b3IgaiA9IG1fcGFyZW50LmZpbmQobWFuaWZlc3Rf
ZW50cnlfcGF0aChpKSk7CiAgICAgIGlmIChqID09IG1fcGFyZW50LmVuZCgpKQogICAgICAgIGNz
LmFkZF9maWxlKG1hbmlmZXN0X2VudHJ5X3BhdGgoaSksCiAgICAgICAgICAgICAgICAgICAgbWFu
aWZlc3RfZW50cnlfaWQoaSkpOwogICAgfQp9CgpzdGF0aWMgcmV2aXNpb25faWQKY29uc3RydWN0
X3JldmlzaW9ucyhhcHBfc3RhdGUgJiBhcHAsCiAgICAgICAgICAgICAgICAgICAgbWFuaWZlc3Rf
aWQgY29uc3QgJiBjaGlsZCwKICAgICAgICAgICAgICAgICAgICBzdGQ6Om11bHRpbWFwPCBtYW5p
ZmVzdF9pZCwgbWFuaWZlc3RfaWQgPiBjb25zdCAmIGFuY2VzdHJ5LAogICAgICAgICAgICAgICAg
ICAgIHN0ZDo6bWFwPG1hbmlmZXN0X2lkLCByZXZpc2lvbl9pZD4gJiBtYXBwZWQpCnsKICByZXZp
c2lvbl9zZXQgcmV2OwogIHR5cGVkZWYgc3RkOjptdWx0aW1hcDwgbWFuaWZlc3RfaWQsIG1hbmlm
ZXN0X2lkID46OmNvbnN0X2l0ZXJhdG9yIGNpOwogIHN0ZDo6cGFpcjxjaSxjaT4gcmFuZ2UgPSBh
bmNlc3RyeS5lcXVhbF9yYW5nZShjaGlsZCk7CiAgZm9yIChjaSBpID0gcmFuZ2UuZmlyc3Q7IGkg
IT0gcmFuZ2Uuc2Vjb25kOyArK2kpCiAgICB7CiAgICAgIG1hbmlmZXN0X2lkIHBhcmVudChpLT5z
ZWNvbmQpOwogICAgICByZXZpc2lvbl9pZCBwYXJlbnRfcmlkOwogICAgICBzdGQ6Om1hcDxtYW5p
ZmVzdF9pZCwgcmV2aXNpb25faWQ+Ojpjb25zdF9pdGVyYXRvciBqID0gbWFwcGVkLmZpbmQocGFy
ZW50KTsKCiAgICAgIGlmIChqICE9IG1hcHBlZC5lbmQoKSkKICAgICAgICBwYXJlbnRfcmlkID0g
ai0+c2Vjb25kOwogICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgcGFyZW50X3JpZCA9IGNv
bnN0cnVjdF9yZXZpc2lvbnMoYXBwLCBwYXJlbnQsIGFuY2VzdHJ5LCBtYXBwZWQpOwogICAgICAg
ICAgUChGKCJpbnNlcnRpbmcgbWFwcGluZyAlZCA6ICVzIC0+ICVzXG4iKSAlIG1hcHBlZC5zaXpl
KCkgJSBwYXJlbnQgJSBwYXJlbnRfcmlkKTs7CiAgICAgICAgICBtYXBwZWQuaW5zZXJ0KHN0ZDo6
bWFrZV9wYWlyKHBhcmVudCwgcGFyZW50X3JpZCkpOwogICAgICAgIH0KICAgICAgCiAgICAgIGNo
YW5nZV9zZXQgY3M7CiAgICAgIGFuYWx5emVfbWFuaWZlc3RfY2hhbmdlcyhhcHAsIHBhcmVudCwg
Y2hpbGQsIGNzKTsKICAgICAgcmV2LmVkZ2VzLmluc2VydChzdGQ6Om1ha2VfcGFpcihwYXJlbnRf
cmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZDo6bWFrZV9wYWly
KHBhcmVudCwgY3MpKSk7CiAgICB9IAoKICByZXZpc2lvbl9pZCByaWQ7CiAgaWYgKHJldi5lZGdl
cy5lbXB0eSgpKQogICAgewogICAgICBQKEYoImlnbm9yaW5nIGVtcHR5IHJldmlzaW9uIGZvciBt
YW5pZmVzdCAlc1xuIikgJSBjaGlsZCk7ICAKICAgICAgcmV0dXJuIHJpZDsKICAgIH0KCiAgcmV2
Lm5ld19tYW5pZmVzdCA9IGNoaWxkOwogIGNhbGN1bGF0ZV9pZGVudChyZXYsIHJpZCk7CgogIGlm
ICghYXBwLmRiLnJldmlzaW9uX2V4aXN0cyAocmlkKSkKICAgIHsKICAgICAgUChGKCJtYXBwaW5n
IG1hbmlmZXN0ICVzIHRvIHJldmlzaW9uICVzXG4iKSAlIGNoaWxkICUgcmlkKTsKICAgICAgYXBw
LmRiLnB1dF9yZXZpc2lvbihyaWQsIHJldik7CiAgICB9CiAgZWxzZQogICAgewogICAgICBQKEYo
InNraXBwaW5nIGFkZGl0aW9uYWwgcGF0aCB0byByZXZpc2lvbiAlc1xuIikgJSByaWQpOwogICAg
fQoKICAvLyBub3cgaG9pc3QgYWxsIHRoZSBpbnRlcmVzdGluZyBjZXJ0cyB1cCB0byB0aGUgcmV2
aXNpb24KICBzdGQ6OnNldDxjZXJ0X25hbWU+IGNuYW1lczsKICBjbmFtZXMuaW5zZXJ0KGNlcnRf
bmFtZShicmFuY2hfY2VydF9uYW1lKSk7CiAgY25hbWVzLmluc2VydChjZXJ0X25hbWUoZGF0ZV9j
ZXJ0X25hbWUpKTsKICBjbmFtZXMuaW5zZXJ0KGNlcnRfbmFtZShhdXRob3JfY2VydF9uYW1lKSk7
CiAgY25hbWVzLmluc2VydChjZXJ0X25hbWUodGFnX2NlcnRfbmFtZSkpOwogIGNuYW1lcy5pbnNl
cnQoY2VydF9uYW1lKGNoYW5nZWxvZ19jZXJ0X25hbWUpKTsKICBjbmFtZXMuaW5zZXJ0KGNlcnRf
bmFtZShjb21tZW50X2NlcnRfbmFtZSkpOwogIGNuYW1lcy5pbnNlcnQoY2VydF9uYW1lKHRlc3Ry
ZXN1bHRfY2VydF9uYW1lKSk7CgogIHN0ZDo6dmVjdG9yPCBtYW5pZmVzdDxjZXJ0PiA+IHRtcDsK
ICBhcHAuZGIuZ2V0X21hbmlmZXN0X2NlcnRzKGNoaWxkLCB0bXApOwogIGVyYXNlX2JvZ3VzX2Nl
cnRzKHRtcCwgYXBwKTsgICAgICAKICBmb3IgKHN0ZDo6dmVjdG9yPCBtYW5pZmVzdDxjZXJ0PiA+
Ojpjb25zdF9pdGVyYXRvciBpID0gdG1wLmJlZ2luKCk7CiAgICAgICBpICE9IHRtcC5lbmQoKTsg
KytpKQogICAgewogICAgICBpZiAoY25hbWVzLmZpbmQoaS0+aW5uZXIoKS5uYW1lKSA9PSBjbmFt
ZXMuZW5kKCkpCiAgICAgICAgY29udGludWU7CiAgICAgIGNlcnQgbmV3X2NlcnQ7CiAgICAgIGNl
cnRfdmFsdWUgdHY7CiAgICAgIGRlY29kZV9iYXNlNjQoaS0+aW5uZXIoKS52YWx1ZSwgdHYpOwog
ICAgICBtYWtlX3NpbXBsZV9jZXJ0KHJpZC5pbm5lcigpLCBpLT5pbm5lcigpLm5hbWUsIHR2LCBh
cHAsIG5ld19jZXJ0KTsKICAgICAgaWYgKCEgYXBwLmRiLnJldmlzaW9uX2NlcnRfZXhpc3RzKHJl
dmlzaW9uPGNlcnQ+KG5ld19jZXJ0KSkpCiAgICAgICAgYXBwLmRiLnB1dF9yZXZpc2lvbl9jZXJ0
KHJldmlzaW9uPGNlcnQ+KG5ld19jZXJ0KSk7CiAgICB9CiAgcmV0dXJuIHJpZDsgIAp9CgoKdm9p
ZCAKYnVpbGRfY2hhbmdlc2V0cyhhcHBfc3RhdGUgJiBhcHApCnsKICBzdGQ6OnZlY3RvcjwgbWFu
aWZlc3Q8Y2VydD4gPiB0bXA7CiAgYXBwLmRiLmdldF9tYW5pZmVzdF9jZXJ0cyhjZXJ0X25hbWUo
ImFuY2VzdG9yIiksIHRtcCk7CiAgZXJhc2VfYm9ndXNfY2VydHModG1wLCBhcHApOwoKICBzdGQ6
Om11bHRpbWFwPCBtYW5pZmVzdF9pZCwgbWFuaWZlc3RfaWQgPiBhbmNlc3RyeTsKICBzdGQ6OnNl
dDxtYW5pZmVzdF9pZD4gaGVhZHM7CiAgc3RkOjpzZXQ8bWFuaWZlc3RfaWQ+IHRvdGFsOwogIAog
IGZvciAoc3RkOjp2ZWN0b3I8IG1hbmlmZXN0PGNlcnQ+ID46OmNvbnN0X2l0ZXJhdG9yIGkgPSB0
bXAuYmVnaW4oKTsKICAgICAgIGkgIT0gdG1wLmVuZCgpOyArK2kpCiAgICB7CiAgICAgIGNlcnRf
dmFsdWUgdHY7CiAgICAgIGRlY29kZV9iYXNlNjQoaS0+aW5uZXIoKS52YWx1ZSwgdHYpOwogICAg
ICBtYW5pZmVzdF9pZCBjaGlsZCwgcGFyZW50OwogICAgICBjaGlsZCA9IGktPmlubmVyKCkuaWRl
bnQ7CiAgICAgIHBhcmVudCA9IGhleGVuYzxpZD4odHYoKSk7CiAgICAgIGhlYWRzLmluc2VydChj
aGlsZCk7CiAgICAgIGhlYWRzLmVyYXNlKHBhcmVudCk7CiAgICAgIHRvdGFsLmluc2VydChjaGls
ZCk7CiAgICAgIHRvdGFsLmluc2VydChwYXJlbnQpOwogICAgICBhbmNlc3RyeS5pbnNlcnQoc3Rk
OjptYWtlX3BhaXIoY2hpbGQsIHBhcmVudCkpOwogICAgfQogIAogIFAoRigiZm91bmQgYSB0b3Rh
bCBvZiAlZCBtYW5pZmVzdHNcbiIpICUgdG90YWwuc2l6ZSgpKTsKCiAgdHJhbnNhY3Rpb25fZ3Vh
cmQgZ3VhcmQoYXBwLmRiKTsKICBzdGQ6Om1hcDxtYW5pZmVzdF9pZCwgcmV2aXNpb25faWQ+IG1h
cHBlZDsKICBmb3IgKHN0ZDo6c2V0PG1hbmlmZXN0X2lkPjo6Y29uc3RfaXRlcmF0b3IgaSA9IGhl
YWRzLmJlZ2luKCk7CiAgICAgICBpICE9IGhlYWRzLmVuZCgpOyArK2kpCiAgICB7CiAgICAgIGNv
bnN0cnVjdF9yZXZpc2lvbnMoYXBwLCAqaSwgYW5jZXN0cnksIG1hcHBlZCk7CiAgICB9CiAgZ3Vh
cmQuY29tbWl0KCk7Cn0KCgovLyBpL28gc3R1ZmYKCnN0ZDo6c3RyaW5nIHJldmlzaW9uX2ZpbGVf
bmFtZSgicmV2aXNpb24iKTsKCm5hbWVzcGFjZSAKewogIG5hbWVzcGFjZSBzeW1zCiAgewogICAg
c3RkOjpzdHJpbmcgY29uc3Qgb2xkX3JldmlzaW9uKCJvbGRfcmV2aXNpb24iKTsKICAgIHN0ZDo6
c3RyaW5nIGNvbnN0IG5ld19tYW5pZmVzdCgibmV3X21hbmlmZXN0Iik7CiAgICBzdGQ6OnN0cmlu
ZyBjb25zdCBvbGRfbWFuaWZlc3QoIm9sZF9tYW5pZmVzdCIpOwogIH0KfQoKCnZvaWQgCnByaW50
X2VkZ2UoYmFzaWNfaW86OnByaW50ZXIgJiBwcmludGVyLAogICAgICAgICAgIGVkZ2VfZW50cnkg
Y29uc3QgJiBlKQp7ICAgICAgIAogIGJhc2ljX2lvOjpzdGFuemEgc3Q7CiAgc3QucHVzaF9oZXhf
cGFpcihzeW1zOjpvbGRfcmV2aXNpb24sIGVkZ2Vfb2xkX3JldmlzaW9uKGUpLmlubmVyKCkoKSk7
CiAgc3QucHVzaF9oZXhfcGFpcihzeW1zOjpvbGRfbWFuaWZlc3QsIGVkZ2Vfb2xkX21hbmlmZXN0
KGUpLmlubmVyKCkoKSk7CiAgcHJpbnRlci5wcmludF9zdGFuemEoc3QpOwogIHByaW50X2NoYW5n
ZV9zZXQocHJpbnRlciwgZWRnZV9jaGFuZ2VzKGUpKTsgCn0KCgp2b2lkIApwcmludF9yZXZpc2lv
bihiYXNpY19pbzo6cHJpbnRlciAmIHByaW50ZXIsCiAgICAgICAgICAgICAgIHJldmlzaW9uX3Nl
dCBjb25zdCAmIHJldikKewogIGJhc2ljX2lvOjpzdGFuemEgc3Q7IAogIHN0LnB1c2hfaGV4X3Bh
aXIoc3ltczo6bmV3X21hbmlmZXN0LCByZXYubmV3X21hbmlmZXN0LmlubmVyKCkoKSk7CiAgcHJp
bnRlci5wcmludF9zdGFuemEoc3QpOwogIGZvciAoZWRnZV9tYXA6OmNvbnN0X2l0ZXJhdG9yIGVk
Z2UgPSByZXYuZWRnZXMuYmVnaW4oKTsKICAgICAgIGVkZ2UgIT0gcmV2LmVkZ2VzLmVuZCgpOyAr
K2VkZ2UpCiAgICBwcmludF9lZGdlKHByaW50ZXIsICplZGdlKTsKfQoKCnZvaWQgCnBhcnNlX2Vk
Z2UoYmFzaWNfaW86OnBhcnNlciAmIHBhcnNlciwKICAgICAgICAgICBlZGdlX21hcCAmIGVzKQp7
CiAgY2hhbmdlX3NldCBjczsKICBtYW5pZmVzdF9pZCBvbGRfbWFuOwogIHJldmlzaW9uX2lkIG9s
ZF9yZXY7CiAgc3RkOjpzdHJpbmcgdG1wOwogIAogIHBhcnNlci5lc3ltKHN5bXM6Om9sZF9yZXZp
c2lvbik7CiAgcGFyc2VyLmhleCh0bXApOwogIG9sZF9yZXYgPSByZXZpc2lvbl9pZCh0bXApOwog
IAogIHBhcnNlci5lc3ltKHN5bXM6Om9sZF9tYW5pZmVzdCk7CiAgcGFyc2VyLmhleCh0bXApOwog
IG9sZF9tYW4gPSBtYW5pZmVzdF9pZCh0bXApOwogIAogIHBhcnNlX2NoYW5nZV9zZXQocGFyc2Vy
LCBjcyk7CgogIGVzLmluc2VydChzdGQ6Om1ha2VfcGFpcihvbGRfcmV2LCBzdGQ6Om1ha2VfcGFp
cihvbGRfbWFuLCBjcykpKTsKfQoKCnZvaWQgCnBhcnNlX3JldmlzaW9uKGJhc2ljX2lvOjpwYXJz
ZXIgJiBwYXJzZXIsCiAgICAgICAgICAgICAgIHJldmlzaW9uX3NldCAmIHJldikKewogIHJldi5l
ZGdlcy5jbGVhcigpOwogIHN0ZDo6c3RyaW5nIHRtcDsKICBwYXJzZXIuZXN5bShzeW1zOjpuZXdf
bWFuaWZlc3QpOwogIHBhcnNlci5oZXgodG1wKTsKICByZXYubmV3X21hbmlmZXN0ID0gbWFuaWZl
c3RfaWQodG1wKTsKICB3aGlsZSAocGFyc2VyLnN5bXAoc3ltczo6b2xkX3JldmlzaW9uKSkKICAg
IHBhcnNlX2VkZ2UocGFyc2VyLCByZXYuZWRnZXMpOwp9Cgp2b2lkIApyZWFkX3JldmlzaW9uX3Nl
dChkYXRhIGNvbnN0ICYgZGF0LAogICAgICAgICAgICAgICAgICByZXZpc2lvbl9zZXQgJiByZXYp
CnsKICBzdGQ6OmlzdHJpbmdzdHJlYW0gaXNzKGRhdCgpKTsKICBiYXNpY19pbzo6aW5wdXRfc291
cmNlIHNyYyhpc3MsICJyZXZpc2lvbiIpOwogIGJhc2ljX2lvOjp0b2tlbml6ZXIgdG9rKHNyYyk7
CiAgYmFzaWNfaW86OnBhcnNlciBwYXJzKHRvayk7CiAgcGFyc2VfcmV2aXNpb24ocGFycywgcmV2
KTsKfQoKdm9pZCAKcmVhZF9yZXZpc2lvbl9zZXQocmV2aXNpb25fZGF0YSBjb25zdCAmIGRhdCwK
ICAgICAgICAgICAgICAgICAgcmV2aXNpb25fc2V0ICYgcmV2KQp7CiAgZGF0YSB1bnBhY2tlZDsK
ICB1bnBhY2soZGF0LmlubmVyKCksIHVucGFja2VkKTsKICByZWFkX3JldmlzaW9uX3NldCh1bnBh
Y2tlZCwgcmV2KTsKfQoKdm9pZAp3cml0ZV9yZXZpc2lvbl9zZXQocmV2aXNpb25fc2V0IGNvbnN0
ICYgcmV2LAogICAgICAgICAgICAgICAgICAgZGF0YSAmIGRhdCkKewogIHN0ZDo6b3N0cmluZ3N0
cmVhbSBvc3M7CiAgYmFzaWNfaW86OnByaW50ZXIgcHIob3NzKTsKICBwcmludF9yZXZpc2lvbihw
ciwgcmV2KTsKICBkYXQgPSBkYXRhKG9zcy5zdHIoKSk7Cn0KCnZvaWQKd3JpdGVfcmV2aXNpb25f
c2V0KHJldmlzaW9uX3NldCBjb25zdCAmIHJldiwKICAgICAgICAgICAgICAgICAgIHJldmlzaW9u
X2RhdGEgJiBkYXQpCnsKICBkYXRhIGQ7CiAgd3JpdGVfcmV2aXNpb25fc2V0KHJldiwgZCk7CiAg
YmFzZTY0PCBnemlwPGRhdGE+ID4gcGFja2VkOwogIHBhY2soZCwgcGFja2VkKTsKICBkYXQgPSBy
ZXZpc2lvbl9kYXRhKHBhY2tlZCk7Cn0KCiNpZmRlZiBCVUlMRF9VTklUX1RFU1RTCiNpbmNsdWRl
ICJ1bml0X3Rlc3RzLmhoIgojaW5jbHVkZSAic2FuaXR5LmhoIgoKc3RhdGljIHZvaWQgCnJldmlz
aW9uX3Rlc3QoKQp7Cn0KCnZvaWQgCmFkZF9yZXZpc2lvbl90ZXN0cyh0ZXN0X3N1aXRlICogc3Vp
dGUpCnsKICBJKHN1aXRlKTsKICBzdWl0ZS0+YWRkKEJPT1NUX1RFU1RfQ0FTRSgmcmV2aXNpb25f
dGVzdCkpOwp9CgoKI2VuZGlmIC8vIEJVSUxEX1VOSVRfVEVTVFMK
])

AT_DATA(left.b64, [Ly8gY29weXJpZ2h0IChDKSAyMDA0IGdyYXlkb24gaG9hcmUgPGdyYXlkb25AcG9ib3guY29tPgov
LyBhbGwgcmlnaHRzIHJlc2VydmVkLgovLyBsaWNlbnNlZCB0byB0aGUgcHVibGljIHVuZGVyIHRo
ZSB0ZXJtcyBvZiB0aGUgR05VIEdQTCAoPj0gMikKLy8gc2VlIHRoZSBmaWxlIENPUFlJTkcgZm9y
IGRldGFpbHMKCiNpbmNsdWRlIDxjY3R5cGU+CiNpbmNsdWRlIDxjc3RkbGliPgojaW5jbHVkZSA8
aW9zdHJlYW0+CiNpbmNsdWRlIDxtYXA+CiNpbmNsdWRlIDxzZXQ+CiNpbmNsdWRlIDxzc3RyZWFt
PgojaW5jbHVkZSA8c3RyaW5nPgoKI2luY2x1ZGUgPGJvb3N0L2xleGljYWxfY2FzdC5ocHA+CiNp
bmNsdWRlIDxib29zdC9keW5hbWljX2JpdHNldC5ocHA+CiNpbmNsdWRlIDxib29zdC9zaGFyZWRf
cHRyLmhwcD4KCiNpbmNsdWRlICJiYXNpY19pby5oaCIKI2luY2x1ZGUgImNoYW5nZV9zZXQuaGgi
CiNpbmNsdWRlICJjb25zdGFudHMuaGgiCiNpbmNsdWRlICJyZXZpc2lvbi5oaCIKI2luY2x1ZGUg
InNhbml0eS5oaCIKI2luY2x1ZGUgInRyYW5zZm9ybXMuaGgiCiNpbmNsdWRlICJ2b2NhYi5oaCIK
CgovLyBjYWxjdWxhdGluZyBsZWFzdCBjb21tb24gYW5jZXN0b3JzIGlzIGEgZGVsaWNhdGUgdGhp
bmcuCi8vIAovLyBpdCB0dXJucyBvdXQgdGhhdCB3ZSBjYW5ub3QgY2hvb3NlIHRoZSBzaW1wbGUg
ImxlYXN0IGNvbW1vbiBhbmNlc3RvciIKLy8gZm9yIHB1cnBvc2VzIG9mIGEgbWVyZ2UsIGJlY2F1
c2UgaXQgaXMgcG9zc2libGUgdGhhdCB0aGVyZSBhcmUgdHdvCi8vIGVxdWFsbHkgcmVhY2hhYmxl
IGNvbW1vbiBhbmNlc3RvcnMsIGFuZCB0aGlzIHByb2R1Y2VzIGFtYmlndWl0eSBpbiB0aGUKLy8g
bWVyZ2UuIHRoZSByZXN1bHQgLS0gaW4gYSBwYXRob2xvZ2ljYWwgY2FzZSAtLSBpcyBzaWxlbnRs
eSBhY2NlcHRpbmcgb25lCi8vIHNldCBvZiBlZGl0cyB3aGlsZSBkaXNjYXJkaW5nIGFub3RoZXI7
IG5vdCBleGFjdGx5IHdoYXQgeW91IHdhbnQgYQovLyB2ZXJzaW9uIGNvbnRyb2wgdG9vbCB0byBk
by4KLy8KLy8gYSBjb25zZXJ2YXRpdmUgYXBwcm94aW1hdGlvbiBpcyB3aGF0IHdlJ2xsIGNhbGwg
YSAic3ViZ3JhcGggcmVjdXJyaW5nIgovLyBMQ0EgYWxnb3JpdGhtLiB0aGlzIGlzIHNvbWV3aGF0
IGxpa2UgbG9jYXRpbmcgdGhlIGxlYXN0IGNvbW1vbiBkb21pbmF0b3IKLy8gbm9kZSwgYnV0IG5v
dCBxdWl0ZS4gaXQgaXMgYWN0dWFsbHkganVzdCBhIHZhbmlsbGEgTENBIHNlYXJjaCwgZXhjZXB0
Ci8vIHRoYXQgYW55IHRpbWUgdGhlcmUncyBhIGZvcmsgKGEgaGlzdG9yaWNhbCBtZXJnZSBsb29r
cyBsaWtlIGEgZm9yayBmcm9tCi8vIG91ciBwZXJzcGVjdGl2ZSwgd29ya2luZyBiYWNrd2FyZHMg
ZnJvbSBjaGlsZHJlbiB0byBwYXJlbnRzKSBpdCByZWR1Y2VzCi8vIHRoZSBmb3JrIHRvIGEgY29t
bW9uIHBhcmVudCB2aWEgYSBzZXF1ZW5jZSBvZiBwYWlyd2lzZSByZWN1cnNpdmUgY2FsbHMKLy8g
dG8gaXRzZWxmIGJlZm9yZSBwcm9jZWVkaW5nLiB0aGlzIHdpbGwgYWx3YXlzIHJlc29sdmUgdG8g
YSBjb21tb24gcGFyZW50Ci8vIHdpdGggbm8gYW1iaWd1aXR5LCB1bmxlc3MgaXQgZmFsbHMgb2Zm
IHRoZSByb290IG9mIHRoZSBncmFwaC4KLy8KLy8gdW5mb3J0dW5hdGVseSB0aGUgc3ViZ3JhcGgg
cmVjdXJyaW5nIGFsZ29yaXRobSBzb21ldGltZXMgZ29lcyB0b28gZmFyCi8vIGJhY2sgaW4gaGlz
dG9yeSAtLSBmb3IgZXhhbXBsZSBpZiB0aGVyZSBpcyBhbiB1bmFtYmlndW91cyBwcm9wYWdhdGUg
ZnJvbQovLyBvbmUgYnJhbmNoIHRvIGFub3RoZXIsIHRoZSBlbnRpcmUgc3ViZ3JhcGggcHJlY2Vl
ZGluZyB0aGUgcHJvcGFnYXRlIG9uCi8vIHRoZSByZWNpcGllbnQgYnJhbmNoIGlzIGVsaWRlZCwg
c2luY2UgaXQgaXMgYSBtZXJnZS4KLy8KLy8gb3VyIGN1cnJlbnQgaHlwb3RoZXNpcyBpcyB0aGF0
IHRoZSAqZXhhY3QqIGNvbmRpdGlvbiB3ZSdyZSBsb29raW5nIGZvciwKLy8gd2hlbiBkb2luZyBh
IG1lcmdlLCBpcyB0aGUgbGVhc3Qgbm9kZSB3aGljaCBkb21pbmF0ZXMgb25lIHNpZGUgb2YgdGhl
Ci8vIG1lcmdlIGFuZCBpcyBhbiBhbmNlc3RvciBvZiB0aGUgb3RoZXIuCgp0eXBlZGVmIHVuc2ln
bmVkIGxvbmcgY3R4Owp0eXBlZGVmIGJvb3N0OjpkeW5hbWljX2JpdHNldDw+IGJpdG1hcDsKdHlw
ZWRlZiBib29zdDo6c2hhcmVkX3B0cjxiaXRtYXA+IHNoYXJlZF9iaXRtYXA7CgpzdGF0aWMgdm9p
ZCAKZW5zdXJlX3BhcmVudHNfbG9hZGVkKGN0eCBjaGlsZCwKICAgICAgICAgICAgICAgICAgICAg
IHN0ZDo6bWFwPGN0eCwgc2hhcmVkX2JpdG1hcD4gJiBwYXJlbnRzLAogICAgICAgICAgICAgICAg
ICAgICAgaW50ZXJuZXI8Y3R4PiAmIGludGVybiwKICAgICAgICAgICAgICAgICAgICAgIGFwcF9z
dGF0ZSAmIGFwcCkKewogIGlmIChwYXJlbnRzLmZpbmQoY2hpbGQpICE9IHBhcmVudHMuZW5kKCkp
CiAgICByZXR1cm47CgogIEwoRigibG9hZGluZyBwYXJlbnRzIGZvciBub2RlICVkXG4iKSAlIGNo
aWxkKTsKCiAgc3RkOjpzZXQ8cmV2aXNpb25faWQ+IGltbV9wYXJlbnRzOwogIGFwcC5kYi5nZXRf
cmV2aXNpb25fcGFyZW50cyhyZXZpc2lvbl9pZChpbnRlcm4ubG9va3VwKGNoaWxkKSksIGltbV9w
YXJlbnRzKTsKCiAgLy8gVGhlIG51bGwgcmV2aXNpb24gaXMgbm90IGEgcGFyZW50IGZvciBwdXJw
b3NlcyBvZiBmaW5kaW5nIGNvbW1vbgogIC8vIGFuY2VzdG9ycy4KICBmb3IgKHN0ZDo6c2V0PHJl
dmlzaW9uX2lkPjo6aXRlcmF0b3IgcCA9IGltbV9wYXJlbnRzLmJlZ2luKCk7CiAgICAgICBwICE9
IGltbV9wYXJlbnRzLmVuZCgpOyArK3ApCiAgICB7CiAgICAgIGlmIChudWxsX2lkKCpwKSkKICAg
ICAgICBpbW1fcGFyZW50cy5lcmFzZShwKTsKICAgIH0KICAgICAgICAgICAgICAKICBzaGFyZWRf
Yml0bWFwIGJpdHMgPSBzaGFyZWRfYml0bWFwKG5ldyBiaXRtYXAocGFyZW50cy5zaXplKCkpKTsK
ICAKICBmb3IgKHN0ZDo6c2V0PHJldmlzaW9uX2lkPjo6Y29uc3RfaXRlcmF0b3IgcCA9IGltbV9w
YXJlbnRzLmJlZ2luKCk7CiAgICAgICBwICE9IGltbV9wYXJlbnRzLmVuZCgpOyArK3ApCiAgICB7
CiAgICAgIGN0eCBwbiA9IGludGVybi5pbnRlcm4ocC0+aW5uZXIoKSgpKTsKICAgICAgTChGKCJw
YXJlbnQgJXMgLT4gbm9kZSAlZFxuIikgJSAqcCAlIHBuKTsKICAgICAgaWYgKHBuID49IGJpdHMt
PnNpemUoKSkgCiAgICAgICAgYml0cy0+cmVzaXplKHBuKzEpOwogICAgICBiaXRzLT5zZXQocG4p
OwogICAgfQogICAgCiAgcGFyZW50cy5pbnNlcnQoc3RkOjptYWtlX3BhaXIoY2hpbGQsIGJpdHMp
KTsKfQoKc3RhdGljIGJvb2wgCmV4cGFuZF9kb21pbmF0b3JzKHN0ZDo6bWFwPGN0eCwgc2hhcmVk
X2JpdG1hcD4gJiBwYXJlbnRzLAogICAgICAgICAgICAgICAgICBzdGQ6Om1hcDxjdHgsIHNoYXJl
ZF9iaXRtYXA+ICYgZG9taW5hdG9ycywKICAgICAgICAgICAgICAgICAgaW50ZXJuZXI8Y3R4PiAm
IGludGVybiwKICAgICAgICAgICAgICAgICAgYXBwX3N0YXRlICYgYXBwKQp7CiAgYm9vbCBzb21l
dGhpbmdfY2hhbmdlZCA9IGZhbHNlOwogIHN0ZDo6dmVjdG9yPGN0eD4gbm9kZXM7CgogIG5vZGVz
LnJlc2VydmUoZG9taW5hdG9ycy5zaXplKCkpOwoKICAvLyBwYXNzIDEsIHB1bGwgb3V0IGFsbCB0
aGUgbm9kZSBudW1iZXJzIHdlJ3JlIGdvaW5nIHRvIHNjYW4gdGhpcyB0aW1lIGFyb3VuZAogIGZv
ciAoc3RkOjptYXA8Y3R4LCBzaGFyZWRfYml0bWFwPjo6Y29uc3RfaXRlcmF0b3IgZSA9IGRvbWlu
YXRvcnMuYmVnaW4oKTsgCiAgICAgICBlICE9IGRvbWluYXRvcnMuZW5kKCk7ICsrZSkKICAgIG5v
ZGVzLnB1c2hfYmFjayhlLT5maXJzdCk7CiAgCiAgLy8gcGFzcyAyLCB1cGRhdGUgYW55IG9mIHRo
ZSBkb21pbmF0b3IgZW50cmllcyB3ZSBjYW4KICBmb3IgKHN0ZDo6dmVjdG9yPGN0eD46OmNvbnN0
X2l0ZXJhdG9yIG4gPSBub2Rlcy5iZWdpbigpOyAKICAgICAgIG4gIT0gbm9kZXMuZW5kKCk7ICsr
bikKICAgIHsKICAgICAgc2hhcmVkX2JpdG1hcCBiaXRzID0gZG9taW5hdG9yc1sqbl07CiAgICAg
IGJpdG1hcCBzYXZlZCgqYml0cyk7CiAgICAgIGlmIChiaXRzLT5zaXplKCkgPD0gKm4pCiAgICAg
ICAgYml0cy0+cmVzaXplKCpuICsgMSk7CiAgICAgIGJpdHMtPnNldCgqbik7CiAgICAgIAogICAg
ICBlbnN1cmVfcGFyZW50c19sb2FkZWQoKm4sIHBhcmVudHMsIGludGVybiwgYXBwKTsKICAgICAg
c2hhcmVkX2JpdG1hcCBuX3BhcmVudHMgPSBwYXJlbnRzWypuXTsKICAgICAgCiAgICAgIGJpdG1h
cCBpbnRlcnNlY3Rpb24oYml0cy0+c2l6ZSgpKTsKICAgICAgCiAgICAgIGJvb2wgZmlyc3QgPSB0
cnVlOwogICAgICBmb3IgKHVuc2lnbmVkIGxvbmcgcGFyZW50ID0gMDsgCiAgICAgICAgICAgcGFy
ZW50ICE9IG5fcGFyZW50cy0+c2l6ZSgpOyArK3BhcmVudCkKICAgICAgICB7CiAgICAgICAgICBp
ZiAoISBuX3BhcmVudHMtPnRlc3QocGFyZW50KSkKICAgICAgICAgICAgY29udGludWU7CgogICAg
ICAgICAgaWYgKGRvbWluYXRvcnMuZmluZChwYXJlbnQpID09IGRvbWluYXRvcnMuZW5kKCkpCiAg
ICAgICAgICAgIGRvbWluYXRvcnMuaW5zZXJ0KHN0ZDo6bWFrZV9wYWlyKHBhcmVudCwgCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYXJlZF9iaXRtYXAobmV3
IGJpdG1hcCgpKSkpOwogICAgICAgICAgc2hhcmVkX2JpdG1hcCBwYml0cyA9IGRvbWluYXRvcnNb
cGFyZW50XTsKCiAgICAgICAgICBpZiAoYml0cy0+c2l6ZSgpID4gcGJpdHMtPnNpemUoKSkKICAg
ICAgICAgICAgcGJpdHMtPnJlc2l6ZShiaXRzLT5zaXplKCkpOwoKICAgICAgICAgIGlmIChwYml0
cy0+c2l6ZSgpID4gYml0cy0+c2l6ZSgpKQogICAgICAgICAgICBiaXRzLT5yZXNpemUocGJpdHMt
PnNpemUoKSk7CgogICAgICAgICAgaWYgKGZpcnN0KQogICAgICAgICAgICB7CiAgICAgICAgICAg
ICAgaW50ZXJzZWN0aW9uID0gKCpwYml0cyk7CiAgICAgICAgICAgICAgZmlyc3QgPSBmYWxzZTsK
ICAgICAgICAgICAgfQogICAgICAgICAgZWxzZQogICAgICAgICAgICBpbnRlcnNlY3Rpb24gJj0g
KCpwYml0cyk7CiAgICAgICAgfQoKICAgICAgKCpiaXRzKSB8PSBpbnRlcnNlY3Rpb247CiAgICAg
IGlmICgqYml0cyAhPSBzYXZlZCkKICAgICAgICBzb21ldGhpbmdfY2hhbmdlZCA9IHRydWU7CiAg
ICB9CiAgcmV0dXJuIHNvbWV0aGluZ19jaGFuZ2VkOwp9CgoKc3RhdGljIGJvb2wgCmV4cGFuZF9h
bmNlc3RvcnMoc3RkOjptYXA8Y3R4LCBzaGFyZWRfYml0bWFwPiAmIHBhcmVudHMsCiAgICAgICAg
ICAgICAgICAgc3RkOjptYXA8Y3R4LCBzaGFyZWRfYml0bWFwPiAmIGFuY2VzdG9ycywKICAgICAg
ICAgICAgICAgICBpbnRlcm5lcjxjdHg+ICYgaW50ZXJuLAogICAgICAgICAgICAgICAgIGFwcF9z
dGF0ZSAmIGFwcCkKewogIGJvb2wgc29tZXRoaW5nX2NoYW5nZWQgPSBmYWxzZTsKICBzdGQ6OnZl
Y3RvcjxjdHg+IG5vZGVzOwoKICBub2Rlcy5yZXNlcnZlKGFuY2VzdG9ycy5zaXplKCkpOwoKICAv
LyBwYXNzIDEsIHB1bGwgb3V0IGFsbCB0aGUgbm9kZSBudW1iZXJzIHdlJ3JlIGdvaW5nIHRvIHNj
YW4gdGhpcyB0aW1lIGFyb3VuZAogIGZvciAoc3RkOjptYXA8Y3R4LCBzaGFyZWRfYml0bWFwPjo6
Y29uc3RfaXRlcmF0b3IgZSA9IGFuY2VzdG9ycy5iZWdpbigpOyAKICAgICAgIGUgIT0gYW5jZXN0
b3JzLmVuZCgpOyArK2UpCiAgICBub2Rlcy5wdXNoX2JhY2soZS0+Zmlyc3QpOwogIAogIC8vIHBh
c3MgMiwgdXBkYXRlIGFueSBvZiB0aGUgYW5jZXN0b3IgZW50cmllcyB3ZSBjYW4KICBmb3IgKHN0
ZDo6dmVjdG9yPGN0eD46OmNvbnN0X2l0ZXJhdG9yIG4gPSBub2Rlcy5iZWdpbigpOyBuICE9IG5v
ZGVzLmVuZCgpOyArK24pCiAgICB7CiAgICAgIHNoYXJlZF9iaXRtYXAgYml0cyA9IGFuY2VzdG9y
c1sqbl07CiAgICAgIGJpdG1hcCBzYXZlZCgqYml0cyk7CiAgICAgIGlmIChiaXRzLT5zaXplKCkg
PD0gKm4pCiAgICAgICAgYml0cy0+cmVzaXplKCpuICsgMSk7CiAgICAgIGJpdHMtPnNldCgqbik7
CgogICAgICBlbnN1cmVfcGFyZW50c19sb2FkZWQoKm4sIHBhcmVudHMsIGludGVybiwgYXBwKTsK
ICAgICAgc2hhcmVkX2JpdG1hcCBuX3BhcmVudHMgPSBwYXJlbnRzWypuXTsKICAgICAgZm9yIChj
dHggcGFyZW50ID0gMDsgcGFyZW50ICE9IG5fcGFyZW50cy0+c2l6ZSgpOyArK3BhcmVudCkKICAg
ICAgICB7CiAgICAgICAgICBpZiAoISBuX3BhcmVudHMtPnRlc3QocGFyZW50KSkKICAgICAgICAg
ICAgY29udGludWU7CgogICAgICAgICAgaWYgKGJpdHMtPnNpemUoKSA8PSBwYXJlbnQpCiAgICAg
ICAgICAgIGJpdHMtPnJlc2l6ZShwYXJlbnQgKyAxKTsKICAgICAgICAgIGJpdHMtPnNldChwYXJl
bnQpOwoKICAgICAgICAgIGlmIChhbmNlc3RvcnMuZmluZChwYXJlbnQpID09IGFuY2VzdG9ycy5l
bmQoKSkKICAgICAgICAgICAgYW5jZXN0b3JzLmluc2VydChtYWtlX3BhaXIocGFyZW50LCAKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYXJlZF9iaXRtYXAobmV3IGJp
dG1hcCgpKSkpOwogICAgICAgICAgc2hhcmVkX2JpdG1hcCBwYml0cyA9IGFuY2VzdG9yc1twYXJl
bnRdOwoKICAgICAgICAgIGlmIChiaXRzLT5zaXplKCkgPiBwYml0cy0+c2l6ZSgpKQogICAgICAg
ICAgICBwYml0cy0+cmVzaXplKGJpdHMtPnNpemUoKSk7CgogICAgICAgICAgaWYgKHBiaXRzLT5z
aXplKCkgPiBiaXRzLT5zaXplKCkpCiAgICAgICAgICAgIGJpdHMtPnJlc2l6ZShwYml0cy0+c2l6
ZSgpKTsKCiAgICAgICAgICAoKmJpdHMpIHw9ICgqcGJpdHMpOwogICAgICAgIH0KICAgICAgaWYg
KCpiaXRzICE9IHNhdmVkKQogICAgICAgIHNvbWV0aGluZ19jaGFuZ2VkID0gdHJ1ZTsKICAgIH0K
ICByZXR1cm4gc29tZXRoaW5nX2NoYW5nZWQ7Cn0KCnN0YXRpYyBib29sIApmaW5kX2ludGVyc2Vj
dGluZ19ub2RlKGJpdG1hcCAmIGZzdCwgCiAgICAgICAgICAgICAgICAgICAgICAgYml0bWFwICYg
c25kLCAKICAgICAgICAgICAgICAgICAgICAgICBpbnRlcm5lcjxjdHg+IGNvbnN0ICYgaW50ZXJu
LCAKICAgICAgICAgICAgICAgICAgICAgICByZXZpc2lvbl9pZCAmIGFuYykKewogIAogIGlmIChm
c3Quc2l6ZSgpID4gc25kLnNpemUoKSkKICAgIHNuZC5yZXNpemUoZnN0LnNpemUoKSk7CiAgZWxz
ZSBpZiAoc25kLnNpemUoKSA+IGZzdC5zaXplKCkpCiAgICBmc3QucmVzaXplKHNuZC5zaXplKCkp
OwogIAogIGJpdG1hcCBpbnRlcnNlY3Rpb24gPSBmc3QgJiBzbmQ7CiAgaWYgKGludGVyc2VjdGlv
bi5hbnkoKSkKICAgIHsKICAgICAgTChGKCJmb3VuZCAlZCBpbnRlcnNlY3Rpbmcgbm9kZXNcbiIp
ICUgaW50ZXJzZWN0aW9uLmNvdW50KCkpOwogICAgICBmb3IgKGN0eCBpID0gMDsgaSA8IGludGVy
c2VjdGlvbi5zaXplKCk7ICsraSkKICAgICAgICB7CiAgICAgICAgICBpZiAoaW50ZXJzZWN0aW9u
LnRlc3QoaSkpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBhbmMgPSByZXZpc2lvbl9pZChp
bnRlcm4ubG9va3VwKGkpKTsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAg
fQogICAgICAgIH0KICAgIH0KICByZXR1cm4gZmFsc2U7Cn0KCi8vICBzdGF0aWMgdm9pZAovLyAg
ZHVtcF9iaXRzZXRfbWFwKHN0cmluZyBjb25zdCAmIGhkciwKLy8gICAgICAgICAgICAgIHN0ZDo6
bWFwPCBjdHgsIHNoYXJlZF9iaXRtYXAgPiBjb25zdCAmIG1tKQovLyAgewovLyAgICBMKEYoImR1
bXBpbmcgWyVzXSAoJWQgZW50cmllcylcbiIpICUgaGRyICUgbW0uc2l6ZSgpKTsKLy8gICAgZm9y
IChzdGQ6Om1hcDwgY3R4LCBzaGFyZWRfYml0bWFwID46OmNvbnN0X2l0ZXJhdG9yIGkgPSBtbS5i
ZWdpbigpOwovLyAgICAgICAgIGkgIT0gbW0uZW5kKCk7ICsraSkKLy8gICAgICB7Ci8vICAgICAg
ICBMKEYoImR1bXAgWyVzXTogJWQgLT4gJXNcbiIpICUgaGRyICUgaS0+Zmlyc3QgJSAoKihpLT5z
ZWNvbmQpKSk7Ci8vICAgICAgfQovLyAgfQoKYm9vbCAKZmluZF9jb21tb25fYW5jZXN0b3IocmV2
aXNpb25faWQgY29uc3QgJiBsZWZ0LAogICAgICAgICAgICAgICAgICAgICByZXZpc2lvbl9pZCBj
b25zdCAmIHJpZ2h0LAogICAgICAgICAgICAgICAgICAgICByZXZpc2lvbl9pZCAmIGFuYywKICAg
ICAgICAgICAgICAgICAgICAgYXBwX3N0YXRlICYgYXBwKQp7CiAgaW50ZXJuZXI8Y3R4PiBpbnRl
cm47CiAgc3RkOjptYXA8IGN0eCwgc2hhcmVkX2JpdG1hcCA+IAogICAgcGFyZW50cywgYW5jZXN0
b3JzLCBkb21pbmF0b3JzOwogIAogIGN0eCBsbiA9IGludGVybi5pbnRlcm4obGVmdC5pbm5lcigp
KCkpOwogIGN0eCBybiA9IGludGVybi5pbnRlcm4ocmlnaHQuaW5uZXIoKSgpKTsKICAKICBzaGFy
ZWRfYml0bWFwIGxhbmMgPSBzaGFyZWRfYml0bWFwKG5ldyBiaXRtYXAoKSk7CiAgc2hhcmVkX2Jp
dG1hcCByYW5jID0gc2hhcmVkX2JpdG1hcChuZXcgYml0bWFwKCkpOwogIHNoYXJlZF9iaXRtYXAg
bGRvbSA9IHNoYXJlZF9iaXRtYXAobmV3IGJpdG1hcCgpKTsKICBzaGFyZWRfYml0bWFwIHJkb20g
PSBzaGFyZWRfYml0bWFwKG5ldyBiaXRtYXAoKSk7CgogIGFuY2VzdG9ycy5pbnNlcnQobWFrZV9w
YWlyKGxuLCBsYW5jKSk7CiAgYW5jZXN0b3JzLmluc2VydChtYWtlX3BhaXIocm4sIHJhbmMpKTsK
ICBkb21pbmF0b3JzLmluc2VydChtYWtlX3BhaXIobG4sIGxkb20pKTsKICBkb21pbmF0b3JzLmlu
c2VydChtYWtlX3BhaXIocm4sIHJkb20pKTsKICAKICBMKEYoInNlYXJjaGluZyBmb3IgY29tbW9u
IGFuY2VzdG9yLCBsZWZ0PSVzIHJpZ2h0PSVzXG4iKSAlIGxlZnQgJSByaWdodCk7CiAgCiAgd2hp
bGUgKGV4cGFuZF9hbmNlc3RvcnMocGFyZW50cywgYW5jZXN0b3JzLCBpbnRlcm4sIGFwcCkgfHwK
ICAgICAgICAgZXhwYW5kX2RvbWluYXRvcnMocGFyZW50cywgZG9taW5hdG9ycywgaW50ZXJuLCBh
cHApKQogICAgewogICAgICBMKEYoImNvbW1vbiBhbmNlc3RvciBzY2FuIFtwYXI9JWQsYW5jPSVk
LGRvbT0lZF1cbiIpICUgCiAgICAgICAgcGFyZW50cy5zaXplKCkgJSBhbmNlc3RvcnMuc2l6ZSgp
ICUgZG9taW5hdG9ycy5zaXplKCkpOwoKICAgICAgaWYgKGZpbmRfaW50ZXJzZWN0aW5nX25vZGUo
KmxhbmMsICpyZG9tLCBpbnRlcm4sIGFuYykpCiAgICAgICAgewogICAgICAgICAgTChGKCJmb3Vu
ZCBub2RlICVkLCBhbmNlc3RvciBvZiBsZWZ0ICVzIGFuZCBkb21pbmF0aW5nIHJpZ2h0ICVzXG4i
KQogICAgICAgICAgICAlIGFuYyAlIGxlZnQgJSByaWdodCk7CiAgICAgICAgICByZXR1cm4gdHJ1
ZTsKICAgICAgICB9CiAgICAgIAogICAgICBlbHNlIGlmIChmaW5kX2ludGVyc2VjdGluZ19ub2Rl
KCpyYW5jLCAqbGRvbSwgaW50ZXJuLCBhbmMpKQogICAgICAgIHsKICAgICAgICAgIEwoRigiZm91
bmQgbm9kZSAlZCwgYW5jZXN0b3Igb2YgcmlnaHQgJXMgYW5kIGRvbWluYXRpbmcgbGVmdCAlc1xu
IikKICAgICAgICAgICAgJSBhbmMgJSByaWdodCAlIGxlZnQpOwogICAgICAgICAgcmV0dXJuIHRy
dWU7CiAgICAgICAgfQogICAgfQovLyAgICAgIGR1bXBfYml0c2V0X21hcCgiYW5jZXN0b3JzIiwg
YW5jZXN0b3JzKTsKLy8gICAgICBkdW1wX2JpdHNldF9tYXAoImRvbWluYXRvcnMiLCBkb21pbmF0
b3JzKTsKLy8gICAgICBkdW1wX2JpdHNldF9tYXAoInBhcmVudHMiLCBwYXJlbnRzKTsKICByZXR1
cm4gZmFsc2U7Cn0KCgovLyAKLy8gVGhlIGlkZWEgd2l0aCB0aGlzIGFsZ29yaXRobSBpcyB0byB3
YWxrIGZyb20gY2hpbGQgdXAgdG8gYW5jZXN0b3IsCi8vIHJlY3Vyc2l2ZWx5LCBhY2N1bXVsYXRp
bmcgYWxsIHRoZSBjaGFuZ2Vfc2V0cyBhc3NvY2lhdGVkIHdpdGgKLy8gaW50ZXJtZWRpYXRlIG5v
ZGVzIGludG8gKm9uZSBiaWcgY2hhbmdlX3NldCouCi8vCi8vIGNsZXZlciByZWFkZXJzIHdpbGwg
cmVhbGl6ZSB0aGlzIGlzIGFuIG92ZXJsYXBwaW5nLXN1YnByb2JsZW0gdHlwZQovLyBzaXR1YXRp
b24gYW5kIHRodXMgbmVlZHMgdG8ga2VlcCBhIGR5bmFtaWMgcHJvZ3JhbW1pbmcgbWFwIHRvIGtl
ZXAKLy8gaXRzZWxmIGluIGxpbmVhciBjb21wbGV4aXR5LgovLwovLyBpbiBmYWN0LCB3ZSBrZWVw
IHR3bzogb25lIHdoaWNoIG1hcHMgdG8gY29tcHV0ZWQgcmVzdWx0cyAocGFydGlhbF9jc2V0cykK
Ly8gYW5kIG9uZSB3aGljaCBqdXN0IGtlZXBzIGEgc2V0IG9mIGFsbCBub2RlcyB3ZSB0cmF2ZXJz
ZWQKLy8gKHZpc2l0ZWRfbm9kZXMpLiBpbiB0aGVvcnkgaXQgY291bGQgYmUgb25lIG1hcCB3aXRo
IGFuIGV4dHJhIGJvb2wgc3R1Y2sKLy8gb24gZWFjaCBlbnRyeSwgYnV0IEkgdGhpbmsgdGhhdCB3
b3VsZCBtYWtlIGl0IGV2ZW4gbGVzcyByZWFkYWJsZS4gaXQncwovLyBhbHJlYWR5IHF1aXRlIHVn
bHkuCi8vCgpzdGF0aWMgYm9vbCAKY2FsY3VsYXRlX2NoYW5nZV9zZXRzX3JlY3Vyc2l2ZShyZXZp
c2lvbl9pZCBjb25zdCAmIGFuY2VzdG9yLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHJldmlzaW9uX2lkIGNvbnN0ICYgY2hpbGQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgYXBwX3N0YXRlICYgYXBwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5n
ZV9zZXQgJiBjdW11bGF0aXZlX2NzZXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
c3RkOjptYXA8cmV2aXNpb25faWQsIGJvb3N0OjpzaGFyZWRfcHRyPGNoYW5nZV9zZXQ+ID4gJiBw
YXJ0aWFsX2NzZXRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZDo6c2V0PHJl
dmlzaW9uX2lkPiAmIHZpc2l0ZWRfbm9kZXMpCnsKCiAgaWYgKGFuY2VzdG9yID09IGNoaWxkKQog
ICAgcmV0dXJuIHRydWU7CgogIHZpc2l0ZWRfbm9kZXMuaW5zZXJ0KGNoaWxkKTsKCiAgYm9vbCBy
ZWxldmFudF9jaGlsZCA9IGZhbHNlOwoKICByZXZpc2lvbl9zZXQgcmV2OwogIGFwcC5kYi5nZXRf
cmV2aXNpb24oY2hpbGQsIHJldik7CgogIEwoRigiZXhwbG9yaW5nIGNoYW5nZXNldHMgZnJvbSBw
YXJlbnRzIG9mICVzLCBzZWVraW5nIHRvd2FyZHMgJXNcbiIpIAogICAgJSBjaGlsZCAlIGFuY2Vz
dG9yKTsKCiAgZm9yKGVkZ2VfbWFwOjpjb25zdF9pdGVyYXRvciBpID0gcmV2LmVkZ2VzLmJlZ2lu
KCk7IGkgIT0gcmV2LmVkZ2VzLmVuZCgpOyArK2kpCiAgICB7CiAgICAgIGJvb2wgcmVsZXZhbnRf
cGFyZW50ID0gZmFsc2U7CiAgICAgIHJldmlzaW9uX2lkIGN1cnJfcGFyZW50ID0gZWRnZV9vbGRf
cmV2aXNpb24oaSk7CgogICAgICBpZiAoY3Vycl9wYXJlbnQuaW5uZXIoKSgpLmVtcHR5KCkpCiAg
ICAgICAgY29udGludWU7CgogICAgICBjaGFuZ2Vfc2V0IGNzZXRfdG9fY3Vycl9wYXJlbnQ7Cgog
ICAgICBMKEYoImNvbnNpZGVyaW5nIHBhcmVudCAlcyBvZiAlc1xuIikgJSBjdXJyX3BhcmVudCAl
IGNoaWxkKTsKCiAgICAgIHN0ZDo6bWFwPHJldmlzaW9uX2lkLCBib29zdDo6c2hhcmVkX3B0cjxj
aGFuZ2Vfc2V0PiA+Ojpjb25zdF9pdGVyYXRvciBqID0gCiAgICAgICAgcGFydGlhbF9jc2V0cy5m
aW5kKGN1cnJfcGFyZW50KTsKICAgICAgaWYgKGogIT0gcGFydGlhbF9jc2V0cy5lbmQoKSkgCiAg
ICAgICAgewogICAgICAgICAgLy8gYSByZWN1cnNpdmUgY2FsbCBoYXMgdHJhdmVyc2VkIHRoaXMg
cGFyZW50IGJlZm9yZSBhbmQgYnVpbHQgYW4KICAgICAgICAgIC8vIGV4aXN0aW5nIGNzZXQuIGp1
c3QgcmV1c2UgdGhhdCByYXRoZXIgdGhhbiByZS10cmF2ZXJzaW5nCiAgICAgICAgICBjc2V0X3Rv
X2N1cnJfcGFyZW50ID0gKihqLT5zZWNvbmQpOwogICAgICAgICAgcmVsZXZhbnRfcGFyZW50ID0g
dHJ1ZTsKICAgICAgICB9CiAgICAgIGVsc2UgaWYgKHZpc2l0ZWRfbm9kZXMuZmluZChjdXJyX3Bh
cmVudCkgIT0gdmlzaXRlZF9ub2Rlcy5lbmQoKSkKICAgICAgICB7CiAgICAgICAgICAvLyBhIHJl
Y3Vyc2l2ZSBjYWxsIGhhcyB0cmF2ZXJzZWQgdGhpcyBwYXJlbnQsIGJ1dCB0aGVyZSB3YXMgbm8K
ICAgICAgICAgIC8vIHBhdGggZnJvbSBpdCB0byB0aGUgcm9vdCwgc28gdGhlIHBhcmVudCBpcyBp
cnJlbGV2YW50LiBza2lwLgogICAgICAgICAgcmVsZXZhbnRfcGFyZW50ID0gZmFsc2U7CiAgICAg
ICAgfQogICAgICBlbHNlCiAgICAgICAgcmVsZXZhbnRfcGFyZW50ID0gY2FsY3VsYXRlX2NoYW5n
ZV9zZXRzX3JlY3Vyc2l2ZShhbmNlc3RvciwgY3Vycl9wYXJlbnQsIGFwcCwgCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjc2V0X3RvX2N1
cnJfcGFyZW50LCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHBhcnRpYWxfY3NldHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXNpdGVkX25vZGVzKTsKCiAgICAgIGlmIChy
ZWxldmFudF9wYXJlbnQpCiAgICAgICAgewogICAgICAgICAgTChGKCJyZXZpc2lvbiAlcyBpcyBy
ZWxldmFudCwgY29tcG9zaW5nIHdpdGggZWRnZSB0byAlc1xuIikgCiAgICAgICAgICAgICUgY3Vy
cl9wYXJlbnQgJSBjaGlsZCk7CiAgICAgICAgICBjb25jYXRlbmF0ZV9jaGFuZ2Vfc2V0cyhjc2V0
X3RvX2N1cnJfcGFyZW50LCBlZGdlX2NoYW5nZXMoaSksIGN1bXVsYXRpdmVfY3NldCk7CiAgICAg
ICAgICByZWxldmFudF9jaGlsZCA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAg
ICAgIGVsc2UKICAgICAgICBMKEYoInBhcmVudCAlcyBvZiAlcyBpcyBub3QgcmVsZXZhbnRcbiIp
ICUgY3Vycl9wYXJlbnQgJSBjaGlsZCk7CiAgICB9CgogIC8vIHN0b3JlIHRoZSBwYXJ0aWFsIGVk
Z2UgZnJvbSBhbmNlc3RvciAtPiBjaGlsZCwgc28gdGhhdCBpZiBhbnlvbmUKICAvLyByZS10cmF2
ZXJzZXMgdGhpcyBlZGdlIHRoZXknbGwganVzdCBmZXRjaCBmcm9tIHRoZSBwYXJ0aWFsX2VkZ2Vz
CiAgLy8gY2FjaGUuCiAgaWYgKHJlbGV2YW50X2NoaWxkKQogICAgcGFydGlhbF9jc2V0cy5pbnNl
cnQoc3RkOjptYWtlX3BhaXIoY2hpbGQsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgYm9vc3Q6OnNoYXJlZF9wdHI8Y2hhbmdlX3NldD4KICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIChuZXcgY2hhbmdlX3NldChjdW11bGF0aXZlX2NzZXQpKSkp
OwogIAogIHJldHVybiByZWxldmFudF9jaGlsZDsKfQoKdm9pZCAKY2FsY3VsYXRlX2NvbXBvc2l0
ZV9jaGFuZ2Vfc2V0KHJldmlzaW9uX2lkIGNvbnN0ICYgYW5jZXN0b3IsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICByZXZpc2lvbl9pZCBjb25zdCAmIGNoaWxkLAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgYXBwX3N0YXRlICYgYXBwLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgY2hhbmdlX3NldCAmIGNvbXBvc2VkKQp7CiAgTChGKCJjYWxjdWxhdGluZyBjb21w
b3NpdGUgY2hhbmdlc2V0IGJldHdlZW4gJXMgYW5kICVzXG4iKQogICAgJSBhbmNlc3RvciAlIGNo
aWxkKTsKICBzdGQ6OnNldDxyZXZpc2lvbl9pZD4gdmlzaXRlZDsKICBzdGQ6Om1hcDxyZXZpc2lv
bl9pZCwgYm9vc3Q6OnNoYXJlZF9wdHI8Y2hhbmdlX3NldD4gPiBwYXJ0aWFsOwogIGNhbGN1bGF0
ZV9jaGFuZ2Vfc2V0c19yZWN1cnNpdmUoYW5jZXN0b3IsIGNoaWxkLCBhcHAsIGNvbXBvc2VkLCBw
YXJ0aWFsLCB2aXNpdGVkKTsKfQoKLy8gbWlncmF0aW9uIHN0dWZmCi8vCi8vIEZJWE1FOiB0aGVz
ZSBhcmUgdGVtcG9yYXJ5IGZ1bmN0aW9ucywgb25jZSB3ZSd2ZSBkb25lIHRoZSBtaWdyYXRpb24g
dG8KLy8gcmV2aXNpb25zIC8gY2hhbmdlc2V0cywgd2UgY2FuIHJlbW92ZSB0aGVtLgoKc3RhdGlj
IHZvaWQgCmFuYWx5emVfbWFuaWZlc3RfY2hhbmdlcyhhcHBfc3RhdGUgJiBhcHAsCiAgICAgICAg
ICAgICAgICAgICAgICAgICBtYW5pZmVzdF9pZCBjb25zdCAmIHBhcmVudCwgCiAgICAgICAgICAg
ICAgICAgICAgICAgICBtYW5pZmVzdF9pZCBjb25zdCAmIGNoaWxkLCAKICAgICAgICAgICAgICAg
ICAgICAgICAgIGNoYW5nZV9zZXQgJiBjcykKewogIG1hbmlmZXN0X21hcCBtX3BhcmVudCwgbV9j
aGlsZDsKICBhcHAuZGIuZ2V0X21hbmlmZXN0KHBhcmVudCwgbV9wYXJlbnQpOwogIGFwcC5kYi5n
ZXRfbWFuaWZlc3QoY2hpbGQsIG1fY2hpbGQpOwoKICBmb3IgKG1hbmlmZXN0X21hcDo6Y29uc3Rf
aXRlcmF0b3IgaSA9IG1fcGFyZW50LmJlZ2luKCk7IAogICAgICAgaSAhPSBtX3BhcmVudC5lbmQo
KTsgKytpKQogICAgewogICAgICBtYW5pZmVzdF9tYXA6OmNvbnN0X2l0ZXJhdG9yIGogPSBtX2No
aWxkLmZpbmQobWFuaWZlc3RfZW50cnlfcGF0aChpKSk7CiAgICAgIGlmIChqID09IG1fY2hpbGQu
ZW5kKCkpCiAgICAgICAgY3MuZGVsZXRlX2ZpbGUobWFuaWZlc3RfZW50cnlfcGF0aChpKSk7CiAg
ICAgIGVsc2UgaWYgKCEgKG1hbmlmZXN0X2VudHJ5X2lkKGkpID09IG1hbmlmZXN0X2VudHJ5X2lk
KGopKSkKICAgICAgICB7CiAgICAgICAgICBjcy5hcHBseV9kZWx0YShtYW5pZmVzdF9lbnRyeV9w
YXRoKGkpLAogICAgICAgICAgICAgICAgICAgICAgICAgbWFuaWZlc3RfZW50cnlfaWQoaSksIAog
ICAgICAgICAgICAgICAgICAgICAgICAgbWFuaWZlc3RfZW50cnlfaWQoaikpOwogICAgICAgIH0g
ICAgICAgCiAgICB9CiAgZm9yIChtYW5pZmVzdF9tYXA6OmNvbnN0X2l0ZXJhdG9yIGkgPSBtX2No
aWxkLmJlZ2luKCk7IAogICAgICAgaSAhPSBtX2NoaWxkLmVuZCgpOyArK2kpCiAgICB7CiAgICAg
IG1hbmlmZXN0X21hcDo6Y29uc3RfaXRlcmF0b3IgaiA9IG1fcGFyZW50LmZpbmQobWFuaWZlc3Rf
ZW50cnlfcGF0aChpKSk7CiAgICAgIGlmIChqID09IG1fcGFyZW50LmVuZCgpKQogICAgICAgIGNz
LmFkZF9maWxlKG1hbmlmZXN0X2VudHJ5X3BhdGgoaSksCiAgICAgICAgICAgICAgICAgICAgbWFu
aWZlc3RfZW50cnlfaWQoaSkpOwogICAgfQp9CgpzdGF0aWMgcmV2aXNpb25faWQKY29uc3RydWN0
X3JldmlzaW9ucyhhcHBfc3RhdGUgJiBhcHAsCiAgICAgICAgICAgICAgICAgICAgbWFuaWZlc3Rf
aWQgY29uc3QgJiBjaGlsZCwKICAgICAgICAgICAgICAgICAgICBzdGQ6Om11bHRpbWFwPCBtYW5p
ZmVzdF9pZCwgbWFuaWZlc3RfaWQgPiBjb25zdCAmIGFuY2VzdHJ5LAogICAgICAgICAgICAgICAg
ICAgIHN0ZDo6bWFwPG1hbmlmZXN0X2lkLCByZXZpc2lvbl9pZD4gJiBtYXBwZWQpCnsKICByZXZp
c2lvbl9zZXQgcmV2OwogIHR5cGVkZWYgc3RkOjptdWx0aW1hcDwgbWFuaWZlc3RfaWQsIG1hbmlm
ZXN0X2lkID46OmNvbnN0X2l0ZXJhdG9yIGNpOwogIHN0ZDo6cGFpcjxjaSxjaT4gcmFuZ2UgPSBh
bmNlc3RyeS5lcXVhbF9yYW5nZShjaGlsZCk7CiAgZm9yIChjaSBpID0gcmFuZ2UuZmlyc3Q7IGkg
IT0gcmFuZ2Uuc2Vjb25kOyArK2kpCiAgICB7CiAgICAgIG1hbmlmZXN0X2lkIHBhcmVudChpLT5z
ZWNvbmQpOwogICAgICByZXZpc2lvbl9pZCBwYXJlbnRfcmlkOwogICAgICBzdGQ6Om1hcDxtYW5p
ZmVzdF9pZCwgcmV2aXNpb25faWQ+Ojpjb25zdF9pdGVyYXRvciBqID0gbWFwcGVkLmZpbmQocGFy
ZW50KTsKCiAgICAgIGlmIChqICE9IG1hcHBlZC5lbmQoKSkKICAgICAgICBwYXJlbnRfcmlkID0g
ai0+c2Vjb25kOwogICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgcGFyZW50X3JpZCA9IGNv
bnN0cnVjdF9yZXZpc2lvbnMoYXBwLCBwYXJlbnQsIGFuY2VzdHJ5LCBtYXBwZWQpOwogICAgICAg
ICAgUChGKCJpbnNlcnRpbmcgbWFwcGluZyAlZCA6ICVzIC0+ICVzXG4iKSAlIG1hcHBlZC5zaXpl
KCkgJSBwYXJlbnQgJSBwYXJlbnRfcmlkKTs7CiAgICAgICAgICBtYXBwZWQuaW5zZXJ0KHN0ZDo6
bWFrZV9wYWlyKHBhcmVudCwgcGFyZW50X3JpZCkpOwogICAgICAgIH0KICAgICAgCiAgICAgIGNo
YW5nZV9zZXQgY3M7CiAgICAgIGFuYWx5emVfbWFuaWZlc3RfY2hhbmdlcyhhcHAsIHBhcmVudCwg
Y2hpbGQsIGNzKTsKICAgICAgcmV2LmVkZ2VzLmluc2VydChzdGQ6Om1ha2VfcGFpcihwYXJlbnRf
cmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZDo6bWFrZV9wYWly
KHBhcmVudCwgY3MpKSk7CiAgICB9IAoKICByZXZpc2lvbl9pZCByaWQ7CiAgaWYgKHJldi5lZGdl
cy5lbXB0eSgpKQogICAgewogICAgICBQKEYoImlnbm9yaW5nIGVtcHR5IHJldmlzaW9uIGZvciBt
YW5pZmVzdCAlc1xuIikgJSBjaGlsZCk7ICAKICAgICAgcmV0dXJuIHJpZDsKICAgIH0KCiAgcmV2
Lm5ld19tYW5pZmVzdCA9IGNoaWxkOwogIGNhbGN1bGF0ZV9pZGVudChyZXYsIHJpZCk7CgogIGlm
ICghYXBwLmRiLnJldmlzaW9uX2V4aXN0cyAocmlkKSkKICAgIHsKICAgICAgUChGKCJtYXBwaW5n
IG1hbmlmZXN0ICVzIHRvIHJldmlzaW9uICVzXG4iKSAlIGNoaWxkICUgcmlkKTsKICAgICAgYXBw
LmRiLnB1dF9yZXZpc2lvbihyaWQsIHJldik7CiAgICB9CiAgZWxzZQogICAgewogICAgICBQKEYo
InNraXBwaW5nIGFkZGl0aW9uYWwgcGF0aCB0byByZXZpc2lvbiAlc1xuIikgJSByaWQpOwogICAg
fQoKICAvLyBub3cgaG9pc3QgYWxsIHRoZSBpbnRlcmVzdGluZyBjZXJ0cyB1cCB0byB0aGUgcmV2
aXNpb24KICBzdGQ6OnNldDxjZXJ0X25hbWU+IGNuYW1lczsKICBjbmFtZXMuaW5zZXJ0KGNlcnRf
bmFtZShicmFuY2hfY2VydF9uYW1lKSk7CiAgY25hbWVzLmluc2VydChjZXJ0X25hbWUoZGF0ZV9j
ZXJ0X25hbWUpKTsKICBjbmFtZXMuaW5zZXJ0KGNlcnRfbmFtZShhdXRob3JfY2VydF9uYW1lKSk7
CiAgY25hbWVzLmluc2VydChjZXJ0X25hbWUodGFnX2NlcnRfbmFtZSkpOwogIGNuYW1lcy5pbnNl
cnQoY2VydF9uYW1lKGNoYW5nZWxvZ19jZXJ0X25hbWUpKTsKICBjbmFtZXMuaW5zZXJ0KGNlcnRf
bmFtZShjb21tZW50X2NlcnRfbmFtZSkpOwogIGNuYW1lcy5pbnNlcnQoY2VydF9uYW1lKHRlc3Ry
ZXN1bHRfY2VydF9uYW1lKSk7CgogIHN0ZDo6dmVjdG9yPCBtYW5pZmVzdDxjZXJ0PiA+IHRtcDsK
ICBhcHAuZGIuZ2V0X21hbmlmZXN0X2NlcnRzKGNoaWxkLCB0bXApOwogIGVyYXNlX2JvZ3VzX2Nl
cnRzKHRtcCwgYXBwKTsgICAgICAKICBmb3IgKHN0ZDo6dmVjdG9yPCBtYW5pZmVzdDxjZXJ0PiA+
Ojpjb25zdF9pdGVyYXRvciBpID0gdG1wLmJlZ2luKCk7CiAgICAgICBpICE9IHRtcC5lbmQoKTsg
KytpKQogICAgewogICAgICBpZiAoY25hbWVzLmZpbmQoaS0+aW5uZXIoKS5uYW1lKSA9PSBjbmFt
ZXMuZW5kKCkpCiAgICAgICAgY29udGludWU7CiAgICAgIGNlcnQgbmV3X2NlcnQ7CiAgICAgIGNl
cnRfdmFsdWUgdHY7CiAgICAgIGRlY29kZV9iYXNlNjQoaS0+aW5uZXIoKS52YWx1ZSwgdHYpOwog
ICAgICBtYWtlX3NpbXBsZV9jZXJ0KHJpZC5pbm5lcigpLCBpLT5pbm5lcigpLm5hbWUsIHR2LCBh
cHAsIG5ld19jZXJ0KTsKICAgICAgaWYgKCEgYXBwLmRiLnJldmlzaW9uX2NlcnRfZXhpc3RzKHJl
dmlzaW9uPGNlcnQ+KG5ld19jZXJ0KSkpCiAgICAgICAgYXBwLmRiLnB1dF9yZXZpc2lvbl9jZXJ0
KHJldmlzaW9uPGNlcnQ+KG5ld19jZXJ0KSk7CiAgICB9CiAgcmV0dXJuIHJpZDsgIAp9CgoKdm9p
ZCAKYnVpbGRfY2hhbmdlc2V0cyhhcHBfc3RhdGUgJiBhcHApCnsKICBzdGQ6OnZlY3RvcjwgbWFu
aWZlc3Q8Y2VydD4gPiB0bXA7CiAgYXBwLmRiLmdldF9tYW5pZmVzdF9jZXJ0cyhjZXJ0X25hbWUo
ImFuY2VzdG9yIiksIHRtcCk7CiAgZXJhc2VfYm9ndXNfY2VydHModG1wLCBhcHApOwoKICBzdGQ6
Om11bHRpbWFwPCBtYW5pZmVzdF9pZCwgbWFuaWZlc3RfaWQgPiBhbmNlc3RyeTsKICBzdGQ6OnNl
dDxtYW5pZmVzdF9pZD4gaGVhZHM7CiAgc3RkOjpzZXQ8bWFuaWZlc3RfaWQ+IHRvdGFsOwogIAog
IGZvciAoc3RkOjp2ZWN0b3I8IG1hbmlmZXN0PGNlcnQ+ID46OmNvbnN0X2l0ZXJhdG9yIGkgPSB0
bXAuYmVnaW4oKTsKICAgICAgIGkgIT0gdG1wLmVuZCgpOyArK2kpCiAgICB7CiAgICAgIGNlcnRf
dmFsdWUgdHY7CiAgICAgIGRlY29kZV9iYXNlNjQoaS0+aW5uZXIoKS52YWx1ZSwgdHYpOwogICAg
ICBtYW5pZmVzdF9pZCBjaGlsZCwgcGFyZW50OwogICAgICBjaGlsZCA9IGktPmlubmVyKCkuaWRl
bnQ7CiAgICAgIHBhcmVudCA9IGhleGVuYzxpZD4odHYoKSk7CiAgICAgIGhlYWRzLmluc2VydChj
aGlsZCk7CiAgICAgIGhlYWRzLmVyYXNlKHBhcmVudCk7CiAgICAgIHRvdGFsLmluc2VydChjaGls
ZCk7CiAgICAgIHRvdGFsLmluc2VydChwYXJlbnQpOwogICAgICBhbmNlc3RyeS5pbnNlcnQoc3Rk
OjptYWtlX3BhaXIoY2hpbGQsIHBhcmVudCkpOwogICAgfQogIAogIFAoRigiZm91bmQgYSB0b3Rh
bCBvZiAlZCBtYW5pZmVzdHNcbiIpICUgdG90YWwuc2l6ZSgpKTsKCiAgdHJhbnNhY3Rpb25fZ3Vh
cmQgZ3VhcmQoYXBwLmRiKTsKICBzdGQ6Om1hcDxtYW5pZmVzdF9pZCwgcmV2aXNpb25faWQ+IG1h
cHBlZDsKICBmb3IgKHN0ZDo6c2V0PG1hbmlmZXN0X2lkPjo6Y29uc3RfaXRlcmF0b3IgaSA9IGhl
YWRzLmJlZ2luKCk7CiAgICAgICBpICE9IGhlYWRzLmVuZCgpOyArK2kpCiAgICB7CiAgICAgIGNv
bnN0cnVjdF9yZXZpc2lvbnMoYXBwLCAqaSwgYW5jZXN0cnksIG1hcHBlZCk7CiAgICB9CiAgZ3Vh
cmQuY29tbWl0KCk7Cn0KCgovLyBpL28gc3R1ZmYKCnN0ZDo6c3RyaW5nIHJldmlzaW9uX2ZpbGVf
bmFtZSgicmV2aXNpb24iKTsKCm5hbWVzcGFjZSAKewogIG5hbWVzcGFjZSBzeW1zCiAgewogICAg
c3RkOjpzdHJpbmcgY29uc3Qgb2xkX3JldmlzaW9uKCJvbGRfcmV2aXNpb24iKTsKICAgIHN0ZDo6
c3RyaW5nIGNvbnN0IG5ld19tYW5pZmVzdCgibmV3X21hbmlmZXN0Iik7CiAgICBzdGQ6OnN0cmlu
ZyBjb25zdCBvbGRfbWFuaWZlc3QoIm9sZF9tYW5pZmVzdCIpOwogIH0KfQoKCnZvaWQgCnByaW50
X2VkZ2UoYmFzaWNfaW86OnByaW50ZXIgJiBwcmludGVyLAogICAgICAgICAgIGVkZ2VfZW50cnkg
Y29uc3QgJiBlKQp7ICAgICAgIAogIGJhc2ljX2lvOjpzdGFuemEgc3Q7CiAgc3QucHVzaF9oZXhf
cGFpcihzeW1zOjpvbGRfcmV2aXNpb24sIGVkZ2Vfb2xkX3JldmlzaW9uKGUpLmlubmVyKCkoKSk7
CiAgc3QucHVzaF9oZXhfcGFpcihzeW1zOjpvbGRfbWFuaWZlc3QsIGVkZ2Vfb2xkX21hbmlmZXN0
KGUpLmlubmVyKCkoKSk7CiAgcHJpbnRlci5wcmludF9zdGFuemEoc3QpOwogIHByaW50X2NoYW5n
ZV9zZXQocHJpbnRlciwgZWRnZV9jaGFuZ2VzKGUpKTsgCn0KCgp2b2lkIApwcmludF9yZXZpc2lv
bihiYXNpY19pbzo6cHJpbnRlciAmIHByaW50ZXIsCiAgICAgICAgICAgICAgIHJldmlzaW9uX3Nl
dCBjb25zdCAmIHJldikKewogIGJhc2ljX2lvOjpzdGFuemEgc3Q7IAogIHN0LnB1c2hfaGV4X3Bh
aXIoc3ltczo6bmV3X21hbmlmZXN0LCByZXYubmV3X21hbmlmZXN0LmlubmVyKCkoKSk7CiAgcHJp
bnRlci5wcmludF9zdGFuemEoc3QpOwogIGZvciAoZWRnZV9tYXA6OmNvbnN0X2l0ZXJhdG9yIGVk
Z2UgPSByZXYuZWRnZXMuYmVnaW4oKTsKICAgICAgIGVkZ2UgIT0gcmV2LmVkZ2VzLmVuZCgpOyAr
K2VkZ2UpCiAgICBwcmludF9lZGdlKHByaW50ZXIsICplZGdlKTsKfQoKCnZvaWQgCnBhcnNlX2Vk
Z2UoYmFzaWNfaW86OnBhcnNlciAmIHBhcnNlciwKICAgICAgICAgICBlZGdlX21hcCAmIGVzKQp7
CiAgY2hhbmdlX3NldCBjczsKICBtYW5pZmVzdF9pZCBvbGRfbWFuOwogIHJldmlzaW9uX2lkIG9s
ZF9yZXY7CiAgc3RkOjpzdHJpbmcgdG1wOwogIAogIHBhcnNlci5lc3ltKHN5bXM6Om9sZF9yZXZp
c2lvbik7CiAgcGFyc2VyLmhleCh0bXApOwogIG9sZF9yZXYgPSByZXZpc2lvbl9pZCh0bXApOwog
IAogIHBhcnNlci5lc3ltKHN5bXM6Om9sZF9tYW5pZmVzdCk7CiAgcGFyc2VyLmhleCh0bXApOwog
IG9sZF9tYW4gPSBtYW5pZmVzdF9pZCh0bXApOwogIAogIHBhcnNlX2NoYW5nZV9zZXQocGFyc2Vy
LCBjcyk7CgogIGVzLmluc2VydChzdGQ6Om1ha2VfcGFpcihvbGRfcmV2LCBzdGQ6Om1ha2VfcGFp
cihvbGRfbWFuLCBjcykpKTsKfQoKCnZvaWQgCnBhcnNlX3JldmlzaW9uKGJhc2ljX2lvOjpwYXJz
ZXIgJiBwYXJzZXIsCiAgICAgICAgICAgICAgIHJldmlzaW9uX3NldCAmIHJldikKewogIHJldi5l
ZGdlcy5jbGVhcigpOwogIHN0ZDo6c3RyaW5nIHRtcDsKICBwYXJzZXIuZXN5bShzeW1zOjpuZXdf
bWFuaWZlc3QpOwogIHBhcnNlci5oZXgodG1wKTsKICByZXYubmV3X21hbmlmZXN0ID0gbWFuaWZl
c3RfaWQodG1wKTsKICB3aGlsZSAocGFyc2VyLnN5bXAoc3ltczo6b2xkX3JldmlzaW9uKSkKICAg
IHBhcnNlX2VkZ2UocGFyc2VyLCByZXYuZWRnZXMpOwp9Cgp2b2lkIApyZWFkX3JldmlzaW9uX3Nl
dChkYXRhIGNvbnN0ICYgZGF0LAogICAgICAgICAgICAgICAgICByZXZpc2lvbl9zZXQgJiByZXYp
CnsKICBzdGQ6OmlzdHJpbmdzdHJlYW0gaXNzKGRhdCgpKTsKICBiYXNpY19pbzo6aW5wdXRfc291
cmNlIHNyYyhpc3MsICJyZXZpc2lvbiIpOwogIGJhc2ljX2lvOjp0b2tlbml6ZXIgdG9rKHNyYyk7
CiAgYmFzaWNfaW86OnBhcnNlciBwYXJzKHRvayk7CiAgcGFyc2VfcmV2aXNpb24ocGFycywgcmV2
KTsKICBJKHNyYy5sb29rYWhlYWQgPT0gRU9GKTsKfQoKdm9pZCAKcmVhZF9yZXZpc2lvbl9zZXQo
cmV2aXNpb25fZGF0YSBjb25zdCAmIGRhdCwKICAgICAgICAgICAgICAgICAgcmV2aXNpb25fc2V0
ICYgcmV2KQp7CiAgZGF0YSB1bnBhY2tlZDsKICB1bnBhY2soZGF0LmlubmVyKCksIHVucGFja2Vk
KTsKICByZWFkX3JldmlzaW9uX3NldCh1bnBhY2tlZCwgcmV2KTsKfQoKdm9pZAp3cml0ZV9yZXZp
c2lvbl9zZXQocmV2aXNpb25fc2V0IGNvbnN0ICYgcmV2LAogICAgICAgICAgICAgICAgICAgZGF0
YSAmIGRhdCkKewogIHN0ZDo6b3N0cmluZ3N0cmVhbSBvc3M7CiAgYmFzaWNfaW86OnByaW50ZXIg
cHIob3NzKTsKICBwcmludF9yZXZpc2lvbihwciwgcmV2KTsKICBkYXQgPSBkYXRhKG9zcy5zdHIo
KSk7Cn0KCnZvaWQKd3JpdGVfcmV2aXNpb25fc2V0KHJldmlzaW9uX3NldCBjb25zdCAmIHJldiwK
ICAgICAgICAgICAgICAgICAgIHJldmlzaW9uX2RhdGEgJiBkYXQpCnsKICBkYXRhIGQ7CiAgd3Jp
dGVfcmV2aXNpb25fc2V0KHJldiwgZCk7CiAgYmFzZTY0PCBnemlwPGRhdGE+ID4gcGFja2VkOwog
IHBhY2soZCwgcGFja2VkKTsKICBkYXQgPSByZXZpc2lvbl9kYXRhKHBhY2tlZCk7Cn0KCiNpZmRl
ZiBCVUlMRF9VTklUX1RFU1RTCiNpbmNsdWRlICJ1bml0X3Rlc3RzLmhoIgojaW5jbHVkZSAic2Fu
aXR5LmhoIgoKc3RhdGljIHZvaWQgCnJldmlzaW9uX3Rlc3QoKQp7Cn0KCnZvaWQgCmFkZF9yZXZp
c2lvbl90ZXN0cyh0ZXN0X3N1aXRlICogc3VpdGUpCnsKICBJKHN1aXRlKTsKICBzdWl0ZS0+YWRk
KEJPT1NUX1RFU1RfQ0FTRSgmcmV2aXNpb25fdGVzdCkpOwp9CgoKI2VuZGlmIC8vIEJVSUxEX1VO
SVRfVEVTVFMK
])

AT_DATA(right.b64, [Ly8gY29weXJpZ2h0IChDKSAyMDA0IGdyYXlkb24gaG9hcmUgPGdyYXlkb25AcG9ib3guY29tPgov
LyBhbGwgcmlnaHRzIHJlc2VydmVkLgovLyBsaWNlbnNlZCB0byB0aGUgcHVibGljIHVuZGVyIHRo
ZSB0ZXJtcyBvZiB0aGUgR05VIEdQTCAoPj0gMikKLy8gc2VlIHRoZSBmaWxlIENPUFlJTkcgZm9y
IGRldGFpbHMKCiNpbmNsdWRlIDxjY3R5cGU+CiNpbmNsdWRlIDxjc3RkbGliPgojaW5jbHVkZSA8
aW9zdHJlYW0+CiNpbmNsdWRlIDxtYXA+CiNpbmNsdWRlIDxzZXQ+CiNpbmNsdWRlIDxzc3RyZWFt
PgojaW5jbHVkZSA8c3RyaW5nPgoKI2luY2x1ZGUgPGJvb3N0L2xleGljYWxfY2FzdC5ocHA+CiNp
bmNsdWRlIDxib29zdC9keW5hbWljX2JpdHNldC5ocHA+CiNpbmNsdWRlIDxib29zdC9zaGFyZWRf
cHRyLmhwcD4KCiNpbmNsdWRlICJiYXNpY19pby5oaCIKI2luY2x1ZGUgImNoYW5nZV9zZXQuaGgi
CiNpbmNsdWRlICJjb25zdGFudHMuaGgiCiNpbmNsdWRlICJyZXZpc2lvbi5oaCIKI2luY2x1ZGUg
InNhbml0eS5oaCIKI2luY2x1ZGUgInRyYW5zZm9ybXMuaGgiCiNpbmNsdWRlICJ2b2NhYi5oaCIK
CgovLyBjYWxjdWxhdGluZyBsZWFzdCBjb21tb24gYW5jZXN0b3JzIGlzIGEgZGVsaWNhdGUgdGhp
bmcuCi8vIAovLyBpdCB0dXJucyBvdXQgdGhhdCB3ZSBjYW5ub3QgY2hvb3NlIHRoZSBzaW1wbGUg
ImxlYXN0IGNvbW1vbiBhbmNlc3RvciIKLy8gZm9yIHB1cnBvc2VzIG9mIGEgbWVyZ2UsIGJlY2F1
c2UgaXQgaXMgcG9zc2libGUgdGhhdCB0aGVyZSBhcmUgdHdvCi8vIGVxdWFsbHkgcmVhY2hhYmxl
IGNvbW1vbiBhbmNlc3RvcnMsIGFuZCB0aGlzIHByb2R1Y2VzIGFtYmlndWl0eSBpbiB0aGUKLy8g
bWVyZ2UuIHRoZSByZXN1bHQgLS0gaW4gYSBwYXRob2xvZ2ljYWwgY2FzZSAtLSBpcyBzaWxlbnRs
eSBhY2NlcHRpbmcgb25lCi8vIHNldCBvZiBlZGl0cyB3aGlsZSBkaXNjYXJkaW5nIGFub3RoZXI7
IG5vdCBleGFjdGx5IHdoYXQgeW91IHdhbnQgYQovLyB2ZXJzaW9uIGNvbnRyb2wgdG9vbCB0byBk
by4KLy8KLy8gYSBjb25zZXJ2YXRpdmUgYXBwcm94aW1hdGlvbiBpcyB3aGF0IHdlJ2xsIGNhbGwg
YSAic3ViZ3JhcGggcmVjdXJyaW5nIgovLyBMQ0EgYWxnb3JpdGhtLiB0aGlzIGlzIHNvbWV3aGF0
IGxpa2UgbG9jYXRpbmcgdGhlIGxlYXN0IGNvbW1vbiBkb21pbmF0b3IKLy8gbm9kZSwgYnV0IG5v
dCBxdWl0ZS4gaXQgaXMgYWN0dWFsbHkganVzdCBhIHZhbmlsbGEgTENBIHNlYXJjaCwgZXhjZXB0
Ci8vIHRoYXQgYW55IHRpbWUgdGhlcmUncyBhIGZvcmsgKGEgaGlzdG9yaWNhbCBtZXJnZSBsb29r
cyBsaWtlIGEgZm9yayBmcm9tCi8vIG91ciBwZXJzcGVjdGl2ZSwgd29ya2luZyBiYWNrd2FyZHMg
ZnJvbSBjaGlsZHJlbiB0byBwYXJlbnRzKSBpdCByZWR1Y2VzCi8vIHRoZSBmb3JrIHRvIGEgY29t
bW9uIHBhcmVudCB2aWEgYSBzZXF1ZW5jZSBvZiBwYWlyd2lzZSByZWN1cnNpdmUgY2FsbHMKLy8g
dG8gaXRzZWxmIGJlZm9yZSBwcm9jZWVkaW5nLiB0aGlzIHdpbGwgYWx3YXlzIHJlc29sdmUgdG8g
YSBjb21tb24gcGFyZW50Ci8vIHdpdGggbm8gYW1iaWd1aXR5LCB1bmxlc3MgaXQgZmFsbHMgb2Zm
IHRoZSByb290IG9mIHRoZSBncmFwaC4KLy8KLy8gdW5mb3J0dW5hdGVseSB0aGUgc3ViZ3JhcGgg
cmVjdXJyaW5nIGFsZ29yaXRobSBzb21ldGltZXMgZ29lcyB0b28gZmFyCi8vIGJhY2sgaW4gaGlz
dG9yeSAtLSBmb3IgZXhhbXBsZSBpZiB0aGVyZSBpcyBhbiB1bmFtYmlndW91cyBwcm9wYWdhdGUg
ZnJvbQovLyBvbmUgYnJhbmNoIHRvIGFub3RoZXIsIHRoZSBlbnRpcmUgc3ViZ3JhcGggcHJlY2Vl
ZGluZyB0aGUgcHJvcGFnYXRlIG9uCi8vIHRoZSByZWNpcGllbnQgYnJhbmNoIGlzIGVsaWRlZCwg
c2luY2UgaXQgaXMgYSBtZXJnZS4KLy8KLy8gb3VyIGN1cnJlbnQgaHlwb3RoZXNpcyBpcyB0aGF0
IHRoZSAqZXhhY3QqIGNvbmRpdGlvbiB3ZSdyZSBsb29raW5nIGZvciwKLy8gd2hlbiBkb2luZyBh
IG1lcmdlLCBpcyB0aGUgbGVhc3Qgbm9kZSB3aGljaCBkb21pbmF0ZXMgb25lIHNpZGUgb2YgdGhl
Ci8vIG1lcmdlIGFuZCBpcyBhbiBhbmNlc3RvciBvZiB0aGUgb3RoZXIuCgp0eXBlZGVmIHVuc2ln
bmVkIGxvbmcgY3R4Owp0eXBlZGVmIGJvb3N0OjpkeW5hbWljX2JpdHNldDw+IGJpdG1hcDsKdHlw
ZWRlZiBib29zdDo6c2hhcmVkX3B0cjxiaXRtYXA+IHNoYXJlZF9iaXRtYXA7CgpzdGF0aWMgdm9p
ZCAKZW5zdXJlX3BhcmVudHNfbG9hZGVkKGN0eCBjaGlsZCwKICAgICAgICAgICAgICAgICAgICAg
IHN0ZDo6bWFwPGN0eCwgc2hhcmVkX2JpdG1hcD4gJiBwYXJlbnRzLAogICAgICAgICAgICAgICAg
ICAgICAgaW50ZXJuZXI8Y3R4PiAmIGludGVybiwKICAgICAgICAgICAgICAgICAgICAgIGFwcF9z
dGF0ZSAmIGFwcCkKewogIGlmIChwYXJlbnRzLmZpbmQoY2hpbGQpICE9IHBhcmVudHMuZW5kKCkp
CiAgICByZXR1cm47CgogIEwoRigibG9hZGluZyBwYXJlbnRzIGZvciBub2RlICVkXG4iKSAlIGNo
aWxkKTsKCiAgc3RkOjpzZXQ8cmV2aXNpb25faWQ+IGltbV9wYXJlbnRzOwogIGFwcC5kYi5nZXRf
cmV2aXNpb25fcGFyZW50cyhyZXZpc2lvbl9pZChpbnRlcm4ubG9va3VwKGNoaWxkKSksIGltbV9w
YXJlbnRzKTsKCiAgLy8gVGhlIG51bGwgcmV2aXNpb24gaXMgbm90IGEgcGFyZW50IGZvciBwdXJw
b3NlcyBvZiBmaW5kaW5nIGNvbW1vbgogIC8vIGFuY2VzdG9ycy4KICBmb3IgKHN0ZDo6c2V0PHJl
dmlzaW9uX2lkPjo6aXRlcmF0b3IgcCA9IGltbV9wYXJlbnRzLmJlZ2luKCk7CiAgICAgICBwICE9
IGltbV9wYXJlbnRzLmVuZCgpOyArK3ApCiAgICB7CiAgICAgIGlmIChudWxsX2lkKCpwKSkKICAg
ICAgICBpbW1fcGFyZW50cy5lcmFzZShwKTsKICAgIH0KICAgICAgICAgICAgICAKICBzaGFyZWRf
Yml0bWFwIGJpdHMgPSBzaGFyZWRfYml0bWFwKG5ldyBiaXRtYXAocGFyZW50cy5zaXplKCkpKTsK
ICAKICBmb3IgKHN0ZDo6c2V0PHJldmlzaW9uX2lkPjo6Y29uc3RfaXRlcmF0b3IgcCA9IGltbV9w
YXJlbnRzLmJlZ2luKCk7CiAgICAgICBwICE9IGltbV9wYXJlbnRzLmVuZCgpOyArK3ApCiAgICB7
CiAgICAgIGN0eCBwbiA9IGludGVybi5pbnRlcm4ocC0+aW5uZXIoKSgpKTsKICAgICAgTChGKCJw
YXJlbnQgJXMgLT4gbm9kZSAlZFxuIikgJSAqcCAlIHBuKTsKICAgICAgaWYgKHBuID49IGJpdHMt
PnNpemUoKSkgCiAgICAgICAgYml0cy0+cmVzaXplKHBuKzEpOwogICAgICBiaXRzLT5zZXQocG4p
OwogICAgfQogICAgCiAgcGFyZW50cy5pbnNlcnQoc3RkOjptYWtlX3BhaXIoY2hpbGQsIGJpdHMp
KTsKfQoKc3RhdGljIGJvb2wgCmV4cGFuZF9kb21pbmF0b3JzKHN0ZDo6bWFwPGN0eCwgc2hhcmVk
X2JpdG1hcD4gJiBwYXJlbnRzLAogICAgICAgICAgICAgICAgICBzdGQ6Om1hcDxjdHgsIHNoYXJl
ZF9iaXRtYXA+ICYgZG9taW5hdG9ycywKICAgICAgICAgICAgICAgICAgaW50ZXJuZXI8Y3R4PiAm
IGludGVybiwKICAgICAgICAgICAgICAgICAgYXBwX3N0YXRlICYgYXBwKQp7CiAgYm9vbCBzb21l
dGhpbmdfY2hhbmdlZCA9IGZhbHNlOwogIHN0ZDo6dmVjdG9yPGN0eD4gbm9kZXM7CgogIG5vZGVz
LnJlc2VydmUoZG9taW5hdG9ycy5zaXplKCkpOwoKICAvLyBwYXNzIDEsIHB1bGwgb3V0IGFsbCB0
aGUgbm9kZSBudW1iZXJzIHdlJ3JlIGdvaW5nIHRvIHNjYW4gdGhpcyB0aW1lIGFyb3VuZAogIGZv
ciAoc3RkOjptYXA8Y3R4LCBzaGFyZWRfYml0bWFwPjo6Y29uc3RfaXRlcmF0b3IgZSA9IGRvbWlu
YXRvcnMuYmVnaW4oKTsgCiAgICAgICBlICE9IGRvbWluYXRvcnMuZW5kKCk7ICsrZSkKICAgIG5v
ZGVzLnB1c2hfYmFjayhlLT5maXJzdCk7CiAgCiAgLy8gcGFzcyAyLCB1cGRhdGUgYW55IG9mIHRo
ZSBkb21pbmF0b3IgZW50cmllcyB3ZSBjYW4KICBmb3IgKHN0ZDo6dmVjdG9yPGN0eD46OmNvbnN0
X2l0ZXJhdG9yIG4gPSBub2Rlcy5iZWdpbigpOyAKICAgICAgIG4gIT0gbm9kZXMuZW5kKCk7ICsr
bikKICAgIHsKICAgICAgc2hhcmVkX2JpdG1hcCBiaXRzID0gZG9taW5hdG9yc1sqbl07CiAgICAg
IGJpdG1hcCBzYXZlZCgqYml0cyk7CiAgICAgIGlmIChiaXRzLT5zaXplKCkgPD0gKm4pCiAgICAg
ICAgYml0cy0+cmVzaXplKCpuICsgMSk7CiAgICAgIGJpdHMtPnNldCgqbik7CiAgICAgIAogICAg
ICBlbnN1cmVfcGFyZW50c19sb2FkZWQoKm4sIHBhcmVudHMsIGludGVybiwgYXBwKTsKICAgICAg
c2hhcmVkX2JpdG1hcCBuX3BhcmVudHMgPSBwYXJlbnRzWypuXTsKICAgICAgCiAgICAgIGJpdG1h
cCBpbnRlcnNlY3Rpb24oYml0cy0+c2l6ZSgpKTsKICAgICAgCiAgICAgIGJvb2wgZmlyc3QgPSB0
cnVlOwogICAgICBmb3IgKHVuc2lnbmVkIGxvbmcgcGFyZW50ID0gMDsgCiAgICAgICAgICAgcGFy
ZW50ICE9IG5fcGFyZW50cy0+c2l6ZSgpOyArK3BhcmVudCkKICAgICAgICB7CiAgICAgICAgICBp
ZiAoISBuX3BhcmVudHMtPnRlc3QocGFyZW50KSkKICAgICAgICAgICAgY29udGludWU7CgogICAg
ICAgICAgaWYgKGRvbWluYXRvcnMuZmluZChwYXJlbnQpID09IGRvbWluYXRvcnMuZW5kKCkpCiAg
ICAgICAgICAgIGRvbWluYXRvcnMuaW5zZXJ0KHN0ZDo6bWFrZV9wYWlyKHBhcmVudCwgCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYXJlZF9iaXRtYXAobmV3
IGJpdG1hcCgpKSkpOwogICAgICAgICAgc2hhcmVkX2JpdG1hcCBwYml0cyA9IGRvbWluYXRvcnNb
cGFyZW50XTsKCiAgICAgICAgICBpZiAoYml0cy0+c2l6ZSgpID4gcGJpdHMtPnNpemUoKSkKICAg
ICAgICAgICAgcGJpdHMtPnJlc2l6ZShiaXRzLT5zaXplKCkpOwoKICAgICAgICAgIGlmIChwYml0
cy0+c2l6ZSgpID4gYml0cy0+c2l6ZSgpKQogICAgICAgICAgICBiaXRzLT5yZXNpemUocGJpdHMt
PnNpemUoKSk7CgogICAgICAgICAgaWYgKGZpcnN0KQogICAgICAgICAgICB7CiAgICAgICAgICAg
ICAgaW50ZXJzZWN0aW9uID0gKCpwYml0cyk7CiAgICAgICAgICAgICAgZmlyc3QgPSBmYWxzZTsK
ICAgICAgICAgICAgfQogICAgICAgICAgZWxzZQogICAgICAgICAgICBpbnRlcnNlY3Rpb24gJj0g
KCpwYml0cyk7CiAgICAgICAgfQoKICAgICAgKCpiaXRzKSB8PSBpbnRlcnNlY3Rpb247CiAgICAg
IGlmICgqYml0cyAhPSBzYXZlZCkKICAgICAgICBzb21ldGhpbmdfY2hhbmdlZCA9IHRydWU7CiAg
ICB9CiAgcmV0dXJuIHNvbWV0aGluZ19jaGFuZ2VkOwp9CgoKc3RhdGljIGJvb2wgCmV4cGFuZF9h
bmNlc3RvcnMoc3RkOjptYXA8Y3R4LCBzaGFyZWRfYml0bWFwPiAmIHBhcmVudHMsCiAgICAgICAg
ICAgICAgICAgc3RkOjptYXA8Y3R4LCBzaGFyZWRfYml0bWFwPiAmIGFuY2VzdG9ycywKICAgICAg
ICAgICAgICAgICBpbnRlcm5lcjxjdHg+ICYgaW50ZXJuLAogICAgICAgICAgICAgICAgIGFwcF9z
dGF0ZSAmIGFwcCkKewogIGJvb2wgc29tZXRoaW5nX2NoYW5nZWQgPSBmYWxzZTsKICBzdGQ6OnZl
Y3RvcjxjdHg+IG5vZGVzOwoKICBub2Rlcy5yZXNlcnZlKGFuY2VzdG9ycy5zaXplKCkpOwoKICAv
LyBwYXNzIDEsIHB1bGwgb3V0IGFsbCB0aGUgbm9kZSBudW1iZXJzIHdlJ3JlIGdvaW5nIHRvIHNj
YW4gdGhpcyB0aW1lIGFyb3VuZAogIGZvciAoc3RkOjptYXA8Y3R4LCBzaGFyZWRfYml0bWFwPjo6
Y29uc3RfaXRlcmF0b3IgZSA9IGFuY2VzdG9ycy5iZWdpbigpOyAKICAgICAgIGUgIT0gYW5jZXN0
b3JzLmVuZCgpOyArK2UpCiAgICBub2Rlcy5wdXNoX2JhY2soZS0+Zmlyc3QpOwogIAogIC8vIHBh
c3MgMiwgdXBkYXRlIGFueSBvZiB0aGUgYW5jZXN0b3IgZW50cmllcyB3ZSBjYW4KICBmb3IgKHN0
ZDo6dmVjdG9yPGN0eD46OmNvbnN0X2l0ZXJhdG9yIG4gPSBub2Rlcy5iZWdpbigpOyBuICE9IG5v
ZGVzLmVuZCgpOyArK24pCiAgICB7CiAgICAgIHNoYXJlZF9iaXRtYXAgYml0cyA9IGFuY2VzdG9y
c1sqbl07CiAgICAgIGJpdG1hcCBzYXZlZCgqYml0cyk7CiAgICAgIGlmIChiaXRzLT5zaXplKCkg
PD0gKm4pCiAgICAgICAgYml0cy0+cmVzaXplKCpuICsgMSk7CiAgICAgIGJpdHMtPnNldCgqbik7
CgogICAgICBlbnN1cmVfcGFyZW50c19sb2FkZWQoKm4sIHBhcmVudHMsIGludGVybiwgYXBwKTsK
ICAgICAgc2hhcmVkX2JpdG1hcCBuX3BhcmVudHMgPSBwYXJlbnRzWypuXTsKICAgICAgZm9yIChj
dHggcGFyZW50ID0gMDsgcGFyZW50ICE9IG5fcGFyZW50cy0+c2l6ZSgpOyArK3BhcmVudCkKICAg
ICAgICB7CiAgICAgICAgICBpZiAoISBuX3BhcmVudHMtPnRlc3QocGFyZW50KSkKICAgICAgICAg
ICAgY29udGludWU7CgogICAgICAgICAgaWYgKGJpdHMtPnNpemUoKSA8PSBwYXJlbnQpCiAgICAg
ICAgICAgIGJpdHMtPnJlc2l6ZShwYXJlbnQgKyAxKTsKICAgICAgICAgIGJpdHMtPnNldChwYXJl
bnQpOwoKICAgICAgICAgIGlmIChhbmNlc3RvcnMuZmluZChwYXJlbnQpID09IGFuY2VzdG9ycy5l
bmQoKSkKICAgICAgICAgICAgYW5jZXN0b3JzLmluc2VydChtYWtlX3BhaXIocGFyZW50LCAKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYXJlZF9iaXRtYXAobmV3IGJp
dG1hcCgpKSkpOwogICAgICAgICAgc2hhcmVkX2JpdG1hcCBwYml0cyA9IGFuY2VzdG9yc1twYXJl
bnRdOwoKICAgICAgICAgIGlmIChiaXRzLT5zaXplKCkgPiBwYml0cy0+c2l6ZSgpKQogICAgICAg
ICAgICBwYml0cy0+cmVzaXplKGJpdHMtPnNpemUoKSk7CgogICAgICAgICAgaWYgKHBiaXRzLT5z
aXplKCkgPiBiaXRzLT5zaXplKCkpCiAgICAgICAgICAgIGJpdHMtPnJlc2l6ZShwYml0cy0+c2l6
ZSgpKTsKCiAgICAgICAgICAoKmJpdHMpIHw9ICgqcGJpdHMpOwogICAgICAgIH0KICAgICAgaWYg
KCpiaXRzICE9IHNhdmVkKQogICAgICAgIHNvbWV0aGluZ19jaGFuZ2VkID0gdHJ1ZTsKICAgIH0K
ICByZXR1cm4gc29tZXRoaW5nX2NoYW5nZWQ7Cn0KCnN0YXRpYyBib29sIApmaW5kX2ludGVyc2Vj
dGluZ19ub2RlKGJpdG1hcCAmIGZzdCwgCiAgICAgICAgICAgICAgICAgICAgICAgYml0bWFwICYg
c25kLCAKICAgICAgICAgICAgICAgICAgICAgICBpbnRlcm5lcjxjdHg+IGNvbnN0ICYgaW50ZXJu
LCAKICAgICAgICAgICAgICAgICAgICAgICByZXZpc2lvbl9pZCAmIGFuYykKewogIAogIGlmIChm
c3Quc2l6ZSgpID4gc25kLnNpemUoKSkKICAgIHNuZC5yZXNpemUoZnN0LnNpemUoKSk7CiAgZWxz
ZSBpZiAoc25kLnNpemUoKSA+IGZzdC5zaXplKCkpCiAgICBmc3QucmVzaXplKHNuZC5zaXplKCkp
OwogIAogIGJpdG1hcCBpbnRlcnNlY3Rpb24gPSBmc3QgJiBzbmQ7CiAgaWYgKGludGVyc2VjdGlv
bi5hbnkoKSkKICAgIHsKICAgICAgTChGKCJmb3VuZCAlZCBpbnRlcnNlY3Rpbmcgbm9kZXNcbiIp
ICUgaW50ZXJzZWN0aW9uLmNvdW50KCkpOwogICAgICBmb3IgKGN0eCBpID0gMDsgaSA8IGludGVy
c2VjdGlvbi5zaXplKCk7ICsraSkKICAgICAgICB7CiAgICAgICAgICBpZiAoaW50ZXJzZWN0aW9u
LnRlc3QoaSkpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBhbmMgPSByZXZpc2lvbl9pZChp
bnRlcm4ubG9va3VwKGkpKTsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAg
fQogICAgICAgIH0KICAgIH0KICByZXR1cm4gZmFsc2U7Cn0KCi8vICBzdGF0aWMgdm9pZAovLyAg
ZHVtcF9iaXRzZXRfbWFwKHN0ZDo6c3RyaW5nIGNvbnN0ICYgaGRyLAovLyAgICAgICAgICAgICAg
c3RkOjptYXA8IGN0eCwgc2hhcmVkX2JpdG1hcCA+IGNvbnN0ICYgbW0pCi8vICB7Ci8vICAgIEwo
RigiZHVtcGluZyBbJXNdICglZCBlbnRyaWVzKVxuIikgJSBoZHIgJSBtbS5zaXplKCkpOwovLyAg
ICBmb3IgKHN0ZDo6bWFwPCBjdHgsIHNoYXJlZF9iaXRtYXAgPjo6Y29uc3RfaXRlcmF0b3IgaSA9
IG1tLmJlZ2luKCk7Ci8vICAgICAgICAgaSAhPSBtbS5lbmQoKTsgKytpKQovLyAgICAgIHsKLy8g
ICAgICAgIEwoRigiZHVtcCBbJXNdOiAlZCAtPiAlc1xuIikgJSBoZHIgJSBpLT5maXJzdCAlICgq
KGktPnNlY29uZCkpKTsKLy8gICAgICB9Ci8vICB9Cgpib29sIApmaW5kX2NvbW1vbl9hbmNlc3Rv
cl9mb3JfbWVyZ2UocmV2aXNpb25faWQgY29uc3QgJiBsZWZ0LAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgcmV2aXNpb25faWQgY29uc3QgJiByaWdodCwKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHJldmlzaW9uX2lkICYgYW5jLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgYXBwX3N0YXRlICYgYXBwKQp7CiAgaW50ZXJuZXI8Y3R4PiBpbnRlcm47CiAgc3RkOjpt
YXA8IGN0eCwgc2hhcmVkX2JpdG1hcCA+IAogICAgcGFyZW50cywgYW5jZXN0b3JzLCBkb21pbmF0
b3JzOwogIAogIGN0eCBsbiA9IGludGVybi5pbnRlcm4obGVmdC5pbm5lcigpKCkpOwogIGN0eCBy
biA9IGludGVybi5pbnRlcm4ocmlnaHQuaW5uZXIoKSgpKTsKICAKICBzaGFyZWRfYml0bWFwIGxh
bmMgPSBzaGFyZWRfYml0bWFwKG5ldyBiaXRtYXAoKSk7CiAgc2hhcmVkX2JpdG1hcCByYW5jID0g
c2hhcmVkX2JpdG1hcChuZXcgYml0bWFwKCkpOwogIHNoYXJlZF9iaXRtYXAgbGRvbSA9IHNoYXJl
ZF9iaXRtYXAobmV3IGJpdG1hcCgpKTsKICBzaGFyZWRfYml0bWFwIHJkb20gPSBzaGFyZWRfYml0
bWFwKG5ldyBiaXRtYXAoKSk7CgogIGFuY2VzdG9ycy5pbnNlcnQobWFrZV9wYWlyKGxuLCBsYW5j
KSk7CiAgYW5jZXN0b3JzLmluc2VydChtYWtlX3BhaXIocm4sIHJhbmMpKTsKICBkb21pbmF0b3Jz
Lmluc2VydChtYWtlX3BhaXIobG4sIGxkb20pKTsKICBkb21pbmF0b3JzLmluc2VydChtYWtlX3Bh
aXIocm4sIHJkb20pKTsKICAKICBMKEYoInNlYXJjaGluZyBmb3IgY29tbW9uIGFuY2VzdG9yLCBs
ZWZ0PSVzIHJpZ2h0PSVzXG4iKSAlIGxlZnQgJSByaWdodCk7CiAgCiAgd2hpbGUgKGV4cGFuZF9h
bmNlc3RvcnMocGFyZW50cywgYW5jZXN0b3JzLCBpbnRlcm4sIGFwcCkgfHwKICAgICAgICAgZXhw
YW5kX2RvbWluYXRvcnMocGFyZW50cywgZG9taW5hdG9ycywgaW50ZXJuLCBhcHApKQogICAgewog
ICAgICBMKEYoImNvbW1vbiBhbmNlc3RvciBzY2FuIFtwYXI9JWQsYW5jPSVkLGRvbT0lZF1cbiIp
ICUgCiAgICAgICAgcGFyZW50cy5zaXplKCkgJSBhbmNlc3RvcnMuc2l6ZSgpICUgZG9taW5hdG9y
cy5zaXplKCkpOwoKICAgICAgaWYgKGZpbmRfaW50ZXJzZWN0aW5nX25vZGUoKmxhbmMsICpyZG9t
LCBpbnRlcm4sIGFuYykpCiAgICAgICAgewogICAgICAgICAgTChGKCJmb3VuZCBub2RlICVkLCBh
bmNlc3RvciBvZiBsZWZ0ICVzIGFuZCBkb21pbmF0aW5nIHJpZ2h0ICVzXG4iKQogICAgICAgICAg
ICAlIGFuYyAlIGxlZnQgJSByaWdodCk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9
CiAgICAgIAogICAgICBlbHNlIGlmIChmaW5kX2ludGVyc2VjdGluZ19ub2RlKCpyYW5jLCAqbGRv
bSwgaW50ZXJuLCBhbmMpKQogICAgICAgIHsKICAgICAgICAgIEwoRigiZm91bmQgbm9kZSAlZCwg
YW5jZXN0b3Igb2YgcmlnaHQgJXMgYW5kIGRvbWluYXRpbmcgbGVmdCAlc1xuIikKICAgICAgICAg
ICAgJSBhbmMgJSByaWdodCAlIGxlZnQpOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAg
fQogICAgfQovLyAgICAgIGR1bXBfYml0c2V0X21hcCgiYW5jZXN0b3JzIiwgYW5jZXN0b3JzKTsK
Ly8gICAgICBkdW1wX2JpdHNldF9tYXAoImRvbWluYXRvcnMiLCBkb21pbmF0b3JzKTsKLy8gICAg
ICBkdW1wX2JpdHNldF9tYXAoInBhcmVudHMiLCBwYXJlbnRzKTsKICByZXR1cm4gZmFsc2U7Cn0K
Cgpib29sCmZpbmRfbGVhc3RfY29tbW9uX2FuY2VzdG9yKHJldmlzaW9uX2lkIGNvbnN0ICYgbGVm
dCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV2aXNpb25faWQgY29uc3QgJiByaWdodCwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV2aXNpb25faWQgJiBhbmMsCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGFwcF9zdGF0ZSAmIGFwcCkKewogIGludGVybmVyPGN0eD4gaW50ZXJu
OwogIHN0ZDo6bWFwPCBjdHgsIHNoYXJlZF9iaXRtYXAgPgogICAgcGFyZW50cywgYW5jZXN0b3Jz
LCBkb21pbmF0b3JzOwoKICBjdHggbG4gPSBpbnRlcm4uaW50ZXJuKGxlZnQuaW5uZXIoKSgpKTsK
ICBjdHggcm4gPSBpbnRlcm4uaW50ZXJuKHJpZ2h0LmlubmVyKCkoKSk7CgogIHNoYXJlZF9iaXRt
YXAgbGFuYyA9IHNoYXJlZF9iaXRtYXAobmV3IGJpdG1hcCgpKTsKICBzaGFyZWRfYml0bWFwIHJh
bmMgPSBzaGFyZWRfYml0bWFwKG5ldyBiaXRtYXAoKSk7CgogIGFuY2VzdG9ycy5pbnNlcnQobWFr
ZV9wYWlyKGxuLCBsYW5jKSk7CiAgYW5jZXN0b3JzLmluc2VydChtYWtlX3BhaXIocm4sIHJhbmMp
KTsKCiAgTChGKCJzZWFyY2hpbmcgZm9yIGxlYXN0IGNvbW1vbiBhbmNlc3RvciwgbGVmdD0lcyBy
aWdodD0lc1xuIikgJSBsZWZ0ICUgcmlnaHQpOwoKICB3aGlsZSAoZXhwYW5kX2FuY2VzdG9ycyhw
YXJlbnRzLCBhbmNlc3RvcnMsIGludGVybiwgYXBwKSkKICAgIHsKICAgICAgTChGKCJsZWFzdCBj
b21tb24gYW5jZXN0b3Igc2NhbiBbcGFyPSVkLGFuYz0lZF1cbiIpICUKICAgICAgICBwYXJlbnRz
LnNpemUoKSAlIGFuY2VzdG9ycy5zaXplKCkpOwoKICAgICAgaWYgKGZpbmRfaW50ZXJzZWN0aW5n
X25vZGUoKmxhbmMsICpyYW5jLCBpbnRlcm4sIGFuYykpCiAgICAgICAgewogICAgICAgICAgTChG
KCJmb3VuZCBub2RlICVkLCBhbmNlc3RvciBvZiBsZWZ0ICVzIGFuZCByaWdodCAlc1xuIikKICAg
ICAgICAgICAgJSBhbmMgJSBsZWZ0ICUgcmlnaHQpOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAg
ICAgICAgfQogICAgfQovLyAgICAgIGR1bXBfYml0c2V0X21hcCgiYW5jZXN0b3JzIiwgYW5jZXN0
b3JzKTsKLy8gICAgICBkdW1wX2JpdHNldF9tYXAoInBhcmVudHMiLCBwYXJlbnRzKTsKICByZXR1
cm4gZmFsc2U7Cn0KCgovLyAKLy8gVGhlIGlkZWEgd2l0aCB0aGlzIGFsZ29yaXRobSBpcyB0byB3
YWxrIGZyb20gY2hpbGQgdXAgdG8gYW5jZXN0b3IsCi8vIHJlY3Vyc2l2ZWx5LCBhY2N1bXVsYXRp
bmcgYWxsIHRoZSBjaGFuZ2Vfc2V0cyBhc3NvY2lhdGVkIHdpdGgKLy8gaW50ZXJtZWRpYXRlIG5v
ZGVzIGludG8gKm9uZSBiaWcgY2hhbmdlX3NldCouCi8vCi8vIGNsZXZlciByZWFkZXJzIHdpbGwg
cmVhbGl6ZSB0aGlzIGlzIGFuIG92ZXJsYXBwaW5nLXN1YnByb2JsZW0gdHlwZQovLyBzaXR1YXRp
b24gYW5kIHRodXMgbmVlZHMgdG8ga2VlcCBhIGR5bmFtaWMgcHJvZ3JhbW1pbmcgbWFwIHRvIGtl
ZXAKLy8gaXRzZWxmIGluIGxpbmVhciBjb21wbGV4aXR5LgovLwovLyBpbiBmYWN0LCB3ZSBrZWVw
IHR3bzogb25lIHdoaWNoIG1hcHMgdG8gY29tcHV0ZWQgcmVzdWx0cyAocGFydGlhbF9jc2V0cykK
Ly8gYW5kIG9uZSB3aGljaCBqdXN0IGtlZXBzIGEgc2V0IG9mIGFsbCBub2RlcyB3ZSB0cmF2ZXJz
ZWQKLy8gKHZpc2l0ZWRfbm9kZXMpLiBpbiB0aGVvcnkgaXQgY291bGQgYmUgb25lIG1hcCB3aXRo
IGFuIGV4dHJhIGJvb2wgc3R1Y2sKLy8gb24gZWFjaCBlbnRyeSwgYnV0IEkgdGhpbmsgdGhhdCB3
b3VsZCBtYWtlIGl0IGV2ZW4gbGVzcyByZWFkYWJsZS4gaXQncwovLyBhbHJlYWR5IHF1aXRlIHVn
bHkuCi8vCgpzdGF0aWMgYm9vbCAKY2FsY3VsYXRlX2NoYW5nZV9zZXRzX3JlY3Vyc2l2ZShyZXZp
c2lvbl9pZCBjb25zdCAmIGFuY2VzdG9yLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHJldmlzaW9uX2lkIGNvbnN0ICYgY2hpbGQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgYXBwX3N0YXRlICYgYXBwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5n
ZV9zZXQgJiBjdW11bGF0aXZlX2NzZXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
c3RkOjptYXA8cmV2aXNpb25faWQsIGJvb3N0OjpzaGFyZWRfcHRyPGNoYW5nZV9zZXQ+ID4gJiBw
YXJ0aWFsX2NzZXRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZDo6c2V0PHJl
dmlzaW9uX2lkPiAmIHZpc2l0ZWRfbm9kZXMpCnsKCiAgaWYgKGFuY2VzdG9yID09IGNoaWxkKQog
ICAgcmV0dXJuIHRydWU7CgogIHZpc2l0ZWRfbm9kZXMuaW5zZXJ0KGNoaWxkKTsKCiAgYm9vbCBy
ZWxldmFudF9jaGlsZCA9IGZhbHNlOwoKICByZXZpc2lvbl9zZXQgcmV2OwogIGFwcC5kYi5nZXRf
cmV2aXNpb24oY2hpbGQsIHJldik7CgogIEwoRigiZXhwbG9yaW5nIGNoYW5nZXNldHMgZnJvbSBw
YXJlbnRzIG9mICVzLCBzZWVraW5nIHRvd2FyZHMgJXNcbiIpIAogICAgJSBjaGlsZCAlIGFuY2Vz
dG9yKTsKCiAgZm9yKGVkZ2VfbWFwOjpjb25zdF9pdGVyYXRvciBpID0gcmV2LmVkZ2VzLmJlZ2lu
KCk7IGkgIT0gcmV2LmVkZ2VzLmVuZCgpOyArK2kpCiAgICB7CiAgICAgIGJvb2wgcmVsZXZhbnRf
cGFyZW50ID0gZmFsc2U7CiAgICAgIHJldmlzaW9uX2lkIGN1cnJfcGFyZW50ID0gZWRnZV9vbGRf
cmV2aXNpb24oaSk7CgogICAgICBpZiAoY3Vycl9wYXJlbnQuaW5uZXIoKSgpLmVtcHR5KCkpCiAg
ICAgICAgY29udGludWU7CgogICAgICBjaGFuZ2Vfc2V0IGNzZXRfdG9fY3Vycl9wYXJlbnQ7Cgog
ICAgICBMKEYoImNvbnNpZGVyaW5nIHBhcmVudCAlcyBvZiAlc1xuIikgJSBjdXJyX3BhcmVudCAl
IGNoaWxkKTsKCiAgICAgIHN0ZDo6bWFwPHJldmlzaW9uX2lkLCBib29zdDo6c2hhcmVkX3B0cjxj
aGFuZ2Vfc2V0PiA+Ojpjb25zdF9pdGVyYXRvciBqID0gCiAgICAgICAgcGFydGlhbF9jc2V0cy5m
aW5kKGN1cnJfcGFyZW50KTsKICAgICAgaWYgKGogIT0gcGFydGlhbF9jc2V0cy5lbmQoKSkgCiAg
ICAgICAgewogICAgICAgICAgLy8gYSByZWN1cnNpdmUgY2FsbCBoYXMgdHJhdmVyc2VkIHRoaXMg
cGFyZW50IGJlZm9yZSBhbmQgYnVpbHQgYW4KICAgICAgICAgIC8vIGV4aXN0aW5nIGNzZXQuIGp1
c3QgcmV1c2UgdGhhdCByYXRoZXIgdGhhbiByZS10cmF2ZXJzaW5nCiAgICAgICAgICBjc2V0X3Rv
X2N1cnJfcGFyZW50ID0gKihqLT5zZWNvbmQpOwogICAgICAgICAgcmVsZXZhbnRfcGFyZW50ID0g
dHJ1ZTsKICAgICAgICB9CiAgICAgIGVsc2UgaWYgKHZpc2l0ZWRfbm9kZXMuZmluZChjdXJyX3Bh
cmVudCkgIT0gdmlzaXRlZF9ub2Rlcy5lbmQoKSkKICAgICAgICB7CiAgICAgICAgICAvLyBhIHJl
Y3Vyc2l2ZSBjYWxsIGhhcyB0cmF2ZXJzZWQgdGhpcyBwYXJlbnQsIGJ1dCB0aGVyZSB3YXMgbm8K
ICAgICAgICAgIC8vIHBhdGggZnJvbSBpdCB0byB0aGUgcm9vdCwgc28gdGhlIHBhcmVudCBpcyBp
cnJlbGV2YW50LiBza2lwLgogICAgICAgICAgcmVsZXZhbnRfcGFyZW50ID0gZmFsc2U7CiAgICAg
ICAgfQogICAgICBlbHNlCiAgICAgICAgcmVsZXZhbnRfcGFyZW50ID0gY2FsY3VsYXRlX2NoYW5n
ZV9zZXRzX3JlY3Vyc2l2ZShhbmNlc3RvciwgY3Vycl9wYXJlbnQsIGFwcCwgCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjc2V0X3RvX2N1
cnJfcGFyZW50LCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHBhcnRpYWxfY3NldHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXNpdGVkX25vZGVzKTsKCiAgICAgIGlmIChy
ZWxldmFudF9wYXJlbnQpCiAgICAgICAgewogICAgICAgICAgTChGKCJyZXZpc2lvbiAlcyBpcyBy
ZWxldmFudCwgY29tcG9zaW5nIHdpdGggZWRnZSB0byAlc1xuIikgCiAgICAgICAgICAgICUgY3Vy
cl9wYXJlbnQgJSBjaGlsZCk7CiAgICAgICAgICBjb25jYXRlbmF0ZV9jaGFuZ2Vfc2V0cyhjc2V0
X3RvX2N1cnJfcGFyZW50LCBlZGdlX2NoYW5nZXMoaSksIGN1bXVsYXRpdmVfY3NldCk7CiAgICAg
ICAgICByZWxldmFudF9jaGlsZCA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAg
ICAgIGVsc2UKICAgICAgICBMKEYoInBhcmVudCAlcyBvZiAlcyBpcyBub3QgcmVsZXZhbnRcbiIp
ICUgY3Vycl9wYXJlbnQgJSBjaGlsZCk7CiAgICB9CgogIC8vIHN0b3JlIHRoZSBwYXJ0aWFsIGVk
Z2UgZnJvbSBhbmNlc3RvciAtPiBjaGlsZCwgc28gdGhhdCBpZiBhbnlvbmUKICAvLyByZS10cmF2
ZXJzZXMgdGhpcyBlZGdlIHRoZXknbGwganVzdCBmZXRjaCBmcm9tIHRoZSBwYXJ0aWFsX2VkZ2Vz
CiAgLy8gY2FjaGUuCiAgaWYgKHJlbGV2YW50X2NoaWxkKQogICAgcGFydGlhbF9jc2V0cy5pbnNl
cnQoc3RkOjptYWtlX3BhaXIoY2hpbGQsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgYm9vc3Q6OnNoYXJlZF9wdHI8Y2hhbmdlX3NldD4KICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIChuZXcgY2hhbmdlX3NldChjdW11bGF0aXZlX2NzZXQpKSkp
OwogIAogIHJldHVybiByZWxldmFudF9jaGlsZDsKfQoKdm9pZCAKY2FsY3VsYXRlX2NvbXBvc2l0
ZV9jaGFuZ2Vfc2V0KHJldmlzaW9uX2lkIGNvbnN0ICYgYW5jZXN0b3IsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICByZXZpc2lvbl9pZCBjb25zdCAmIGNoaWxkLAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgYXBwX3N0YXRlICYgYXBwLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgY2hhbmdlX3NldCAmIGNvbXBvc2VkKQp7CiAgTChGKCJjYWxjdWxhdGluZyBjb21w
b3NpdGUgY2hhbmdlc2V0IGJldHdlZW4gJXMgYW5kICVzXG4iKQogICAgJSBhbmNlc3RvciAlIGNo
aWxkKTsKICBzdGQ6OnNldDxyZXZpc2lvbl9pZD4gdmlzaXRlZDsKICBzdGQ6Om1hcDxyZXZpc2lv
bl9pZCwgYm9vc3Q6OnNoYXJlZF9wdHI8Y2hhbmdlX3NldD4gPiBwYXJ0aWFsOwogIGNhbGN1bGF0
ZV9jaGFuZ2Vfc2V0c19yZWN1cnNpdmUoYW5jZXN0b3IsIGNoaWxkLCBhcHAsIGNvbXBvc2VkLCBw
YXJ0aWFsLCB2aXNpdGVkKTsKfQoKLy8gbWlncmF0aW9uIHN0dWZmCi8vCi8vIEZJWE1FOiB0aGVz
ZSBhcmUgdGVtcG9yYXJ5IGZ1bmN0aW9ucywgb25jZSB3ZSd2ZSBkb25lIHRoZSBtaWdyYXRpb24g
dG8KLy8gcmV2aXNpb25zIC8gY2hhbmdlc2V0cywgd2UgY2FuIHJlbW92ZSB0aGVtLgoKc3RhdGlj
IHZvaWQgCmFuYWx5emVfbWFuaWZlc3RfY2hhbmdlcyhhcHBfc3RhdGUgJiBhcHAsCiAgICAgICAg
ICAgICAgICAgICAgICAgICBtYW5pZmVzdF9pZCBjb25zdCAmIHBhcmVudCwgCiAgICAgICAgICAg
ICAgICAgICAgICAgICBtYW5pZmVzdF9pZCBjb25zdCAmIGNoaWxkLCAKICAgICAgICAgICAgICAg
ICAgICAgICAgIGNoYW5nZV9zZXQgJiBjcykKewogIG1hbmlmZXN0X21hcCBtX3BhcmVudCwgbV9j
aGlsZDsKICBhcHAuZGIuZ2V0X21hbmlmZXN0KHBhcmVudCwgbV9wYXJlbnQpOwogIGFwcC5kYi5n
ZXRfbWFuaWZlc3QoY2hpbGQsIG1fY2hpbGQpOwoKICBmb3IgKG1hbmlmZXN0X21hcDo6Y29uc3Rf
aXRlcmF0b3IgaSA9IG1fcGFyZW50LmJlZ2luKCk7IAogICAgICAgaSAhPSBtX3BhcmVudC5lbmQo
KTsgKytpKQogICAgewogICAgICBtYW5pZmVzdF9tYXA6OmNvbnN0X2l0ZXJhdG9yIGogPSBtX2No
aWxkLmZpbmQobWFuaWZlc3RfZW50cnlfcGF0aChpKSk7CiAgICAgIGlmIChqID09IG1fY2hpbGQu
ZW5kKCkpCiAgICAgICAgY3MuZGVsZXRlX2ZpbGUobWFuaWZlc3RfZW50cnlfcGF0aChpKSk7CiAg
ICAgIGVsc2UgaWYgKCEgKG1hbmlmZXN0X2VudHJ5X2lkKGkpID09IG1hbmlmZXN0X2VudHJ5X2lk
KGopKSkKICAgICAgICB7CiAgICAgICAgICBjcy5hcHBseV9kZWx0YShtYW5pZmVzdF9lbnRyeV9w
YXRoKGkpLAogICAgICAgICAgICAgICAgICAgICAgICAgbWFuaWZlc3RfZW50cnlfaWQoaSksIAog
ICAgICAgICAgICAgICAgICAgICAgICAgbWFuaWZlc3RfZW50cnlfaWQoaikpOwogICAgICAgIH0g
ICAgICAgCiAgICB9CiAgZm9yIChtYW5pZmVzdF9tYXA6OmNvbnN0X2l0ZXJhdG9yIGkgPSBtX2No
aWxkLmJlZ2luKCk7IAogICAgICAgaSAhPSBtX2NoaWxkLmVuZCgpOyArK2kpCiAgICB7CiAgICAg
IG1hbmlmZXN0X21hcDo6Y29uc3RfaXRlcmF0b3IgaiA9IG1fcGFyZW50LmZpbmQobWFuaWZlc3Rf
ZW50cnlfcGF0aChpKSk7CiAgICAgIGlmIChqID09IG1fcGFyZW50LmVuZCgpKQogICAgICAgIGNz
LmFkZF9maWxlKG1hbmlmZXN0X2VudHJ5X3BhdGgoaSksCiAgICAgICAgICAgICAgICAgICAgbWFu
aWZlc3RfZW50cnlfaWQoaSkpOwogICAgfQp9CgpzdGF0aWMgcmV2aXNpb25faWQKY29uc3RydWN0
X3JldmlzaW9ucyhhcHBfc3RhdGUgJiBhcHAsCiAgICAgICAgICAgICAgICAgICAgbWFuaWZlc3Rf
aWQgY29uc3QgJiBjaGlsZCwKICAgICAgICAgICAgICAgICAgICBzdGQ6Om11bHRpbWFwPCBtYW5p
ZmVzdF9pZCwgbWFuaWZlc3RfaWQgPiBjb25zdCAmIGFuY2VzdHJ5LAogICAgICAgICAgICAgICAg
ICAgIHN0ZDo6bWFwPG1hbmlmZXN0X2lkLCByZXZpc2lvbl9pZD4gJiBtYXBwZWQpCnsKICByZXZp
c2lvbl9zZXQgcmV2OwogIHR5cGVkZWYgc3RkOjptdWx0aW1hcDwgbWFuaWZlc3RfaWQsIG1hbmlm
ZXN0X2lkID46OmNvbnN0X2l0ZXJhdG9yIGNpOwogIHN0ZDo6cGFpcjxjaSxjaT4gcmFuZ2UgPSBh
bmNlc3RyeS5lcXVhbF9yYW5nZShjaGlsZCk7CiAgZm9yIChjaSBpID0gcmFuZ2UuZmlyc3Q7IGkg
IT0gcmFuZ2Uuc2Vjb25kOyArK2kpCiAgICB7CiAgICAgIG1hbmlmZXN0X2lkIHBhcmVudChpLT5z
ZWNvbmQpOwogICAgICByZXZpc2lvbl9pZCBwYXJlbnRfcmlkOwogICAgICBzdGQ6Om1hcDxtYW5p
ZmVzdF9pZCwgcmV2aXNpb25faWQ+Ojpjb25zdF9pdGVyYXRvciBqID0gbWFwcGVkLmZpbmQocGFy
ZW50KTsKCiAgICAgIGlmIChqICE9IG1hcHBlZC5lbmQoKSkKICAgICAgICBwYXJlbnRfcmlkID0g
ai0+c2Vjb25kOwogICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgcGFyZW50X3JpZCA9IGNv
bnN0cnVjdF9yZXZpc2lvbnMoYXBwLCBwYXJlbnQsIGFuY2VzdHJ5LCBtYXBwZWQpOwogICAgICAg
ICAgUChGKCJpbnNlcnRpbmcgbWFwcGluZyAlZCA6ICVzIC0+ICVzXG4iKSAlIG1hcHBlZC5zaXpl
KCkgJSBwYXJlbnQgJSBwYXJlbnRfcmlkKTs7CiAgICAgICAgICBtYXBwZWQuaW5zZXJ0KHN0ZDo6
bWFrZV9wYWlyKHBhcmVudCwgcGFyZW50X3JpZCkpOwogICAgICAgIH0KICAgICAgCiAgICAgIGNo
YW5nZV9zZXQgY3M7CiAgICAgIGFuYWx5emVfbWFuaWZlc3RfY2hhbmdlcyhhcHAsIHBhcmVudCwg
Y2hpbGQsIGNzKTsKICAgICAgcmV2LmVkZ2VzLmluc2VydChzdGQ6Om1ha2VfcGFpcihwYXJlbnRf
cmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZDo6bWFrZV9wYWly
KHBhcmVudCwgY3MpKSk7CiAgICB9IAoKICByZXZpc2lvbl9pZCByaWQ7CiAgaWYgKHJldi5lZGdl
cy5lbXB0eSgpKQogICAgewogICAgICBQKEYoImlnbm9yaW5nIGVtcHR5IHJldmlzaW9uIGZvciBt
YW5pZmVzdCAlc1xuIikgJSBjaGlsZCk7ICAKICAgICAgcmV0dXJuIHJpZDsKICAgIH0KCiAgcmV2
Lm5ld19tYW5pZmVzdCA9IGNoaWxkOwogIGNhbGN1bGF0ZV9pZGVudChyZXYsIHJpZCk7CgogIGlm
ICghYXBwLmRiLnJldmlzaW9uX2V4aXN0cyAocmlkKSkKICAgIHsKICAgICAgUChGKCJtYXBwaW5n
IG1hbmlmZXN0ICVzIHRvIHJldmlzaW9uICVzXG4iKSAlIGNoaWxkICUgcmlkKTsKICAgICAgYXBw
LmRiLnB1dF9yZXZpc2lvbihyaWQsIHJldik7CiAgICB9CiAgZWxzZQogICAgewogICAgICBQKEYo
InNraXBwaW5nIGFkZGl0aW9uYWwgcGF0aCB0byByZXZpc2lvbiAlc1xuIikgJSByaWQpOwogICAg
fQoKICAvLyBub3cgaG9pc3QgYWxsIHRoZSBpbnRlcmVzdGluZyBjZXJ0cyB1cCB0byB0aGUgcmV2
aXNpb24KICBzdGQ6OnNldDxjZXJ0X25hbWU+IGNuYW1lczsKICBjbmFtZXMuaW5zZXJ0KGNlcnRf
bmFtZShicmFuY2hfY2VydF9uYW1lKSk7CiAgY25hbWVzLmluc2VydChjZXJ0X25hbWUoZGF0ZV9j
ZXJ0X25hbWUpKTsKICBjbmFtZXMuaW5zZXJ0KGNlcnRfbmFtZShhdXRob3JfY2VydF9uYW1lKSk7
CiAgY25hbWVzLmluc2VydChjZXJ0X25hbWUodGFnX2NlcnRfbmFtZSkpOwogIGNuYW1lcy5pbnNl
cnQoY2VydF9uYW1lKGNoYW5nZWxvZ19jZXJ0X25hbWUpKTsKICBjbmFtZXMuaW5zZXJ0KGNlcnRf
bmFtZShjb21tZW50X2NlcnRfbmFtZSkpOwogIGNuYW1lcy5pbnNlcnQoY2VydF9uYW1lKHRlc3Ry
ZXN1bHRfY2VydF9uYW1lKSk7CgogIHN0ZDo6dmVjdG9yPCBtYW5pZmVzdDxjZXJ0PiA+IHRtcDsK
ICBhcHAuZGIuZ2V0X21hbmlmZXN0X2NlcnRzKGNoaWxkLCB0bXApOwogIGVyYXNlX2JvZ3VzX2Nl
cnRzKHRtcCwgYXBwKTsgICAgICAKICBmb3IgKHN0ZDo6dmVjdG9yPCBtYW5pZmVzdDxjZXJ0PiA+
Ojpjb25zdF9pdGVyYXRvciBpID0gdG1wLmJlZ2luKCk7CiAgICAgICBpICE9IHRtcC5lbmQoKTsg
KytpKQogICAgewogICAgICBpZiAoY25hbWVzLmZpbmQoaS0+aW5uZXIoKS5uYW1lKSA9PSBjbmFt
ZXMuZW5kKCkpCiAgICAgICAgY29udGludWU7CiAgICAgIGNlcnQgbmV3X2NlcnQ7CiAgICAgIGNl
cnRfdmFsdWUgdHY7CiAgICAgIGRlY29kZV9iYXNlNjQoaS0+aW5uZXIoKS52YWx1ZSwgdHYpOwog
ICAgICBtYWtlX3NpbXBsZV9jZXJ0KHJpZC5pbm5lcigpLCBpLT5pbm5lcigpLm5hbWUsIHR2LCBh
cHAsIG5ld19jZXJ0KTsKICAgICAgaWYgKCEgYXBwLmRiLnJldmlzaW9uX2NlcnRfZXhpc3RzKHJl
dmlzaW9uPGNlcnQ+KG5ld19jZXJ0KSkpCiAgICAgICAgYXBwLmRiLnB1dF9yZXZpc2lvbl9jZXJ0
KHJldmlzaW9uPGNlcnQ+KG5ld19jZXJ0KSk7CiAgICB9CiAgcmV0dXJuIHJpZDsgIAp9CgoKdm9p
ZCAKYnVpbGRfY2hhbmdlc2V0cyhhcHBfc3RhdGUgJiBhcHApCnsKICBzdGQ6OnZlY3RvcjwgbWFu
aWZlc3Q8Y2VydD4gPiB0bXA7CiAgYXBwLmRiLmdldF9tYW5pZmVzdF9jZXJ0cyhjZXJ0X25hbWUo
ImFuY2VzdG9yIiksIHRtcCk7CiAgZXJhc2VfYm9ndXNfY2VydHModG1wLCBhcHApOwoKICBzdGQ6
Om11bHRpbWFwPCBtYW5pZmVzdF9pZCwgbWFuaWZlc3RfaWQgPiBhbmNlc3RyeTsKICBzdGQ6OnNl
dDxtYW5pZmVzdF9pZD4gaGVhZHM7CiAgc3RkOjpzZXQ8bWFuaWZlc3RfaWQ+IHRvdGFsOwogIAog
IGZvciAoc3RkOjp2ZWN0b3I8IG1hbmlmZXN0PGNlcnQ+ID46OmNvbnN0X2l0ZXJhdG9yIGkgPSB0
bXAuYmVnaW4oKTsKICAgICAgIGkgIT0gdG1wLmVuZCgpOyArK2kpCiAgICB7CiAgICAgIGNlcnRf
dmFsdWUgdHY7CiAgICAgIGRlY29kZV9iYXNlNjQoaS0+aW5uZXIoKS52YWx1ZSwgdHYpOwogICAg
ICBtYW5pZmVzdF9pZCBjaGlsZCwgcGFyZW50OwogICAgICBjaGlsZCA9IGktPmlubmVyKCkuaWRl
bnQ7CiAgICAgIHBhcmVudCA9IGhleGVuYzxpZD4odHYoKSk7CiAgICAgIGhlYWRzLmluc2VydChj
aGlsZCk7CiAgICAgIGhlYWRzLmVyYXNlKHBhcmVudCk7CiAgICAgIHRvdGFsLmluc2VydChjaGls
ZCk7CiAgICAgIHRvdGFsLmluc2VydChwYXJlbnQpOwogICAgICBhbmNlc3RyeS5pbnNlcnQoc3Rk
OjptYWtlX3BhaXIoY2hpbGQsIHBhcmVudCkpOwogICAgfQogIAogIFAoRigiZm91bmQgYSB0b3Rh
bCBvZiAlZCBtYW5pZmVzdHNcbiIpICUgdG90YWwuc2l6ZSgpKTsKCiAgdHJhbnNhY3Rpb25fZ3Vh
cmQgZ3VhcmQoYXBwLmRiKTsKICBzdGQ6Om1hcDxtYW5pZmVzdF9pZCwgcmV2aXNpb25faWQ+IG1h
cHBlZDsKICBmb3IgKHN0ZDo6c2V0PG1hbmlmZXN0X2lkPjo6Y29uc3RfaXRlcmF0b3IgaSA9IGhl
YWRzLmJlZ2luKCk7CiAgICAgICBpICE9IGhlYWRzLmVuZCgpOyArK2kpCiAgICB7CiAgICAgIGNv
bnN0cnVjdF9yZXZpc2lvbnMoYXBwLCAqaSwgYW5jZXN0cnksIG1hcHBlZCk7CiAgICB9CiAgZ3Vh
cmQuY29tbWl0KCk7Cn0KCgovLyBpL28gc3R1ZmYKCnN0ZDo6c3RyaW5nIHJldmlzaW9uX2ZpbGVf
bmFtZSgicmV2aXNpb24iKTsKCm5hbWVzcGFjZSAKewogIG5hbWVzcGFjZSBzeW1zCiAgewogICAg
c3RkOjpzdHJpbmcgY29uc3Qgb2xkX3JldmlzaW9uKCJvbGRfcmV2aXNpb24iKTsKICAgIHN0ZDo6
c3RyaW5nIGNvbnN0IG5ld19tYW5pZmVzdCgibmV3X21hbmlmZXN0Iik7CiAgICBzdGQ6OnN0cmlu
ZyBjb25zdCBvbGRfbWFuaWZlc3QoIm9sZF9tYW5pZmVzdCIpOwogIH0KfQoKCnZvaWQgCnByaW50
X2VkZ2UoYmFzaWNfaW86OnByaW50ZXIgJiBwcmludGVyLAogICAgICAgICAgIGVkZ2VfZW50cnkg
Y29uc3QgJiBlKQp7ICAgICAgIAogIGJhc2ljX2lvOjpzdGFuemEgc3Q7CiAgc3QucHVzaF9oZXhf
cGFpcihzeW1zOjpvbGRfcmV2aXNpb24sIGVkZ2Vfb2xkX3JldmlzaW9uKGUpLmlubmVyKCkoKSk7
CiAgc3QucHVzaF9oZXhfcGFpcihzeW1zOjpvbGRfbWFuaWZlc3QsIGVkZ2Vfb2xkX21hbmlmZXN0
KGUpLmlubmVyKCkoKSk7CiAgcHJpbnRlci5wcmludF9zdGFuemEoc3QpOwogIHByaW50X2NoYW5n
ZV9zZXQocHJpbnRlciwgZWRnZV9jaGFuZ2VzKGUpKTsgCn0KCgp2b2lkIApwcmludF9yZXZpc2lv
bihiYXNpY19pbzo6cHJpbnRlciAmIHByaW50ZXIsCiAgICAgICAgICAgICAgIHJldmlzaW9uX3Nl
dCBjb25zdCAmIHJldikKewogIGJhc2ljX2lvOjpzdGFuemEgc3Q7IAogIHN0LnB1c2hfaGV4X3Bh
aXIoc3ltczo6bmV3X21hbmlmZXN0LCByZXYubmV3X21hbmlmZXN0LmlubmVyKCkoKSk7CiAgcHJp
bnRlci5wcmludF9zdGFuemEoc3QpOwogIGZvciAoZWRnZV9tYXA6OmNvbnN0X2l0ZXJhdG9yIGVk
Z2UgPSByZXYuZWRnZXMuYmVnaW4oKTsKICAgICAgIGVkZ2UgIT0gcmV2LmVkZ2VzLmVuZCgpOyAr
K2VkZ2UpCiAgICBwcmludF9lZGdlKHByaW50ZXIsICplZGdlKTsKfQoKCnZvaWQgCnBhcnNlX2Vk
Z2UoYmFzaWNfaW86OnBhcnNlciAmIHBhcnNlciwKICAgICAgICAgICBlZGdlX21hcCAmIGVzKQp7
CiAgY2hhbmdlX3NldCBjczsKICBtYW5pZmVzdF9pZCBvbGRfbWFuOwogIHJldmlzaW9uX2lkIG9s
ZF9yZXY7CiAgc3RkOjpzdHJpbmcgdG1wOwogIAogIHBhcnNlci5lc3ltKHN5bXM6Om9sZF9yZXZp
c2lvbik7CiAgcGFyc2VyLmhleCh0bXApOwogIG9sZF9yZXYgPSByZXZpc2lvbl9pZCh0bXApOwog
IAogIHBhcnNlci5lc3ltKHN5bXM6Om9sZF9tYW5pZmVzdCk7CiAgcGFyc2VyLmhleCh0bXApOwog
IG9sZF9tYW4gPSBtYW5pZmVzdF9pZCh0bXApOwogIAogIHBhcnNlX2NoYW5nZV9zZXQocGFyc2Vy
LCBjcyk7CgogIGVzLmluc2VydChzdGQ6Om1ha2VfcGFpcihvbGRfcmV2LCBzdGQ6Om1ha2VfcGFp
cihvbGRfbWFuLCBjcykpKTsKfQoKCnZvaWQgCnBhcnNlX3JldmlzaW9uKGJhc2ljX2lvOjpwYXJz
ZXIgJiBwYXJzZXIsCiAgICAgICAgICAgICAgIHJldmlzaW9uX3NldCAmIHJldikKewogIHJldi5l
ZGdlcy5jbGVhcigpOwogIHN0ZDo6c3RyaW5nIHRtcDsKICBwYXJzZXIuZXN5bShzeW1zOjpuZXdf
bWFuaWZlc3QpOwogIHBhcnNlci5oZXgodG1wKTsKICByZXYubmV3X21hbmlmZXN0ID0gbWFuaWZl
c3RfaWQodG1wKTsKICB3aGlsZSAocGFyc2VyLnN5bXAoc3ltczo6b2xkX3JldmlzaW9uKSkKICAg
IHBhcnNlX2VkZ2UocGFyc2VyLCByZXYuZWRnZXMpOwp9Cgp2b2lkIApyZWFkX3JldmlzaW9uX3Nl
dChkYXRhIGNvbnN0ICYgZGF0LAogICAgICAgICAgICAgICAgICByZXZpc2lvbl9zZXQgJiByZXYp
CnsKICBzdGQ6OmlzdHJpbmdzdHJlYW0gaXNzKGRhdCgpKTsKICBiYXNpY19pbzo6aW5wdXRfc291
cmNlIHNyYyhpc3MsICJyZXZpc2lvbiIpOwogIGJhc2ljX2lvOjp0b2tlbml6ZXIgdG9rKHNyYyk7
CiAgYmFzaWNfaW86OnBhcnNlciBwYXJzKHRvayk7CiAgcGFyc2VfcmV2aXNpb24ocGFycywgcmV2
KTsKfQoKdm9pZCAKcmVhZF9yZXZpc2lvbl9zZXQocmV2aXNpb25fZGF0YSBjb25zdCAmIGRhdCwK
ICAgICAgICAgICAgICAgICAgcmV2aXNpb25fc2V0ICYgcmV2KQp7CiAgZGF0YSB1bnBhY2tlZDsK
ICB1bnBhY2soZGF0LmlubmVyKCksIHVucGFja2VkKTsKICByZWFkX3JldmlzaW9uX3NldCh1bnBh
Y2tlZCwgcmV2KTsKfQoKdm9pZAp3cml0ZV9yZXZpc2lvbl9zZXQocmV2aXNpb25fc2V0IGNvbnN0
ICYgcmV2LAogICAgICAgICAgICAgICAgICAgZGF0YSAmIGRhdCkKewogIHN0ZDo6b3N0cmluZ3N0
cmVhbSBvc3M7CiAgYmFzaWNfaW86OnByaW50ZXIgcHIob3NzKTsKICBwcmludF9yZXZpc2lvbihw
ciwgcmV2KTsKICBkYXQgPSBkYXRhKG9zcy5zdHIoKSk7Cn0KCnZvaWQKd3JpdGVfcmV2aXNpb25f
c2V0KHJldmlzaW9uX3NldCBjb25zdCAmIHJldiwKICAgICAgICAgICAgICAgICAgIHJldmlzaW9u
X2RhdGEgJiBkYXQpCnsKICBkYXRhIGQ7CiAgd3JpdGVfcmV2aXNpb25fc2V0KHJldiwgZCk7CiAg
YmFzZTY0PCBnemlwPGRhdGE+ID4gcGFja2VkOwogIHBhY2soZCwgcGFja2VkKTsKICBkYXQgPSBy
ZXZpc2lvbl9kYXRhKHBhY2tlZCk7Cn0KCiNpZmRlZiBCVUlMRF9VTklUX1RFU1RTCiNpbmNsdWRl
ICJ1bml0X3Rlc3RzLmhoIgojaW5jbHVkZSAic2FuaXR5LmhoIgoKc3RhdGljIHZvaWQgCnJldmlz
aW9uX3Rlc3QoKQp7Cn0KCnZvaWQgCmFkZF9yZXZpc2lvbl90ZXN0cyh0ZXN0X3N1aXRlICogc3Vp
dGUpCnsKICBJKHN1aXRlKTsKICBzdWl0ZS0+YWRkKEJPT1NUX1RFU1RfQ0FTRSgmcmV2aXNpb25f
dGVzdCkpOwp9CgoKI2VuZGlmIC8vIEJVSUxEX1VOSVRfVEVTVFMK
])

AT_DATA(correct.b64, [Ly8gY29weXJpZ2h0IChDKSAyMDA0IGdyYXlkb24gaG9hcmUgPGdyYXlkb25AcG9ib3guY29tPgov
LyBhbGwgcmlnaHRzIHJlc2VydmVkLgovLyBsaWNlbnNlZCB0byB0aGUgcHVibGljIHVuZGVyIHRo
ZSB0ZXJtcyBvZiB0aGUgR05VIEdQTCAoPj0gMikKLy8gc2VlIHRoZSBmaWxlIENPUFlJTkcgZm9y
IGRldGFpbHMKCiNpbmNsdWRlIDxjY3R5cGU+CiNpbmNsdWRlIDxjc3RkbGliPgojaW5jbHVkZSA8
aW9zdHJlYW0+CiNpbmNsdWRlIDxtYXA+CiNpbmNsdWRlIDxzZXQ+CiNpbmNsdWRlIDxzc3RyZWFt
PgojaW5jbHVkZSA8c3RyaW5nPgoKI2luY2x1ZGUgPGJvb3N0L2xleGljYWxfY2FzdC5ocHA+CiNp
bmNsdWRlIDxib29zdC9keW5hbWljX2JpdHNldC5ocHA+CiNpbmNsdWRlIDxib29zdC9zaGFyZWRf
cHRyLmhwcD4KCiNpbmNsdWRlICJiYXNpY19pby5oaCIKI2luY2x1ZGUgImNoYW5nZV9zZXQuaGgi
CiNpbmNsdWRlICJjb25zdGFudHMuaGgiCiNpbmNsdWRlICJyZXZpc2lvbi5oaCIKI2luY2x1ZGUg
InNhbml0eS5oaCIKI2luY2x1ZGUgInRyYW5zZm9ybXMuaGgiCiNpbmNsdWRlICJ2b2NhYi5oaCIK
CgovLyBjYWxjdWxhdGluZyBsZWFzdCBjb21tb24gYW5jZXN0b3JzIGlzIGEgZGVsaWNhdGUgdGhp
bmcuCi8vIAovLyBpdCB0dXJucyBvdXQgdGhhdCB3ZSBjYW5ub3QgY2hvb3NlIHRoZSBzaW1wbGUg
ImxlYXN0IGNvbW1vbiBhbmNlc3RvciIKLy8gZm9yIHB1cnBvc2VzIG9mIGEgbWVyZ2UsIGJlY2F1
c2UgaXQgaXMgcG9zc2libGUgdGhhdCB0aGVyZSBhcmUgdHdvCi8vIGVxdWFsbHkgcmVhY2hhYmxl
IGNvbW1vbiBhbmNlc3RvcnMsIGFuZCB0aGlzIHByb2R1Y2VzIGFtYmlndWl0eSBpbiB0aGUKLy8g
bWVyZ2UuIHRoZSByZXN1bHQgLS0gaW4gYSBwYXRob2xvZ2ljYWwgY2FzZSAtLSBpcyBzaWxlbnRs
eSBhY2NlcHRpbmcgb25lCi8vIHNldCBvZiBlZGl0cyB3aGlsZSBkaXNjYXJkaW5nIGFub3RoZXI7
IG5vdCBleGFjdGx5IHdoYXQgeW91IHdhbnQgYQovLyB2ZXJzaW9uIGNvbnRyb2wgdG9vbCB0byBk
by4KLy8KLy8gYSBjb25zZXJ2YXRpdmUgYXBwcm94aW1hdGlvbiBpcyB3aGF0IHdlJ2xsIGNhbGwg
YSAic3ViZ3JhcGggcmVjdXJyaW5nIgovLyBMQ0EgYWxnb3JpdGhtLiB0aGlzIGlzIHNvbWV3aGF0
IGxpa2UgbG9jYXRpbmcgdGhlIGxlYXN0IGNvbW1vbiBkb21pbmF0b3IKLy8gbm9kZSwgYnV0IG5v
dCBxdWl0ZS4gaXQgaXMgYWN0dWFsbHkganVzdCBhIHZhbmlsbGEgTENBIHNlYXJjaCwgZXhjZXB0
Ci8vIHRoYXQgYW55IHRpbWUgdGhlcmUncyBhIGZvcmsgKGEgaGlzdG9yaWNhbCBtZXJnZSBsb29r
cyBsaWtlIGEgZm9yayBmcm9tCi8vIG91ciBwZXJzcGVjdGl2ZSwgd29ya2luZyBiYWNrd2FyZHMg
ZnJvbSBjaGlsZHJlbiB0byBwYXJlbnRzKSBpdCByZWR1Y2VzCi8vIHRoZSBmb3JrIHRvIGEgY29t
bW9uIHBhcmVudCB2aWEgYSBzZXF1ZW5jZSBvZiBwYWlyd2lzZSByZWN1cnNpdmUgY2FsbHMKLy8g
dG8gaXRzZWxmIGJlZm9yZSBwcm9jZWVkaW5nLiB0aGlzIHdpbGwgYWx3YXlzIHJlc29sdmUgdG8g
YSBjb21tb24gcGFyZW50Ci8vIHdpdGggbm8gYW1iaWd1aXR5LCB1bmxlc3MgaXQgZmFsbHMgb2Zm
IHRoZSByb290IG9mIHRoZSBncmFwaC4KLy8KLy8gdW5mb3J0dW5hdGVseSB0aGUgc3ViZ3JhcGgg
cmVjdXJyaW5nIGFsZ29yaXRobSBzb21ldGltZXMgZ29lcyB0b28gZmFyCi8vIGJhY2sgaW4gaGlz
dG9yeSAtLSBmb3IgZXhhbXBsZSBpZiB0aGVyZSBpcyBhbiB1bmFtYmlndW91cyBwcm9wYWdhdGUg
ZnJvbQovLyBvbmUgYnJhbmNoIHRvIGFub3RoZXIsIHRoZSBlbnRpcmUgc3ViZ3JhcGggcHJlY2Vl
ZGluZyB0aGUgcHJvcGFnYXRlIG9uCi8vIHRoZSByZWNpcGllbnQgYnJhbmNoIGlzIGVsaWRlZCwg
c2luY2UgaXQgaXMgYSBtZXJnZS4KLy8KLy8gb3VyIGN1cnJlbnQgaHlwb3RoZXNpcyBpcyB0aGF0
IHRoZSAqZXhhY3QqIGNvbmRpdGlvbiB3ZSdyZSBsb29raW5nIGZvciwKLy8gd2hlbiBkb2luZyBh
IG1lcmdlLCBpcyB0aGUgbGVhc3Qgbm9kZSB3aGljaCBkb21pbmF0ZXMgb25lIHNpZGUgb2YgdGhl
Ci8vIG1lcmdlIGFuZCBpcyBhbiBhbmNlc3RvciBvZiB0aGUgb3RoZXIuCgp0eXBlZGVmIHVuc2ln
bmVkIGxvbmcgY3R4Owp0eXBlZGVmIGJvb3N0OjpkeW5hbWljX2JpdHNldDw+IGJpdG1hcDsKdHlw
ZWRlZiBib29zdDo6c2hhcmVkX3B0cjxiaXRtYXA+IHNoYXJlZF9iaXRtYXA7CgpzdGF0aWMgdm9p
ZCAKZW5zdXJlX3BhcmVudHNfbG9hZGVkKGN0eCBjaGlsZCwKICAgICAgICAgICAgICAgICAgICAg
IHN0ZDo6bWFwPGN0eCwgc2hhcmVkX2JpdG1hcD4gJiBwYXJlbnRzLAogICAgICAgICAgICAgICAg
ICAgICAgaW50ZXJuZXI8Y3R4PiAmIGludGVybiwKICAgICAgICAgICAgICAgICAgICAgIGFwcF9z
dGF0ZSAmIGFwcCkKewogIGlmIChwYXJlbnRzLmZpbmQoY2hpbGQpICE9IHBhcmVudHMuZW5kKCkp
CiAgICByZXR1cm47CgogIEwoRigibG9hZGluZyBwYXJlbnRzIGZvciBub2RlICVkXG4iKSAlIGNo
aWxkKTsKCiAgc3RkOjpzZXQ8cmV2aXNpb25faWQ+IGltbV9wYXJlbnRzOwogIGFwcC5kYi5nZXRf
cmV2aXNpb25fcGFyZW50cyhyZXZpc2lvbl9pZChpbnRlcm4ubG9va3VwKGNoaWxkKSksIGltbV9w
YXJlbnRzKTsKCiAgLy8gVGhlIG51bGwgcmV2aXNpb24gaXMgbm90IGEgcGFyZW50IGZvciBwdXJw
b3NlcyBvZiBmaW5kaW5nIGNvbW1vbgogIC8vIGFuY2VzdG9ycy4KICBmb3IgKHN0ZDo6c2V0PHJl
dmlzaW9uX2lkPjo6aXRlcmF0b3IgcCA9IGltbV9wYXJlbnRzLmJlZ2luKCk7CiAgICAgICBwICE9
IGltbV9wYXJlbnRzLmVuZCgpOyArK3ApCiAgICB7CiAgICAgIGlmIChudWxsX2lkKCpwKSkKICAg
ICAgICBpbW1fcGFyZW50cy5lcmFzZShwKTsKICAgIH0KICAgICAgICAgICAgICAKICBzaGFyZWRf
Yml0bWFwIGJpdHMgPSBzaGFyZWRfYml0bWFwKG5ldyBiaXRtYXAocGFyZW50cy5zaXplKCkpKTsK
ICAKICBmb3IgKHN0ZDo6c2V0PHJldmlzaW9uX2lkPjo6Y29uc3RfaXRlcmF0b3IgcCA9IGltbV9w
YXJlbnRzLmJlZ2luKCk7CiAgICAgICBwICE9IGltbV9wYXJlbnRzLmVuZCgpOyArK3ApCiAgICB7
CiAgICAgIGN0eCBwbiA9IGludGVybi5pbnRlcm4ocC0+aW5uZXIoKSgpKTsKICAgICAgTChGKCJw
YXJlbnQgJXMgLT4gbm9kZSAlZFxuIikgJSAqcCAlIHBuKTsKICAgICAgaWYgKHBuID49IGJpdHMt
PnNpemUoKSkgCiAgICAgICAgYml0cy0+cmVzaXplKHBuKzEpOwogICAgICBiaXRzLT5zZXQocG4p
OwogICAgfQogICAgCiAgcGFyZW50cy5pbnNlcnQoc3RkOjptYWtlX3BhaXIoY2hpbGQsIGJpdHMp
KTsKfQoKc3RhdGljIGJvb2wgCmV4cGFuZF9kb21pbmF0b3JzKHN0ZDo6bWFwPGN0eCwgc2hhcmVk
X2JpdG1hcD4gJiBwYXJlbnRzLAogICAgICAgICAgICAgICAgICBzdGQ6Om1hcDxjdHgsIHNoYXJl
ZF9iaXRtYXA+ICYgZG9taW5hdG9ycywKICAgICAgICAgICAgICAgICAgaW50ZXJuZXI8Y3R4PiAm
IGludGVybiwKICAgICAgICAgICAgICAgICAgYXBwX3N0YXRlICYgYXBwKQp7CiAgYm9vbCBzb21l
dGhpbmdfY2hhbmdlZCA9IGZhbHNlOwogIHN0ZDo6dmVjdG9yPGN0eD4gbm9kZXM7CgogIG5vZGVz
LnJlc2VydmUoZG9taW5hdG9ycy5zaXplKCkpOwoKICAvLyBwYXNzIDEsIHB1bGwgb3V0IGFsbCB0
aGUgbm9kZSBudW1iZXJzIHdlJ3JlIGdvaW5nIHRvIHNjYW4gdGhpcyB0aW1lIGFyb3VuZAogIGZv
ciAoc3RkOjptYXA8Y3R4LCBzaGFyZWRfYml0bWFwPjo6Y29uc3RfaXRlcmF0b3IgZSA9IGRvbWlu
YXRvcnMuYmVnaW4oKTsgCiAgICAgICBlICE9IGRvbWluYXRvcnMuZW5kKCk7ICsrZSkKICAgIG5v
ZGVzLnB1c2hfYmFjayhlLT5maXJzdCk7CiAgCiAgLy8gcGFzcyAyLCB1cGRhdGUgYW55IG9mIHRo
ZSBkb21pbmF0b3IgZW50cmllcyB3ZSBjYW4KICBmb3IgKHN0ZDo6dmVjdG9yPGN0eD46OmNvbnN0
X2l0ZXJhdG9yIG4gPSBub2Rlcy5iZWdpbigpOyAKICAgICAgIG4gIT0gbm9kZXMuZW5kKCk7ICsr
bikKICAgIHsKICAgICAgc2hhcmVkX2JpdG1hcCBiaXRzID0gZG9taW5hdG9yc1sqbl07CiAgICAg
IGJpdG1hcCBzYXZlZCgqYml0cyk7CiAgICAgIGlmIChiaXRzLT5zaXplKCkgPD0gKm4pCiAgICAg
ICAgYml0cy0+cmVzaXplKCpuICsgMSk7CiAgICAgIGJpdHMtPnNldCgqbik7CiAgICAgIAogICAg
ICBlbnN1cmVfcGFyZW50c19sb2FkZWQoKm4sIHBhcmVudHMsIGludGVybiwgYXBwKTsKICAgICAg
c2hhcmVkX2JpdG1hcCBuX3BhcmVudHMgPSBwYXJlbnRzWypuXTsKICAgICAgCiAgICAgIGJpdG1h
cCBpbnRlcnNlY3Rpb24oYml0cy0+c2l6ZSgpKTsKICAgICAgCiAgICAgIGJvb2wgZmlyc3QgPSB0
cnVlOwogICAgICBmb3IgKHVuc2lnbmVkIGxvbmcgcGFyZW50ID0gMDsgCiAgICAgICAgICAgcGFy
ZW50ICE9IG5fcGFyZW50cy0+c2l6ZSgpOyArK3BhcmVudCkKICAgICAgICB7CiAgICAgICAgICBp
ZiAoISBuX3BhcmVudHMtPnRlc3QocGFyZW50KSkKICAgICAgICAgICAgY29udGludWU7CgogICAg
ICAgICAgaWYgKGRvbWluYXRvcnMuZmluZChwYXJlbnQpID09IGRvbWluYXRvcnMuZW5kKCkpCiAg
ICAgICAgICAgIGRvbWluYXRvcnMuaW5zZXJ0KHN0ZDo6bWFrZV9wYWlyKHBhcmVudCwgCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYXJlZF9iaXRtYXAobmV3
IGJpdG1hcCgpKSkpOwogICAgICAgICAgc2hhcmVkX2JpdG1hcCBwYml0cyA9IGRvbWluYXRvcnNb
cGFyZW50XTsKCiAgICAgICAgICBpZiAoYml0cy0+c2l6ZSgpID4gcGJpdHMtPnNpemUoKSkKICAg
ICAgICAgICAgcGJpdHMtPnJlc2l6ZShiaXRzLT5zaXplKCkpOwoKICAgICAgICAgIGlmIChwYml0
cy0+c2l6ZSgpID4gYml0cy0+c2l6ZSgpKQogICAgICAgICAgICBiaXRzLT5yZXNpemUocGJpdHMt
PnNpemUoKSk7CgogICAgICAgICAgaWYgKGZpcnN0KQogICAgICAgICAgICB7CiAgICAgICAgICAg
ICAgaW50ZXJzZWN0aW9uID0gKCpwYml0cyk7CiAgICAgICAgICAgICAgZmlyc3QgPSBmYWxzZTsK
ICAgICAgICAgICAgfQogICAgICAgICAgZWxzZQogICAgICAgICAgICBpbnRlcnNlY3Rpb24gJj0g
KCpwYml0cyk7CiAgICAgICAgfQoKICAgICAgKCpiaXRzKSB8PSBpbnRlcnNlY3Rpb247CiAgICAg
IGlmICgqYml0cyAhPSBzYXZlZCkKICAgICAgICBzb21ldGhpbmdfY2hhbmdlZCA9IHRydWU7CiAg
ICB9CiAgcmV0dXJuIHNvbWV0aGluZ19jaGFuZ2VkOwp9CgoKc3RhdGljIGJvb2wgCmV4cGFuZF9h
bmNlc3RvcnMoc3RkOjptYXA8Y3R4LCBzaGFyZWRfYml0bWFwPiAmIHBhcmVudHMsCiAgICAgICAg
ICAgICAgICAgc3RkOjptYXA8Y3R4LCBzaGFyZWRfYml0bWFwPiAmIGFuY2VzdG9ycywKICAgICAg
ICAgICAgICAgICBpbnRlcm5lcjxjdHg+ICYgaW50ZXJuLAogICAgICAgICAgICAgICAgIGFwcF9z
dGF0ZSAmIGFwcCkKewogIGJvb2wgc29tZXRoaW5nX2NoYW5nZWQgPSBmYWxzZTsKICBzdGQ6OnZl
Y3RvcjxjdHg+IG5vZGVzOwoKICBub2Rlcy5yZXNlcnZlKGFuY2VzdG9ycy5zaXplKCkpOwoKICAv
LyBwYXNzIDEsIHB1bGwgb3V0IGFsbCB0aGUgbm9kZSBudW1iZXJzIHdlJ3JlIGdvaW5nIHRvIHNj
YW4gdGhpcyB0aW1lIGFyb3VuZAogIGZvciAoc3RkOjptYXA8Y3R4LCBzaGFyZWRfYml0bWFwPjo6
Y29uc3RfaXRlcmF0b3IgZSA9IGFuY2VzdG9ycy5iZWdpbigpOyAKICAgICAgIGUgIT0gYW5jZXN0
b3JzLmVuZCgpOyArK2UpCiAgICBub2Rlcy5wdXNoX2JhY2soZS0+Zmlyc3QpOwogIAogIC8vIHBh
c3MgMiwgdXBkYXRlIGFueSBvZiB0aGUgYW5jZXN0b3IgZW50cmllcyB3ZSBjYW4KICBmb3IgKHN0
ZDo6dmVjdG9yPGN0eD46OmNvbnN0X2l0ZXJhdG9yIG4gPSBub2Rlcy5iZWdpbigpOyBuICE9IG5v
ZGVzLmVuZCgpOyArK24pCiAgICB7CiAgICAgIHNoYXJlZF9iaXRtYXAgYml0cyA9IGFuY2VzdG9y
c1sqbl07CiAgICAgIGJpdG1hcCBzYXZlZCgqYml0cyk7CiAgICAgIGlmIChiaXRzLT5zaXplKCkg
PD0gKm4pCiAgICAgICAgYml0cy0+cmVzaXplKCpuICsgMSk7CiAgICAgIGJpdHMtPnNldCgqbik7
CgogICAgICBlbnN1cmVfcGFyZW50c19sb2FkZWQoKm4sIHBhcmVudHMsIGludGVybiwgYXBwKTsK
ICAgICAgc2hhcmVkX2JpdG1hcCBuX3BhcmVudHMgPSBwYXJlbnRzWypuXTsKICAgICAgZm9yIChj
dHggcGFyZW50ID0gMDsgcGFyZW50ICE9IG5fcGFyZW50cy0+c2l6ZSgpOyArK3BhcmVudCkKICAg
ICAgICB7CiAgICAgICAgICBpZiAoISBuX3BhcmVudHMtPnRlc3QocGFyZW50KSkKICAgICAgICAg
ICAgY29udGludWU7CgogICAgICAgICAgaWYgKGJpdHMtPnNpemUoKSA8PSBwYXJlbnQpCiAgICAg
ICAgICAgIGJpdHMtPnJlc2l6ZShwYXJlbnQgKyAxKTsKICAgICAgICAgIGJpdHMtPnNldChwYXJl
bnQpOwoKICAgICAgICAgIGlmIChhbmNlc3RvcnMuZmluZChwYXJlbnQpID09IGFuY2VzdG9ycy5l
bmQoKSkKICAgICAgICAgICAgYW5jZXN0b3JzLmluc2VydChtYWtlX3BhaXIocGFyZW50LCAKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYXJlZF9iaXRtYXAobmV3IGJp
dG1hcCgpKSkpOwogICAgICAgICAgc2hhcmVkX2JpdG1hcCBwYml0cyA9IGFuY2VzdG9yc1twYXJl
bnRdOwoKICAgICAgICAgIGlmIChiaXRzLT5zaXplKCkgPiBwYml0cy0+c2l6ZSgpKQogICAgICAg
ICAgICBwYml0cy0+cmVzaXplKGJpdHMtPnNpemUoKSk7CgogICAgICAgICAgaWYgKHBiaXRzLT5z
aXplKCkgPiBiaXRzLT5zaXplKCkpCiAgICAgICAgICAgIGJpdHMtPnJlc2l6ZShwYml0cy0+c2l6
ZSgpKTsKCiAgICAgICAgICAoKmJpdHMpIHw9ICgqcGJpdHMpOwogICAgICAgIH0KICAgICAgaWYg
KCpiaXRzICE9IHNhdmVkKQogICAgICAgIHNvbWV0aGluZ19jaGFuZ2VkID0gdHJ1ZTsKICAgIH0K
ICByZXR1cm4gc29tZXRoaW5nX2NoYW5nZWQ7Cn0KCnN0YXRpYyBib29sIApmaW5kX2ludGVyc2Vj
dGluZ19ub2RlKGJpdG1hcCAmIGZzdCwgCiAgICAgICAgICAgICAgICAgICAgICAgYml0bWFwICYg
c25kLCAKICAgICAgICAgICAgICAgICAgICAgICBpbnRlcm5lcjxjdHg+IGNvbnN0ICYgaW50ZXJu
LCAKICAgICAgICAgICAgICAgICAgICAgICByZXZpc2lvbl9pZCAmIGFuYykKewogIAogIGlmIChm
c3Quc2l6ZSgpID4gc25kLnNpemUoKSkKICAgIHNuZC5yZXNpemUoZnN0LnNpemUoKSk7CiAgZWxz
ZSBpZiAoc25kLnNpemUoKSA+IGZzdC5zaXplKCkpCiAgICBmc3QucmVzaXplKHNuZC5zaXplKCkp
OwogIAogIGJpdG1hcCBpbnRlcnNlY3Rpb24gPSBmc3QgJiBzbmQ7CiAgaWYgKGludGVyc2VjdGlv
bi5hbnkoKSkKICAgIHsKICAgICAgTChGKCJmb3VuZCAlZCBpbnRlcnNlY3Rpbmcgbm9kZXNcbiIp
ICUgaW50ZXJzZWN0aW9uLmNvdW50KCkpOwogICAgICBmb3IgKGN0eCBpID0gMDsgaSA8IGludGVy
c2VjdGlvbi5zaXplKCk7ICsraSkKICAgICAgICB7CiAgICAgICAgICBpZiAoaW50ZXJzZWN0aW9u
LnRlc3QoaSkpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBhbmMgPSByZXZpc2lvbl9pZChp
bnRlcm4ubG9va3VwKGkpKTsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAg
fQogICAgICAgIH0KICAgIH0KICByZXR1cm4gZmFsc2U7Cn0KCi8vICBzdGF0aWMgdm9pZAovLyAg
ZHVtcF9iaXRzZXRfbWFwKHN0ZDo6c3RyaW5nIGNvbnN0ICYgaGRyLAovLyAgICAgICAgICAgICAg
c3RkOjptYXA8IGN0eCwgc2hhcmVkX2JpdG1hcCA+IGNvbnN0ICYgbW0pCi8vICB7Ci8vICAgIEwo
RigiZHVtcGluZyBbJXNdICglZCBlbnRyaWVzKVxuIikgJSBoZHIgJSBtbS5zaXplKCkpOwovLyAg
ICBmb3IgKHN0ZDo6bWFwPCBjdHgsIHNoYXJlZF9iaXRtYXAgPjo6Y29uc3RfaXRlcmF0b3IgaSA9
IG1tLmJlZ2luKCk7Ci8vICAgICAgICAgaSAhPSBtbS5lbmQoKTsgKytpKQovLyAgICAgIHsKLy8g
ICAgICAgIEwoRigiZHVtcCBbJXNdOiAlZCAtPiAlc1xuIikgJSBoZHIgJSBpLT5maXJzdCAlICgq
KGktPnNlY29uZCkpKTsKLy8gICAgICB9Ci8vICB9Cgpib29sIApmaW5kX2NvbW1vbl9hbmNlc3Rv
cl9mb3JfbWVyZ2UocmV2aXNpb25faWQgY29uc3QgJiBsZWZ0LAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgcmV2aXNpb25faWQgY29uc3QgJiByaWdodCwKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHJldmlzaW9uX2lkICYgYW5jLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgYXBwX3N0YXRlICYgYXBwKQp7CiAgaW50ZXJuZXI8Y3R4PiBpbnRlcm47CiAgc3RkOjpt
YXA8IGN0eCwgc2hhcmVkX2JpdG1hcCA+IAogICAgcGFyZW50cywgYW5jZXN0b3JzLCBkb21pbmF0
b3JzOwogIAogIGN0eCBsbiA9IGludGVybi5pbnRlcm4obGVmdC5pbm5lcigpKCkpOwogIGN0eCBy
biA9IGludGVybi5pbnRlcm4ocmlnaHQuaW5uZXIoKSgpKTsKICAKICBzaGFyZWRfYml0bWFwIGxh
bmMgPSBzaGFyZWRfYml0bWFwKG5ldyBiaXRtYXAoKSk7CiAgc2hhcmVkX2JpdG1hcCByYW5jID0g
c2hhcmVkX2JpdG1hcChuZXcgYml0bWFwKCkpOwogIHNoYXJlZF9iaXRtYXAgbGRvbSA9IHNoYXJl
ZF9iaXRtYXAobmV3IGJpdG1hcCgpKTsKICBzaGFyZWRfYml0bWFwIHJkb20gPSBzaGFyZWRfYml0
bWFwKG5ldyBiaXRtYXAoKSk7CgogIGFuY2VzdG9ycy5pbnNlcnQobWFrZV9wYWlyKGxuLCBsYW5j
KSk7CiAgYW5jZXN0b3JzLmluc2VydChtYWtlX3BhaXIocm4sIHJhbmMpKTsKICBkb21pbmF0b3Jz
Lmluc2VydChtYWtlX3BhaXIobG4sIGxkb20pKTsKICBkb21pbmF0b3JzLmluc2VydChtYWtlX3Bh
aXIocm4sIHJkb20pKTsKICAKICBMKEYoInNlYXJjaGluZyBmb3IgY29tbW9uIGFuY2VzdG9yLCBs
ZWZ0PSVzIHJpZ2h0PSVzXG4iKSAlIGxlZnQgJSByaWdodCk7CiAgCiAgd2hpbGUgKGV4cGFuZF9h
bmNlc3RvcnMocGFyZW50cywgYW5jZXN0b3JzLCBpbnRlcm4sIGFwcCkgfHwKICAgICAgICAgZXhw
YW5kX2RvbWluYXRvcnMocGFyZW50cywgZG9taW5hdG9ycywgaW50ZXJuLCBhcHApKQogICAgewog
ICAgICBMKEYoImNvbW1vbiBhbmNlc3RvciBzY2FuIFtwYXI9JWQsYW5jPSVkLGRvbT0lZF1cbiIp
ICUgCiAgICAgICAgcGFyZW50cy5zaXplKCkgJSBhbmNlc3RvcnMuc2l6ZSgpICUgZG9taW5hdG9y
cy5zaXplKCkpOwoKICAgICAgaWYgKGZpbmRfaW50ZXJzZWN0aW5nX25vZGUoKmxhbmMsICpyZG9t
LCBpbnRlcm4sIGFuYykpCiAgICAgICAgewogICAgICAgICAgTChGKCJmb3VuZCBub2RlICVkLCBh
bmNlc3RvciBvZiBsZWZ0ICVzIGFuZCBkb21pbmF0aW5nIHJpZ2h0ICVzXG4iKQogICAgICAgICAg
ICAlIGFuYyAlIGxlZnQgJSByaWdodCk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9
CiAgICAgIAogICAgICBlbHNlIGlmIChmaW5kX2ludGVyc2VjdGluZ19ub2RlKCpyYW5jLCAqbGRv
bSwgaW50ZXJuLCBhbmMpKQogICAgICAgIHsKICAgICAgICAgIEwoRigiZm91bmQgbm9kZSAlZCwg
YW5jZXN0b3Igb2YgcmlnaHQgJXMgYW5kIGRvbWluYXRpbmcgbGVmdCAlc1xuIikKICAgICAgICAg
ICAgJSBhbmMgJSByaWdodCAlIGxlZnQpOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAg
fQogICAgfQovLyAgICAgIGR1bXBfYml0c2V0X21hcCgiYW5jZXN0b3JzIiwgYW5jZXN0b3JzKTsK
Ly8gICAgICBkdW1wX2JpdHNldF9tYXAoImRvbWluYXRvcnMiLCBkb21pbmF0b3JzKTsKLy8gICAg
ICBkdW1wX2JpdHNldF9tYXAoInBhcmVudHMiLCBwYXJlbnRzKTsKICByZXR1cm4gZmFsc2U7Cn0K
Cgpib29sCmZpbmRfbGVhc3RfY29tbW9uX2FuY2VzdG9yKHJldmlzaW9uX2lkIGNvbnN0ICYgbGVm
dCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV2aXNpb25faWQgY29uc3QgJiByaWdodCwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV2aXNpb25faWQgJiBhbmMsCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGFwcF9zdGF0ZSAmIGFwcCkKewogIGludGVybmVyPGN0eD4gaW50ZXJu
OwogIHN0ZDo6bWFwPCBjdHgsIHNoYXJlZF9iaXRtYXAgPgogICAgcGFyZW50cywgYW5jZXN0b3Jz
LCBkb21pbmF0b3JzOwoKICBjdHggbG4gPSBpbnRlcm4uaW50ZXJuKGxlZnQuaW5uZXIoKSgpKTsK
ICBjdHggcm4gPSBpbnRlcm4uaW50ZXJuKHJpZ2h0LmlubmVyKCkoKSk7CgogIHNoYXJlZF9iaXRt
YXAgbGFuYyA9IHNoYXJlZF9iaXRtYXAobmV3IGJpdG1hcCgpKTsKICBzaGFyZWRfYml0bWFwIHJh
bmMgPSBzaGFyZWRfYml0bWFwKG5ldyBiaXRtYXAoKSk7CgogIGFuY2VzdG9ycy5pbnNlcnQobWFr
ZV9wYWlyKGxuLCBsYW5jKSk7CiAgYW5jZXN0b3JzLmluc2VydChtYWtlX3BhaXIocm4sIHJhbmMp
KTsKCiAgTChGKCJzZWFyY2hpbmcgZm9yIGxlYXN0IGNvbW1vbiBhbmNlc3RvciwgbGVmdD0lcyBy
aWdodD0lc1xuIikgJSBsZWZ0ICUgcmlnaHQpOwoKICB3aGlsZSAoZXhwYW5kX2FuY2VzdG9ycyhw
YXJlbnRzLCBhbmNlc3RvcnMsIGludGVybiwgYXBwKSkKICAgIHsKICAgICAgTChGKCJsZWFzdCBj
b21tb24gYW5jZXN0b3Igc2NhbiBbcGFyPSVkLGFuYz0lZF1cbiIpICUKICAgICAgICBwYXJlbnRz
LnNpemUoKSAlIGFuY2VzdG9ycy5zaXplKCkpOwoKICAgICAgaWYgKGZpbmRfaW50ZXJzZWN0aW5n
X25vZGUoKmxhbmMsICpyYW5jLCBpbnRlcm4sIGFuYykpCiAgICAgICAgewogICAgICAgICAgTChG
KCJmb3VuZCBub2RlICVkLCBhbmNlc3RvciBvZiBsZWZ0ICVzIGFuZCByaWdodCAlc1xuIikKICAg
ICAgICAgICAgJSBhbmMgJSBsZWZ0ICUgcmlnaHQpOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAg
ICAgICAgfQogICAgfQovLyAgICAgIGR1bXBfYml0c2V0X21hcCgiYW5jZXN0b3JzIiwgYW5jZXN0
b3JzKTsKLy8gICAgICBkdW1wX2JpdHNldF9tYXAoInBhcmVudHMiLCBwYXJlbnRzKTsKICByZXR1
cm4gZmFsc2U7Cn0KCgovLyAKLy8gVGhlIGlkZWEgd2l0aCB0aGlzIGFsZ29yaXRobSBpcyB0byB3
YWxrIGZyb20gY2hpbGQgdXAgdG8gYW5jZXN0b3IsCi8vIHJlY3Vyc2l2ZWx5LCBhY2N1bXVsYXRp
bmcgYWxsIHRoZSBjaGFuZ2Vfc2V0cyBhc3NvY2lhdGVkIHdpdGgKLy8gaW50ZXJtZWRpYXRlIG5v
ZGVzIGludG8gKm9uZSBiaWcgY2hhbmdlX3NldCouCi8vCi8vIGNsZXZlciByZWFkZXJzIHdpbGwg
cmVhbGl6ZSB0aGlzIGlzIGFuIG92ZXJsYXBwaW5nLXN1YnByb2JsZW0gdHlwZQovLyBzaXR1YXRp
b24gYW5kIHRodXMgbmVlZHMgdG8ga2VlcCBhIGR5bmFtaWMgcHJvZ3JhbW1pbmcgbWFwIHRvIGtl
ZXAKLy8gaXRzZWxmIGluIGxpbmVhciBjb21wbGV4aXR5LgovLwovLyBpbiBmYWN0LCB3ZSBrZWVw
IHR3bzogb25lIHdoaWNoIG1hcHMgdG8gY29tcHV0ZWQgcmVzdWx0cyAocGFydGlhbF9jc2V0cykK
Ly8gYW5kIG9uZSB3aGljaCBqdXN0IGtlZXBzIGEgc2V0IG9mIGFsbCBub2RlcyB3ZSB0cmF2ZXJz
ZWQKLy8gKHZpc2l0ZWRfbm9kZXMpLiBpbiB0aGVvcnkgaXQgY291bGQgYmUgb25lIG1hcCB3aXRo
IGFuIGV4dHJhIGJvb2wgc3R1Y2sKLy8gb24gZWFjaCBlbnRyeSwgYnV0IEkgdGhpbmsgdGhhdCB3
b3VsZCBtYWtlIGl0IGV2ZW4gbGVzcyByZWFkYWJsZS4gaXQncwovLyBhbHJlYWR5IHF1aXRlIHVn
bHkuCi8vCgpzdGF0aWMgYm9vbCAKY2FsY3VsYXRlX2NoYW5nZV9zZXRzX3JlY3Vyc2l2ZShyZXZp
c2lvbl9pZCBjb25zdCAmIGFuY2VzdG9yLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHJldmlzaW9uX2lkIGNvbnN0ICYgY2hpbGQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgYXBwX3N0YXRlICYgYXBwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5n
ZV9zZXQgJiBjdW11bGF0aXZlX2NzZXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
c3RkOjptYXA8cmV2aXNpb25faWQsIGJvb3N0OjpzaGFyZWRfcHRyPGNoYW5nZV9zZXQ+ID4gJiBw
YXJ0aWFsX2NzZXRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZDo6c2V0PHJl
dmlzaW9uX2lkPiAmIHZpc2l0ZWRfbm9kZXMpCnsKCiAgaWYgKGFuY2VzdG9yID09IGNoaWxkKQog
ICAgcmV0dXJuIHRydWU7CgogIHZpc2l0ZWRfbm9kZXMuaW5zZXJ0KGNoaWxkKTsKCiAgYm9vbCBy
ZWxldmFudF9jaGlsZCA9IGZhbHNlOwoKICByZXZpc2lvbl9zZXQgcmV2OwogIGFwcC5kYi5nZXRf
cmV2aXNpb24oY2hpbGQsIHJldik7CgogIEwoRigiZXhwbG9yaW5nIGNoYW5nZXNldHMgZnJvbSBw
YXJlbnRzIG9mICVzLCBzZWVraW5nIHRvd2FyZHMgJXNcbiIpIAogICAgJSBjaGlsZCAlIGFuY2Vz
dG9yKTsKCiAgZm9yKGVkZ2VfbWFwOjpjb25zdF9pdGVyYXRvciBpID0gcmV2LmVkZ2VzLmJlZ2lu
KCk7IGkgIT0gcmV2LmVkZ2VzLmVuZCgpOyArK2kpCiAgICB7CiAgICAgIGJvb2wgcmVsZXZhbnRf
cGFyZW50ID0gZmFsc2U7CiAgICAgIHJldmlzaW9uX2lkIGN1cnJfcGFyZW50ID0gZWRnZV9vbGRf
cmV2aXNpb24oaSk7CgogICAgICBpZiAoY3Vycl9wYXJlbnQuaW5uZXIoKSgpLmVtcHR5KCkpCiAg
ICAgICAgY29udGludWU7CgogICAgICBjaGFuZ2Vfc2V0IGNzZXRfdG9fY3Vycl9wYXJlbnQ7Cgog
ICAgICBMKEYoImNvbnNpZGVyaW5nIHBhcmVudCAlcyBvZiAlc1xuIikgJSBjdXJyX3BhcmVudCAl
IGNoaWxkKTsKCiAgICAgIHN0ZDo6bWFwPHJldmlzaW9uX2lkLCBib29zdDo6c2hhcmVkX3B0cjxj
aGFuZ2Vfc2V0PiA+Ojpjb25zdF9pdGVyYXRvciBqID0gCiAgICAgICAgcGFydGlhbF9jc2V0cy5m
aW5kKGN1cnJfcGFyZW50KTsKICAgICAgaWYgKGogIT0gcGFydGlhbF9jc2V0cy5lbmQoKSkgCiAg
ICAgICAgewogICAgICAgICAgLy8gYSByZWN1cnNpdmUgY2FsbCBoYXMgdHJhdmVyc2VkIHRoaXMg
cGFyZW50IGJlZm9yZSBhbmQgYnVpbHQgYW4KICAgICAgICAgIC8vIGV4aXN0aW5nIGNzZXQuIGp1
c3QgcmV1c2UgdGhhdCByYXRoZXIgdGhhbiByZS10cmF2ZXJzaW5nCiAgICAgICAgICBjc2V0X3Rv
X2N1cnJfcGFyZW50ID0gKihqLT5zZWNvbmQpOwogICAgICAgICAgcmVsZXZhbnRfcGFyZW50ID0g
dHJ1ZTsKICAgICAgICB9CiAgICAgIGVsc2UgaWYgKHZpc2l0ZWRfbm9kZXMuZmluZChjdXJyX3Bh
cmVudCkgIT0gdmlzaXRlZF9ub2Rlcy5lbmQoKSkKICAgICAgICB7CiAgICAgICAgICAvLyBhIHJl
Y3Vyc2l2ZSBjYWxsIGhhcyB0cmF2ZXJzZWQgdGhpcyBwYXJlbnQsIGJ1dCB0aGVyZSB3YXMgbm8K
ICAgICAgICAgIC8vIHBhdGggZnJvbSBpdCB0byB0aGUgcm9vdCwgc28gdGhlIHBhcmVudCBpcyBp
cnJlbGV2YW50LiBza2lwLgogICAgICAgICAgcmVsZXZhbnRfcGFyZW50ID0gZmFsc2U7CiAgICAg
ICAgfQogICAgICBlbHNlCiAgICAgICAgcmVsZXZhbnRfcGFyZW50ID0gY2FsY3VsYXRlX2NoYW5n
ZV9zZXRzX3JlY3Vyc2l2ZShhbmNlc3RvciwgY3Vycl9wYXJlbnQsIGFwcCwgCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjc2V0X3RvX2N1
cnJfcGFyZW50LCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHBhcnRpYWxfY3NldHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXNpdGVkX25vZGVzKTsKCiAgICAgIGlmIChy
ZWxldmFudF9wYXJlbnQpCiAgICAgICAgewogICAgICAgICAgTChGKCJyZXZpc2lvbiAlcyBpcyBy
ZWxldmFudCwgY29tcG9zaW5nIHdpdGggZWRnZSB0byAlc1xuIikgCiAgICAgICAgICAgICUgY3Vy
cl9wYXJlbnQgJSBjaGlsZCk7CiAgICAgICAgICBjb25jYXRlbmF0ZV9jaGFuZ2Vfc2V0cyhjc2V0
X3RvX2N1cnJfcGFyZW50LCBlZGdlX2NoYW5nZXMoaSksIGN1bXVsYXRpdmVfY3NldCk7CiAgICAg
ICAgICByZWxldmFudF9jaGlsZCA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAg
ICAgIGVsc2UKICAgICAgICBMKEYoInBhcmVudCAlcyBvZiAlcyBpcyBub3QgcmVsZXZhbnRcbiIp
ICUgY3Vycl9wYXJlbnQgJSBjaGlsZCk7CiAgICB9CgogIC8vIHN0b3JlIHRoZSBwYXJ0aWFsIGVk
Z2UgZnJvbSBhbmNlc3RvciAtPiBjaGlsZCwgc28gdGhhdCBpZiBhbnlvbmUKICAvLyByZS10cmF2
ZXJzZXMgdGhpcyBlZGdlIHRoZXknbGwganVzdCBmZXRjaCBmcm9tIHRoZSBwYXJ0aWFsX2VkZ2Vz
CiAgLy8gY2FjaGUuCiAgaWYgKHJlbGV2YW50X2NoaWxkKQogICAgcGFydGlhbF9jc2V0cy5pbnNl
cnQoc3RkOjptYWtlX3BhaXIoY2hpbGQsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgYm9vc3Q6OnNoYXJlZF9wdHI8Y2hhbmdlX3NldD4KICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIChuZXcgY2hhbmdlX3NldChjdW11bGF0aXZlX2NzZXQpKSkp
OwogIAogIHJldHVybiByZWxldmFudF9jaGlsZDsKfQoKdm9pZCAKY2FsY3VsYXRlX2NvbXBvc2l0
ZV9jaGFuZ2Vfc2V0KHJldmlzaW9uX2lkIGNvbnN0ICYgYW5jZXN0b3IsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICByZXZpc2lvbl9pZCBjb25zdCAmIGNoaWxkLAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgYXBwX3N0YXRlICYgYXBwLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgY2hhbmdlX3NldCAmIGNvbXBvc2VkKQp7CiAgTChGKCJjYWxjdWxhdGluZyBjb21w
b3NpdGUgY2hhbmdlc2V0IGJldHdlZW4gJXMgYW5kICVzXG4iKQogICAgJSBhbmNlc3RvciAlIGNo
aWxkKTsKICBzdGQ6OnNldDxyZXZpc2lvbl9pZD4gdmlzaXRlZDsKICBzdGQ6Om1hcDxyZXZpc2lv
bl9pZCwgYm9vc3Q6OnNoYXJlZF9wdHI8Y2hhbmdlX3NldD4gPiBwYXJ0aWFsOwogIGNhbGN1bGF0
ZV9jaGFuZ2Vfc2V0c19yZWN1cnNpdmUoYW5jZXN0b3IsIGNoaWxkLCBhcHAsIGNvbXBvc2VkLCBw
YXJ0aWFsLCB2aXNpdGVkKTsKfQoKLy8gbWlncmF0aW9uIHN0dWZmCi8vCi8vIEZJWE1FOiB0aGVz
ZSBhcmUgdGVtcG9yYXJ5IGZ1bmN0aW9ucywgb25jZSB3ZSd2ZSBkb25lIHRoZSBtaWdyYXRpb24g
dG8KLy8gcmV2aXNpb25zIC8gY2hhbmdlc2V0cywgd2UgY2FuIHJlbW92ZSB0aGVtLgoKc3RhdGlj
IHZvaWQgCmFuYWx5emVfbWFuaWZlc3RfY2hhbmdlcyhhcHBfc3RhdGUgJiBhcHAsCiAgICAgICAg
ICAgICAgICAgICAgICAgICBtYW5pZmVzdF9pZCBjb25zdCAmIHBhcmVudCwgCiAgICAgICAgICAg
ICAgICAgICAgICAgICBtYW5pZmVzdF9pZCBjb25zdCAmIGNoaWxkLCAKICAgICAgICAgICAgICAg
ICAgICAgICAgIGNoYW5nZV9zZXQgJiBjcykKewogIG1hbmlmZXN0X21hcCBtX3BhcmVudCwgbV9j
aGlsZDsKICBhcHAuZGIuZ2V0X21hbmlmZXN0KHBhcmVudCwgbV9wYXJlbnQpOwogIGFwcC5kYi5n
ZXRfbWFuaWZlc3QoY2hpbGQsIG1fY2hpbGQpOwoKICBmb3IgKG1hbmlmZXN0X21hcDo6Y29uc3Rf
aXRlcmF0b3IgaSA9IG1fcGFyZW50LmJlZ2luKCk7IAogICAgICAgaSAhPSBtX3BhcmVudC5lbmQo
KTsgKytpKQogICAgewogICAgICBtYW5pZmVzdF9tYXA6OmNvbnN0X2l0ZXJhdG9yIGogPSBtX2No
aWxkLmZpbmQobWFuaWZlc3RfZW50cnlfcGF0aChpKSk7CiAgICAgIGlmIChqID09IG1fY2hpbGQu
ZW5kKCkpCiAgICAgICAgY3MuZGVsZXRlX2ZpbGUobWFuaWZlc3RfZW50cnlfcGF0aChpKSk7CiAg
ICAgIGVsc2UgaWYgKCEgKG1hbmlmZXN0X2VudHJ5X2lkKGkpID09IG1hbmlmZXN0X2VudHJ5X2lk
KGopKSkKICAgICAgICB7CiAgICAgICAgICBjcy5hcHBseV9kZWx0YShtYW5pZmVzdF9lbnRyeV9w
YXRoKGkpLAogICAgICAgICAgICAgICAgICAgICAgICAgbWFuaWZlc3RfZW50cnlfaWQoaSksIAog
ICAgICAgICAgICAgICAgICAgICAgICAgbWFuaWZlc3RfZW50cnlfaWQoaikpOwogICAgICAgIH0g
ICAgICAgCiAgICB9CiAgZm9yIChtYW5pZmVzdF9tYXA6OmNvbnN0X2l0ZXJhdG9yIGkgPSBtX2No
aWxkLmJlZ2luKCk7IAogICAgICAgaSAhPSBtX2NoaWxkLmVuZCgpOyArK2kpCiAgICB7CiAgICAg
IG1hbmlmZXN0X21hcDo6Y29uc3RfaXRlcmF0b3IgaiA9IG1fcGFyZW50LmZpbmQobWFuaWZlc3Rf
ZW50cnlfcGF0aChpKSk7CiAgICAgIGlmIChqID09IG1fcGFyZW50LmVuZCgpKQogICAgICAgIGNz
LmFkZF9maWxlKG1hbmlmZXN0X2VudHJ5X3BhdGgoaSksCiAgICAgICAgICAgICAgICAgICAgbWFu
aWZlc3RfZW50cnlfaWQoaSkpOwogICAgfQp9CgpzdGF0aWMgcmV2aXNpb25faWQKY29uc3RydWN0
X3JldmlzaW9ucyhhcHBfc3RhdGUgJiBhcHAsCiAgICAgICAgICAgICAgICAgICAgbWFuaWZlc3Rf
aWQgY29uc3QgJiBjaGlsZCwKICAgICAgICAgICAgICAgICAgICBzdGQ6Om11bHRpbWFwPCBtYW5p
ZmVzdF9pZCwgbWFuaWZlc3RfaWQgPiBjb25zdCAmIGFuY2VzdHJ5LAogICAgICAgICAgICAgICAg
ICAgIHN0ZDo6bWFwPG1hbmlmZXN0X2lkLCByZXZpc2lvbl9pZD4gJiBtYXBwZWQpCnsKICByZXZp
c2lvbl9zZXQgcmV2OwogIHR5cGVkZWYgc3RkOjptdWx0aW1hcDwgbWFuaWZlc3RfaWQsIG1hbmlm
ZXN0X2lkID46OmNvbnN0X2l0ZXJhdG9yIGNpOwogIHN0ZDo6cGFpcjxjaSxjaT4gcmFuZ2UgPSBh
bmNlc3RyeS5lcXVhbF9yYW5nZShjaGlsZCk7CiAgZm9yIChjaSBpID0gcmFuZ2UuZmlyc3Q7IGkg
IT0gcmFuZ2Uuc2Vjb25kOyArK2kpCiAgICB7CiAgICAgIG1hbmlmZXN0X2lkIHBhcmVudChpLT5z
ZWNvbmQpOwogICAgICByZXZpc2lvbl9pZCBwYXJlbnRfcmlkOwogICAgICBzdGQ6Om1hcDxtYW5p
ZmVzdF9pZCwgcmV2aXNpb25faWQ+Ojpjb25zdF9pdGVyYXRvciBqID0gbWFwcGVkLmZpbmQocGFy
ZW50KTsKCiAgICAgIGlmIChqICE9IG1hcHBlZC5lbmQoKSkKICAgICAgICBwYXJlbnRfcmlkID0g
ai0+c2Vjb25kOwogICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgcGFyZW50X3JpZCA9IGNv
bnN0cnVjdF9yZXZpc2lvbnMoYXBwLCBwYXJlbnQsIGFuY2VzdHJ5LCBtYXBwZWQpOwogICAgICAg
ICAgUChGKCJpbnNlcnRpbmcgbWFwcGluZyAlZCA6ICVzIC0+ICVzXG4iKSAlIG1hcHBlZC5zaXpl
KCkgJSBwYXJlbnQgJSBwYXJlbnRfcmlkKTs7CiAgICAgICAgICBtYXBwZWQuaW5zZXJ0KHN0ZDo6
bWFrZV9wYWlyKHBhcmVudCwgcGFyZW50X3JpZCkpOwogICAgICAgIH0KICAgICAgCiAgICAgIGNo
YW5nZV9zZXQgY3M7CiAgICAgIGFuYWx5emVfbWFuaWZlc3RfY2hhbmdlcyhhcHAsIHBhcmVudCwg
Y2hpbGQsIGNzKTsKICAgICAgcmV2LmVkZ2VzLmluc2VydChzdGQ6Om1ha2VfcGFpcihwYXJlbnRf
cmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZDo6bWFrZV9wYWly
KHBhcmVudCwgY3MpKSk7CiAgICB9IAoKICByZXZpc2lvbl9pZCByaWQ7CiAgaWYgKHJldi5lZGdl
cy5lbXB0eSgpKQogICAgewogICAgICBQKEYoImlnbm9yaW5nIGVtcHR5IHJldmlzaW9uIGZvciBt
YW5pZmVzdCAlc1xuIikgJSBjaGlsZCk7ICAKICAgICAgcmV0dXJuIHJpZDsKICAgIH0KCiAgcmV2
Lm5ld19tYW5pZmVzdCA9IGNoaWxkOwogIGNhbGN1bGF0ZV9pZGVudChyZXYsIHJpZCk7CgogIGlm
ICghYXBwLmRiLnJldmlzaW9uX2V4aXN0cyAocmlkKSkKICAgIHsKICAgICAgUChGKCJtYXBwaW5n
IG1hbmlmZXN0ICVzIHRvIHJldmlzaW9uICVzXG4iKSAlIGNoaWxkICUgcmlkKTsKICAgICAgYXBw
LmRiLnB1dF9yZXZpc2lvbihyaWQsIHJldik7CiAgICB9CiAgZWxzZQogICAgewogICAgICBQKEYo
InNraXBwaW5nIGFkZGl0aW9uYWwgcGF0aCB0byByZXZpc2lvbiAlc1xuIikgJSByaWQpOwogICAg
fQoKICAvLyBub3cgaG9pc3QgYWxsIHRoZSBpbnRlcmVzdGluZyBjZXJ0cyB1cCB0byB0aGUgcmV2
aXNpb24KICBzdGQ6OnNldDxjZXJ0X25hbWU+IGNuYW1lczsKICBjbmFtZXMuaW5zZXJ0KGNlcnRf
bmFtZShicmFuY2hfY2VydF9uYW1lKSk7CiAgY25hbWVzLmluc2VydChjZXJ0X25hbWUoZGF0ZV9j
ZXJ0X25hbWUpKTsKICBjbmFtZXMuaW5zZXJ0KGNlcnRfbmFtZShhdXRob3JfY2VydF9uYW1lKSk7
CiAgY25hbWVzLmluc2VydChjZXJ0X25hbWUodGFnX2NlcnRfbmFtZSkpOwogIGNuYW1lcy5pbnNl
cnQoY2VydF9uYW1lKGNoYW5nZWxvZ19jZXJ0X25hbWUpKTsKICBjbmFtZXMuaW5zZXJ0KGNlcnRf
bmFtZShjb21tZW50X2NlcnRfbmFtZSkpOwogIGNuYW1lcy5pbnNlcnQoY2VydF9uYW1lKHRlc3Ry
ZXN1bHRfY2VydF9uYW1lKSk7CgogIHN0ZDo6dmVjdG9yPCBtYW5pZmVzdDxjZXJ0PiA+IHRtcDsK
ICBhcHAuZGIuZ2V0X21hbmlmZXN0X2NlcnRzKGNoaWxkLCB0bXApOwogIGVyYXNlX2JvZ3VzX2Nl
cnRzKHRtcCwgYXBwKTsgICAgICAKICBmb3IgKHN0ZDo6dmVjdG9yPCBtYW5pZmVzdDxjZXJ0PiA+
Ojpjb25zdF9pdGVyYXRvciBpID0gdG1wLmJlZ2luKCk7CiAgICAgICBpICE9IHRtcC5lbmQoKTsg
KytpKQogICAgewogICAgICBpZiAoY25hbWVzLmZpbmQoaS0+aW5uZXIoKS5uYW1lKSA9PSBjbmFt
ZXMuZW5kKCkpCiAgICAgICAgY29udGludWU7CiAgICAgIGNlcnQgbmV3X2NlcnQ7CiAgICAgIGNl
cnRfdmFsdWUgdHY7CiAgICAgIGRlY29kZV9iYXNlNjQoaS0+aW5uZXIoKS52YWx1ZSwgdHYpOwog
ICAgICBtYWtlX3NpbXBsZV9jZXJ0KHJpZC5pbm5lcigpLCBpLT5pbm5lcigpLm5hbWUsIHR2LCBh
cHAsIG5ld19jZXJ0KTsKICAgICAgaWYgKCEgYXBwLmRiLnJldmlzaW9uX2NlcnRfZXhpc3RzKHJl
dmlzaW9uPGNlcnQ+KG5ld19jZXJ0KSkpCiAgICAgICAgYXBwLmRiLnB1dF9yZXZpc2lvbl9jZXJ0
KHJldmlzaW9uPGNlcnQ+KG5ld19jZXJ0KSk7CiAgICB9CiAgcmV0dXJuIHJpZDsgIAp9CgoKdm9p
ZCAKYnVpbGRfY2hhbmdlc2V0cyhhcHBfc3RhdGUgJiBhcHApCnsKICBzdGQ6OnZlY3RvcjwgbWFu
aWZlc3Q8Y2VydD4gPiB0bXA7CiAgYXBwLmRiLmdldF9tYW5pZmVzdF9jZXJ0cyhjZXJ0X25hbWUo
ImFuY2VzdG9yIiksIHRtcCk7CiAgZXJhc2VfYm9ndXNfY2VydHModG1wLCBhcHApOwoKICBzdGQ6
Om11bHRpbWFwPCBtYW5pZmVzdF9pZCwgbWFuaWZlc3RfaWQgPiBhbmNlc3RyeTsKICBzdGQ6OnNl
dDxtYW5pZmVzdF9pZD4gaGVhZHM7CiAgc3RkOjpzZXQ8bWFuaWZlc3RfaWQ+IHRvdGFsOwogIAog
IGZvciAoc3RkOjp2ZWN0b3I8IG1hbmlmZXN0PGNlcnQ+ID46OmNvbnN0X2l0ZXJhdG9yIGkgPSB0
bXAuYmVnaW4oKTsKICAgICAgIGkgIT0gdG1wLmVuZCgpOyArK2kpCiAgICB7CiAgICAgIGNlcnRf
dmFsdWUgdHY7CiAgICAgIGRlY29kZV9iYXNlNjQoaS0+aW5uZXIoKS52YWx1ZSwgdHYpOwogICAg
ICBtYW5pZmVzdF9pZCBjaGlsZCwgcGFyZW50OwogICAgICBjaGlsZCA9IGktPmlubmVyKCkuaWRl
bnQ7CiAgICAgIHBhcmVudCA9IGhleGVuYzxpZD4odHYoKSk7CiAgICAgIGhlYWRzLmluc2VydChj
aGlsZCk7CiAgICAgIGhlYWRzLmVyYXNlKHBhcmVudCk7CiAgICAgIHRvdGFsLmluc2VydChjaGls
ZCk7CiAgICAgIHRvdGFsLmluc2VydChwYXJlbnQpOwogICAgICBhbmNlc3RyeS5pbnNlcnQoc3Rk
OjptYWtlX3BhaXIoY2hpbGQsIHBhcmVudCkpOwogICAgfQogIAogIFAoRigiZm91bmQgYSB0b3Rh
bCBvZiAlZCBtYW5pZmVzdHNcbiIpICUgdG90YWwuc2l6ZSgpKTsKCiAgdHJhbnNhY3Rpb25fZ3Vh
cmQgZ3VhcmQoYXBwLmRiKTsKICBzdGQ6Om1hcDxtYW5pZmVzdF9pZCwgcmV2aXNpb25faWQ+IG1h
cHBlZDsKICBmb3IgKHN0ZDo6c2V0PG1hbmlmZXN0X2lkPjo6Y29uc3RfaXRlcmF0b3IgaSA9IGhl
YWRzLmJlZ2luKCk7CiAgICAgICBpICE9IGhlYWRzLmVuZCgpOyArK2kpCiAgICB7CiAgICAgIGNv
bnN0cnVjdF9yZXZpc2lvbnMoYXBwLCAqaSwgYW5jZXN0cnksIG1hcHBlZCk7CiAgICB9CiAgZ3Vh
cmQuY29tbWl0KCk7Cn0KCgovLyBpL28gc3R1ZmYKCnN0ZDo6c3RyaW5nIHJldmlzaW9uX2ZpbGVf
bmFtZSgicmV2aXNpb24iKTsKCm5hbWVzcGFjZSAKewogIG5hbWVzcGFjZSBzeW1zCiAgewogICAg
c3RkOjpzdHJpbmcgY29uc3Qgb2xkX3JldmlzaW9uKCJvbGRfcmV2aXNpb24iKTsKICAgIHN0ZDo6
c3RyaW5nIGNvbnN0IG5ld19tYW5pZmVzdCgibmV3X21hbmlmZXN0Iik7CiAgICBzdGQ6OnN0cmlu
ZyBjb25zdCBvbGRfbWFuaWZlc3QoIm9sZF9tYW5pZmVzdCIpOwogIH0KfQoKCnZvaWQgCnByaW50
X2VkZ2UoYmFzaWNfaW86OnByaW50ZXIgJiBwcmludGVyLAogICAgICAgICAgIGVkZ2VfZW50cnkg
Y29uc3QgJiBlKQp7ICAgICAgIAogIGJhc2ljX2lvOjpzdGFuemEgc3Q7CiAgc3QucHVzaF9oZXhf
cGFpcihzeW1zOjpvbGRfcmV2aXNpb24sIGVkZ2Vfb2xkX3JldmlzaW9uKGUpLmlubmVyKCkoKSk7
CiAgc3QucHVzaF9oZXhfcGFpcihzeW1zOjpvbGRfbWFuaWZlc3QsIGVkZ2Vfb2xkX21hbmlmZXN0
KGUpLmlubmVyKCkoKSk7CiAgcHJpbnRlci5wcmludF9zdGFuemEoc3QpOwogIHByaW50X2NoYW5n
ZV9zZXQocHJpbnRlciwgZWRnZV9jaGFuZ2VzKGUpKTsgCn0KCgp2b2lkIApwcmludF9yZXZpc2lv
bihiYXNpY19pbzo6cHJpbnRlciAmIHByaW50ZXIsCiAgICAgICAgICAgICAgIHJldmlzaW9uX3Nl
dCBjb25zdCAmIHJldikKewogIGJhc2ljX2lvOjpzdGFuemEgc3Q7IAogIHN0LnB1c2hfaGV4X3Bh
aXIoc3ltczo6bmV3X21hbmlmZXN0LCByZXYubmV3X21hbmlmZXN0LmlubmVyKCkoKSk7CiAgcHJp
bnRlci5wcmludF9zdGFuemEoc3QpOwogIGZvciAoZWRnZV9tYXA6OmNvbnN0X2l0ZXJhdG9yIGVk
Z2UgPSByZXYuZWRnZXMuYmVnaW4oKTsKICAgICAgIGVkZ2UgIT0gcmV2LmVkZ2VzLmVuZCgpOyAr
K2VkZ2UpCiAgICBwcmludF9lZGdlKHByaW50ZXIsICplZGdlKTsKfQoKCnZvaWQgCnBhcnNlX2Vk
Z2UoYmFzaWNfaW86OnBhcnNlciAmIHBhcnNlciwKICAgICAgICAgICBlZGdlX21hcCAmIGVzKQp7
CiAgY2hhbmdlX3NldCBjczsKICBtYW5pZmVzdF9pZCBvbGRfbWFuOwogIHJldmlzaW9uX2lkIG9s
ZF9yZXY7CiAgc3RkOjpzdHJpbmcgdG1wOwogIAogIHBhcnNlci5lc3ltKHN5bXM6Om9sZF9yZXZp
c2lvbik7CiAgcGFyc2VyLmhleCh0bXApOwogIG9sZF9yZXYgPSByZXZpc2lvbl9pZCh0bXApOwog
IAogIHBhcnNlci5lc3ltKHN5bXM6Om9sZF9tYW5pZmVzdCk7CiAgcGFyc2VyLmhleCh0bXApOwog
IG9sZF9tYW4gPSBtYW5pZmVzdF9pZCh0bXApOwogIAogIHBhcnNlX2NoYW5nZV9zZXQocGFyc2Vy
LCBjcyk7CgogIGVzLmluc2VydChzdGQ6Om1ha2VfcGFpcihvbGRfcmV2LCBzdGQ6Om1ha2VfcGFp
cihvbGRfbWFuLCBjcykpKTsKfQoKCnZvaWQgCnBhcnNlX3JldmlzaW9uKGJhc2ljX2lvOjpwYXJz
ZXIgJiBwYXJzZXIsCiAgICAgICAgICAgICAgIHJldmlzaW9uX3NldCAmIHJldikKewogIHJldi5l
ZGdlcy5jbGVhcigpOwogIHN0ZDo6c3RyaW5nIHRtcDsKICBwYXJzZXIuZXN5bShzeW1zOjpuZXdf
bWFuaWZlc3QpOwogIHBhcnNlci5oZXgodG1wKTsKICByZXYubmV3X21hbmlmZXN0ID0gbWFuaWZl
c3RfaWQodG1wKTsKICB3aGlsZSAocGFyc2VyLnN5bXAoc3ltczo6b2xkX3JldmlzaW9uKSkKICAg
IHBhcnNlX2VkZ2UocGFyc2VyLCByZXYuZWRnZXMpOwp9Cgp2b2lkIApyZWFkX3JldmlzaW9uX3Nl
dChkYXRhIGNvbnN0ICYgZGF0LAogICAgICAgICAgICAgICAgICByZXZpc2lvbl9zZXQgJiByZXYp
CnsKICBzdGQ6OmlzdHJpbmdzdHJlYW0gaXNzKGRhdCgpKTsKICBiYXNpY19pbzo6aW5wdXRfc291
cmNlIHNyYyhpc3MsICJyZXZpc2lvbiIpOwogIGJhc2ljX2lvOjp0b2tlbml6ZXIgdG9rKHNyYyk7
CiAgYmFzaWNfaW86OnBhcnNlciBwYXJzKHRvayk7CiAgcGFyc2VfcmV2aXNpb24ocGFycywgcmV2
KTsKICBJKHNyYy5sb29rYWhlYWQgPT0gRU9GKTsKfQoKdm9pZCAKcmVhZF9yZXZpc2lvbl9zZXQo
cmV2aXNpb25fZGF0YSBjb25zdCAmIGRhdCwKICAgICAgICAgICAgICAgICAgcmV2aXNpb25fc2V0
ICYgcmV2KQp7CiAgZGF0YSB1bnBhY2tlZDsKICB1bnBhY2soZGF0LmlubmVyKCksIHVucGFja2Vk
KTsKICByZWFkX3JldmlzaW9uX3NldCh1bnBhY2tlZCwgcmV2KTsKfQoKdm9pZAp3cml0ZV9yZXZp
c2lvbl9zZXQocmV2aXNpb25fc2V0IGNvbnN0ICYgcmV2LAogICAgICAgICAgICAgICAgICAgZGF0
YSAmIGRhdCkKewogIHN0ZDo6b3N0cmluZ3N0cmVhbSBvc3M7CiAgYmFzaWNfaW86OnByaW50ZXIg
cHIob3NzKTsKICBwcmludF9yZXZpc2lvbihwciwgcmV2KTsKICBkYXQgPSBkYXRhKG9zcy5zdHIo
KSk7Cn0KCnZvaWQKd3JpdGVfcmV2aXNpb25fc2V0KHJldmlzaW9uX3NldCBjb25zdCAmIHJldiwK
ICAgICAgICAgICAgICAgICAgIHJldmlzaW9uX2RhdGEgJiBkYXQpCnsKICBkYXRhIGQ7CiAgd3Jp
dGVfcmV2aXNpb25fc2V0KHJldiwgZCk7CiAgYmFzZTY0PCBnemlwPGRhdGE+ID4gcGFja2VkOwog
IHBhY2soZCwgcGFja2VkKTsKICBkYXQgPSByZXZpc2lvbl9kYXRhKHBhY2tlZCk7Cn0KCiNpZmRl
ZiBCVUlMRF9VTklUX1RFU1RTCiNpbmNsdWRlICJ1bml0X3Rlc3RzLmhoIgojaW5jbHVkZSAic2Fu
aXR5LmhoIgoKc3RhdGljIHZvaWQgCnJldmlzaW9uX3Rlc3QoKQp7Cn0KCnZvaWQgCmFkZF9yZXZp
c2lvbl90ZXN0cyh0ZXN0X3N1aXRlICogc3VpdGUpCnsKICBJKHN1aXRlKTsKICBzdWl0ZS0+YWRk
KEJPT1NUX1RFU1RfQ0FTRSgmcmV2aXNpb25fdGVzdCkpOwp9CgoKI2VuZGlmIC8vIEJVSUxEX1VO
SVRfVEVTVFMK
])

UNB64(parent.b64, parent)
UNB64(left.b64, left)
UNB64(right.b64, right)
UNB64(correct.b64, correct)

AT_CHECK(cp -f parent testfile)
AT_CHECK(MONOTONE add testfile, [], [ignore], [ignore])
COMMIT(testbranch)
PARENT_SHA=`BASE_REVISION`

AT_CHECK(cp -f left testfile)
COMMIT(testbranch)

REVERT_TO($PARENT_SHA)

AT_CHECK(cp -f right testfile)
COMMIT(testbranch)

AT_CHECK(MONOTONE --branch=testbranch merge, [], [ignore], [ignore])

AT_CHECK(MONOTONE update, [], [ignore], [ignore])
AT_CHECK(cmp testfile correct)

AT_CLEANUP
