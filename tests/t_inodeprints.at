AT_SETUP([inodeprints])
MTN_SETUP

# Turn them on
AT_CHECK(touch _MTN/inodeprints)

AT_CHECK(MTN diff, [], [stdout], [ignore])
AT_CHECK(QGREP("no changes" stdout))

ADD_FILE(testfile, [blah blah
])

AT_CHECK(MTN diff, [], [stdout], [ignore])
AT_CHECK(QGREP("blah blah" stdout))

COMMIT(testbranch)

# Something should have been written to it
AT_CHECK(test -s _MTN/inodeprints)
AT_CHECK(cp _MTN/inodeprints ip1)

# And stuff should still work
AT_CHECK(MTN diff, [], [stdout], [ignore])
AT_CHECK(QGREP("no changes" stdout))

SET_FILE(testfile, [stuff stuff
])

AT_CHECK(MTN diff, [], [stdout], [ignore])
AT_CHECK(QGREP("stuff stuff" stdout))

# Make sure partial commit doesn't screw things up
ADD_FILE(otherfile, [other stuff
])
AT_CHECK(MTN commit otherfile --message=foo, [], [ignore], [ignore])

# Should have changed the inodeprints file
AT_CHECK(cmp _MTN/inodeprints ip1, [1], [ignore], [ignore])

# Still should think testfile is modified
AT_CHECK(MTN diff, [], [stdout], [ignore])
AT_CHECK(QGREP("stuff stuff" stdout))

AT_CLEANUP
