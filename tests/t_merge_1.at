AT_SETUP([test a merge])
MONOTONE_SETUP

NEED_UNB64

# This is a real merge error.  'right' contains only a single added
# function; when it was really merged with 'left', the last line of
# this function was lost.

# This may actually be a bug in the unidiff algorithm; 'diff' and
# 'monotone diff' produce different results when calculating
# diff(parent, left).

# This test is a bug report:
AT_XFAIL_IF(true)

AT_DATA(parent.b64, [Ly8gY29weXJpZ2h0IChDKSAyMDAyLCAyMDAzIGdyYXlkb24gaG9hcmUgPGdyYXlkb25AcG9i
b3guY29tPgovLyBhbGwgcmlnaHRzIHJlc2VydmVkLgovLyBsaWNlbnNlZCB0byB0aGUgcHVi
bGljIHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdQTCAoPj0gMikKLy8gc2VlIHRoZSBm
aWxlIENPUFlJTkcgZm9yIGRldGFpbHMKCiNpbmNsdWRlIDxpdGVyYXRvcj4KI2luY2x1ZGUg
PGxpc3Q+CiNpbmNsdWRlIDxzZXQ+CiNpbmNsdWRlIDxzc3RyZWFtPgojaW5jbHVkZSA8dmVj
dG9yPgoKI2luY2x1ZGUgPHN0ZGFyZy5oPgoKI2luY2x1ZGUgPGJvb3N0L3NoYXJlZF9wdHIu
aHBwPgojaW5jbHVkZSA8Ym9vc3QvbGV4aWNhbF9jYXN0LmhwcD4KI2luY2x1ZGUgPGJvb3N0
L2ZpbGVzeXN0ZW0vcGF0aC5ocHA+CiNpbmNsdWRlIDxib29zdC9maWxlc3lzdGVtL29wZXJh
dGlvbnMuaHBwPgoKI2luY2x1ZGUgPHNxbGl0ZS5oPgoKI2luY2x1ZGUgImFwcF9zdGF0ZS5o
aCIKI2luY2x1ZGUgImNlcnQuaGgiCiNpbmNsdWRlICJjbGVhbnVwLmhoIgojaW5jbHVkZSAi
Y29uc3RhbnRzLmhoIgojaW5jbHVkZSAiZGF0YWJhc2UuaGgiCiNpbmNsdWRlICJrZXlzLmho
IgojaW5jbHVkZSAic2FuaXR5LmhoIgojaW5jbHVkZSAic2NoZW1hX21pZ3JhdGlvbi5oaCIK
I2luY2x1ZGUgImNlcnQuaGgiCiNpbmNsdWRlICJ0cmFuc2Zvcm1zLmhoIgojaW5jbHVkZSAi
dWkuaGgiCiNpbmNsdWRlICJ2b2NhYi5oaCIKI2luY2x1ZGUgInhkZWx0YS5oaCIKCi8vIGRl
ZmluZWQgaW4gc2NoZW1hLnNxbCwgY29udmVydGVkIHRvIGhlYWRlcjoKI2luY2x1ZGUgInNj
aGVtYS5oIgoKLy8gZGVmaW5lZCBpbiB2aWV3cy5zcWwsIGNvbnZlcnRlZCB0byBoZWFkZXI6
CiNpbmNsdWRlICJ2aWV3cy5oIgoKLy8gdGhpcyBmaWxlIGRlZmluZXMgYSBwdWJsaWMsIHR5
cGVkIGludGVyZmFjZSB0byB0aGUgZGF0YWJhc2UuCi8vIHRoZSBkYXRhYmFzZSBjbGFzcyBl
bmNhcHN1bGF0ZXMgYWxsIGtub3dsZWRnZSBhYm91dCBzcWxpdGUsCi8vIHRoZSBzY2hlbWEs
IGFuZCBhbGwgU1FMIHN0YXRlbWVudHMgdXNlZCB0byBhY2Nlc3MgdGhlIHNjaGVtYS4KLy8K
Ly8gc2VlIGZpbGUgc2NoZW1hLnNxbCBmb3IgdGhlIHRleHQgb2YgdGhlIHNjaGVtYS4KCnVz
aW5nIGJvb3N0OjpzaGFyZWRfcHRyOwp1c2luZyBib29zdDo6bGV4aWNhbF9jYXN0Owp1c2lu
ZyBuYW1lc3BhY2Ugc3RkOwoKaW50IGNvbnN0IG9uZV9yb3cgPSAxOwppbnQgY29uc3Qgb25l
X2NvbCA9IDE7CmludCBjb25zdCBhbnlfcm93cyA9IC0xOwppbnQgY29uc3QgYW55X2NvbHMg
PSAtMTsKCmV4dGVybiAiQyIgewogIC8vIHN0cmFuZ2VseSB0aGlzIGlzbid0IGRlY2xhcmVk
LCBldmVuIHRob3VnaCBpdCdzIHByZXNlbnQgaW4gbXkgc3FsaXRlLgogIGNoYXIgKnNxbGl0
ZV92bXByaW50Zihjb25zdCBjaGFyICp6Rm9ybWF0LCB2YV9saXN0KTsKfQoKZGF0YWJhc2U6
OmRhdGFiYXNlKGZzOjpwYXRoIGNvbnN0ICYgZm4pIDoKICBmaWxlbmFtZShmbiksCiAgLy8g
bmIuIHVwZGF0ZSB0aGlzIGlmIHlvdSBjaGFuZ2UgdGhlIHNjaGVtYS4gdW5mb3J0dW5hdGVs
eSB3ZSBhcmUgbm90CiAgLy8gdXNpbmcgc2VsZi1kaWdlc3Rpbmcgc2NoZW1hcyBkdWUgdG8g
Y29tbWVudCBpcnJlZ3VsYXJpdGllcyBhbmQKICAvLyBub24tYWxwaGFiZXRpYyBvcmRlcmlu
ZyBvZiB0YWJsZXMgaW4gc3FsIHNvdXJjZSBmaWxlcy4gd2UgY291bGQgY3JlYXRlCiAgLy8g
YSB0ZW1wb3JhcnkgZGIsIHdyaXRlIG91ciBpbnRlbmRlZCBzY2hlbWEgaW50byBpdCwgYW5k
IHJlYWQgaXQgYmFjaywKICAvLyBidXQgdGhpcyBzZWVtcyBsaWtlIGl0IHdvdWxkIGJlIHRv
byBydWRlLiBwb3NzaWJseSByZXZpc2l0IHRoaXMgaXNzdWUuCiAgc2NoZW1hKCJjMWU4NjU4
OGUxMWFkMDdmYTUzZTVkMjk0ZWRjMDQzY2UxZDQwMDVhIiksCiAgX19zcWwoTlVMTCksCiAg
dHJhbnNhY3Rpb25fbGV2ZWwoMCkKe30KCnZvaWQgCmRhdGFiYXNlOjpjaGVja19zY2hlbWEo
KQp7CiAgc3RyaW5nIGRiX3NjaGVtYV9pZDsgIAogIGNhbGN1bGF0ZV9zY2hlbWFfaWQgKF9f
c3FsLCBkYl9zY2hlbWFfaWQpOwogIE4gKHNjaGVtYSA9PSBkYl9zY2hlbWFfaWQsCiAgICAg
RigiZGF0YWJhc2Ugc2NoZW1hcyBkbyBub3QgbWF0Y2g6ICIKICAgICAgICJ3YW50ZWQgJXMs
IGdvdCAlcy4gdHJ5IG1pZ3JhdGluZyBkYXRhYmFzZSIpIAogICAgICUgc2NoZW1hICUgZGJf
c2NoZW1hX2lkKTsKfQoKc3RhdGljIHZvaWQgCnNxbGl0ZV91bmJhc2U2NF9mbihzcWxpdGVf
ZnVuYyAqZiwgaW50IG5hcmdzLCBjaGFyIGNvbnN0ICoqIGFyZ3MpCnsKICBpZiAobmFyZ3Mg
IT0gMSkKICAgIHsKICAgICAgc3FsaXRlX3NldF9yZXN1bHRfZXJyb3IoZiwgIm5lZWQgZXhh
Y3RseSAxIGFyZyB0byB1bmJhc2U2NCgpIiwgLTEpOwogICAgICByZXR1cm47CiAgICB9CiAg
ZGF0YSBkZWNvZGVkOwogIGRlY29kZV9iYXNlNjQoYmFzZTY0PGRhdGE+KHN0cmluZyhhcmdz
WzBdKSksIGRlY29kZWQpOwogIHNxbGl0ZV9zZXRfcmVzdWx0X3N0cmluZyhmLCBkZWNvZGVk
KCkuY19zdHIoKSwgZGVjb2RlZCgpLnNpemUoKSk7Cn0KCnZvaWQgCmRhdGFiYXNlOjpzZXRf
YXBwKGFwcF9zdGF0ZSAqIGFwcCkKewogIF9fYXBwID0gYXBwOwp9CgpzdHJ1Y3Qgc3FsaXRl
ICogCmRhdGFiYXNlOjpzcWwoYm9vbCBpbml0KQp7CiAgaWYgKCEgX19zcWwpCiAgICB7CiAg
ICAgIGlmICghIGluaXQpCgl7CgkgIGlmIChmaWxlbmFtZS5zdHJpbmcoKSA9PSAiIikKCSAg
ICB0aHJvdyBpbmZvcm1hdGl2ZV9mYWlsdXJlKHN0cmluZygibm8gZGF0YWJhc2Ugc3BlY2lm
aWVkIikpOwoJICBlbHNlIGlmICghIGZzOjpleGlzdHMoZmlsZW5hbWUpKQoJICAgIHRocm93
IGluZm9ybWF0aXZlX2ZhaWx1cmUoc3RyaW5nKCJkYXRhYmFzZSAiKSArIGZpbGVuYW1lLnN0
cmluZygpICsKCQkJCSAgICAgIHN0cmluZygiIGRvZXMgbm90IGV4aXN0IikpOwoJfQogICAg
ICBOKGZpbGVuYW1lLnN0cmluZygpICE9ICIiLAoJRigibmVlZCBkYXRhYmFzZSBuYW1lIikp
OwogICAgICBjaGFyICogZXJybXNnID0gTlVMTDsKICAgICAgX19zcWwgPSBzcWxpdGVfb3Bl
bihmaWxlbmFtZS5zdHJpbmcoKS5jX3N0cigpLCAwNzU1LCAmZXJybXNnKTsKICAgICAgaWYg
KCEgX19zcWwpCgl0aHJvdyBvb3BzKHN0cmluZygiY291bGQgbm90IG9wZW4gZGF0YWJhc2U6
ICIpICsgZmlsZW5hbWUuc3RyaW5nKCkgKyAKCQkgICAoZXJybXNnID8gKCI6ICIgKyBzdHJp
bmcoZXJybXNnKSkgOiAiIikpOwogICAgICBpZiAoaW5pdCkKCWV4ZWN1dGUoc2NoZW1hX2Nv
bnN0YW50KTsKCiAgICAgIGNoZWNrX3NjaGVtYSgpOwogICAgICBpbnN0YWxsX2Z1bmN0aW9u
cyhfX2FwcCk7CiAgICAgIGluc3RhbGxfdmlld3MoKTsKICAgIH0KICByZXR1cm4gX19zcWw7
Cn0KCnZvaWQgCmRhdGFiYXNlOjppbml0aWFsaXplKCkKewogIGlmIChfX3NxbCkKICAgIHRo
cm93IG9vcHMoImNhbm5vdCBpbml0aWFsaXplIGRhdGFiYXNlIHdoaWxlIGl0IGlzIG9wZW4i
KTsKCiAgTighZnM6OmV4aXN0cyhmaWxlbmFtZSksCiAgICBGKCJjb3VsZCBub3QgaW5pdGlh
bGl6ZSBkYXRhYmFzZTogJXM6IGFscmVhZHkgZXhpc3RzIikgCiAgICAlIGZpbGVuYW1lLnN0
cmluZygpKTsKCiAgZnM6OnBhdGggam91cm5hbCA9IG1rcGF0aChmaWxlbmFtZS5zdHJpbmco
KSArICItam91cm5hbCIpOwogIE4oIWZzOjpleGlzdHMoam91cm5hbCksCiAgICBGKCJleGlz
dGluZyAocG9zc2libHkgc3RhbGUpIGpvdXJuYWwgZmlsZSAnJXMnIGhhcyBzYW1lIHN0ZW0g
YXMgbmV3IGRhdGFiYXNlICclcyciKQogICAgJSBqb3VybmFsLnN0cmluZygpICUgZmlsZW5h
bWUuc3RyaW5nKCkpOwoKICBzcWxpdGUgKnMgPSBzcWwodHJ1ZSk7CiAgSShzICE9IE5VTEwp
Owp9CgoKc3RydWN0IApkdW1wX3JlcXVlc3QKewogIGR1bXBfcmVxdWVzdCgpIHt9OwogIHN0
cnVjdCBzcWxpdGUgKnNxbDsKICBzdHJpbmcgdGFibGVfbmFtZTsKICBvc3RyZWFtICpvdXQ7
Cn07CgpzdGF0aWMgaW50IApkdW1wX3Jvd19jYih2b2lkICpkYXRhLCBpbnQgbiwgY2hhciAq
KnZhbHMsIGNoYXIgKipjb2xzKQp7CiAgZHVtcF9yZXF1ZXN0ICpkdW1wID0gcmVpbnRlcnBy
ZXRfY2FzdDxkdW1wX3JlcXVlc3QgKj4oZGF0YSk7CiAgSShkdW1wICE9IE5VTEwpOwogIEko
dmFscyAhPSBOVUxMKTsKICBJKGR1bXAtPm91dCAhPSBOVUxMKTsKICAqKGR1bXAtPm91dCkg
PDwgRigiSU5TRVJUIElOVE8gJXMgVkFMVUVTKCIpICUgZHVtcC0+dGFibGVfbmFtZTsKICBm
b3IgKGludCBpID0gMDsgaSA8IG47ICsraSkKICAgIHsKICAgICAgaWYgKGkgIT0gMCkKCSoo
ZHVtcC0+b3V0KSA8PCAnLCc7CgogICAgICBpZiAodmFsc1tpXSA9PSBOVUxMKQoJKihkdW1w
LT5vdXQpIDw8ICJOVUxMIjsKICAgICAgZWxzZQoJewoJICAqKGR1bXAtPm91dCkgPDwgIici
OwoJICBmb3IgKGNoYXIgKmNwID0gdmFsc1tpXTsgKmNwOyArK2NwKQoJICAgIHsKCSAgICAg
IGlmICgqY3AgPT0gJ1wnJykKCQkqKGR1bXAtPm91dCkgPDwgIicnIjsKCSAgICAgIGVsc2UK
CQkqKGR1bXAtPm91dCkgPDwgKmNwOwoJICAgIH0KCSAgKihkdW1wLT5vdXQpIDw8ICInIjsK
CX0KICAgIH0KICAqKGR1bXAtPm91dCkgPDwgIik7XG4iOyAgCiAgcmV0dXJuIDA7Cn0KCnN0
YXRpYyBpbnQgCmR1bXBfdGFibGVfY2Iodm9pZCAqZGF0YSwgaW50IG4sIGNoYXIgKip2YWxz
LCBjaGFyICoqY29scykKewogIGR1bXBfcmVxdWVzdCAqZHVtcCA9IHJlaW50ZXJwcmV0X2Nh
c3Q8ZHVtcF9yZXF1ZXN0ICo+KGRhdGEpOwogIEkoZHVtcCAhPSBOVUxMKTsKICBJKGR1bXAt
PnNxbCAhPSBOVUxMKTsKICBJKHZhbHMgIT0gTlVMTCk7CiAgSSh2YWxzWzBdICE9IE5VTEwp
OwogIEkodmFsc1sxXSAhPSBOVUxMKTsKICBJKHZhbHNbMl0gIT0gTlVMTCk7CiAgSShuID09
IDMpOwogIGlmIChzdHJpbmcodmFsc1sxXSkgPT0gInRhYmxlIikKICAgIHsKICAgICAgKihk
dW1wLT5vdXQpIDw8IHZhbHNbMl0gPDwgIjtcbiI7CiAgICAgIGR1bXAtPnRhYmxlX25hbWUg
PSBzdHJpbmcodmFsc1swXSk7CiAgICAgIHNxbGl0ZV9leGVjX3ByaW50ZihkdW1wLT5zcWws
ICJTRUxFQ1QgKiBGUk9NICclcSciLCAKCQkJIGR1bXBfcm93X2NiLCBkYXRhLCBOVUxMLCB2
YWxzWzBdKTsKICAgIH0KICByZXR1cm4gMDsKfQoKdm9pZCAKZGF0YWJhc2U6OmR1bXAob3N0
cmVhbSAmIG91dCkKewogIGR1bXBfcmVxdWVzdCByZXE7CiAgcmVxLm91dCA9ICZvdXQ7CiAg
cmVxLnNxbCA9IHNxbCgpOwogIG91dCA8PCAiQkVHSU4gVFJBTlNBQ1RJT047XG4iOwogIGlu
dCByZXMgPSBzcWxpdGVfZXhlYyhyZXEuc3FsLAoJCQkiU0VMRUNUIG5hbWUsIHR5cGUsIHNx
bCBGUk9NIHNxbGl0ZV9tYXN0ZXIgIgoJCQkiV0hFUkUgdHlwZT0ndGFibGUnIEFORCBzcWwg
Tk9UIE5VTEwgIgoJCQkiT1JERVIgQlkgc3Vic3RyKHR5cGUsMiwxKSwgbmFtZSIsCgkJCWR1
bXBfdGFibGVfY2IsICZyZXEsIE5VTEwpOwogIEkocmVzID09IFNRTElURV9PSyk7CiAgb3V0
IDw8ICJDT01NSVQ7XG4iOwp9Cgp2b2lkIApkYXRhYmFzZTo6bG9hZChpc3RyZWFtICYgaW4p
CnsKICBjaGFyIGJ1Zltjb25zdGFudHM6OmJ1ZnN6XTsKICBzdHJpbmcgdG1wOwoKICBOKGZp
bGVuYW1lLnN0cmluZygpICE9ICIiLAogICAgRigibmVlZCBkYXRhYmFzZSBuYW1lIikpOwog
IGNoYXIgKiBlcnJtc2cgPSBOVUxMOwogIF9fc3FsID0gc3FsaXRlX29wZW4oZmlsZW5hbWUu
c3RyaW5nKCkuY19zdHIoKSwgMDc1NSwgJmVycm1zZyk7CiAgaWYgKCEgX19zcWwpCiAgICB0
aHJvdyBvb3BzKHN0cmluZygiY291bGQgbm90IG9wZW4gZGF0YWJhc2U6ICIpICsgZmlsZW5h
bWUuc3RyaW5nKCkgKyAKCSAgICAgICAoZXJybXNnID8gKCI6ICIgKyBzdHJpbmcoZXJybXNn
KSkgOiAiIikpOwogIAogIHdoaWxlKGluKQogICAgewogICAgICBpbi5yZWFkKGJ1ZiwgY29u
c3RhbnRzOjpidWZzeik7CiAgICAgIHRtcC5hcHBlbmQoYnVmLCBpbi5nY291bnQoKSk7CiAg
ICB9CgogIGV4ZWN1dGUodG1wLmNfc3RyKCkpOwp9CgoKdm9pZCAKZGF0YWJhc2U6OmRlYnVn
KHN0cmluZyBjb25zdCAmIHNxbCwgb3N0cmVhbSAmIG91dCkKewogIHJlc3VsdHMgcmVzOwog
IGZldGNoKHJlcywgYW55X2NvbHMsIGFueV9yb3dzLCBzcWwuY19zdHIoKSk7CiAgb3V0IDw8
ICInIiA8PCBzcWwgPDwgIicgLT4gIiA8PCByZXMuc2l6ZSgpIDw8ICIgcm93c1xuIiA8PCBl
bmRsOwogIGZvciAoc2l6ZV90IGkgPSAwOyBpIDwgcmVzLnNpemUoKTsgKytpKQogICAgewog
ICAgICBmb3IgKHNpemVfdCBqID0gMDsgaiA8IHJlc1tpXS5zaXplKCk7ICsraikKCXsKCSAg
aWYgKGogIT0gMCkKCSAgICBvdXQgPDwgIiB8ICI7CgkgIG91dCA8PCByZXNbaV1bal07Cgl9
CiAgICAgIG91dCA8PCBlbmRsOwogICAgfQp9Cgp1bnNpZ25lZCBsb25nIApkYXRhYmFzZTo6
Z2V0X3N0YXRpc3RpYyhzdHJpbmcgY29uc3QgJiBxdWVyeSkKewogIHJlc3VsdHMgcmVzOwog
IGZldGNoKHJlcywgMSwgMSwgcXVlcnkuY19zdHIoKSk7CiAgcmV0dXJuIGxleGljYWxfY2Fz
dDx1bnNpZ25lZCBsb25nPihyZXNbMF1bMF0pOwp9Cgp2b2lkIApkYXRhYmFzZTo6aW5mbyhv
c3RyZWFtICYgb3V0KQp7CiAgc3RyaW5nIGlkOwogIGNhbGN1bGF0ZV9zY2hlbWFfaWQoc3Fs
KCksIGlkKTsKICBvdXQgPDwgInNjaGVtYSB2ZXJzaW9uICA6ICIgPDwgaWQgPDwgZW5kbDsK
ICBvdXQgPDwgImZ1bGwgbWFuaWZlc3RzICA6ICIgPDwgZ2V0X3N0YXRpc3RpYygiU0VMRUNU
IENPVU5UKCopIEZST00gbWFuaWZlc3RzIikgPDwgZW5kbDsKICBvdXQgPDwgIm1hbmlmZXN0
IGRlbHRhcyA6ICIgPDwgZ2V0X3N0YXRpc3RpYygiU0VMRUNUIENPVU5UKCopIEZST00gbWFu
aWZlc3RfZGVsdGFzIikgPDwgZW5kbDsKICBvdXQgPDwgImZ1bGwgZmlsZXMgICAgICA6ICIg
PDwgZ2V0X3N0YXRpc3RpYygiU0VMRUNUIENPVU5UKCopIEZST00gZmlsZXMiKSA8PCBlbmRs
OwogIG91dCA8PCAiZmlsZSBkZWx0YXMgICAgIDogIiA8PCBnZXRfc3RhdGlzdGljKCJTRUxF
Q1QgQ09VTlQoKikgRlJPTSBmaWxlX2RlbHRhcyIpIDw8IGVuZGw7Cn0KCnZvaWQgCmRhdGFi
YXNlOjp2ZXJzaW9uKG9zdHJlYW0gJiBvdXQpCnsKICBzdHJpbmcgaWQ7CiAgY2FsY3VsYXRl
X3NjaGVtYV9pZChzcWwoKSwgaWQpOwogIG91dCA8PCAiZGF0YWJhc2Ugc2NoZW1hIHZlcnNp
b246ICIgPDwgaWQgPDwgZW5kbDsKfQoKdm9pZCAKZGF0YWJhc2U6Om1pZ3JhdGUoKQp7ICAK
ICBOKGZpbGVuYW1lLnN0cmluZygpICE9ICIiLAogICAgRigibmVlZCBkYXRhYmFzZSBuYW1l
IikpOwogIGNoYXIgKiBlcnJtc2cgPSBOVUxMOwogIF9fc3FsID0gc3FsaXRlX29wZW4oZmls
ZW5hbWUuc3RyaW5nKCkuY19zdHIoKSwgMDc1NSwgJmVycm1zZyk7CiAgaWYgKCEgX19zcWwp
CiAgICB0aHJvdyBvb3BzKHN0cmluZygiY291bGQgbm90IG9wZW4gZGF0YWJhc2U6ICIpICsg
ZmlsZW5hbWUuc3RyaW5nKCkgKyAKCSAgICAgICAoZXJybXNnID8gKCI6ICIgKyBzdHJpbmco
ZXJybXNnKSkgOiAiIikpOwogIG1pZ3JhdGVfbW9ub3RvbmVfc2NoZW1hKF9fc3FsKTsKICBz
cWxpdGVfY2xvc2UoX19zcWwpOwp9Cgp2b2lkIApkYXRhYmFzZTo6cmVoYXNoKCkKewogIHRy
YW5zYWN0aW9uX2d1YXJkIGd1YXJkKCp0aGlzKTsKICB0aWNrZXIgbWNlcnRzKCJtY2VydHMi
LCAibSIsIDEpOwogIHRpY2tlciBmY2VydHMoImZjZXJ0cyIsICJmIiwgMSk7CiAgdGlja2Vy
IHB1YmtleXMoInB1YmtleXMiLCAiKyIsIDEpOwogIHRpY2tlciBwcml2a2V5cygicHJpdmtl
eXMiLCAiISIsIDEpOwogIAogIHsKICAgIC8vIHJlaGFzaCBhbGwgbWNlcnRzCiAgICByZXN1
bHRzIHJlczsKICAgIHZlY3RvcjxjZXJ0PiBjZXJ0czsKICAgIGZldGNoKHJlcywgNSwgYW55
X3Jvd3MsIAoJICAiU0VMRUNUIGlkLCBuYW1lLCB2YWx1ZSwga2V5cGFpciwgc2lnbmF0dXJl
ICIKCSAgIkZST00gbWFuaWZlc3RfY2VydHMiKTsKICAgIHJlc3VsdHNfdG9fY2VydHMocmVz
LCBjZXJ0cyk7CiAgICBleGVjdXRlKCJERUxFVEUgRlJPTSBtYW5pZmVzdF9jZXJ0cyIpOwog
ICAgZm9yKHZlY3RvcjxjZXJ0Pjo6Y29uc3RfaXRlcmF0b3IgaSA9IGNlcnRzLmJlZ2luKCk7
IGkgIT0gY2VydHMuZW5kKCk7ICsraSkKICAgICAgewoJcHV0X2NlcnQoKmksICJtYW5pZmVz
dF9jZXJ0cyIpOwoJKyttY2VydHM7CiAgICAgIH0KICB9CgogIHsKICAgIC8vIHJlaGFzaCBh
bGwgZmNlcnRzCiAgICByZXN1bHRzIHJlczsKICAgIHZlY3RvcjxjZXJ0PiBjZXJ0czsgICAg
CiAgICBmZXRjaChyZXMsIDUsIGFueV9yb3dzLCAKCSAgIlNFTEVDVCBpZCwgbmFtZSwgdmFs
dWUsIGtleXBhaXIsIHNpZ25hdHVyZSAiCgkgICJGUk9NIGZpbGVfY2VydHMiKTsKICAgIHJl
c3VsdHNfdG9fY2VydHMocmVzLCBjZXJ0cyk7CiAgICBleGVjdXRlKCJERUxFVEUgRlJPTSBm
aWxlX2NlcnRzIik7CiAgICBmb3IodmVjdG9yPGNlcnQ+Ojpjb25zdF9pdGVyYXRvciBpID0g
Y2VydHMuYmVnaW4oKTsgaSAhPSBjZXJ0cy5lbmQoKTsgKytpKQogICAgICB7CglwdXRfY2Vy
dCgqaSwgImZpbGVfY2VydHMiKTsKCSsrZmNlcnRzOwogICAgICB9CiAgfQogIAoKICB7CiAg
ICAvLyByZWhhc2ggYWxsIHB1YmtleXMKICAgIHJlc3VsdHMgcmVzOwogICAgZmV0Y2gocmVz
LCAyLCBhbnlfcm93cywgIlNFTEVDVCBpZCwga2V5ZGF0YSBGUk9NIHB1YmxpY19rZXlzIik7
CiAgICBleGVjdXRlKCJERUxFVEUgRlJPTSBwdWJsaWNfa2V5cyIpOwogICAgZm9yIChzaXpl
X3QgaSA9IDA7IGkgPCByZXMuc2l6ZSgpOyArK2kpCiAgICAgIHsKCWhleGVuYzxpZD4gdG1w
OwoJa2V5X2hhc2hfY29kZShyc2Ffa2V5cGFpcl9pZChyZXNbaV1bMF0pLCBiYXNlNjQ8cnNh
X3B1Yl9rZXk+KHJlc1tpXVsxXSksIHRtcCk7CglleGVjdXRlKCJJTlNFUlQgSU5UTyBwdWJs
aWNfa2V5cyBWQUxVRVMoJyVxJywgJyVxJywgJyVxJykiLCAKCQl0bXAoKS5jX3N0cigpLCBy
ZXNbaV1bMF0uY19zdHIoKSwgcmVzW2ldWzFdLmNfc3RyKCkpOwoJKytwdWJrZXlzOwogICAg
ICB9CiAgfQoKewogICAgLy8gcmVoYXNoIGFsbCBwcml2a2V5cwogICAgcmVzdWx0cyByZXM7
CiAgICBmZXRjaChyZXMsIDIsIGFueV9yb3dzLCAiU0VMRUNUIGlkLCBrZXlkYXRhIEZST00g
cHJpdmF0ZV9rZXlzIik7CiAgICBleGVjdXRlKCJERUxFVEUgRlJPTSBwcml2YXRlX2tleXMi
KTsKICAgIGZvciAoc2l6ZV90IGkgPSAwOyBpIDwgcmVzLnNpemUoKTsgKytpKQogICAgICB7
CgloZXhlbmM8aWQ+IHRtcDsKCWtleV9oYXNoX2NvZGUocnNhX2tleXBhaXJfaWQocmVzW2ld
WzBdKSwgYmFzZTY0PCBhcmM0PHJzYV9wcml2X2tleT4gPihyZXNbaV1bMV0pLCB0bXApOwoJ
ZXhlY3V0ZSgiSU5TRVJUIElOVE8gcHJpdmF0ZV9rZXlzIFZBTFVFUygnJXEnLCAnJXEnLCAn
JXEnKSIsIAoJCXRtcCgpLmNfc3RyKCksIHJlc1tpXVswXS5jX3N0cigpLCByZXNbaV1bMV0u
Y19zdHIoKSk7CgkrK3ByaXZrZXlzOwogICAgICB9CiAgfQoKICBndWFyZC5jb21taXQoKTsK
fQoKdm9pZCAKZGF0YWJhc2U6OmVuc3VyZV9vcGVuKCkKewogIHNxbGl0ZSAqcyA9IHNxbCgp
OwogIEkocyAhPSBOVUxMKTsKfQoKZGF0YWJhc2U6On5kYXRhYmFzZSgpIAp7CiAgaWYgKF9f
c3FsKQogICAgewogICAgICBzcWxpdGVfY2xvc2UoX19zcWwpOwogICAgICBfX3NxbCA9IDA7
CiAgICB9Cn0KCnN0YXRpYyB2b2lkIAphc3NlcnRfc3FsaXRlX29rKGludCByZXMpCnsKICBz
d2l0Y2ggKHJlcykKICAgIHsgICAgICAKICAgIGNhc2UgU1FMSVRFX09LOiAKICAgICAgYnJl
YWs7CgogICAgY2FzZSBTUUxJVEVfRVJST1I6CiAgICAgIHRocm93IG9vcHMoIlNRTCBlcnJv
ciBvciBtaXNzaW5nIGRhdGFiYXNlIik7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgU1FMSVRF
X0lOVEVSTkFMOgogICAgICB0aHJvdyBvb3BzKCJBbiBpbnRlcm5hbCBsb2dpYyBlcnJvciBp
biBTUUxpdGUiKTsKICAgICAgYnJlYWs7CgogICAgY2FzZSBTUUxJVEVfUEVSTToKICAgICAg
dGhyb3cgb29wcygiQWNjZXNzIHBlcm1pc3Npb24gZGVuaWVkIik7CiAgICAgIGJyZWFrOwoK
ICAgIGNhc2UgU1FMSVRFX0FCT1JUOgogICAgICB0aHJvdyBvb3BzKCJDYWxsYmFjayByb3V0
aW5lIHJlcXVlc3RlZCBhbiBhYm9ydCIpOwogICAgICBicmVhazsKCiAgICBjYXNlIFNRTElU
RV9CVVNZOgogICAgICB0aHJvdyBvb3BzKCJUaGUgZGF0YWJhc2UgZmlsZSBpcyBsb2NrZWQi
KTsKICAgICAgYnJlYWs7CgogICAgY2FzZSBTUUxJVEVfTE9DS0VEOgogICAgICB0aHJvdyBv
b3BzKCJBIHRhYmxlIGluIHRoZSBkYXRhYmFzZSBpcyBsb2NrZWQiKTsKICAgICAgYnJlYWs7
CgogICAgY2FzZSBTUUxJVEVfTk9NRU06CiAgICAgIHRocm93IG9vcHMoIkEgbWFsbG9jKCkg
ZmFpbGVkIik7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgU1FMSVRFX1JFQURPTkxZOgogICAg
ICB0aHJvdyBvb3BzKCJBdHRlbXB0IHRvIHdyaXRlIGEgcmVhZG9ubHkgZGF0YWJhc2UiKTsK
ICAgICAgYnJlYWs7CgogICAgY2FzZSBTUUxJVEVfSU5URVJSVVBUOgogICAgICB0aHJvdyBv
b3BzKCJPcGVyYXRpb24gdGVybWluYXRlZCBieSBzcWxpdGVfaW50ZXJydXB0KCkiKTsKICAg
ICAgYnJlYWs7CgogICAgY2FzZSBTUUxJVEVfSU9FUlI6CiAgICAgIHRocm93IG9vcHMoIlNv
bWUga2luZCBvZiBkaXNrIEkvTyBlcnJvciBvY2N1cnJlZCIpOwogICAgICBicmVhazsKCiAg
ICBjYXNlIFNRTElURV9DT1JSVVBUOgogICAgICB0aHJvdyBvb3BzKCJUaGUgZGF0YWJhc2Ug
ZGlzayBpbWFnZSBpcyBtYWxmb3JtZWQiKTsKICAgICAgYnJlYWs7CgogICAgY2FzZSBTUUxJ
VEVfTk9URk9VTkQ6CiAgICAgIHRocm93IG9vcHMoIihJbnRlcm5hbCBPbmx5KSBUYWJsZSBv
ciByZWNvcmQgbm90IGZvdW5kIik7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgU1FMSVRFX0ZV
TEw6CiAgICAgIHRocm93IG9vcHMoIkluc2VydGlvbiBmYWlsZWQgYmVjYXVzZSBkYXRhYmFz
ZSBpcyBmdWxsIik7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgU1FMSVRFX0NBTlRPUEVOOgog
ICAgICB0aHJvdyBvb3BzKCJVbmFibGUgdG8gb3BlbiB0aGUgZGF0YWJhc2UgZmlsZSIpOwog
ICAgICBicmVhazsKCiAgICBjYXNlIFNRTElURV9QUk9UT0NPTDoKICAgICAgdGhyb3cgb29w
cygiZGF0YWJhc2UgbG9jayBwcm90b2NvbCBlcnJvciIpOwogICAgICBicmVhazsKCiAgICBj
YXNlIFNRTElURV9FTVBUWToKICAgICAgdGhyb3cgb29wcygiKEludGVybmFsIE9ubHkpIGRh
dGFiYXNlIHRhYmxlIGlzIGVtcHR5Iik7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgU1FMSVRF
X1NDSEVNQToKICAgICAgdGhyb3cgb29wcygiVGhlIGRhdGFiYXNlIHNjaGVtYSBjaGFuZ2Vk
Iik7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgU1FMSVRFX1RPT0JJRzoKICAgICAgdGhyb3cg
b29wcygiVG9vIG11Y2ggZGF0YSBmb3Igb25lIHJvdyBvZiBhIHRhYmxlIik7CiAgICAgIGJy
ZWFrOwoKICAgIGNhc2UgU1FMSVRFX0NPTlNUUkFJTlQ6CiAgICAgIHRocm93IG9vcHMoIkFi
b3J0IGR1ZSB0byBjb250cmFpbnQgdmlvbGF0aW9uIik7CiAgICAgIGJyZWFrOwoKICAgIGNh
c2UgU1FMSVRFX01JU01BVENIOgogICAgICB0aHJvdyBvb3BzKCJEYXRhIHR5cGUgbWlzbWF0
Y2giKTsKICAgICAgYnJlYWs7CgogICAgY2FzZSBTUUxJVEVfTUlTVVNFOgogICAgICB0aHJv
dyBvb3BzKCJMaWJyYXJ5IHVzZWQgaW5jb3JyZWN0bHkiKTsKICAgICAgYnJlYWs7CgogICAg
ZGVmYXVsdDoKICAgICAgdGhyb3cgb29wcyhzdHJpbmcoIlVua25vd24gREIgcmVzdWx0IGNv
ZGU6ICIpICsgbGV4aWNhbF9jYXN0PHN0cmluZz4ocmVzKSk7CiAgICAgIGJyZWFrOwogICAg
fQp9Cgp2b2lkIApkYXRhYmFzZTo6ZXhlY3V0ZShjaGFyIGNvbnN0ICogcXVlcnksIC4uLikK
ewogIHZhX2xpc3QgYXA7CiAgaW50IHJlczsKICBjaGFyICogZXJybXNnID0gTlVMTDsKCiAg
dmFfc3RhcnQoYXAsIHF1ZXJ5KTsKCiAgLy8gbG9nIGl0CiAgY2hhciAqIGZvcm1hdHRlZCA9
IHNxbGl0ZV92bXByaW50ZihxdWVyeSwgYXApOwogIHN0cmluZyBxcShmb3JtYXR0ZWQpOwog
IGlmIChxcS5zaXplKCkgPiBjb25zdGFudHM6OmRiX2xvZ19saW5lX3N6KSAKICAgIHFxID0g
cXEuc3Vic3RyKDAsIGNvbnN0YW50czo6ZGJfbG9nX2xpbmVfc3opICsgc3RyaW5nKCIgLi4u
Iik7CiAgTChGKCJkYi5leGVjdXRlKFwiJXNcIilcbiIpICUgcXEpOwogIHNxbGl0ZV9mcmVl
bWVtKGZvcm1hdHRlZCk7CgogIHZhX2VuZChhcCk7CiAgdmFfc3RhcnQoYXAsIHF1ZXJ5KTsK
CiAgLy8gZG8gaXQKICByZXMgPSBzcWxpdGVfZXhlY192cHJpbnRmKHNxbCgpLCBxdWVyeSwg
TlVMTCwgTlVMTCwgJmVycm1zZywgYXApOwoKICB2YV9lbmQoYXApOwoKICBpZiAoZXJybXNn
KQogICAgdGhyb3cgb29wcyhzdHJpbmcoInNxbGl0ZSBleGVjIGVycm9yICIpICsgZXJybXNn
KTsKCiAgYXNzZXJ0X3NxbGl0ZV9vayhyZXMpOwoKfQoKdm9pZCAKZGF0YWJhc2U6OmZldGNo
KHJlc3VsdHMgJiByZXMsIAoJCWludCBjb25zdCB3YW50X2NvbHMsIAoJCWludCBjb25zdCB3
YW50X3Jvd3MsIAoJCWNoYXIgY29uc3QgKiBxdWVyeSwgLi4uKQp7CiAgY2hhciAqKiByZXN1
bHQgPSBOVUxMOwogIGludCBucm93OwogIGludCBuY29sOwogIGNoYXIgKiBlcnJtc2cgPSBO
VUxMOwogIGludCByZXNjb2RlOwoKICB2YV9saXN0IGFwOwogIHJlcy5jbGVhcigpOwogIHJl
cy5yZXNpemUoMCk7CiAgdmFfc3RhcnQoYXAsIHF1ZXJ5KTsKCiAgLy8gbG9nIGl0CiAgY2hh
ciAqIGZvcm1hdHRlZCA9IHNxbGl0ZV92bXByaW50ZihxdWVyeSwgYXApOwogIHN0cmluZyBx
cShmb3JtYXR0ZWQpOwogIGlmIChxcS5zaXplKCkgPiBjb25zdGFudHM6OmxvZ19saW5lX3N6
KSAKICAgIHFxID0gcXEuc3Vic3RyKDAsIGNvbnN0YW50czo6bG9nX2xpbmVfc3opICsgc3Ry
aW5nKCIgLi4uIik7CiAgTChGKCJkYi5mZXRjaChcIiVzXCIpXG4iKSAlIHFxKTsKICBzcWxp
dGVfZnJlZW1lbShmb3JtYXR0ZWQpOwoKICB2YV9lbmQoYXApOwogIHZhX3N0YXJ0KGFwLCBx
dWVyeSk7CgogIC8vIGRvIGl0CiAgcmVzY29kZSA9IHNxbGl0ZV9nZXRfdGFibGVfdnByaW50
ZihzcWwoKSwgcXVlcnksICZyZXN1bHQsICZucm93LCAmbmNvbCwgJmVycm1zZywgYXApOwoK
ICB2YV9lbmQoYXApOwoKICBjbGVhbnVwX3B0cjxjaGFyICoqLCB2b2lkPiAKICAgIHJlc3Vs
dF9ndWFyZChyZXN1bHQsICZzcWxpdGVfZnJlZV90YWJsZSk7CgogIHN0cmluZyBjdHggPSBz
dHJpbmcoImRiIHF1ZXJ5IFsiKSArIHN0cmluZyhxdWVyeSkgKyAiXTogIjsKCiAgaWYgKGVy
cm1zZykKICAgIHRocm93IG9vcHMoY3R4ICsgc3RyaW5nKCJzcWxpdGUgZXJyb3IgIikgKyBl
cnJtc2cpOwogIGFzc2VydF9zcWxpdGVfb2socmVzY29kZSk7CgogIGlmICh3YW50X2NvbHMg
PT0gMCAmJiBuY29sID09IDApIHJldHVybjsKICBpZiAod2FudF9yb3dzID09IDAgJiYgbnJv
dyA9PSAwKSByZXR1cm47CiAgaWYgKHdhbnRfY29scyA9PSBhbnlfcm93cyAmJiBuY29sID09
IDApIHJldHVybjsKICBpZiAod2FudF9yb3dzID09IGFueV9yb3dzICYmIG5yb3cgPT0gMCkg
cmV0dXJuOwoKICBpZiAod2FudF9jb2xzICE9IGFueV9jb2xzICYmCiAgICAgIG5jb2wgIT0g
d2FudF9jb2xzKQogICAgdGhyb3cgb29wcygoRigiJXMgd2FudGVkICVkIGNvbHVtbnMsIGdv
dCAlcyIpCgkJJSBjdHggJSB3YW50X2NvbHMgJSBuY29sKS5zdHIoKSk7CgogIGlmICh3YW50
X3Jvd3MgIT0gYW55X3Jvd3MgJiYKICAgICAgbnJvdyAhPSB3YW50X3Jvd3MpCiAgICB0aHJv
dyBvb3BzKChGKCIlcyB3YW50ZWQgJWQgcm93cywgZ290ICVzIikKCQklIGN0eCAlIHdhbnRf
cm93cyAlIG5yb3cpLnN0cigpKTsKCiAgaWYgKCFyZXN1bHQpCiAgICB0aHJvdyBvb3BzKGN0
eCArICJudWxsIHJlc3VsdCBzZXQiKTsKCiAgZm9yIChpbnQgaSA9IDA7IGkgPCBuY29sOyAr
K2kpIAogICAgaWYgKCFyZXN1bHRbaV0pCiAgICAgIHRocm93IG9vcHMoY3R4ICsgIm51bGwg
Y29sdW1uIG5hbWUiKTsKCiAgZm9yIChpbnQgcm93ID0gMDsgcm93IDwgbnJvdzsgKytyb3cp
IAogICAgewogICAgICB2ZWN0b3I8c3RyaW5nPiByb3d2ZWM7CiAgICAgIGZvciAoaW50IGNv
bCA9IDA7IGNvbCA8IG5jb2w7ICsrY29sKQoJewoJICBpbnQgaSA9ICgoMSArIHJvdykgKiBu
Y29sKSArIGNvbDsKCSAgaWYgKCFyZXN1bHRbaV0pCgkgICAgdGhyb3cgb29wcyhjdHggKyAi
bnVsbCByZXN1bHQgdmFsdWUiKTsKCSAgZWxzZQoJICAgIHJvd3ZlYy5wdXNoX2JhY2socmVz
dWx0W2ldKTsKCX0KICAgICAgcmVzLnB1c2hfYmFjayhyb3d2ZWMpOwogICAgfQp9CgovLyBn
ZW5lcmFsIGFwcGxpY2F0aW9uLWxldmVsIGxvZ2ljCgp2b2lkIApkYXRhYmFzZTo6c2V0X2Zp
bGVuYW1lKGZzOjpwYXRoIGNvbnN0ICYgZmlsZSkKewogIGlmIChfX3NxbCkKICAgIHsKICAg
ICAgdGhyb3cgb29wcygiY2Fubm90IGNoYW5nZSBmaWxlbmFtZSB0byAiICsgZmlsZS5zdHJp
bmcoKSArICIgd2hpbGUgZGIgaXMgb3BlbiIpOwogICAgfQogIGZpbGVuYW1lID0gZmlsZTsK
fQoKdm9pZCAKZGF0YWJhc2U6OmJlZ2luX3RyYW5zYWN0aW9uKCkgCnsKICBpZiAodHJhbnNh
Y3Rpb25fbGV2ZWwgPT0gMCkKICAgICAgZXhlY3V0ZSgiQkVHSU4iKTsKICB0cmFuc2FjdGlv
bl9sZXZlbCsrOwp9Cgp2b2lkIApkYXRhYmFzZTo6Y29tbWl0X3RyYW5zYWN0aW9uKCkKewog
IGlmICh0cmFuc2FjdGlvbl9sZXZlbCA9PSAxKQogICAgZXhlY3V0ZSgiQ09NTUlUIik7CiAg
dHJhbnNhY3Rpb25fbGV2ZWwtLTsKfQoKdm9pZCAKZGF0YWJhc2U6OnJvbGxiYWNrX3RyYW5z
YWN0aW9uKCkKewogIGlmICh0cmFuc2FjdGlvbl9sZXZlbCA9PSAxKQogICAgZXhlY3V0ZSgi
Uk9MTEJBQ0siKTsKICB0cmFuc2FjdGlvbl9sZXZlbC0tOwp9CgoKYm9vbCAKZGF0YWJhc2U6
OmV4aXN0cyhoZXhlbmM8aWQ+IGNvbnN0ICYgaWRlbnQsCgkJICAgICAgc3RyaW5nIGNvbnN0
ICYgdGFibGUpCnsKICByZXN1bHRzIHJlczsKICBmZXRjaChyZXMsIG9uZV9jb2wsIGFueV9y
b3dzLCAKCSJTRUxFQ1QgaWQgRlJPTSAnJXEnIFdIRVJFIGlkID0gJyVxJyIsCgl0YWJsZS5j
X3N0cigpLCBpZGVudCgpLmNfc3RyKCkpOwogIEkoKHJlcy5zaXplKCkgPT0gMSkgfHwgKHJl
cy5zaXplKCkgPT0gMCkpOwogIHJldHVybiByZXMuc2l6ZSgpID09IDE7Cn0KCgpib29sIApk
YXRhYmFzZTo6ZGVsdGFfZXhpc3RzKGhleGVuYzxpZD4gY29uc3QgJiBpZGVudCwKCQkgICAg
ICAgc3RyaW5nIGNvbnN0ICYgdGFibGUpCnsKICByZXN1bHRzIHJlczsKICBmZXRjaChyZXMs
IG9uZV9jb2wsIGFueV9yb3dzLCAKCSJTRUxFQ1QgaWQgRlJPTSAnJXEnIFdIRVJFIGlkID0g
JyVxJyIsCgl0YWJsZS5jX3N0cigpLCBpZGVudCgpLmNfc3RyKCkpOwogIHJldHVybiByZXMu
c2l6ZSgpID4gMDsKfQoKYm9vbCAKZGF0YWJhc2U6OmRlbHRhX2V4aXN0cyhoZXhlbmM8aWQ+
IGNvbnN0ICYgaWRlbnQsCgkJICAgICAgIGhleGVuYzxpZD4gY29uc3QgJiBiYXNlLAoJCSAg
ICAgICBzdHJpbmcgY29uc3QgJiB0YWJsZSkKewogIHJlc3VsdHMgcmVzOwogIGZldGNoKHJl
cywgb25lX2NvbCwgYW55X3Jvd3MsIAoJIlNFTEVDVCBpZCBGUk9NICclcScgV0hFUkUgaWQg
PSAnJXEnIEFORCBiYXNlID0gJyVxJyIsCgl0YWJsZS5jX3N0cigpLCBpZGVudCgpLmNfc3Ry
KCksIGJhc2UoKS5jX3N0cigpKTsKICBJKChyZXMuc2l6ZSgpID09IDEpIHx8IChyZXMuc2l6
ZSgpID09IDApKTsKICByZXR1cm4gcmVzLnNpemUoKSA9PSAxOwp9CgppbnQgCmRhdGFiYXNl
Ojpjb3VudChzdHJpbmcgY29uc3QgJiB0YWJsZSkKewogIHJlc3VsdHMgcmVzOwogIGZldGNo
KHJlcywgb25lX2NvbCwgb25lX3JvdywgCgkiU0VMRUNUIENPVU5UKCopIEZST00gJyVxJyIs
IAoJdGFibGUuY19zdHIoKSk7CiAgcmV0dXJuIGxleGljYWxfY2FzdDxpbnQ+KHJlc1swXVsw
XSk7ICAKfQoKdm9pZCAKZGF0YWJhc2U6OmdldChoZXhlbmM8aWQ+IGNvbnN0ICYgaWRlbnQs
CgkgICAgICBiYXNlNjQ8IGd6aXA8ZGF0YT4gPiAmIGRhdCwKCSAgICAgIHN0cmluZyBjb25z
dCAmIHRhYmxlKQp7CiAgcmVzdWx0cyByZXM7CiAgZmV0Y2gocmVzLCBvbmVfY29sLCBvbmVf
cm93LAoJIlNFTEVDVCBkYXRhIEZST00gJyVxJyBXSEVSRSBpZCA9ICclcSciLCAKCXRhYmxl
LmNfc3RyKCksIGlkZW50KCkuY19zdHIoKSk7CgogIC8vIGNvbnNpc3RlbmN5IGNoZWNrCiAg
YmFzZTY0PGd6aXA8ZGF0YT4gPiByZGF0YShyZXNbMF1bMF0pOwogIGhleGVuYzxpZD4gdGlk
OwogIGNhbGN1bGF0ZV9pZGVudChyZGF0YSwgdGlkKTsKICBJKHRpZCA9PSBpZGVudCk7Cgog
IGRhdCA9IHJkYXRhOwp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X2RlbHRhKGhleGVuYzxpZD4g
Y29uc3QgJiBpZGVudCwKCQkgICAgaGV4ZW5jPGlkPiBjb25zdCAmIGJhc2UsCgkJICAgIGJh
c2U2NDwgZ3ppcDxkZWx0YT4gPiAmIGRlbCwKCQkgICAgc3RyaW5nIGNvbnN0ICYgdGFibGUp
CnsKICBJKGlkZW50KCkgIT0gIiIpOwogIEkoYmFzZSgpICE9ICIiKTsKICByZXN1bHRzIHJl
czsKICBmZXRjaChyZXMsIG9uZV9jb2wsIG9uZV9yb3csCgkiU0VMRUNUIGRlbHRhIEZST00g
JyVxJyBXSEVSRSBpZCA9ICclcScgQU5EIGJhc2UgPSAnJXEnIiwgCgl0YWJsZS5jX3N0cigp
LCBpZGVudCgpLmNfc3RyKCksIGJhc2UoKS5jX3N0cigpKTsKICBkZWwgPSByZXNbMF1bMF07
Cn0KCnZvaWQgCmRhdGFiYXNlOjpwdXQoaGV4ZW5jPGlkPiBjb25zdCAmIGlkZW50LAoJICAg
ICAgYmFzZTY0PCBnemlwPGRhdGE+ID4gY29uc3QgJiBkYXQsCgkgICAgICBzdHJpbmcgY29u
c3QgJiB0YWJsZSkKewogIC8vIGNvbnNpc3RlbmN5IGNoZWNrCiAgSShpZGVudCgpICE9ICIi
KTsKICBoZXhlbmM8aWQ+IHRpZDsKICBjYWxjdWxhdGVfaWRlbnQoZGF0LCB0aWQpOwogIEko
dGlkID09IGlkZW50KTsKICAKICBleGVjdXRlKCJJTlNFUlQgSU5UTyAnJXEnIFZBTFVFUygn
JXEnLCAnJXEnKSIsIAoJICB0YWJsZS5jX3N0cigpLCBpZGVudCgpLmNfc3RyKCksIGRhdCgp
LmNfc3RyKCkpOwp9CgoKdm9pZCAKZGF0YWJhc2U6OnB1dF9kZWx0YShoZXhlbmM8aWQ+IGNv
bnN0ICYgaWRlbnQsCgkJICAgIGhleGVuYzxpZD4gY29uc3QgJiBiYXNlLAoJCSAgICBiYXNl
NjQ8Z3ppcDxkZWx0YT4gPiBjb25zdCAmIGRlbCwKCQkgICAgc3RyaW5nIGNvbnN0ICYgdGFi
bGUpCnsKICAvLyBuYjogZGVsdGEgc2NoZW1hIGlzIChpZCwgYmFzZSwgZGVsdGEpCiAgSShp
ZGVudCgpICE9ICIiKTsKICBJKGJhc2UoKSAhPSAiIik7CiAgZXhlY3V0ZSgiSU5TRVJUIElO
VE8gJyVxJyBWQUxVRVMoJyVxJywgJyVxJywgJyVxJykiLCAKCSAgdGFibGUuY19zdHIoKSwg
CgkgIGlkZW50KCkuY19zdHIoKSwgYmFzZSgpLmNfc3RyKCksIGRlbCgpLmNfc3RyKCkpOwp9
Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X3ZlcnNpb24oaGV4ZW5jPGlkPiBjb25zdCAmIGlkZW50
LAoJCSAgICAgIGJhc2U2NDwgZ3ppcDxkYXRhPiA+ICYgZGF0LAoJCSAgICAgIHN0cmluZyBj
b25zdCAmIGRhdGFfdGFibGUsCgkJICAgICAgc3RyaW5nIGNvbnN0ICYgZGVsdGFfdGFibGUp
CnsKICBJKGlkZW50KCkgIT0gIiIpOwogIGlmIChleGlzdHMoaWRlbnQsIGRhdGFfdGFibGUp
KQogICAgewogICAgICAvLyBlYXN5IHBhdGgKICAgICAgZ2V0KGlkZW50LCBkYXQsIGRhdGFf
dGFibGUpOwogICAgfQogIGVsc2UKICAgIHsKICAgICAgLy8gdHJpY2t5IHBhdGgKCiAgICAg
IC8vIHdlIHN0YXJ0IGZyb20gdGhlIGZpbGUgd2Ugd2FudCB0byByZWNvbnN0cnVjdCBhbmQg
d29yayAqZm9yd2FyZHMqCiAgICAgIC8vIHRocm91Z2ggdGhlIGRhdGFiYXNlLCB1bnRpbCB3
ZSBnZXQgdG8gYSBmdWxsIGRhdGEgb2JqZWN0LiB3ZSB0aGVuCiAgICAgIC8vIHRyYWNlIGJh
Y2sgdGhyb3VnaCB0aGUgbGlzdCBvZiBlZGdlcyB3ZSBmb2xsb3dlZCB0byBnZXQgdG8gdGhl
IGRhdGEKICAgICAgLy8gb2JqZWN0LCBhcHBseWluZyByZXZlcnNlIGRlbHRhcy4KICAgICAg
Ly8KICAgICAgLy8gdGhlIGVmZmVjdCBvZiB0aGlzIGFsZ29yaXRobSBpcyBicmVhZHRoLWZp
cnN0IHNlYXJjaCwgYmFja3dhcmRzCiAgICAgIC8vIHRocm91Z2ggdGhlIHN0b3JhZ2UgZ3Jh
cGgsIHRvIGRpc2NvdmVyIGEgZm9yd2FyZHMgc2hvcnRlc3QgcGF0aCwgYW5kCiAgICAgIC8v
IHRoZW4gZm9sbG93aW5nIHRoYXQgc2hvcnRlc3QgcGF0aCB3aXRoIGRlbHRhIGFwcGxpY2F0
aW9uLgogICAgICAvLwogICAgICAvLyB3ZSB1c2VkIHRvIGRvIHRoaXMgd2l0aCB0aGUgYm9v
c3QgZ3JhcGggbGlicmFyeSwgYnV0IGl0IGludm92bGVkCiAgICAgIC8vIGxvYWRpbmcgdG9v
IG11Y2ggb2YgdGhlIHN0b3JhZ2UgZ3JhcGggaW50byBtZW1vcnkgYXQgYW55IG1vbWVudC4g
dGhpcwogICAgICAvLyBpbXBlcmF0aXZlIHZlcnNpb24gb25seSBsb2FkcyB0aGUgZGVzY2Vu
ZGVudHMgb2YgdGhlIHJlY29uc3RydWN0aW9uCiAgICAgIC8vIG5vZGUsIHNvIGl0IG11Y2gg
Y2hlYXBlciBpbiB0ZXJtcyBvZiBtZW1vcnkuCiAgICAgIC8vCiAgICAgIC8vIHdlIGFsc28g
bWFpbnRhaW4gYSBjeWNsZS1kZXRlY3Rpbmcgc2V0LCBqdXN0IHRvIGJlIHNhZmUKICAgICAg
CiAgICAgIEwoRigicmVjb25zdHJ1Y3RpbmcgJXMgaW4gJXNcbiIpICUgaWRlbnQgJSBkZWx0
YV90YWJsZSk7CiAgICAgIEkoZGVsdGFfZXhpc3RzKGlkZW50LCBkZWx0YV90YWJsZSkpOwog
ICAgICAKICAgICAgLy8gbmI6IGFuIGVkZ2UgbWFwIGdvZXMgaW4gdGhlIGRpcmVjdGlvbiBv
ZiB0aGUKICAgICAgLy8gZGVsdGEsICpub3QqIHRoZSBkaXJlY3Rpb24gd2UgZGlzY292ZXIg
dGhpbmdzIGluLAogICAgICAvLyBpLmUuIGVhY2ggbWFwIGlzIG9mIHRoZSBmb3JtIFtuZXdp
ZF0gLT4gW29sZGlkXQoKICAgICAgdHlwZWRlZiBtYXA8IGhleGVuYzxpZD4sIGhleGVuYzxp
ZD4gPiBlZGdlbWFwOwogICAgICBsaXN0PCBzaGFyZWRfcHRyPGVkZ2VtYXA+ID4gcGF0aHM7
CgogICAgICBzZXQ8IGhleGVuYzxpZD4gPiBmcm9udGllciwgY3ljbGVzOwogICAgICBmcm9u
dGllci5pbnNlcnQoaWRlbnQpOwoKICAgICAgYm9vbCBmb3VuZF9yb290ID0gZmFsc2U7CiAg
ICAgIGhleGVuYzxpZD4gcm9vdCgiIik7CgogICAgICB3aGlsZSAoISBmb3VuZF9yb290KQoJ
ewoJICBzZXQ8IGhleGVuYzxpZD4gPiBuZXh0X2Zyb250aWVyOwoJICBzaGFyZWRfcHRyPGVk
Z2VtYXA+IGZyb250aWVyX21hcChuZXcgZWRnZW1hcCgpKTsKCgkgIEkoIWZyb250aWVyLmVt
cHR5KCkpOwoKCSAgZm9yIChzZXQ8IGhleGVuYzxpZD4gPjo6Y29uc3RfaXRlcmF0b3IgaSA9
IGZyb250aWVyLmJlZ2luKCk7CgkgICAgICAgaSAhPSBmcm9udGllci5lbmQoKTsgKytpKQoJ
ICAgIHsKCSAgICAgIGlmIChleGlzdHMoKmksIGRhdGFfdGFibGUpKQoJCXsKCQkgIHJvb3Qg
PSAqaTsKCQkgIGZvdW5kX3Jvb3QgPSB0cnVlOwoJCSAgYnJlYWs7CgkJfQoJICAgICAgZWxz
ZQoJCXsKCQkgIGN5Y2xlcy5pbnNlcnQoKmkpOwoJCSAgcmVzdWx0cyByZXM7CgkJICBmZXRj
aChyZXMsIG9uZV9jb2wsIGFueV9yb3dzLCAiU0VMRUNUIGJhc2UgZnJvbSAnJXEnIFdIRVJF
IGlkID0gJyVxJyIsCgkJCWRlbHRhX3RhYmxlLmNfc3RyKCksICgqaSkoKS5jX3N0cigpKTsK
CQkgIGZvciAoc2l6ZV90IGsgPSAwOyBrIDwgcmVzLnNpemUoKTsgKytrKQoJCSAgICB7CgkJ
ICAgICAgaGV4ZW5jPGlkPiBjb25zdCBueHQocmVzW2tdWzBdKTsKCgkJICAgICAgaWYgKGN5
Y2xlcy5maW5kKG54dCkgIT0gY3ljbGVzLmVuZCgpKQoJCQl0aHJvdyBvb3BzKCJjeWNsZSBp
biB0YWJsZSAnIiArIGRlbHRhX3RhYmxlICsgIicsIGF0IG5vZGUgIiAKCQkJCSAgICsgKCpp
KSgpICsgIiA8LSAiICsgbnh0KCkpOwoKCQkgICAgICBuZXh0X2Zyb250aWVyLmluc2VydChu
eHQpOwoKCQkgICAgICBpZiAoZnJvbnRpZXJfbWFwLT5maW5kKG54dCkgPT0gZnJvbnRpZXJf
bWFwLT5lbmQoKSkKCQkJewoJCQkgIEwoRigiaW5zZXJ0aW5nIGVkZ2U6ICVzIDwtICVzXG4i
KSAlICgqaSkgJSBueHQpOwoJCQkgIGZyb250aWVyX21hcC0+aW5zZXJ0KG1ha2VfcGFpcihu
eHQsICppKSk7CgkJCX0KCQkgICAgICBlbHNlCgkJCUwoRigic2tpcHBpbmcgbWVyZ2UgZWRn
ZSAlcyA8LSAlc1xuIikgJSAoKmkpICUgbnh0KTsKCQkgICAgfQoJCX0KCSAgICB9CgkgIGlm
ICghZm91bmRfcm9vdCkKCSAgICB7CgkgICAgICBmcm9udGllciA9IG5leHRfZnJvbnRpZXI7
CgkgICAgICBwYXRocy5wdXNoX2Zyb250KGZyb250aWVyX21hcCk7CgkgICAgfQoJfQoKICAg
ICAgLy8gcGF0aCBidWlsdCwgbm93IGFsbCB3ZSBuZWVkIHRvIGRvIGlzIGZvbGxvdyBpdCBi
YWNrCgogICAgICBJKGZvdW5kX3Jvb3QpOwogICAgICBJKHJvb3QoKSAhPSAiIik7CiAgICAg
IGJhc2U2NDwgZ3ppcDxkYXRhPiA+IGJlZ2luX3BhY2tlZDsKICAgICAgZGF0YSBiZWdpbjsg
ICAgICAKICAgICAgZ2V0KHJvb3QsIGJlZ2luX3BhY2tlZCwgZGF0YV90YWJsZSk7CiAgICAg
IHVucGFjayhiZWdpbl9wYWNrZWQsIGJlZ2luKTsKICAgICAgaGV4ZW5jPGlkPiBjdXJyID0g
cm9vdDsKCiAgICAgIGJvb3N0OjpzaGFyZWRfcHRyPGRlbHRhX2FwcGxpY2F0b3I+IGFwcCA9
IG5ld19waWVjZXdpc2VfYXBwbGljYXRvcigpOwogICAgICBhcHAtPmJlZ2luKGJlZ2luKCkp
OwogICAgICAKICAgICAgZm9yIChsaXN0PCBzaGFyZWRfcHRyPGVkZ2VtYXA+ID46OmNvbnN0
X2l0ZXJhdG9yIHAgPSBwYXRocy5iZWdpbigpOwoJICAgcCAhPSBwYXRocy5lbmQoKTsgKytw
KQoJewoJICBzaGFyZWRfcHRyPGVkZ2VtYXA+IGkgPSAqcDsKCSAgSShpLT5maW5kKGN1cnIp
ICE9IGktPmVuZCgpKTsKCSAgaGV4ZW5jPGlkPiBjb25zdCBueHQgPSBpLT5maW5kKGN1cnIp
LT5zZWNvbmQ7CgoJICBMKEYoImZvbGxvd2luZyBkZWx0YSAlcyAtPiAlc1xuIikgJSBjdXJy
ICUgbnh0KTsKCSAgYmFzZTY0PCBnemlwPGRlbHRhPiA+IGRlbF9wYWNrZWQ7CgkgIGdldF9k
ZWx0YShueHQsIGN1cnIsIGRlbF9wYWNrZWQsIGRlbHRhX3RhYmxlKTsKCSAgZGVsdGEgZGVs
OwoJICB1bnBhY2soZGVsX3BhY2tlZCwgZGVsKTsKCSAgYXBwbHlfZGVsdGEgKGFwcCwgZGVs
KCkpOwoJICBhcHAtPm5leHQoKTsKCSAgY3VyciA9IG54dDsKCX0KCiAgICAgIHN0cmluZyB0
bXA7CiAgICAgIGFwcC0+ZmluaXNoKHRtcCk7CiAgICAgIGRhdGEgZW5kKHRtcCk7CgogICAg
ICBoZXhlbmM8aWQ+IGZpbmFsOwogICAgICBjYWxjdWxhdGVfaWRlbnQoZW5kLCBmaW5hbCk7
CiAgICAgIEkoZmluYWwgPT0gaWRlbnQpOwogICAgICBwYWNrKGVuZCwgZGF0KTsKICAgIH0K
fQoKCnZvaWQgCmRhdGFiYXNlOjpkcm9wKGhleGVuYzxpZD4gY29uc3QgJiBpZGVudCwgCgkg
ICAgICAgc3RyaW5nIGNvbnN0ICYgdGFibGUpCnsKICBleGVjdXRlKCJERUxFVEUgRlJPTSAn
JXEnIFdIRVJFIGlkID0gJyVxJyIsICAKCSAgdGFibGUuY19zdHIoKSwKCSAgaWRlbnQoKS5j
X3N0cigpKTsKfQoKdm9pZCAKZGF0YWJhc2U6OnB1dF92ZXJzaW9uKGhleGVuYzxpZD4gY29u
c3QgJiBvbGRfaWQsCgkJICAgICAgaGV4ZW5jPGlkPiBjb25zdCAmIG5ld19pZCwKCQkgICAg
ICBiYXNlNjQ8IGd6aXA8ZGVsdGE+ID4gY29uc3QgJiBkZWwsCgkJICAgICAgc3RyaW5nIGNv
bnN0ICYgZGF0YV90YWJsZSwKCQkgICAgICBzdHJpbmcgY29uc3QgJiBkZWx0YV90YWJsZSkK
ewoKICBiYXNlNjQ8IGd6aXA8ZGF0YT4gPiBvbGRfZGF0YSwgbmV3X2RhdGE7CiAgYmFzZTY0
PCBnemlwPGRlbHRhPiA+IHJldmVyc2VfZGVsdGE7CiAgCiAgZ2V0X3ZlcnNpb24ob2xkX2lk
LCBvbGRfZGF0YSwgZGF0YV90YWJsZSwgZGVsdGFfdGFibGUpOwogIHBhdGNoKG9sZF9kYXRh
LCBkZWwsIG5ld19kYXRhKTsKICBkaWZmKG5ld19kYXRhLCBvbGRfZGF0YSwgcmV2ZXJzZV9k
ZWx0YSk7CiAgICAgIAogIHRyYW5zYWN0aW9uX2d1YXJkIGd1YXJkKCp0aGlzKTsKICBpZiAo
ZXhpc3RzKG9sZF9pZCwgZGF0YV90YWJsZSkpCiAgICB7CiAgICAgIC8vIGRlc2NlbmRlbnQg
b2YgYSBoZWFkIHZlcnNpb24gcmVwbGFjZXMgdGhlIGhlYWQsIHRoZXJlZm9yZSBvbGQgaGVh
ZAogICAgICAvLyBtdXN0IGJlIGRpc3Bvc2VkIG9mCiAgICAgIGRyb3Aob2xkX2lkLCBkYXRh
X3RhYmxlKTsKICAgIH0KICBwdXQobmV3X2lkLCBuZXdfZGF0YSwgZGF0YV90YWJsZSk7CiAg
cHV0X2RlbHRhKG9sZF9pZCwgbmV3X2lkLCByZXZlcnNlX2RlbHRhLCBkZWx0YV90YWJsZSk7
CiAgZ3VhcmQuY29tbWl0KCk7Cn0KCnZvaWQgCmRhdGFiYXNlOjpwdXRfcmV2ZXJzZV92ZXJz
aW9uKGhleGVuYzxpZD4gY29uc3QgJiBuZXdfaWQsCgkJCSAgICAgIGhleGVuYzxpZD4gY29u
c3QgJiBvbGRfaWQsCgkJCSAgICAgIGJhc2U2NDwgZ3ppcDxkZWx0YT4gPiBjb25zdCAmIHJl
dmVyc2VfZGVsLAoJCQkgICAgICBzdHJpbmcgY29uc3QgJiBkYXRhX3RhYmxlLAoJCQkgICAg
ICBzdHJpbmcgY29uc3QgJiBkZWx0YV90YWJsZSkKewogIGJhc2U2NDwgZ3ppcDxkYXRhPiA+
IG9sZF9kYXRhLCBuZXdfZGF0YTsKICAKICBnZXRfdmVyc2lvbihuZXdfaWQsIG5ld19kYXRh
LCBkYXRhX3RhYmxlLCBkZWx0YV90YWJsZSk7CiAgcGF0Y2gobmV3X2RhdGEsIHJldmVyc2Vf
ZGVsLCBvbGRfZGF0YSk7CiAgaGV4ZW5jPGlkPiBjaGVjazsKICBjYWxjdWxhdGVfaWRlbnQo
b2xkX2RhdGEsIGNoZWNrKTsKICBJKG9sZF9pZCA9PSBjaGVjayk7CiAgICAgIAogIHRyYW5z
YWN0aW9uX2d1YXJkIGd1YXJkKCp0aGlzKTsKICBwdXRfZGVsdGEob2xkX2lkLCBuZXdfaWQs
IHJldmVyc2VfZGVsLCBkZWx0YV90YWJsZSk7CiAgZ3VhcmQuY29tbWl0KCk7Cn0KCgoKLy8g
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tCi8vIC0tICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAtLQovLyAtLSAgICAgICAgICAgICAgcHVibGljIGludGVyZmFjZSBm
b2xsb3dzICAgICAgICAgICAgICAgICAgLS0KLy8gLS0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tCi8vIC0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKYm9vbCAK
ZGF0YWJhc2U6OmZpbGVfdmVyc2lvbl9leGlzdHMoZmlsZV9pZCBjb25zdCAmIGlkKQp7CiAg
cmV0dXJuIGRlbHRhX2V4aXN0cyhpZC5pbm5lcigpLCAiZmlsZV9kZWx0YXMiKSAKICAgIHx8
IGV4aXN0cyhpZC5pbm5lcigpLCAiZmlsZXMiKTsKfQoKYm9vbCAKZGF0YWJhc2U6Om1hbmlm
ZXN0X3ZlcnNpb25fZXhpc3RzKG1hbmlmZXN0X2lkIGNvbnN0ICYgaWQpCnsKICByZXR1cm4g
ZGVsdGFfZXhpc3RzKGlkLmlubmVyKCksICJtYW5pZmVzdF9kZWx0YXMiKSAKICAgIHx8IGV4
aXN0cyhpZC5pbm5lcigpLCAibWFuaWZlc3RzIik7Cn0KCmJvb2wgCmRhdGFiYXNlOjpyZXZp
c2lvbl9leGlzdHMocmV2aXNpb25faWQgY29uc3QgJiBpZCkKewogIHJldHVybiBleGlzdHMo
aWQuaW5uZXIoKSwgInJldmlzaW9ucyIpOwp9CgoKdm9pZCAKZGF0YWJhc2U6OmdldF9maWxl
X3ZlcnNpb24oZmlsZV9pZCBjb25zdCAmIGlkLAoJCQkgICBmaWxlX2RhdGEgJiBkYXQpCnsK
ICBiYXNlNjQ8IGd6aXA8ZGF0YT4gPiB0bXA7CiAgZ2V0X3ZlcnNpb24oaWQuaW5uZXIoKSwg
dG1wLCAiZmlsZXMiLCAiZmlsZV9kZWx0YXMiKTsKICBkYXQgPSB0bXA7Cn0KCnZvaWQgCmRh
dGFiYXNlOjpnZXRfbWFuaWZlc3RfdmVyc2lvbihtYW5pZmVzdF9pZCBjb25zdCAmIGlkLAoJ
CQkgICAgICAgbWFuaWZlc3RfZGF0YSAmIGRhdCkKewogIGJhc2U2NDwgZ3ppcDxkYXRhPiA+
IHRtcDsKICBnZXRfdmVyc2lvbihpZC5pbm5lcigpLCB0bXAsICJtYW5pZmVzdHMiLCAibWFu
aWZlc3RfZGVsdGFzIik7CiAgZGF0ID0gdG1wOwp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X21h
bmlmZXN0KG1hbmlmZXN0X2lkIGNvbnN0ICYgaWQsCgkJICAgICAgIG1hbmlmZXN0X21hcCAm
IG1tKQp7CiAgbWFuaWZlc3RfZGF0YSBtZGF0OwogIGdldF9tYW5pZmVzdF92ZXJzaW9uKGlk
LCBtZGF0KTsKICByZWFkX21hbmlmZXN0X21hcChtZGF0LCBtbSk7Cn0KCgp2b2lkIApkYXRh
YmFzZTo6cHV0X2ZpbGUoZmlsZV9pZCBjb25zdCAmIGlkLAoJCSAgIGZpbGVfZGF0YSBjb25z
dCAmIGRhdCkKewogIHB1dChpZC5pbm5lcigpLCBkYXQuaW5uZXIoKSwgImZpbGVzIik7Cn0K
CnZvaWQgCmRhdGFiYXNlOjpwdXRfZmlsZV92ZXJzaW9uKGZpbGVfaWQgY29uc3QgJiBvbGRf
aWQsCgkJCSAgIGZpbGVfaWQgY29uc3QgJiBuZXdfaWQsCgkJCSAgIGZpbGVfZGVsdGEgY29u
c3QgJiBkZWwpCnsKICBwdXRfdmVyc2lvbihvbGRfaWQuaW5uZXIoKSwgbmV3X2lkLmlubmVy
KCksIGRlbC5pbm5lcigpLCAKCSAgICAgICJmaWxlcyIsICJmaWxlX2RlbHRhcyIpOwp9Cgp2
b2lkIApkYXRhYmFzZTo6cHV0X2ZpbGVfcmV2ZXJzZV92ZXJzaW9uKGZpbGVfaWQgY29uc3Qg
JiBuZXdfaWQsCgkJCQkgICBmaWxlX2lkIGNvbnN0ICYgb2xkX2lkLAkJCQkgICAKCQkJCSAg
IGZpbGVfZGVsdGEgY29uc3QgJiBkZWwpCnsKICBwdXRfcmV2ZXJzZV92ZXJzaW9uKG5ld19p
ZC5pbm5lcigpLCBvbGRfaWQuaW5uZXIoKSwgZGVsLmlubmVyKCksIAoJCSAgICAgICJmaWxl
cyIsICJmaWxlX2RlbHRhcyIpOwp9CgoKdm9pZCAKZGF0YWJhc2U6OnB1dF9tYW5pZmVzdCht
YW5pZmVzdF9pZCBjb25zdCAmIGlkLAoJCSAgICAgICBtYW5pZmVzdF9kYXRhIGNvbnN0ICYg
ZGF0KQp7CiAgcHV0KGlkLmlubmVyKCksIGRhdC5pbm5lcigpLCAibWFuaWZlc3RzIik7Cn0K
CnZvaWQgCmRhdGFiYXNlOjpwdXRfbWFuaWZlc3RfdmVyc2lvbihtYW5pZmVzdF9pZCBjb25z
dCAmIG9sZF9pZCwKCQkJICAgICAgIG1hbmlmZXN0X2lkIGNvbnN0ICYgbmV3X2lkLAoJCQkg
ICAgICAgbWFuaWZlc3RfZGVsdGEgY29uc3QgJiBkZWwpCnsKICBwdXRfdmVyc2lvbihvbGRf
aWQuaW5uZXIoKSwgbmV3X2lkLmlubmVyKCksIGRlbC5pbm5lcigpLCAKCSAgICAgICJtYW5p
ZmVzdHMiLCAibWFuaWZlc3RfZGVsdGFzIik7Cn0KCnZvaWQgCmRhdGFiYXNlOjpwdXRfbWFu
aWZlc3RfcmV2ZXJzZV92ZXJzaW9uKG1hbmlmZXN0X2lkIGNvbnN0ICYgbmV3X2lkLAoJCQkJ
ICAgICAgIG1hbmlmZXN0X2lkIGNvbnN0ICYgb2xkX2lkLAkJCQkgICAKCQkJCSAgICAgICBt
YW5pZmVzdF9kZWx0YSBjb25zdCAmIGRlbCkKewogIHB1dF9yZXZlcnNlX3ZlcnNpb24obmV3
X2lkLmlubmVyKCksIG9sZF9pZC5pbm5lcigpLCBkZWwuaW5uZXIoKSwgCgkJICAgICAgIm1h
bmlmZXN0cyIsICJtYW5pZmVzdF9kZWx0YXMiKTsKfQoKCnZvaWQgCmRhdGFiYXNlOjpnZXRf
cmV2aXNpb25fYW5jZXN0cnkoc3RkOjpzZXQ8c3RkOjpwYWlyPHJldmlzaW9uX2lkLCByZXZp
c2lvbl9pZD4gPiAmIGdyYXBoKQp7CiAgcmVzdWx0cyByZXM7CiAgZ3JhcGguY2xlYXIoKTsK
ICBmZXRjaChyZXMsIDIsIGFueV9yb3dzLCAKCSJTRUxFQ1QgcGFyZW50LGNoaWxkIEZST00g
cmV2aXNpb25fYW5jZXN0cnkiKTsKICBmb3IgKHNpemVfdCBpID0gMDsgaSA8IHJlcy5zaXpl
KCk7ICsraSkKICAgIGdyYXBoLmluc2VydChzdGQ6Om1ha2VfcGFpcihyZXZpc2lvbl9pZChy
ZXNbaV1bMF0pLAoJCQkJcmV2aXNpb25faWQocmVzW2ldWzFdKSkpOwp9Cgp2b2lkIApkYXRh
YmFzZTo6Z2V0X3JldmlzaW9uX3BhcmVudHMocmV2aXNpb25faWQgY29uc3QgJiBpZCwKCQkJ
ICAgICAgc2V0PHJldmlzaW9uX2lkPiAmIHBhcmVudHMpCnsKICByZXN1bHRzIHJlczsKICBw
YXJlbnRzLmNsZWFyKCk7CiAgZmV0Y2gocmVzLCBvbmVfY29sLCBhbnlfcm93cywgCgkiU0VM
RUNUIHBhcmVudCBGUk9NIHJldmlzaW9uX2FuY2VzdHJ5IFdIRVJFIGNoaWxkID0gJyVxJyIs
CglpZC5pbm5lcigpKCkuY19zdHIoKSk7CiAgZm9yIChzaXplX3QgaSA9IDA7IGkgPCByZXMu
c2l6ZSgpOyArK2kpCiAgICBwYXJlbnRzLmluc2VydChyZXZpc2lvbl9pZChyZXNbaV1bMF0p
KTsKfQoKdm9pZCAKZGF0YWJhc2U6OmdldF9yZXZpc2lvbl9jaGlsZHJlbihyZXZpc2lvbl9p
ZCBjb25zdCAmIGlkLAoJCQkJc2V0PHJldmlzaW9uX2lkPiAmIGNoaWxkcmVuKQp7CiAgcmVz
dWx0cyByZXM7CiAgY2hpbGRyZW4uY2xlYXIoKTsKICBmZXRjaChyZXMsIG9uZV9jb2wsIGFu
eV9yb3dzLCAKCSJTRUxFQ1QgY2hpbGQgRlJPTSByZXZpc2lvbl9hbmNlc3RyeSBXSEVSRSBw
YXJlbnQgPSAnJXEnIiwKCWlkLmlubmVyKCkoKS5jX3N0cigpKTsKICBmb3IgKHNpemVfdCBp
ID0gMDsgaSA8IHJlcy5zaXplKCk7ICsraSkKICAgIGNoaWxkcmVuLmluc2VydChyZXZpc2lv
bl9pZChyZXNbaV1bMF0pKTsKfQoKdm9pZCAKZGF0YWJhc2U6OmdldF9yZXZpc2lvbl9tYW5p
ZmVzdChyZXZpc2lvbl9pZCBjb25zdCAmIHJpZCwKCQkJICAgICAgIG1hbmlmZXN0X2lkICYg
bWlkKQp7CiAgcmV2aXNpb25fc2V0IHJldjsKICBnZXRfcmV2aXNpb24ocmlkLCByZXYpOwog
IG1pZCA9IHJldi5uZXdfbWFuaWZlc3Q7Cn0KCnZvaWQgCmRhdGFiYXNlOjpnZXRfcmV2aXNp
b24ocmV2aXNpb25faWQgY29uc3QgJiBpZCwKCQkgICAgICAgcmV2aXNpb25fc2V0ICYgcmV2
KQp7CiAgcmV2aXNpb25fZGF0YSBkOwogIGdldF9yZXZpc2lvbihpZCwgZCk7CiAgcmVhZF9y
ZXZpc2lvbl9zZXQoZCwgcmV2KTsKfQoKdm9pZCAKZGF0YWJhc2U6OmdldF9yZXZpc2lvbihy
ZXZpc2lvbl9pZCBjb25zdCAmIGlkLAoJCSAgICAgICByZXZpc2lvbl9kYXRhICYgZGF0KQp7
CiAgcmVzdWx0cyByZXM7CiAgZmV0Y2gocmVzLCBvbmVfY29sLCBvbmVfcm93LCAKCSJTRUxF
Q1QgZGF0YSBGUk9NIHJldmlzaW9ucyBXSEVSRSBpZCA9ICclcSciLAoJaWQuaW5uZXIoKSgp
LmNfc3RyKCkpOwoKICBkYXQgPSByZXZpc2lvbl9kYXRhKHJlc1swXVswXSk7CgogIC8vIHZl
cmlmeSB0aGF0IHdlIGdvdCBhIHJldmlzaW9uIHdpdGggdGhlIHJpZ2h0IGlkCiAgewogICAg
cmV2aXNpb25faWQgdG1wOwogICAgY2FsY3VsYXRlX2lkZW50KGRhdCwgdG1wKTsKICAgIEko
aWQgPT0gdG1wKTsKICB9Cn0KCnZvaWQgCmRhdGFiYXNlOjpwdXRfcmV2aXNpb24ocmV2aXNp
b25faWQgY29uc3QgJiBuZXdfaWQsCgkJICAgICAgIHJldmlzaW9uX3NldCBjb25zdCAmIHJl
dikKewoKICBJKCFyZXZpc2lvbl9leGlzdHMobmV3X2lkKSk7CiAgcmV2aXNpb25fZGF0YSBk
OwoKICB3cml0ZV9yZXZpc2lvbl9zZXQocmV2LCBkKTsKICByZXZpc2lvbl9pZCB0bXA7CiAg
Y2FsY3VsYXRlX2lkZW50KGQsIHRtcCk7CiAgSSh0bXAgPT0gbmV3X2lkKTsKCiAgdHJhbnNh
Y3Rpb25fZ3VhcmQgZ3VhcmQoKnRoaXMpOwoKICBleGVjdXRlKCJJTlNFUlQgSU5UTyByZXZp
c2lvbnMgVkFMVUVTKCclcScsICclcScpIiwgCgkgIG5ld19pZC5pbm5lcigpKCkuY19zdHIo
KSwgCgkgIGQuaW5uZXIoKSgpLmNfc3RyKCkpOwoKICBmb3IgKGVkZ2VfbWFwOjpjb25zdF9p
dGVyYXRvciBlID0gcmV2LmVkZ2VzLmJlZ2luKCk7CiAgICAgICBlICE9IHJldi5lZGdlcy5l
bmQoKTsgKytlKQogICAgewogICAgICBleGVjdXRlKCJJTlNFUlQgSU5UTyByZXZpc2lvbl9h
bmNlc3RyeSBWQUxVRVMoJyVxJywgJyVxJykiLCAKCSAgICAgIGVkZ2Vfb2xkX3JldmlzaW9u
KGUpLmlubmVyKCkoKS5jX3N0cigpLAoJICAgICAgbmV3X2lkLmlubmVyKCkoKS5jX3N0cigp
KTsKICAgIH0KCiAgZ3VhcmQuY29tbWl0KCk7Cn0KCnZvaWQgCmRhdGFiYXNlOjpwdXRfcmV2
aXNpb24ocmV2aXNpb25faWQgY29uc3QgJiBuZXdfaWQsCgkJICAgICAgIHJldmlzaW9uX2Rh
dGEgY29uc3QgJiBkYXQpCnsKICByZXZpc2lvbl9zZXQgcmV2OwogIHJlYWRfcmV2aXNpb25f
c2V0KGRhdCwgcmV2KTsKICBwdXRfcmV2aXNpb24obmV3X2lkLCByZXYpOwp9CgoKLy8gY3J5
cHRvIGtleSBtYW5hZ2VtZW50Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X2tleV9pZHMoc3RyaW5n
IGNvbnN0ICYgcGF0dGVybiwKCQkgICAgICB2ZWN0b3I8cnNhX2tleXBhaXJfaWQ+ICYgcHVi
a2V5cywKCQkgICAgICB2ZWN0b3I8cnNhX2tleXBhaXJfaWQ+ICYgcHJpdmtleXMpCnsKICBw
dWJrZXlzLmNsZWFyKCk7CiAgcHJpdmtleXMuY2xlYXIoKTsKICByZXN1bHRzIHJlczsKCiAg
aWYgKHBhdHRlcm4gIT0gIiIpCiAgICBmZXRjaChyZXMsIG9uZV9jb2wsIGFueV9yb3dzLCAK
CSAgIlNFTEVDVCBpZCBmcm9tIHB1YmxpY19rZXlzIFdIRVJFIGlkIEdMT0IgJyVxJyIsCgkg
IHBhdHRlcm4uY19zdHIoKSk7CiAgZWxzZQogICAgZmV0Y2gocmVzLCBvbmVfY29sLCBhbnlf
cm93cywgCgkgICJTRUxFQ1QgaWQgZnJvbSBwdWJsaWNfa2V5cyIpOwoKICBmb3IgKHNpemVf
dCBpID0gMDsgaSA8IHJlcy5zaXplKCk7ICsraSkKICAgIHB1YmtleXMucHVzaF9iYWNrKHJl
c1tpXVswXSk7CgogIGlmIChwYXR0ZXJuICE9ICIiKQogICAgZmV0Y2gocmVzLCBvbmVfY29s
LCBhbnlfcm93cywgCgkgICJTRUxFQ1QgaWQgZnJvbSBwcml2YXRlX2tleXMgV0hFUkUgaWQg
R0xPQiAnJXEnIiwKCSAgcGF0dGVybi5jX3N0cigpKTsKICBlbHNlCiAgICBmZXRjaChyZXMs
IG9uZV9jb2wsIGFueV9yb3dzLCAKCSAgIlNFTEVDVCBpZCBmcm9tIHByaXZhdGVfa2V5cyIp
OwoKICBmb3IgKHNpemVfdCBpID0gMDsgaSA8IHJlcy5zaXplKCk7ICsraSkKICAgIHByaXZr
ZXlzLnB1c2hfYmFjayhyZXNbaV1bMF0pOwp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X3ByaXZh
dGVfa2V5cyh2ZWN0b3I8cnNhX2tleXBhaXJfaWQ+ICYgcHJpdmtleXMpCnsKICBwcml2a2V5
cy5jbGVhcigpOwogIHJlc3VsdHMgcmVzOwogIGZldGNoKHJlcywgb25lX2NvbCwgYW55X3Jv
d3MsICAiU0VMRUNUIGlkIGZyb20gcHJpdmF0ZV9rZXlzIik7CiAgZm9yIChzaXplX3QgaSA9
IDA7IGkgPCByZXMuc2l6ZSgpOyArK2kpCiAgICBwcml2a2V5cy5wdXNoX2JhY2socmVzW2ld
WzBdKTsKfQoKYm9vbCAKZGF0YWJhc2U6OnB1YmxpY19rZXlfZXhpc3RzKGhleGVuYzxpZD4g
Y29uc3QgJiBoYXNoKQp7CiAgcmVzdWx0cyByZXM7CiAgZmV0Y2gocmVzLCBvbmVfY29sLCBh
bnlfcm93cywgCgkiU0VMRUNUIGlkIEZST00gcHVibGljX2tleXMgV0hFUkUgaGFzaCA9ICcl
cSciLAoJaGFzaCgpLmNfc3RyKCkpOwogIEkoKHJlcy5zaXplKCkgPT0gMSkgfHwgKHJlcy5z
aXplKCkgPT0gMCkpOwogIGlmIChyZXMuc2l6ZSgpID09IDEpIAogICAgcmV0dXJuIHRydWU7
CiAgcmV0dXJuIGZhbHNlOwp9Cgpib29sIApkYXRhYmFzZTo6cHVibGljX2tleV9leGlzdHMo
cnNhX2tleXBhaXJfaWQgY29uc3QgJiBpZCkKewogIHJlc3VsdHMgcmVzOwogIGZldGNoKHJl
cywgb25lX2NvbCwgYW55X3Jvd3MsIAoJIlNFTEVDVCBpZCBGUk9NIHB1YmxpY19rZXlzIFdI
RVJFIGlkID0gJyVxJyIsCglpZCgpLmNfc3RyKCkpOwogIEkoKHJlcy5zaXplKCkgPT0gMSkg
fHwgKHJlcy5zaXplKCkgPT0gMCkpOwogIGlmIChyZXMuc2l6ZSgpID09IDEpIAogICAgcmV0
dXJuIHRydWU7CiAgcmV0dXJuIGZhbHNlOwp9Cgpib29sIApkYXRhYmFzZTo6cHJpdmF0ZV9r
ZXlfZXhpc3RzKHJzYV9rZXlwYWlyX2lkIGNvbnN0ICYgaWQpCnsKICByZXN1bHRzIHJlczsK
ICBmZXRjaChyZXMsIG9uZV9jb2wsIGFueV9yb3dzLAoJIlNFTEVDVCBpZCBGUk9NIHByaXZh
dGVfa2V5cyBXSEVSRSBpZCA9ICclcSciLAoJaWQoKS5jX3N0cigpKTsKICBJKChyZXMuc2l6
ZSgpID09IDEpIHx8IChyZXMuc2l6ZSgpID09IDApKTsKICBpZiAocmVzLnNpemUoKSA9PSAx
KQogICAgcmV0dXJuIHRydWU7CiAgcmV0dXJuIGZhbHNlOwp9Cgpib29sIApkYXRhYmFzZTo6
a2V5X2V4aXN0cyhyc2Ffa2V5cGFpcl9pZCBjb25zdCAmIGlkKQp7CiAgcmV0dXJuIHB1Ymxp
Y19rZXlfZXhpc3RzKGlkKSB8fCBwcml2YXRlX2tleV9leGlzdHMoaWQpOwp9Cgp2b2lkIApk
YXRhYmFzZTo6Z2V0X3B1YmtleShoZXhlbmM8aWQ+IGNvbnN0ICYgaGFzaCwgCgkJICAgICBy
c2Ffa2V5cGFpcl9pZCAmIGlkLAoJCSAgICAgYmFzZTY0PHJzYV9wdWJfa2V5PiAmIHB1Yl9l
bmNvZGVkKQp7CiAgcmVzdWx0cyByZXM7CiAgZmV0Y2gocmVzLCAyLCBvbmVfcm93LCAKCSJT
RUxFQ1QgaWQsIGtleWRhdGEgRlJPTSBwdWJsaWNfa2V5cyB3aGVyZSBoYXNoID0gJyVxJyIs
IAoJaGFzaCgpLmNfc3RyKCkpOwogIGlkID0gcmVzWzBdWzBdOwogIHB1Yl9lbmNvZGVkID0g
cmVzWzBdWzFdOwp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X2tleShyc2Ffa2V5cGFpcl9pZCBj
b25zdCAmIHB1Yl9pZCwgCgkJICBiYXNlNjQ8cnNhX3B1Yl9rZXk+ICYgcHViX2VuY29kZWQp
CnsKICByZXN1bHRzIHJlczsKICBmZXRjaChyZXMsIG9uZV9jb2wsIG9uZV9yb3csIAoJIlNF
TEVDVCBrZXlkYXRhIEZST00gcHVibGljX2tleXMgd2hlcmUgaWQgPSAnJXEnIiwgCglwdWJf
aWQoKS5jX3N0cigpKTsKICBwdWJfZW5jb2RlZCA9IHJlc1swXVswXTsKfQoKdm9pZCAKZGF0
YWJhc2U6OmdldF9rZXkocnNhX2tleXBhaXJfaWQgY29uc3QgJiBwcml2X2lkLCAKCQkgIGJh
c2U2NDwgYXJjNDxyc2FfcHJpdl9rZXk+ID4gJiBwcml2X2VuY29kZWQpCnsKICByZXN1bHRz
IHJlczsKICBmZXRjaChyZXMsIG9uZV9jb2wsIG9uZV9jb2wsIAoJIlNFTEVDVCBrZXlkYXRh
IEZST00gcHJpdmF0ZV9rZXlzIHdoZXJlIGlkID0gJyVxJyIsIAoJcHJpdl9pZCgpLmNfc3Ry
KCkpOwogIHByaXZfZW5jb2RlZCA9IHJlc1swXVswXTsKfQoKCnZvaWQgCmRhdGFiYXNlOjpw
dXRfa2V5KHJzYV9rZXlwYWlyX2lkIGNvbnN0ICYgcHViX2lkLCAKCQkgIGJhc2U2NDxyc2Ff
cHViX2tleT4gY29uc3QgJiBwdWJfZW5jb2RlZCkKewogIGhleGVuYzxpZD4gdGhhc2g7CiAg
a2V5X2hhc2hfY29kZShwdWJfaWQsIHB1Yl9lbmNvZGVkLCB0aGFzaCk7CiAgZXhlY3V0ZSgi
SU5TRVJUIElOVE8gcHVibGljX2tleXMgVkFMVUVTKCclcScsICclcScsICclcScpIiwgCgkg
IHRoYXNoKCkuY19zdHIoKSwgcHViX2lkKCkuY19zdHIoKSwgcHViX2VuY29kZWQoKS5jX3N0
cigpKTsKfQoKdm9pZCAKZGF0YWJhc2U6OnB1dF9rZXkocnNhX2tleXBhaXJfaWQgY29uc3Qg
JiBwcml2X2lkLCAKCQkgIGJhc2U2NDwgYXJjNDxyc2FfcHJpdl9rZXk+ID4gY29uc3QgJiBw
cml2X2VuY29kZWQpCnsKICAKICBoZXhlbmM8aWQ+IHRoYXNoOwogIGtleV9oYXNoX2NvZGUo
cHJpdl9pZCwgcHJpdl9lbmNvZGVkLCB0aGFzaCk7CiAgZXhlY3V0ZSgiSU5TRVJUIElOVE8g
cHJpdmF0ZV9rZXlzIFZBTFVFUygnJXEnLCAnJXEnLCAnJXEnKSIsIAoJICB0aGFzaCgpLmNf
c3RyKCksIHByaXZfaWQoKS5jX3N0cigpLCBwcml2X2VuY29kZWQoKS5jX3N0cigpKTsKfQoK
dm9pZCAKZGF0YWJhc2U6OnB1dF9rZXlfcGFpcihyc2Ffa2V5cGFpcl9pZCBjb25zdCAmIGlk
LCAKCQkgICAgICAgYmFzZTY0PHJzYV9wdWJfa2V5PiBjb25zdCAmIHB1Yl9lbmNvZGVkLAoJ
CSAgICAgICBiYXNlNjQ8IGFyYzQ8cnNhX3ByaXZfa2V5PiA+IGNvbnN0ICYgcHJpdl9lbmNv
ZGVkKQp7CiAgdHJhbnNhY3Rpb25fZ3VhcmQgZ3VhcmQoKnRoaXMpOwogIHB1dF9rZXkoaWQs
IHB1Yl9lbmNvZGVkKTsKICBwdXRfa2V5KGlkLCBwcml2X2VuY29kZWQpOwogIGd1YXJkLmNv
bW1pdCgpOwp9CgoKLy8gY2VydCBtYW5hZ2VtZW50Cgpib29sIApkYXRhYmFzZTo6Y2VydF9l
eGlzdHMoY2VydCBjb25zdCAmIHQsCgkJICAgICAgc3RyaW5nIGNvbnN0ICYgdGFibGUpCnsK
ICByZXN1bHRzIHJlczsKICBmZXRjaChyZXMsIDEsIGFueV9yb3dzLAoJIlNFTEVDVCBpZCBG
Uk9NICclcScgV0hFUkUgaWQgPSAnJXEnICIKCSJBTkQgbmFtZSA9ICclcScgQU5EIHZhbHVl
ID0gJyVxJyAiIAoJIkFORCBrZXlwYWlyID0gJyVxJyBBTkQgc2lnbmF0dXJlID0gJyVxJyAi
LAoJdGFibGUuY19zdHIoKSwKCXQuaWRlbnQoKS5jX3N0cigpLAoJdC5uYW1lKCkuY19zdHIo
KSwKCXQudmFsdWUoKS5jX3N0cigpLAoJdC5rZXkoKS5jX3N0cigpLAoJdC5zaWcoKS5jX3N0
cigpKTsKICBJKHJlcy5zaXplKCkgPT0gMCB8fCByZXMuc2l6ZSgpID09IDEpOwogIHJldHVy
biByZXMuc2l6ZSgpID09IDE7Cn0KCnZvaWQgCmRhdGFiYXNlOjpwdXRfY2VydChjZXJ0IGNv
bnN0ICYgdCwKCQkgICBzdHJpbmcgY29uc3QgJiB0YWJsZSkKewogIGhleGVuYzxpZD4gdGhh
c2g7CiAgY2VydF9oYXNoX2NvZGUodCwgdGhhc2gpOwogIGV4ZWN1dGUoIklOU0VSVCBJTlRP
ICclcScgVkFMVUVTKCclcScsICclcScsICclcScsICclcScsICclcScsICclcScpIiwgCgkg
IHRhYmxlLmNfc3RyKCksCgkgIHRoYXNoKCkuY19zdHIoKSwKCSAgdC5pZGVudCgpLmNfc3Ry
KCksCgkgIHQubmFtZSgpLmNfc3RyKCksIAoJICB0LnZhbHVlKCkuY19zdHIoKSwKCSAgdC5r
ZXkoKS5jX3N0cigpLAoJICB0LnNpZygpLmNfc3RyKCkpOwp9Cgp2b2lkIApkYXRhYmFzZTo6
cmVzdWx0c190b19jZXJ0cyhyZXN1bHRzIGNvbnN0ICYgcmVzLAoJCQkgICB2ZWN0b3I8Y2Vy
dD4gJiBjZXJ0cykKewogIGNlcnRzLmNsZWFyKCk7CiAgZm9yIChzaXplX3QgaSA9IDA7IGkg
PCByZXMuc2l6ZSgpOyArK2kpCiAgICB7CiAgICAgIGNlcnQgdDsKICAgICAgdCA9IGNlcnQo
aGV4ZW5jPGlkPihyZXNbaV1bMF0pLCAKCSAgICAgIGNlcnRfbmFtZShyZXNbaV1bMV0pLAoJ
ICAgICAgYmFzZTY0PGNlcnRfdmFsdWU+KHJlc1tpXVsyXSksCgkgICAgICByc2Ffa2V5cGFp
cl9pZChyZXNbaV1bM10pLAoJICAgICAgYmFzZTY0PHJzYV9zaGExX3NpZ25hdHVyZT4ocmVz
W2ldWzRdKSk7CiAgICAgIGNlcnRzLnB1c2hfYmFjayh0KTsKICAgIH0KfQoKCnN0cnVjdCB2
YWxpZF9jZXJ0cwp7CiAgc2V0PHJzYV9rZXlwYWlyX2lkPiB2YWxpZF9zaWduZXJzOwogIGhl
eGVuYzxpZD4gaWRlbnQ7CiAgY2VydF9uYW1lIG5hbWU7CiAgYmFzZTY0PGNlcnRfdmFsdWU+
IHZhbDsKICBzdHJpbmcgc2lnbmF0dXJlX3R5cGU7CgogIHZhbGlkX2NlcnRzKHN0cmluZyBj
b25zdCAmIHR5KSAKICAgIDogc2lnbmF0dXJlX3R5cGUodHkpIAogIHsKICAgIEwoRigiY29u
c3RydWN0aW5nIHZhbGlkaXR5IGNoZWNrZXIgZm9yICVzIGNlcnRzXG4iKSAlIHR5KTsKICB9
CgogIGJvb2wgY2hlY2tfc2lnbmVyX3RydXN0KGFwcF9zdGF0ZSAmIGFwcCkKICB7CiAgICBi
b29sIHRydXN0ZWQgPSBmYWxzZTsKCiAgICBMKEYoImNoZWNraW5nICVkIHNpZ25lciAlcyBj
ZXJ0IHRydXN0IHNldFxuIikgCiAgICAgICUgdmFsaWRfc2lnbmVycy5zaXplKCkgJSBzaWdu
YXR1cmVfdHlwZSk7CiAgICB0cnkKICAgICAgewoJY2VydF92YWx1ZSB2OwoJZGVjb2RlX2Jh
c2U2NCh2YWwsIHYpOwoJLy8gRklYTUU6IGxhbWUgc3RyaW5nLW1ha2VzLXRoZS1tb2RlIGFy
Z3VtZW50CglpZiAoc2lnbmF0dXJlX3R5cGUgPT0gInJldmlzaW9uIikKCSAgdHJ1c3RlZCA9
IGFwcC5sdWEuaG9va19nZXRfcmV2aXNpb25fY2VydF90cnVzdCh2YWxpZF9zaWduZXJzLAoJ
CQkJCQkJaWRlbnQsIG5hbWUsIHYpOwoJZWxzZSBpZiAoc2lnbmF0dXJlX3R5cGUgPT0gIm1h
bmlmZXN0IikKCSAgdHJ1c3RlZCA9IGFwcC5sdWEuaG9va19nZXRfbWFuaWZlc3RfY2VydF90
cnVzdCh2YWxpZF9zaWduZXJzLAoJCQkJCQkJIGlkZW50LCBuYW1lLCB2KTsKCWVsc2UgaWYg
KHNpZ25hdHVyZV90eXBlID09ICJmaWxlIikKCSAgdHJ1c3RlZCA9IGFwcC5sdWEuaG9va19n
ZXRfZmlsZV9jZXJ0X3RydXN0KHZhbGlkX3NpZ25lcnMsCgkJCQkJCSAgICAgaWRlbnQsIG5h
bWUsIHYpOwoJZWxzZQoJICBJKGZhbHNlKTsgLy8gc2hvdWxkIGJlIGlsbGVnYWwKICAgICAg
fQogICAgY2F0Y2ggKC4uLikKICAgICAgewoJVyhGKCJleGNlcHRpb24gaW4gc3FsaXRlIHZh
bGlkX2NlcnRzOjpjaGVja19zZXRfdHJ1c3RcbiIpKTsKICAgICAgfQogICAgCiAgICBpZiAo
dHJ1c3RlZCkKICAgICAgTChGKCJ0cnVzdCBmdW5jdGlvbiBsaWtlZCAlZCAlcyBzaWduZXJz
XG4iKSAKCSUgdmFsaWRfc2lnbmVycy5zaXplKCkgJSBzaWduYXR1cmVfdHlwZSk7CiAgICBl
bHNlCiAgICAgIEwoRigidHJ1c3QgZnVuY3Rpb24gZGlzbGlrZWQgJWQgJXMgc2lnbmVyc1xu
IikgCgklIHZhbGlkX3NpZ25lcnMuc2l6ZSgpICUgc2lnbmF0dXJlX3R5cGUpOwogICAgCiAg
ICByZXR1cm4gdHJ1c3RlZDsKICB9CgogIHZvaWQgY2hlY2tfc2luZ2xlX3NpZ25lcihhcHBf
c3RhdGUgJiBhcHAsCgkJCSAgIGludCBhcmdjLCAKCQkJICAgY2hhciBjb25zdCAqKiBhcmd2
KQogIHsKICAgIHRyeQogICAgICB7CgkvLyBhcmdzIGFyZTogaGFzaCwgaWQsIG5hbWUsIHZh
bHVlLCBrZXlwYWlyLCBwdWJrZXksIHNpZ25hdHVyZQoJLy8gTChGKCJlbnRyaWVzIGFyZSBb
JXNdIFslc10gWyVzXSBbJXNdIFslc10gWyVzXSBbJXNdXG4iKSAKCS8vIAkgICUgYXJndlsw
XSAlIGFyZ3ZbMV0gJSBhcmd2WzJdICUgYXJndlszXSAlIGFyZ3ZbNF0gJSBhcmd2WzVdICUg
YXJndls2XSk7CgoJY2VydCB0bXAgPSBjZXJ0KGhleGVuYzxpZD4oYXJndlsxXSksIAoJCQlj
ZXJ0X25hbWUoYXJndlsyXSksCgkJCWJhc2U2NDxjZXJ0X3ZhbHVlPihhcmd2WzNdKSwKCQkJ
cnNhX2tleXBhaXJfaWQoYXJndls0XSksCgkJCWJhc2U2NDxyc2Ffc2hhMV9zaWduYXR1cmU+
KGFyZ3ZbNl0pKTsKCgliYXNlNjQ8cnNhX3B1Yl9rZXk+IHBrKGFyZ3ZbNV0pOwoKCWlmIChp
ZGVudCgpLmVtcHR5KCkpCgkgIGlkZW50ID0gdG1wLmlkZW50OwoJZWxzZQoJICBJKGlkZW50
ID09IHRtcC5pZGVudCk7CgoJaWYgKG5hbWUoKS5lbXB0eSgpKQoJICBuYW1lID0gdG1wLm5h
bWU7CgllbHNlCgkgIEkobmFtZSA9PSB0bXAubmFtZSk7CgoJaWYgKHZhbCgpLmVtcHR5KCkp
CgkgIHZhbCA9IHRtcC52YWx1ZTsKCWVsc2UKCSAgSSh2YWwgPT0gdG1wLnZhbHVlKTsKCgkv
LyAJTChGKCJleGFtaW5pbmcgJyVzJyAlcyBjZXJ0IGZyb20gJXNcbiIpIAoJLy8gCSAgJSBu
YW1lICUgc2lnbmF0dXJlX3R5cGUgJSBpZGVudCk7CgoJc3RyaW5nIHR4dDsKCWNlcnRfc2ln
bmFibGVfdGV4dCh0bXAsIHR4dCk7CglpZiAoY2hlY2tfc2lnbmF0dXJlKGFwcC5sdWEsIHRt
cC5rZXksIHBrLCB0eHQsIHRtcC5zaWcpKQoJICB7CgkgICAgTChGKCJvayAnJXMnICVzIGNl
cnQgZnJvbSAlc1xuIikgCgkgICAgICAlIG5hbWUgJSBzaWduYXR1cmVfdHlwZSAlIHRtcC5r
ZXkpOwoJICAgIHZhbGlkX3NpZ25lcnMuaW5zZXJ0KHRtcC5rZXkpOwoJICB9CgllbHNlCgkg
IHsKCSAgICBXKEYoImJhZCAnJXMnICVzIGNlcnQgZnJvbSAlc1xuIikgCgkgICAgICAlIG5h
bWUgJSBzaWduYXR1cmVfdHlwZSAlIHRtcC5rZXkpOwoJICB9CiAgICAgIH0KICAgIGNhdGNo
IChzdGQ6OmV4Y2VwdGlvbiAmIGUpCiAgICAgIHsKCVcoRigic3RkOjpleGNlcHRpb24gaW4g
c3FsaXRlIHZhbGlkX2NlcnRzOjpjaGVja19zaW5nbGVfc2lnbmVyOiAlc1xuIikgJSBlLndo
YXQoKSk7CiAgICAgIH0KICAgIGNhdGNoICguLi4pCiAgICAgIHsKCVcoRigidW5rbm93biBl
eGNlcHRpb24gaW4gc3FsaXRlIHZhbGlkX2NlcnRzOjpjaGVja19zaW5nbGVfc2lnbmVyXG4i
KSk7CiAgICAgIH0KICB9Cn07CgpleHRlcm4gIkMiCnsKCnN0YXRpYyB2b2lkCnRydXN0ZWRf
c3RlcF9jYWxsYmFjayhzcWxpdGVfZnVuYyAqIGZuX2N0eCwgCgkJICAgICAgaW50IGFyZ2Ms
IAoJCSAgICAgIGNoYXIgY29uc3QgKiogYXJndikKewogIGFwcF9zdGF0ZSAqIGFwcCA9IE5V
TEw7IAogIHZhbGlkX2NlcnRzICoqIHZwcDsKCiAgSShmbl9jdHgpOwogIEkoYXJnYyA9PSA4
KTsKICBJKGFyZ3YpOwogIGZvciAoc2l6ZV90IGkgPSAwOyBpIDwgODsgKytpKQogICAgSShh
cmd2W2ldKTsKCiAgYXBwID0gc3RhdGljX2Nhc3Q8YXBwX3N0YXRlICo+KHNxbGl0ZV91c2Vy
X2RhdGEoZm5fY3R4KSk7CiAgSShhcHApOwogIHZwcCA9IHN0YXRpY19jYXN0PHZhbGlkX2Nl
cnRzICoqPihzcWxpdGVfYWdncmVnYXRlX2NvbnRleHQoZm5fY3R4LCBzaXplb2YodmFsaWRf
Y2VydHMgKikpKTsKICBJKHZwcCk7CiAgaWYgKCEgKCp2cHApKQogICAgKnZwcCA9IG5ldyB2
YWxpZF9jZXJ0cyhzdHJpbmcoYXJndlswXSkpOwogIEkoKnZwcCk7CiAgKCp2cHApLT5jaGVj
a19zaW5nbGVfc2lnbmVyKCphcHAsIGFyZ2MtMSwgYXJndisxKTsgIAp9CgpzdGF0aWMgdm9p
ZAp0cnVzdGVkX2ZpbmFsaXplX2NhbGxiYWNrKHNxbGl0ZV9mdW5jICogZm5fY3R4KQp7CiAg
YXBwX3N0YXRlICogYXBwID0gTlVMTDsgCiAgdmFsaWRfY2VydHMgKiogdnBwOwogIGFwcCA9
IHN0YXRpY19jYXN0PGFwcF9zdGF0ZSAqPihzcWxpdGVfdXNlcl9kYXRhKGZuX2N0eCkpOwog
IEkoYXBwKTsKICB2cHAgPSBzdGF0aWNfY2FzdDx2YWxpZF9jZXJ0cyAqKj4oc3FsaXRlX2Fn
Z3JlZ2F0ZV9jb250ZXh0KGZuX2N0eCwgc2l6ZW9mKHZhbGlkX2NlcnRzICopKSk7CgogIEko
dnBwKTsKICBJKCp2cHApOwoKICBpZiAoKCp2cHApLT5jaGVja19zaWduZXJfdHJ1c3QoKmFw
cCkpCiAgICBzcWxpdGVfc2V0X3Jlc3VsdF9pbnQoZm5fY3R4LCAxKTsKICBlbHNlCiAgICBz
cWxpdGVfc2V0X3Jlc3VsdF9pbnQoZm5fY3R4LCAwKTsKCiAgZGVsZXRlICgqdnBwKTsKfQp9
CgoKdm9pZApkYXRhYmFzZTo6aW5zdGFsbF9mdW5jdGlvbnMoYXBwX3N0YXRlICogYXBwKQp7
CiAgLy8gcmVnaXN0ZXIgYW55IGZ1bmN0aW9ucyB3ZSdyZSBnb2luZyB0byB1c2UKICBJKHNx
bGl0ZV9jcmVhdGVfZnVuY3Rpb24oc3FsKCksICJ1bmJhc2U2NCIsIC0xLCAKCQkJICAgJnNx
bGl0ZV91bmJhc2U2NF9mbiwgCgkJCSAgIE5VTEwpID09IDApOwoKICBJKHNxbGl0ZV9jcmVh
dGVfYWdncmVnYXRlKHNxbCgpLCAidHJ1c3RlZCIsIDgsIAoJCQkgICAgJnRydXN0ZWRfc3Rl
cF9jYWxsYmFjaywKCQkJICAgICZ0cnVzdGVkX2ZpbmFsaXplX2NhbGxiYWNrLAoJCQkgICAg
YXBwKSA9PSAwKTsKfQoKdm9pZApkYXRhYmFzZTo6aW5zdGFsbF92aWV3cygpCnsKICAvLyBk
ZWxldGUgYW55IGV4aXN0aW5nIHZpZXdzCiAgcmVzdWx0cyByZXM7CiAgZmV0Y2gocmVzLCBv
bmVfY29sLCBhbnlfcm93cywKCSJTRUxFQ1QgbmFtZSBGUk9NIHNxbGl0ZV9tYXN0ZXIgV0hF
UkUgdHlwZT0ndmlldyciKTsKICBmb3IgKHNpemVfdCBpID0gMDsgaSA8IHJlcy5zaXplKCk7
ICsraSkKICAgIHsKICAgICAgZXhlY3V0ZSgiRFJPUCBWSUVXICclcSciLCByZXNbaV1bMF0u
Y19zdHIoKSk7CiAgICB9CiAgLy8gcmVnaXN0ZXIgYW55IHZpZXdzIHdlJ3JlIGdvaW5nIHRv
IHVzZQogIGV4ZWN1dGUodmlld3NfY29uc3RhbnQpOwp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0
X2hlYWRzKGJhc2U2NDxjZXJ0X3ZhbHVlPiBjb25zdCAmIGJyYW5jaCwKCQkgICAgc3RkOjpz
ZXQ8cmV2aXNpb25faWQ+ICYgaGVhZHMpCnsKICByZXN1bHRzIHJlczsKICBmZXRjaChyZXMs
IG9uZV9jb2wsIGFueV9yb3dzLAoJIlNFTEVDVCBpZCAiCgkiRlJPTSBicmFuY2hfaGVhZHMg
IgoJIldIRVJFIHZhbHVlID0gJyVxJyIsCglicmFuY2goKS5jX3N0cigpKTsKICBoZWFkcy5j
bGVhcigpOwogIGZvciAoc2l6ZV90IGkgPSAwOyBpIDwgcmVzLnNpemUoKTsgKytpKQogICAg
ewogICAgICBoZWFkcy5pbnNlcnQocmV2aXNpb25faWQocmVzW2ldWzBdKSk7CiAgICB9Cn0K
CnZvaWQgCmRhdGFiYXNlOjpnZXRfY2VydHMoaGV4ZW5jPGlkPiBjb25zdCAmIGlkZW50LCAK
CQkgICAgdmVjdG9yPGNlcnQ+ICYgY2VydHMsCQkJCgkJICAgIHN0cmluZyBjb25zdCAmIHRh
YmxlKQp7CiAgcmVzdWx0cyByZXM7CiAgZmV0Y2gocmVzLCA1LCBhbnlfcm93cywgCgkiU0VM
RUNUIGlkLCBuYW1lLCB2YWx1ZSwga2V5cGFpciwgc2lnbmF0dXJlIEZST00gJyVxJyAiCgki
V0hFUkUgaWQgPSAnJXEnIiwgCgl0YWJsZS5jX3N0cigpLCAJCglpZGVudCgpLmNfc3RyKCkp
OwogIHJlc3VsdHNfdG9fY2VydHMocmVzLCBjZXJ0cyk7Cn0KCgp2b2lkIApkYXRhYmFzZTo6
Z2V0X2NlcnRzKGNlcnRfbmFtZSBjb25zdCAmIG5hbWUsIAkgICAgICAKCQkgICAgdmVjdG9y
PGNlcnQ+ICYgY2VydHMsCgkJICAgIHN0cmluZyBjb25zdCAmIHRhYmxlKQp7CiAgcmVzdWx0
cyByZXM7CiAgZmV0Y2gocmVzLCA1LCBhbnlfcm93cywgCgkiU0VMRUNUIGlkLCBuYW1lLCB2
YWx1ZSwga2V5cGFpciwgc2lnbmF0dXJlICIKCSJGUk9NICclcScgV0hFUkUgbmFtZSA9ICcl
cSciLCAKCXRhYmxlLmNfc3RyKCksIAkKCW5hbWUoKS5jX3N0cigpKTsKICByZXN1bHRzX3Rv
X2NlcnRzKHJlcywgY2VydHMpOwp9CgoKdm9pZCAKZGF0YWJhc2U6OmdldF9jZXJ0cyhoZXhl
bmM8aWQ+IGNvbnN0ICYgaWRlbnQsIAoJCSAgICBjZXJ0X25hbWUgY29uc3QgJiBuYW1lLCAJ
ICAgICAgCgkJICAgIHZlY3RvcjxjZXJ0PiAmIGNlcnRzLAoJCSAgICBzdHJpbmcgY29uc3Qg
JiB0YWJsZSkKewogIHJlc3VsdHMgcmVzOwogIGZldGNoKHJlcywgNSwgYW55X3Jvd3MsIAoJ
IlNFTEVDVCBpZCwgbmFtZSwgdmFsdWUsIGtleXBhaXIsIHNpZ25hdHVyZSAiCgkiRlJPTSAn
JXEnICIKCSJXSEVSRSBpZCA9ICclcScgQU5EIG5hbWUgPSAnJXEnIiwgCgl0YWJsZS5jX3N0
cigpLCAJCglpZGVudCgpLmNfc3RyKCksCgluYW1lKCkuY19zdHIoKSk7CiAgcmVzdWx0c190
b19jZXJ0cyhyZXMsIGNlcnRzKTsKfQoKdm9pZCAKZGF0YWJhc2U6OmdldF9jZXJ0cyhjZXJ0
X25hbWUgY29uc3QgJiBuYW1lLAoJCSAgICBiYXNlNjQ8Y2VydF92YWx1ZT4gY29uc3QgJiB2
YWwsIAoJCSAgICB2ZWN0b3I8Y2VydD4gJiBjZXJ0cywKCQkgICAgc3RyaW5nIGNvbnN0ICYg
dGFibGUpCnsKICByZXN1bHRzIHJlczsKICBmZXRjaChyZXMsIDUsIGFueV9yb3dzLCAKCSJT
RUxFQ1QgaWQsIG5hbWUsIHZhbHVlLCBrZXlwYWlyLCBzaWduYXR1cmUgIgoJIkZST00gJyVx
JyAiCgkiV0hFUkUgbmFtZSA9ICclcScgQU5EIHZhbHVlID0gJyVxJyIsIAoJdGFibGUuY19z
dHIoKSwgCQoJbmFtZSgpLmNfc3RyKCksCgl2YWwoKS5jX3N0cigpKTsKICByZXN1bHRzX3Rv
X2NlcnRzKHJlcywgY2VydHMpOwp9CgoKdm9pZCAKZGF0YWJhc2U6OmdldF9jZXJ0cyhoZXhl
bmM8aWQ+IGNvbnN0ICYgaWRlbnQsIAoJCSAgICBjZXJ0X25hbWUgY29uc3QgJiBuYW1lLCAJ
ICAgICAgCgkJICAgIGJhc2U2NDxjZXJ0X3ZhbHVlPiBjb25zdCAmIHZhbHVlLAoJCSAgICB2
ZWN0b3I8Y2VydD4gJiBjZXJ0cywKCQkgICAgc3RyaW5nIGNvbnN0ICYgdGFibGUpCnsKICBy
ZXN1bHRzIHJlczsKICBmZXRjaChyZXMsIDUsIGFueV9yb3dzLCAKCSJTRUxFQ1QgaWQsIG5h
bWUsIHZhbHVlLCBrZXlwYWlyLCBzaWduYXR1cmUgIgoJIkZST00gJyVxJyAiCgkiV0hFUkUg
aWQgPSAnJXEnIEFORCBuYW1lID0gJyVxJyBBTkQgdmFsdWUgPSAnJXEnIiwgCgl0YWJsZS5j
X3N0cigpLCAJCglpZGVudCgpLmNfc3RyKCksCgluYW1lKCkuY19zdHIoKSwKCXZhbHVlKCku
Y19zdHIoKSk7CiAgcmVzdWx0c190b19jZXJ0cyhyZXMsIGNlcnRzKTsKfQoKCgpib29sIApk
YXRhYmFzZTo6cmV2aXNpb25fY2VydF9leGlzdHMocmV2aXNpb248Y2VydD4gY29uc3QgJiBj
ZXJ0KQp7IAogIHJldHVybiBjZXJ0X2V4aXN0cyhjZXJ0LmlubmVyKCksICJyZXZpc2lvbl9j
ZXJ0cyIpOyAKfQoKYm9vbCAKZGF0YWJhc2U6Om1hbmlmZXN0X2NlcnRfZXhpc3RzKG1hbmlm
ZXN0PGNlcnQ+IGNvbnN0ICYgY2VydCkKeyAKICByZXR1cm4gY2VydF9leGlzdHMoY2VydC5p
bm5lcigpLCAibWFuaWZlc3RfY2VydHMiKTsgCn0KCmJvb2wgCmRhdGFiYXNlOjpmaWxlX2Nl
cnRfZXhpc3RzKGZpbGU8Y2VydD4gY29uc3QgJiBjZXJ0KQp7IAogIHJldHVybiBjZXJ0X2V4
aXN0cyhjZXJ0LmlubmVyKCksICJmaWxlX2NlcnRzIik7IAp9Cgp2b2lkIApkYXRhYmFzZTo6
cHV0X21hbmlmZXN0X2NlcnQobWFuaWZlc3Q8Y2VydD4gY29uc3QgJiBjZXJ0KQp7IAogIHB1
dF9jZXJ0KGNlcnQuaW5uZXIoKSwgIm1hbmlmZXN0X2NlcnRzIik7IAp9Cgp2b2lkIApkYXRh
YmFzZTo6cHV0X3JldmlzaW9uX2NlcnQocmV2aXNpb248Y2VydD4gY29uc3QgJiBjZXJ0KQp7
IAogIHB1dF9jZXJ0KGNlcnQuaW5uZXIoKSwgInJldmlzaW9uX2NlcnRzIik7IAp9Cgp2b2lk
IApkYXRhYmFzZTo6cHV0X2ZpbGVfY2VydChmaWxlPGNlcnQ+IGNvbnN0ICYgY2VydCkKeyAK
ICBwdXRfY2VydChjZXJ0LmlubmVyKCksICJmaWxlX2NlcnRzIik7IAp9Cgp2b2lkIApkYXRh
YmFzZTo6Z2V0X2ZpbGVfY2VydHMoY2VydF9uYW1lIGNvbnN0ICYgbmFtZSwgCgkJCSB2ZWN0
b3I8IGZpbGU8Y2VydD4gPiAmIHRzKQp7CiAgdmVjdG9yPGNlcnQ+IGNlcnRzOwogIGdldF9j
ZXJ0cyhuYW1lLCBjZXJ0cywgImZpbGVfY2VydHMiKTsKICB0cy5jbGVhcigpOwogIGNvcHko
Y2VydHMuYmVnaW4oKSwgY2VydHMuZW5kKCksIGJhY2tfaW5zZXJ0ZXIodHMpKTsgIAp9Cgp2
b2lkIApkYXRhYmFzZTo6Z2V0X2ZpbGVfY2VydHMoZmlsZV9pZCBjb25zdCAmIGlkLCAKCQkJ
IGNlcnRfbmFtZSBjb25zdCAmIG5hbWUsIAoJCQkgdmVjdG9yPCBmaWxlPGNlcnQ+ID4gJiB0
cykKewogIHZlY3RvcjxjZXJ0PiBjZXJ0czsKICBnZXRfY2VydHMoaWQuaW5uZXIoKSwgbmFt
ZSwgY2VydHMsICJmaWxlX2NlcnRzIik7CiAgdHMuY2xlYXIoKTsKICBjb3B5KGNlcnRzLmJl
Z2luKCksIGNlcnRzLmVuZCgpLCBiYWNrX2luc2VydGVyKHRzKSk7ICAgIAp9Cgp2b2lkIApk
YXRhYmFzZTo6Z2V0X2ZpbGVfY2VydHMoY2VydF9uYW1lIGNvbnN0ICYgbmFtZSwKCQkJIGJh
c2U2NDxjZXJ0X3ZhbHVlPiBjb25zdCAmIHZhbCwgCgkJCSB2ZWN0b3I8IGZpbGU8Y2VydD4g
PiAmIHRzKQp7CiAgdmVjdG9yPGNlcnQ+IGNlcnRzOwogIGdldF9jZXJ0cyhuYW1lLCB2YWws
IGNlcnRzLCAiZmlsZV9jZXJ0cyIpOwogIHRzLmNsZWFyKCk7CiAgY29weShjZXJ0cy5iZWdp
bigpLCBjZXJ0cy5lbmQoKSwgYmFja19pbnNlcnRlcih0cykpOyAgCn0KCnZvaWQgCmRhdGFi
YXNlOjpnZXRfZmlsZV9jZXJ0cyhmaWxlX2lkIGNvbnN0ICYgaWQsIAoJCQkgY2VydF9uYW1l
IGNvbnN0ICYgbmFtZSwKCQkJIGJhc2U2NDxjZXJ0X3ZhbHVlPiBjb25zdCAmIHZhbCwgCgkJ
CSB2ZWN0b3I8IGZpbGU8Y2VydD4gPiAmIHRzKQp7CiAgdmVjdG9yPGNlcnQ+IGNlcnRzOwog
IGdldF9jZXJ0cyhpZC5pbm5lcigpLCBuYW1lLCB2YWwsIGNlcnRzLCAiZmlsZV9jZXJ0cyIp
OwogIHRzLmNsZWFyKCk7CiAgY29weShjZXJ0cy5iZWdpbigpLCBjZXJ0cy5lbmQoKSwgYmFj
a19pbnNlcnRlcih0cykpOyAgCn0KCnZvaWQgCmRhdGFiYXNlOjpnZXRfZmlsZV9jZXJ0cyhm
aWxlX2lkIGNvbnN0ICYgaWQsIAoJCQkgdmVjdG9yPCBmaWxlPGNlcnQ+ID4gJiB0cykKeyAK
ICB2ZWN0b3I8Y2VydD4gY2VydHM7CiAgZ2V0X2NlcnRzKGlkLmlubmVyKCksIGNlcnRzLCAi
ZmlsZV9jZXJ0cyIpOyAKICB0cy5jbGVhcigpOwogIGNvcHkoY2VydHMuYmVnaW4oKSwgY2Vy
dHMuZW5kKCksIGJhY2tfaW5zZXJ0ZXIodHMpKTsKfQoKCmJvb2wgCmRhdGFiYXNlOjpmaWxl
X2NlcnRfZXhpc3RzKGhleGVuYzxpZD4gY29uc3QgJiBoYXNoKQp7CiAgcmVzdWx0cyByZXM7
CiAgdmVjdG9yPGNlcnQ+IGNlcnRzOwogIGZldGNoKHJlcywgb25lX2NvbCwgYW55X3Jvd3Ms
IAoJIlNFTEVDVCBpZCAiCgkiRlJPTSBmaWxlX2NlcnRzICIKCSJXSEVSRSBoYXNoID0gJyVx
JyIsIAoJaGFzaCgpLmNfc3RyKCkpOwogIEkocmVzLnNpemUoKSA9PSAwIHx8IHJlcy5zaXpl
KCkgPT0gMSk7CiAgcmV0dXJuIChyZXMuc2l6ZSgpID09IDEpOwp9Cgp2b2lkIApkYXRhYmFz
ZTo6Z2V0X2ZpbGVfY2VydChoZXhlbmM8aWQ+IGNvbnN0ICYgaGFzaCwKCQkJZmlsZTxjZXJ0
PiAmIGMpCnsKICByZXN1bHRzIHJlczsKICB2ZWN0b3I8Y2VydD4gY2VydHM7CiAgZmV0Y2go
cmVzLCA1LCBvbmVfcm93LCAKCSJTRUxFQ1QgaWQsIG5hbWUsIHZhbHVlLCBrZXlwYWlyLCBz
aWduYXR1cmUgIgoJIkZST00gZmlsZV9jZXJ0cyAiCgkiV0hFUkUgaGFzaCA9ICclcSciLCAK
CWhhc2goKS5jX3N0cigpKTsKICByZXN1bHRzX3RvX2NlcnRzKHJlcywgY2VydHMpOwogIEko
Y2VydHMuc2l6ZSgpID09IDEpOwogIGMgPSBmaWxlPGNlcnQ+KGNlcnRzWzBdKTsKfQoKCgp2
b2lkIApkYXRhYmFzZTo6Z2V0X3JldmlzaW9uX2NlcnRzKGNlcnRfbmFtZSBjb25zdCAmIG5h
bWUsIAoJCQkgICAgdmVjdG9yPCByZXZpc2lvbjxjZXJ0PiA+ICYgdHMpCnsKICB2ZWN0b3I8
Y2VydD4gY2VydHM7CiAgZ2V0X2NlcnRzKG5hbWUsIGNlcnRzLCAicmV2aXNpb25fY2VydHMi
KTsKICB0cy5jbGVhcigpOwogIGNvcHkoY2VydHMuYmVnaW4oKSwgY2VydHMuZW5kKCksIGJh
Y2tfaW5zZXJ0ZXIodHMpKTsgIAp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X3JldmlzaW9uX2Nl
cnRzKHJldmlzaW9uX2lkIGNvbnN0ICYgaWQsIAoJCQkgICAgY2VydF9uYW1lIGNvbnN0ICYg
bmFtZSwgCgkJCSAgICB2ZWN0b3I8IHJldmlzaW9uPGNlcnQ+ID4gJiB0cykKewogIHZlY3Rv
cjxjZXJ0PiBjZXJ0czsKICBnZXRfY2VydHMoaWQuaW5uZXIoKSwgbmFtZSwgY2VydHMsICJy
ZXZpc2lvbl9jZXJ0cyIpOwogIHRzLmNsZWFyKCk7CiAgY29weShjZXJ0cy5iZWdpbigpLCBj
ZXJ0cy5lbmQoKSwgYmFja19pbnNlcnRlcih0cykpOyAgCn0KCnZvaWQgCmRhdGFiYXNlOjpn
ZXRfcmV2aXNpb25fY2VydHMocmV2aXNpb25faWQgY29uc3QgJiBpZCwgCgkJCSAgICBjZXJ0
X25hbWUgY29uc3QgJiBuYW1lLAoJCQkgICAgYmFzZTY0PGNlcnRfdmFsdWU+IGNvbnN0ICYg
dmFsLCAKCQkJICAgIHZlY3RvcjwgcmV2aXNpb248Y2VydD4gPiAmIHRzKQp7CiAgdmVjdG9y
PGNlcnQ+IGNlcnRzOwogIGdldF9jZXJ0cyhpZC5pbm5lcigpLCBuYW1lLCB2YWwsIGNlcnRz
LCAicmV2aXNpb25fY2VydHMiKTsKICB0cy5jbGVhcigpOwogIGNvcHkoY2VydHMuYmVnaW4o
KSwgY2VydHMuZW5kKCksIGJhY2tfaW5zZXJ0ZXIodHMpKTsgIAp9Cgp2b2lkIApkYXRhYmFz
ZTo6Z2V0X3JldmlzaW9uX2NlcnRzKGNlcnRfbmFtZSBjb25zdCAmIG5hbWUsCgkJCSAgICBi
YXNlNjQ8Y2VydF92YWx1ZT4gY29uc3QgJiB2YWwsIAoJCQkgICAgdmVjdG9yPCByZXZpc2lv
bjxjZXJ0PiA+ICYgdHMpCnsKICB2ZWN0b3I8Y2VydD4gY2VydHM7CiAgZ2V0X2NlcnRzKG5h
bWUsIHZhbCwgY2VydHMsICJyZXZpc2lvbl9jZXJ0cyIpOwogIHRzLmNsZWFyKCk7CiAgY29w
eShjZXJ0cy5iZWdpbigpLCBjZXJ0cy5lbmQoKSwgYmFja19pbnNlcnRlcih0cykpOyAgCn0K
CnZvaWQgCmRhdGFiYXNlOjpnZXRfcmV2aXNpb25fY2VydHMocmV2aXNpb25faWQgY29uc3Qg
JiBpZCwgCgkJCSAgICB2ZWN0b3I8IHJldmlzaW9uPGNlcnQ+ID4gJiB0cykKeyAKICB2ZWN0
b3I8Y2VydD4gY2VydHM7CiAgZ2V0X2NlcnRzKGlkLmlubmVyKCksIGNlcnRzLCAicmV2aXNp
b25fY2VydHMiKTsgCiAgdHMuY2xlYXIoKTsKICBjb3B5KGNlcnRzLmJlZ2luKCksIGNlcnRz
LmVuZCgpLCBiYWNrX2luc2VydGVyKHRzKSk7Cn0KCnZvaWQgCmRhdGFiYXNlOjpnZXRfcmV2
aXNpb25fY2VydChoZXhlbmM8aWQ+IGNvbnN0ICYgaGFzaCwKCQkJICAgcmV2aXNpb248Y2Vy
dD4gJiBjKQp7CiAgcmVzdWx0cyByZXM7CiAgdmVjdG9yPGNlcnQ+IGNlcnRzOwogIGZldGNo
KHJlcywgNSwgb25lX3JvdywgCgkiU0VMRUNUIGlkLCBuYW1lLCB2YWx1ZSwga2V5cGFpciwg
c2lnbmF0dXJlICIKCSJGUk9NIHJldmlzaW9uX2NlcnRzICIKCSJXSEVSRSBoYXNoID0gJyVx
JyIsIAoJaGFzaCgpLmNfc3RyKCkpOwogIHJlc3VsdHNfdG9fY2VydHMocmVzLCBjZXJ0cyk7
CiAgSShjZXJ0cy5zaXplKCkgPT0gMSk7CiAgYyA9IHJldmlzaW9uPGNlcnQ+KGNlcnRzWzBd
KTsKfQoKYm9vbCAKZGF0YWJhc2U6OnJldmlzaW9uX2NlcnRfZXhpc3RzKGhleGVuYzxpZD4g
Y29uc3QgJiBoYXNoKQp7CiAgcmVzdWx0cyByZXM7CiAgdmVjdG9yPGNlcnQ+IGNlcnRzOwog
IGZldGNoKHJlcywgb25lX2NvbCwgYW55X3Jvd3MsIAoJIlNFTEVDVCBpZCAiCgkiRlJPTSBy
ZXZpc2lvbl9jZXJ0cyAiCgkiV0hFUkUgaGFzaCA9ICclcSciLCAKCWhhc2goKS5jX3N0cigp
KTsKICBJKHJlcy5zaXplKCkgPT0gMCB8fCByZXMuc2l6ZSgpID09IDEpOwogIHJldHVybiAo
cmVzLnNpemUoKSA9PSAxKTsKfQoKYm9vbCAKZGF0YWJhc2U6Om1hbmlmZXN0X2NlcnRfZXhp
c3RzKGhleGVuYzxpZD4gY29uc3QgJiBoYXNoKQp7CiAgcmVzdWx0cyByZXM7CiAgdmVjdG9y
PGNlcnQ+IGNlcnRzOwogIGZldGNoKHJlcywgb25lX2NvbCwgYW55X3Jvd3MsIAoJIlNFTEVD
VCBpZCAiCgkiRlJPTSBtYW5pZmVzdF9jZXJ0cyAiCgkiV0hFUkUgaGFzaCA9ICclcSciLCAK
CWhhc2goKS5jX3N0cigpKTsKICBJKHJlcy5zaXplKCkgPT0gMCB8fCByZXMuc2l6ZSgpID09
IDEpOwogIHJldHVybiAocmVzLnNpemUoKSA9PSAxKTsKfQoKdm9pZCAKZGF0YWJhc2U6Omdl
dF9tYW5pZmVzdF9jZXJ0KGhleGVuYzxpZD4gY29uc3QgJiBoYXNoLAoJCQkgICAgbWFuaWZl
c3Q8Y2VydD4gJiBjKQp7CiAgcmVzdWx0cyByZXM7CiAgdmVjdG9yPGNlcnQ+IGNlcnRzOwog
IGZldGNoKHJlcywgNSwgb25lX3JvdywgCgkiU0VMRUNUIGlkLCBuYW1lLCB2YWx1ZSwga2V5
cGFpciwgc2lnbmF0dXJlICIKCSJGUk9NIG1hbmlmZXN0X2NlcnRzICIKCSJXSEVSRSBoYXNo
ID0gJyVxJyIsIAoJaGFzaCgpLmNfc3RyKCkpOwogIHJlc3VsdHNfdG9fY2VydHMocmVzLCBj
ZXJ0cyk7CiAgSShjZXJ0cy5zaXplKCkgPT0gMSk7CiAgYyA9IG1hbmlmZXN0PGNlcnQ+KGNl
cnRzWzBdKTsKfQoKdm9pZCAKZGF0YWJhc2U6OmdldF9tYW5pZmVzdF9jZXJ0cyhtYW5pZmVz
dF9pZCBjb25zdCAmIGlkLCAKCQkJICAgICB2ZWN0b3I8IG1hbmlmZXN0PGNlcnQ+ID4gJiB0
cykKeyAKICB2ZWN0b3I8Y2VydD4gY2VydHM7CiAgZ2V0X2NlcnRzKGlkLmlubmVyKCksIGNl
cnRzLCAibWFuaWZlc3RfY2VydHMiKTsgCiAgdHMuY2xlYXIoKTsKICBjb3B5KGNlcnRzLmJl
Z2luKCksIGNlcnRzLmVuZCgpLCBiYWNrX2luc2VydGVyKHRzKSk7Cn0KCgp2b2lkIApkYXRh
YmFzZTo6Z2V0X21hbmlmZXN0X2NlcnRzKGNlcnRfbmFtZSBjb25zdCAmIG5hbWUsIAoJCQkg
ICAgdmVjdG9yPCBtYW5pZmVzdDxjZXJ0PiA+ICYgdHMpCnsKICB2ZWN0b3I8Y2VydD4gY2Vy
dHM7CiAgZ2V0X2NlcnRzKG5hbWUsIGNlcnRzLCAibWFuaWZlc3RfY2VydHMiKTsKICB0cy5j
bGVhcigpOwogIGNvcHkoY2VydHMuYmVnaW4oKSwgY2VydHMuZW5kKCksIGJhY2tfaW5zZXJ0
ZXIodHMpKTsgIAp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X21hbmlmZXN0X2NlcnRzKG1hbmlm
ZXN0X2lkIGNvbnN0ICYgaWQsIAoJCQkgICAgIGNlcnRfbmFtZSBjb25zdCAmIG5hbWUsIAoJ
CQkgICAgIHZlY3RvcjwgbWFuaWZlc3Q8Y2VydD4gPiAmIHRzKQp7CiAgdmVjdG9yPGNlcnQ+
IGNlcnRzOwogIGdldF9jZXJ0cyhpZC5pbm5lcigpLCBuYW1lLCBjZXJ0cywgIm1hbmlmZXN0
X2NlcnRzIik7CiAgdHMuY2xlYXIoKTsKICBjb3B5KGNlcnRzLmJlZ2luKCksIGNlcnRzLmVu
ZCgpLCBiYWNrX2luc2VydGVyKHRzKSk7ICAKfQoKCi8vIGNvbXBsZXRpb25zCnZvaWQgCmRh
dGFiYXNlOjpjb21wbGV0ZShzdHJpbmcgY29uc3QgJiBwYXJ0aWFsLAoJCSAgIHNldDxyZXZp
c2lvbl9pZD4gJiBjb21wbGV0aW9ucykKewogIHJlc3VsdHMgcmVzOwogIGNvbXBsZXRpb25z
LmNsZWFyKCk7CgogIGZldGNoKHJlcywgMSwgYW55X3Jvd3MsCgkiU0VMRUNUIGlkIEZST00g
cmV2aXNpb25zIFdIRVJFIGlkIEdMT0IgJyVxKiciLAoJcGFydGlhbC5jX3N0cigpKTsKCiAg
Zm9yIChzaXplX3QgaSA9IDA7IGkgPCByZXMuc2l6ZSgpOyArK2kpCiAgICBjb21wbGV0aW9u
cy5pbnNlcnQocmV2aXNpb25faWQocmVzW2ldWzBdKSk7ICAKfQoKCnZvaWQgCmRhdGFiYXNl
Ojpjb21wbGV0ZShzdHJpbmcgY29uc3QgJiBwYXJ0aWFsLAoJCSAgIHNldDxtYW5pZmVzdF9p
ZD4gJiBjb21wbGV0aW9ucykKewogIHJlc3VsdHMgcmVzOwogIGNvbXBsZXRpb25zLmNsZWFy
KCk7CgogIGZldGNoKHJlcywgMSwgYW55X3Jvd3MsCgkiU0VMRUNUIGlkIEZST00gbWFuaWZl
c3RzIFdIRVJFIGlkIEdMT0IgJyVxKiciLAoJcGFydGlhbC5jX3N0cigpKTsKCiAgZm9yIChz
aXplX3QgaSA9IDA7IGkgPCByZXMuc2l6ZSgpOyArK2kpCiAgICBjb21wbGV0aW9ucy5pbnNl
cnQobWFuaWZlc3RfaWQocmVzW2ldWzBdKSk7ICAKICAKICByZXMuY2xlYXIoKTsKCiAgZmV0
Y2gocmVzLCAxLCBhbnlfcm93cywKCSJTRUxFQ1QgaWQgRlJPTSBtYW5pZmVzdF9kZWx0YXMg
V0hFUkUgaWQgR0xPQiAnJXEqJyIsCglwYXJ0aWFsLmNfc3RyKCkpOwoKICBmb3IgKHNpemVf
dCBpID0gMDsgaSA8IHJlcy5zaXplKCk7ICsraSkKICAgIGNvbXBsZXRpb25zLmluc2VydCht
YW5pZmVzdF9pZChyZXNbaV1bMF0pKTsgIAp9Cgp2b2lkIApkYXRhYmFzZTo6Y29tcGxldGUo
c3RyaW5nIGNvbnN0ICYgcGFydGlhbCwKCQkgICBzZXQ8ZmlsZV9pZD4gJiBjb21wbGV0aW9u
cykKewogIHJlc3VsdHMgcmVzOwogIGNvbXBsZXRpb25zLmNsZWFyKCk7CgogIGZldGNoKHJl
cywgMSwgYW55X3Jvd3MsCgkiU0VMRUNUIGlkIEZST00gZmlsZXMgV0hFUkUgaWQgR0xPQiAn
JXEqJyIsCglwYXJ0aWFsLmNfc3RyKCkpOwoKICBmb3IgKHNpemVfdCBpID0gMDsgaSA8IHJl
cy5zaXplKCk7ICsraSkKICAgIGNvbXBsZXRpb25zLmluc2VydChmaWxlX2lkKHJlc1tpXVsw
XSkpOyAgCiAgCiAgcmVzLmNsZWFyKCk7CgogIGZldGNoKHJlcywgMSwgYW55X3Jvd3MsCgki
U0VMRUNUIGlkIEZST00gZmlsZV9kZWx0YXMgV0hFUkUgaWQgR0xPQiAnJXEqJyIsCglwYXJ0
aWFsLmNfc3RyKCkpOwoKICBmb3IgKHNpemVfdCBpID0gMDsgaSA8IHJlcy5zaXplKCk7ICsr
aSkKICAgIGNvbXBsZXRpb25zLmluc2VydChmaWxlX2lkKHJlc1tpXVswXSkpOyAgCn0KCnVz
aW5nIGNvbW1hbmRzOjpzZWxlY3Rvcl90eXBlOwoKc3RhdGljIHZvaWQgc2VsZWN0b3JfdG9f
Y2VydG5hbWUoc2VsZWN0b3JfdHlwZSB0eSwKCQkJCSBzdHJpbmcgJiBzKQp7CiAgc3dpdGNo
ICh0eSkKICAgIHsKICAgIGNhc2UgY29tbWFuZHM6OnNlbF9hdXRob3I6CiAgICAgIHMgPSBh
dXRob3JfY2VydF9uYW1lOwogICAgICBicmVhazsKICAgIGNhc2UgY29tbWFuZHM6OnNlbF9i
cmFuY2g6CiAgICAgIHMgPSBicmFuY2hfY2VydF9uYW1lOwogICAgICBicmVhazsKICAgIGNh
c2UgY29tbWFuZHM6OnNlbF9kYXRlOgogICAgICBzID0gZGF0ZV9jZXJ0X25hbWU7CiAgICAg
IGJyZWFrOwogICAgY2FzZSBjb21tYW5kczo6c2VsX3RhZzoKICAgICAgcyA9IHRhZ19jZXJ0
X25hbWU7CiAgICAgIGJyZWFrOwogICAgY2FzZSBjb21tYW5kczo6c2VsX2lkZW50OgogICAg
Y2FzZSBjb21tYW5kczo6c2VsX3Vua25vd246CiAgICAgIEkoZmFsc2UpOyAvLyBkb24ndCBk
byB0aGlzLgogICAgICBicmVhazsKICAgIH0KfQoKdm9pZCBkYXRhYmFzZTo6Y29tcGxldGUo
c2VsZWN0b3JfdHlwZSB0eSwKCQkJc3RyaW5nIGNvbnN0ICYgcGFydGlhbCwKCQkJdmVjdG9y
PHBhaXI8c2VsZWN0b3JfdHlwZSwgc3RyaW5nPiA+IGNvbnN0ICYgbGltaXQsCgkJCXNldDxz
dHJpbmc+ICYgY29tcGxldGlvbnMpCnsKICBjb21wbGV0aW9ucy5jbGVhcigpOwoKICAvLyBz
dGVwIDE6IHRoZSBsaW1pdCBpcyB0cmFuc2Zvcm1lZCBpbnRvIGFuIFNRTCBzZWxlY3Qgc3Rh
dGVtZW50IHdoaWNoCiAgLy8gc2VsZWN0cyBhIHNldCBvZiBJRHMgZnJvbSB0aGUgbWFuaWZl
c3RfY2VydHMgdGFibGUgd2hpY2ggbWF0Y2ggdGhlCiAgLy8gbGltaXQuICB0aGlzIGlzIGRv
bmUgYnkgYnVpbGRpbmcgYW4gU1FMIHNlbGVjdCBzdGF0ZW1lbnQgZm9yIGVhY2ggdGVybQog
IC8vIGluIHRoZSBsaW1pdCBhbmQgdGhlbiBJTlRFUlNFQ1RpbmcgdGhlbSBhbGwuCgogIHN0
cmluZyBsaW0gPSAiKCI7CiAgYm9vbCBmaXJzdF9saW1pdCA9IHRydWU7CiAgZm9yICh2ZWN0
b3I8cGFpcjxzZWxlY3Rvcl90eXBlLCBzdHJpbmc+ID46OmNvbnN0X2l0ZXJhdG9yIGkgPSBs
aW1pdC5iZWdpbigpOwogICAgICAgaSAhPSBsaW1pdC5lbmQoKTsgKytpKQogICAgewogICAg
ICBpZiAoZmlyc3RfbGltaXQpCglmaXJzdF9saW1pdCA9IGZhbHNlOwogICAgICBlbHNlCgls
aW0gKz0gIiBJTlRFUlNFQ1QgIjsKICAgICAgCiAgICAgIGlmIChpLT5maXJzdCA9PSBjb21t
YW5kczo6c2VsX2lkZW50KQoJewoJICBsaW0gKz0gIlNFTEVDVCBpZCBGUk9NIHJldmlzaW9u
X2NlcnRzICI7CgkgIGxpbSArPSAoRigiV0hFUkUgaWQgR0xPQiAnJXMqJyIpIAoJCSAgJSBp
LT5zZWNvbmQpLnN0cigpOwoJfQogICAgICBlbHNlIGlmIChpLT5maXJzdCA9PSBjb21tYW5k
czo6c2VsX3Vua25vd24pCgl7CgkgIGxpbSArPSAiU0VMRUNUIGlkIEZST00gcmV2aXNpb25f
Y2VydHMgIjsKCSAgbGltICs9IChGKCIgV0hFUkUgKG5hbWU9JyVzJyBPUiBuYW1lPSclcycg
T1IgbmFtZT0nJXMnKSIpCgkJICAlIGF1dGhvcl9jZXJ0X25hbWUgCgkJICAlIHRhZ19jZXJ0
X25hbWUgCgkJICAlIGJyYW5jaF9jZXJ0X25hbWUpLnN0cigpOwoJICBsaW0gKz0gKEYoIiBB
TkQgdW5iYXNlNjQodmFsdWUpIGdsb2IgJyolcyonIikKCQkgICUgaS0+c2Vjb25kKS5zdHIo
KTsJICAKCX0KICAgICAgZWxzZQoJewoJICBzdHJpbmcgY2VydG5hbWU7CgkgIHNlbGVjdG9y
X3RvX2NlcnRuYW1lKGktPmZpcnN0LCBjZXJ0bmFtZSk7CgkgIGxpbSArPSAiU0VMRUNUIGlk
IEZST00gcmV2aXNpb25fY2VydHMgIjsKCSAgbGltICs9IChGKCJXSEVSRSBuYW1lPSclcycg
QU5EIHVuYmFzZTY0KHZhbHVlKSBnbG9iICcqJXMqJyIpCgkJICAlIGNlcnRuYW1lICUgaS0+
c2Vjb25kKS5zdHIoKTsKCX0KICAgIH0KICBsaW0gKz0gIikiOwogIAogIC8vIHN0ZXAgMjog
ZGVwZW5kaW5nIG9uIHdoYXQgd2UndmUgYmVlbiBhc2tlZCB0byBkaXNhbWJpZ3VhdGUsIHdl
CiAgLy8gd2lsbCBjb21wbGV0ZSBlaXRoZXIgc29tZSBpZGVudHMsIG9yIGNlcnQgdmFsdWVz
LCBvciAidW5rbm93biIKICAvLyB3aGljaCBnZW5lcmFsbHkgbWVhbnMgImF1dGhvciwgdGFn
IG9yIGJyYW5jaCIKCiAgc3RyaW5nIHF1ZXJ5OwogIGlmICh0eSA9PSBjb21tYW5kczo6c2Vs
X2lkZW50KQogICAgewogICAgICBxdWVyeSA9IChGKCJTRUxFQ1QgaWQgRlJPTSAlcyIpICUg
bGltKS5zdHIoKTsKICAgIH0KICBlbHNlIAogICAgewogICAgICBxdWVyeSA9ICJTRUxFQ1Qg
dmFsdWUgRlJPTSByZXZpc2lvbl9jZXJ0cyBXSEVSRSI7CiAgICAgIGlmICh0eSA9PSBjb21t
YW5kczo6c2VsX3Vua25vd24pCgl7CSAgCQoJICBxdWVyeSArPSAKCSAgICAoRigiIChuYW1l
PSclcycgT1IgbmFtZT0nJXMnIE9SIG5hbWU9JyVzJykiKQoJICAgICAlIGF1dGhvcl9jZXJ0
X25hbWUgCgkgICAgICUgdGFnX2NlcnRfbmFtZSAKCSAgICAgJSBicmFuY2hfY2VydF9uYW1l
KS5zdHIoKTsKCX0KICAgICAgZWxzZQoJewoJICBzdHJpbmcgY2VydG5hbWU7CgkgIHNlbGVj
dG9yX3RvX2NlcnRuYW1lKHR5LCBjZXJ0bmFtZSk7CgkgIHF1ZXJ5ICs9IAoJICAgIChGKCIg
KG5hbWU9JyVzJykiKSAlIGNlcnRuYW1lKS5zdHIoKTsKCX0KICAgICAgICAKICAgICAgcXVl
cnkgKz0gKEYoIiBBTkQgKHVuYmFzZTY0KHZhbHVlKSBHTE9CICcqJXMqJykiKSAlIHBhcnRp
YWwpLnN0cigpOwogICAgICBxdWVyeSArPSAoRigiIEFORCAoaWQgSU4gJXMpIikgJSBsaW0p
LnN0cigpOwogICAgfQoKICByZXN1bHRzIHJlczsKICBmZXRjaChyZXMsIG9uZV9jb2wsIGFu
eV9yb3dzLCBxdWVyeS5jX3N0cigpKTsKICBmb3IgKHNpemVfdCBpID0gMDsgaSA8IHJlcy5z
aXplKCk7ICsraSkKICAgIHsKICAgICAgaWYgKHR5ID09IGNvbW1hbmRzOjpzZWxfaWRlbnQp
Cgljb21wbGV0aW9ucy5pbnNlcnQocmVzW2ldWzBdKTsKICAgICAgZWxzZQoJewoJICBiYXNl
NjQ8ZGF0YT4gcm93X2VuY29kZWQocmVzW2ldWzBdKTsKCSAgZGF0YSByb3dfZGVjb2RlZDsK
CSAgZGVjb2RlX2Jhc2U2NChyb3dfZW5jb2RlZCwgcm93X2RlY29kZWQpOwoJICBjb21wbGV0
aW9ucy5pbnNlcnQocm93X2RlY29kZWQoKSk7Cgl9CiAgICB9Cn0KCgovLyBtZXJrbGUgbm9k
ZXMKCmJvb2wgCmRhdGFiYXNlOjptZXJrbGVfbm9kZV9leGlzdHMoc3RyaW5nIGNvbnN0ICYg
dHlwZSwKCQkJICAgICB1dGY4IGNvbnN0ICYgY29sbGVjdGlvbiwgCgkJCSAgICAgc2l6ZV90
IGxldmVsLAoJCQkgICAgIGhleGVuYzxwcmVmaXg+IGNvbnN0ICYgcHJlZml4KQp7CiAgcmVz
dWx0cyByZXM7CiAgZmV0Y2gocmVzLCBvbmVfY29sLCBvbmVfcm93LCAKCSJTRUxFQ1QgQ09V
TlQoKikgIgoJIkZST00gbWVya2xlX25vZGVzICIKCSJXSEVSRSB0eXBlID0gJyVxJyAiCgki
QU5EIGNvbGxlY3Rpb24gPSAnJXEnICIKCSJBTkQgbGV2ZWwgPSAlZCAiCgkiQU5EIHByZWZp
eCA9ICclcScgIiwKCXR5cGUuY19zdHIoKSwgY29sbGVjdGlvbigpLmNfc3RyKCksIGxldmVs
LCBwcmVmaXgoKS5jX3N0cigpKTsKICBzaXplX3Qgbl9ub2RlcyA9IGxleGljYWxfY2FzdDxz
aXplX3Q+KHJlc1swXVswXSk7CiAgSShuX25vZGVzID09IDAgfHwgbl9ub2RlcyA9PSAxKTsK
ICByZXR1cm4gbl9ub2RlcyA9PSAxOwp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X21lcmtsZV9u
b2RlKHN0cmluZyBjb25zdCAmIHR5cGUsCgkJCSAgdXRmOCBjb25zdCAmIGNvbGxlY3Rpb24s
IAoJCQkgIHNpemVfdCBsZXZlbCwKCQkJICBoZXhlbmM8cHJlZml4PiBjb25zdCAmIHByZWZp
eCwKCQkJICBiYXNlNjQ8bWVya2xlPiAmIG5vZGUpCnsKICByZXN1bHRzIHJlczsKICBmZXRj
aChyZXMsIG9uZV9jb2wsIG9uZV9yb3csIAoJIlNFTEVDVCBib2R5ICIKCSJGUk9NIG1lcmts
ZV9ub2RlcyAiCgkiV0hFUkUgdHlwZSA9ICclcScgIgoJIkFORCBjb2xsZWN0aW9uID0gJyVx
JyAiCgkiQU5EIGxldmVsID0gJWQgIgoJIkFORCBwcmVmaXggPSAnJXEnIiwKCXR5cGUuY19z
dHIoKSwgY29sbGVjdGlvbigpLmNfc3RyKCksIGxldmVsLCBwcmVmaXgoKS5jX3N0cigpKTsK
ICBub2RlID0gcmVzWzBdWzBdOwp9Cgp2b2lkIApkYXRhYmFzZTo6cHV0X21lcmtsZV9ub2Rl
KHN0cmluZyBjb25zdCAmIHR5cGUsCgkJCSAgdXRmOCBjb25zdCAmIGNvbGxlY3Rpb24sIAoJ
CQkgIHNpemVfdCBsZXZlbCwKCQkJICBoZXhlbmM8cHJlZml4PiBjb25zdCAmIHByZWZpeCwJ
CQkJICAgICAgIAoJCQkgIGJhc2U2NDxtZXJrbGU+IGNvbnN0ICYgbm9kZSkKewogIGV4ZWN1
dGUoIklOU0VSVCBPUiBSRVBMQUNFICIKCSAgIklOVE8gbWVya2xlX25vZGVzICIKCSAgIlZB
TFVFUyAoJyVxJywgJyVxJywgJWQsICclcScsICclcScpIiwKCSAgdHlwZS5jX3N0cigpLCBj
b2xsZWN0aW9uKCkuY19zdHIoKSwgbGV2ZWwsIHByZWZpeCgpLmNfc3RyKCksIG5vZGUoKS5j
X3N0cigpKTsKfQoKdm9pZCAKZGF0YWJhc2U6OmVyYXNlX21lcmtsZV9ub2RlcyhzdHJpbmcg
Y29uc3QgJiB0eXBlLAoJCQkgICAgIHV0ZjggY29uc3QgJiBjb2xsZWN0aW9uKQp7CiAgZXhl
Y3V0ZSgiREVMRVRFIEZST00gbWVya2xlX25vZGVzICIKCSAgIldIRVJFIHR5cGUgPSAnJXEn
ICIKCSAgIkFORCBjb2xsZWN0aW9uID0gJyVxJyIsCgkgIHR5cGUuY19zdHIoKSwgY29sbGVj
dGlvbigpLmNfc3RyKCkpOwp9CgovLyB0cmFuc2FjdGlvbiBndWFyZHMKCnRyYW5zYWN0aW9u
X2d1YXJkOjp0cmFuc2FjdGlvbl9ndWFyZChkYXRhYmFzZSAmIGQpIDogY29tbWl0dGVkKGZh
bHNlKSwgZGIoZCkgCnsKICBkYi5iZWdpbl90cmFuc2FjdGlvbigpOwp9CnRyYW5zYWN0aW9u
X2d1YXJkOjp+dHJhbnNhY3Rpb25fZ3VhcmQoKQp7CiAgaWYgKGNvbW1pdHRlZCkKICAgIGRi
LmNvbW1pdF90cmFuc2FjdGlvbigpOwogIGVsc2UKICAgIGRiLnJvbGxiYWNrX3RyYW5zYWN0
aW9uKCk7Cn0KCnZvaWQgCnRyYW5zYWN0aW9uX2d1YXJkOjpjb21taXQoKQp7CiAgY29tbWl0
dGVkID0gdHJ1ZTsKfQoK
])

AT_DATA(left.b64, [Ly8gY29weXJpZ2h0IChDKSAyMDAyLCAyMDAzIGdyYXlkb24gaG9hcmUgPGdyYXlkb25AcG9i
b3guY29tPgovLyBhbGwgcmlnaHRzIHJlc2VydmVkLgovLyBsaWNlbnNlZCB0byB0aGUgcHVi
bGljIHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdQTCAoPj0gMikKLy8gc2VlIHRoZSBm
aWxlIENPUFlJTkcgZm9yIGRldGFpbHMKCiNpbmNsdWRlIDxpdGVyYXRvcj4KI2luY2x1ZGUg
PGxpc3Q+CiNpbmNsdWRlIDxzZXQ+CiNpbmNsdWRlIDxzc3RyZWFtPgojaW5jbHVkZSA8dmVj
dG9yPgoKI2luY2x1ZGUgPHN0ZGFyZy5oPgoKI2luY2x1ZGUgPGJvb3N0L3NoYXJlZF9wdHIu
aHBwPgojaW5jbHVkZSA8Ym9vc3QvbGV4aWNhbF9jYXN0LmhwcD4KI2luY2x1ZGUgPGJvb3N0
L2ZpbGVzeXN0ZW0vcGF0aC5ocHA+CiNpbmNsdWRlIDxib29zdC9maWxlc3lzdGVtL29wZXJh
dGlvbnMuaHBwPgoKI2luY2x1ZGUgPHNxbGl0ZS5oPgoKI2luY2x1ZGUgImFwcF9zdGF0ZS5o
aCIKI2luY2x1ZGUgImNlcnQuaGgiCiNpbmNsdWRlICJjbGVhbnVwLmhoIgojaW5jbHVkZSAi
Y29uc3RhbnRzLmhoIgojaW5jbHVkZSAiZGF0YWJhc2UuaGgiCiNpbmNsdWRlICJrZXlzLmho
IgojaW5jbHVkZSAic2FuaXR5LmhoIgojaW5jbHVkZSAic2NoZW1hX21pZ3JhdGlvbi5oaCIK
I2luY2x1ZGUgImNlcnQuaGgiCiNpbmNsdWRlICJ0cmFuc2Zvcm1zLmhoIgojaW5jbHVkZSAi
dWkuaGgiCiNpbmNsdWRlICJ2b2NhYi5oaCIKI2luY2x1ZGUgInhkZWx0YS5oaCIKCi8vIGRl
ZmluZWQgaW4gc2NoZW1hLnNxbCwgY29udmVydGVkIHRvIGhlYWRlcjoKI2luY2x1ZGUgInNj
aGVtYS5oIgoKLy8gZGVmaW5lZCBpbiB2aWV3cy5zcWwsIGNvbnZlcnRlZCB0byBoZWFkZXI6
CiNpbmNsdWRlICJ2aWV3cy5oIgoKLy8gdGhpcyBmaWxlIGRlZmluZXMgYSBwdWJsaWMsIHR5
cGVkIGludGVyZmFjZSB0byB0aGUgZGF0YWJhc2UuCi8vIHRoZSBkYXRhYmFzZSBjbGFzcyBl
bmNhcHN1bGF0ZXMgYWxsIGtub3dsZWRnZSBhYm91dCBzcWxpdGUsCi8vIHRoZSBzY2hlbWEs
IGFuZCBhbGwgU1FMIHN0YXRlbWVudHMgdXNlZCB0byBhY2Nlc3MgdGhlIHNjaGVtYS4KLy8K
Ly8gc2VlIGZpbGUgc2NoZW1hLnNxbCBmb3IgdGhlIHRleHQgb2YgdGhlIHNjaGVtYS4KCnVz
aW5nIGJvb3N0OjpzaGFyZWRfcHRyOwp1c2luZyBib29zdDo6bGV4aWNhbF9jYXN0Owp1c2lu
ZyBuYW1lc3BhY2Ugc3RkOwoKaW50IGNvbnN0IG9uZV9yb3cgPSAxOwppbnQgY29uc3Qgb25l
X2NvbCA9IDE7CmludCBjb25zdCBhbnlfcm93cyA9IC0xOwppbnQgY29uc3QgYW55X2NvbHMg
PSAtMTsKCmV4dGVybiAiQyIgewogIC8vIHN0cmFuZ2VseSB0aGlzIGlzbid0IGRlY2xhcmVk
LCBldmVuIHRob3VnaCBpdCdzIHByZXNlbnQgaW4gbXkgc3FsaXRlLgogIGNoYXIgKnNxbGl0
ZV92bXByaW50Zihjb25zdCBjaGFyICp6Rm9ybWF0LCB2YV9saXN0KTsKfQoKZGF0YWJhc2U6
OmRhdGFiYXNlKGZzOjpwYXRoIGNvbnN0ICYgZm4pIDoKICBmaWxlbmFtZShmbiksCiAgLy8g
bmIuIHVwZGF0ZSB0aGlzIGlmIHlvdSBjaGFuZ2UgdGhlIHNjaGVtYS4gdW5mb3J0dW5hdGVs
eSB3ZSBhcmUgbm90CiAgLy8gdXNpbmcgc2VsZi1kaWdlc3Rpbmcgc2NoZW1hcyBkdWUgdG8g
Y29tbWVudCBpcnJlZ3VsYXJpdGllcyBhbmQKICAvLyBub24tYWxwaGFiZXRpYyBvcmRlcmlu
ZyBvZiB0YWJsZXMgaW4gc3FsIHNvdXJjZSBmaWxlcy4gd2UgY291bGQgY3JlYXRlCiAgLy8g
YSB0ZW1wb3JhcnkgZGIsIHdyaXRlIG91ciBpbnRlbmRlZCBzY2hlbWEgaW50byBpdCwgYW5k
IHJlYWQgaXQgYmFjaywKICAvLyBidXQgdGhpcyBzZWVtcyBsaWtlIGl0IHdvdWxkIGJlIHRv
byBydWRlLiBwb3NzaWJseSByZXZpc2l0IHRoaXMgaXNzdWUuCiAgc2NoZW1hKCJjMWU4NjU4
OGUxMWFkMDdmYTUzZTVkMjk0ZWRjMDQzY2UxZDQwMDVhIiksCiAgX19zcWwoTlVMTCksCiAg
dHJhbnNhY3Rpb25fbGV2ZWwoMCkKe30KCnZvaWQgCmRhdGFiYXNlOjpjaGVja19zY2hlbWEo
KQp7CiAgc3RyaW5nIGRiX3NjaGVtYV9pZDsgIAogIGNhbGN1bGF0ZV9zY2hlbWFfaWQgKF9f
c3FsLCBkYl9zY2hlbWFfaWQpOwogIE4gKHNjaGVtYSA9PSBkYl9zY2hlbWFfaWQsCiAgICAg
RigiZGF0YWJhc2Ugc2NoZW1hcyBkbyBub3QgbWF0Y2g6ICIKICAgICAgICJ3YW50ZWQgJXMs
IGdvdCAlcy4gdHJ5IG1pZ3JhdGluZyBkYXRhYmFzZSIpIAogICAgICUgc2NoZW1hICUgZGJf
c2NoZW1hX2lkKTsKfQoKc3RhdGljIHZvaWQgCnNxbGl0ZV91bmJhc2U2NF9mbihzcWxpdGVf
ZnVuYyAqZiwgaW50IG5hcmdzLCBjaGFyIGNvbnN0ICoqIGFyZ3MpCnsKICBpZiAobmFyZ3Mg
IT0gMSkKICAgIHsKICAgICAgc3FsaXRlX3NldF9yZXN1bHRfZXJyb3IoZiwgIm5lZWQgZXhh
Y3RseSAxIGFyZyB0byB1bmJhc2U2NCgpIiwgLTEpOwogICAgICByZXR1cm47CiAgICB9CiAg
ZGF0YSBkZWNvZGVkOwogIGRlY29kZV9iYXNlNjQoYmFzZTY0PGRhdGE+KHN0cmluZyhhcmdz
WzBdKSksIGRlY29kZWQpOwogIHNxbGl0ZV9zZXRfcmVzdWx0X3N0cmluZyhmLCBkZWNvZGVk
KCkuY19zdHIoKSwgZGVjb2RlZCgpLnNpemUoKSk7Cn0KCnZvaWQgCmRhdGFiYXNlOjpzZXRf
YXBwKGFwcF9zdGF0ZSAqIGFwcCkKewogIF9fYXBwID0gYXBwOwp9CgpzdHJ1Y3Qgc3FsaXRl
ICogCmRhdGFiYXNlOjpzcWwoYm9vbCBpbml0KQp7CiAgaWYgKCEgX19zcWwpCiAgICB7CiAg
ICAgIGlmICghIGluaXQpCiAgICAgICAgewogICAgICAgICAgaWYgKGZpbGVuYW1lLnN0cmlu
ZygpID09ICIiKQogICAgICAgICAgICB0aHJvdyBpbmZvcm1hdGl2ZV9mYWlsdXJlKHN0cmlu
Zygibm8gZGF0YWJhc2Ugc3BlY2lmaWVkIikpOwogICAgICAgICAgZWxzZSBpZiAoISBmczo6
ZXhpc3RzKGZpbGVuYW1lKSkKICAgICAgICAgICAgdGhyb3cgaW5mb3JtYXRpdmVfZmFpbHVy
ZShzdHJpbmcoImRhdGFiYXNlICIpICsgZmlsZW5hbWUuc3RyaW5nKCkgKwogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZygiIGRvZXMgbm90IGV4aXN0Iikp
OwogICAgICAgIH0KICAgICAgTihmaWxlbmFtZS5zdHJpbmcoKSAhPSAiIiwKICAgICAgICBG
KCJuZWVkIGRhdGFiYXNlIG5hbWUiKSk7CiAgICAgIGNoYXIgKiBlcnJtc2cgPSBOVUxMOwog
ICAgICBfX3NxbCA9IHNxbGl0ZV9vcGVuKGZpbGVuYW1lLnN0cmluZygpLmNfc3RyKCksIDA3
NTUsICZlcnJtc2cpOwogICAgICBpZiAoISBfX3NxbCkKICAgICAgICB0aHJvdyBvb3BzKHN0
cmluZygiY291bGQgbm90IG9wZW4gZGF0YWJhc2U6ICIpICsgZmlsZW5hbWUuc3RyaW5nKCkg
KyAKICAgICAgICAgICAgICAgICAgIChlcnJtc2cgPyAoIjogIiArIHN0cmluZyhlcnJtc2cp
KSA6ICIiKSk7CiAgICAgIGlmIChpbml0KQogICAgICAgIGV4ZWN1dGUoc2NoZW1hX2NvbnN0
YW50KTsKCiAgICAgIGNoZWNrX3NjaGVtYSgpOwogICAgICBpbnN0YWxsX2Z1bmN0aW9ucyhf
X2FwcCk7CiAgICAgIGluc3RhbGxfdmlld3MoKTsKICAgIH0KICByZXR1cm4gX19zcWw7Cn0K
CnZvaWQgCmRhdGFiYXNlOjppbml0aWFsaXplKCkKewogIGlmIChfX3NxbCkKICAgIHRocm93
IG9vcHMoImNhbm5vdCBpbml0aWFsaXplIGRhdGFiYXNlIHdoaWxlIGl0IGlzIG9wZW4iKTsK
CiAgTighZnM6OmV4aXN0cyhmaWxlbmFtZSksCiAgICBGKCJjb3VsZCBub3QgaW5pdGlhbGl6
ZSBkYXRhYmFzZTogJXM6IGFscmVhZHkgZXhpc3RzIikgCiAgICAlIGZpbGVuYW1lLnN0cmlu
ZygpKTsKCiAgZnM6OnBhdGggam91cm5hbCA9IG1rcGF0aChmaWxlbmFtZS5zdHJpbmcoKSAr
ICItam91cm5hbCIpOwogIE4oIWZzOjpleGlzdHMoam91cm5hbCksCiAgICBGKCJleGlzdGlu
ZyAocG9zc2libHkgc3RhbGUpIGpvdXJuYWwgZmlsZSAnJXMnIGhhcyBzYW1lIHN0ZW0gYXMg
bmV3IGRhdGFiYXNlICclcyciKQogICAgJSBqb3VybmFsLnN0cmluZygpICUgZmlsZW5hbWUu
c3RyaW5nKCkpOwoKICBzcWxpdGUgKnMgPSBzcWwodHJ1ZSk7CiAgSShzICE9IE5VTEwpOwp9
CgoKc3RydWN0IApkdW1wX3JlcXVlc3QKewogIGR1bXBfcmVxdWVzdCgpIHt9OwogIHN0cnVj
dCBzcWxpdGUgKnNxbDsKICBzdHJpbmcgdGFibGVfbmFtZTsKICBvc3RyZWFtICpvdXQ7Cn07
CgpzdGF0aWMgaW50IApkdW1wX3Jvd19jYih2b2lkICpkYXRhLCBpbnQgbiwgY2hhciAqKnZh
bHMsIGNoYXIgKipjb2xzKQp7CiAgZHVtcF9yZXF1ZXN0ICpkdW1wID0gcmVpbnRlcnByZXRf
Y2FzdDxkdW1wX3JlcXVlc3QgKj4oZGF0YSk7CiAgSShkdW1wICE9IE5VTEwpOwogIEkodmFs
cyAhPSBOVUxMKTsKICBJKGR1bXAtPm91dCAhPSBOVUxMKTsKICAqKGR1bXAtPm91dCkgPDwg
RigiSU5TRVJUIElOVE8gJXMgVkFMVUVTKCIpICUgZHVtcC0+dGFibGVfbmFtZTsKICBmb3Ig
KGludCBpID0gMDsgaSA8IG47ICsraSkKICAgIHsKICAgICAgaWYgKGkgIT0gMCkKICAgICAg
ICAqKGR1bXAtPm91dCkgPDwgJywnOwoKICAgICAgaWYgKHZhbHNbaV0gPT0gTlVMTCkKICAg
ICAgICAqKGR1bXAtPm91dCkgPDwgIk5VTEwiOwogICAgICBlbHNlCiAgICAgICAgewogICAg
ICAgICAgKihkdW1wLT5vdXQpIDw8ICInIjsKICAgICAgICAgIGZvciAoY2hhciAqY3AgPSB2
YWxzW2ldOyAqY3A7ICsrY3ApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBpZiAoKmNw
ID09ICdcJycpCiAgICAgICAgICAgICAgICAqKGR1bXAtPm91dCkgPDwgIicnIjsKICAgICAg
ICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAqKGR1bXAtPm91dCkgPDwgKmNwOwogICAg
ICAgICAgICB9CiAgICAgICAgICAqKGR1bXAtPm91dCkgPDwgIiciOwogICAgICAgIH0KICAg
IH0KICAqKGR1bXAtPm91dCkgPDwgIik7XG4iOyAgCiAgcmV0dXJuIDA7Cn0KCnN0YXRpYyBp
bnQgCmR1bXBfdGFibGVfY2Iodm9pZCAqZGF0YSwgaW50IG4sIGNoYXIgKip2YWxzLCBjaGFy
ICoqY29scykKewogIGR1bXBfcmVxdWVzdCAqZHVtcCA9IHJlaW50ZXJwcmV0X2Nhc3Q8ZHVt
cF9yZXF1ZXN0ICo+KGRhdGEpOwogIEkoZHVtcCAhPSBOVUxMKTsKICBJKGR1bXAtPnNxbCAh
PSBOVUxMKTsKICBJKHZhbHMgIT0gTlVMTCk7CiAgSSh2YWxzWzBdICE9IE5VTEwpOwogIEko
dmFsc1sxXSAhPSBOVUxMKTsKICBJKHZhbHNbMl0gIT0gTlVMTCk7CiAgSShuID09IDMpOwog
IGlmIChzdHJpbmcodmFsc1sxXSkgPT0gInRhYmxlIikKICAgIHsKICAgICAgKihkdW1wLT5v
dXQpIDw8IHZhbHNbMl0gPDwgIjtcbiI7CiAgICAgIGR1bXAtPnRhYmxlX25hbWUgPSBzdHJp
bmcodmFsc1swXSk7CiAgICAgIHNxbGl0ZV9leGVjX3ByaW50ZihkdW1wLT5zcWwsICJTRUxF
Q1QgKiBGUk9NICclcSciLCAKICAgICAgICAgICAgICAgICAgICAgICAgIGR1bXBfcm93X2Ni
LCBkYXRhLCBOVUxMLCB2YWxzWzBdKTsKICAgIH0KICByZXR1cm4gMDsKfQoKdm9pZCAKZGF0
YWJhc2U6OmR1bXAob3N0cmVhbSAmIG91dCkKewogIGR1bXBfcmVxdWVzdCByZXE7CiAgcmVx
Lm91dCA9ICZvdXQ7CiAgcmVxLnNxbCA9IHNxbCgpOwogIG91dCA8PCAiQkVHSU4gVFJBTlNB
Q1RJT047XG4iOwogIGludCByZXMgPSBzcWxpdGVfZXhlYyhyZXEuc3FsLAogICAgICAgICAg
ICAgICAgICAgICAgICAiU0VMRUNUIG5hbWUsIHR5cGUsIHNxbCBGUk9NIHNxbGl0ZV9tYXN0
ZXIgIgogICAgICAgICAgICAgICAgICAgICAgICAiV0hFUkUgdHlwZT0ndGFibGUnIEFORCBz
cWwgTk9UIE5VTEwgIgogICAgICAgICAgICAgICAgICAgICAgICAiT1JERVIgQlkgc3Vic3Ry
KHR5cGUsMiwxKSwgbmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGR1bXBfdGFibGVf
Y2IsICZyZXEsIE5VTEwpOwogIEkocmVzID09IFNRTElURV9PSyk7CiAgb3V0IDw8ICJDT01N
SVQ7XG4iOwp9Cgp2b2lkIApkYXRhYmFzZTo6bG9hZChpc3RyZWFtICYgaW4pCnsKICBjaGFy
IGJ1Zltjb25zdGFudHM6OmJ1ZnN6XTsKICBzdHJpbmcgdG1wOwoKICBOKGZpbGVuYW1lLnN0
cmluZygpICE9ICIiLAogICAgRigibmVlZCBkYXRhYmFzZSBuYW1lIikpOwogIGNoYXIgKiBl
cnJtc2cgPSBOVUxMOwogIF9fc3FsID0gc3FsaXRlX29wZW4oZmlsZW5hbWUuc3RyaW5nKCku
Y19zdHIoKSwgMDc1NSwgJmVycm1zZyk7CiAgaWYgKCEgX19zcWwpCiAgICB0aHJvdyBvb3Bz
KHN0cmluZygiY291bGQgbm90IG9wZW4gZGF0YWJhc2U6ICIpICsgZmlsZW5hbWUuc3RyaW5n
KCkgKyAKICAgICAgICAgICAgICAgKGVycm1zZyA/ICgiOiAiICsgc3RyaW5nKGVycm1zZykp
IDogIiIpKTsKICAKICB3aGlsZShpbikKICAgIHsKICAgICAgaW4ucmVhZChidWYsIGNvbnN0
YW50czo6YnVmc3opOwogICAgICB0bXAuYXBwZW5kKGJ1ZiwgaW4uZ2NvdW50KCkpOwogICAg
fQoKICBleGVjdXRlKHRtcC5jX3N0cigpKTsKfQoKCnZvaWQgCmRhdGFiYXNlOjpkZWJ1Zyhz
dHJpbmcgY29uc3QgJiBzcWwsIG9zdHJlYW0gJiBvdXQpCnsKICByZXN1bHRzIHJlczsKICBm
ZXRjaChyZXMsIGFueV9jb2xzLCBhbnlfcm93cywgc3FsLmNfc3RyKCkpOwogIG91dCA8PCAi
JyIgPDwgc3FsIDw8ICInIC0+ICIgPDwgcmVzLnNpemUoKSA8PCAiIHJvd3NcbiIgPDwgZW5k
bDsKICBmb3IgKHNpemVfdCBpID0gMDsgaSA8IHJlcy5zaXplKCk7ICsraSkKICAgIHsKICAg
ICAgZm9yIChzaXplX3QgaiA9IDA7IGogPCByZXNbaV0uc2l6ZSgpOyArK2opCiAgICAgICAg
ewogICAgICAgICAgaWYgKGogIT0gMCkKICAgICAgICAgICAgb3V0IDw8ICIgfCAiOwogICAg
ICAgICAgb3V0IDw8IHJlc1tpXVtqXTsKICAgICAgICB9CiAgICAgIG91dCA8PCBlbmRsOwog
ICAgfQp9Cgp1bnNpZ25lZCBsb25nIApkYXRhYmFzZTo6Z2V0X3N0YXRpc3RpYyhzdHJpbmcg
Y29uc3QgJiBxdWVyeSkKewogIHJlc3VsdHMgcmVzOwogIGZldGNoKHJlcywgMSwgMSwgcXVl
cnkuY19zdHIoKSk7CiAgcmV0dXJuIGxleGljYWxfY2FzdDx1bnNpZ25lZCBsb25nPihyZXNb
MF1bMF0pOwp9Cgp2b2lkIApkYXRhYmFzZTo6aW5mbyhvc3RyZWFtICYgb3V0KQp7CiAgc3Ry
aW5nIGlkOwogIGNhbGN1bGF0ZV9zY2hlbWFfaWQoc3FsKCksIGlkKTsKICBvdXQgPDwgInNj
aGVtYSB2ZXJzaW9uICA6ICIgPDwgaWQgPDwgZW5kbDsKICBvdXQgPDwgImZ1bGwgbWFuaWZl
c3RzICA6ICIgPDwgZ2V0X3N0YXRpc3RpYygiU0VMRUNUIENPVU5UKCopIEZST00gbWFuaWZl
c3RzIikgPDwgZW5kbDsKICBvdXQgPDwgIm1hbmlmZXN0IGRlbHRhcyA6ICIgPDwgZ2V0X3N0
YXRpc3RpYygiU0VMRUNUIENPVU5UKCopIEZST00gbWFuaWZlc3RfZGVsdGFzIikgPDwgZW5k
bDsKICBvdXQgPDwgImZ1bGwgZmlsZXMgICAgICA6ICIgPDwgZ2V0X3N0YXRpc3RpYygiU0VM
RUNUIENPVU5UKCopIEZST00gZmlsZXMiKSA8PCBlbmRsOwogIG91dCA8PCAiZmlsZSBkZWx0
YXMgICAgIDogIiA8PCBnZXRfc3RhdGlzdGljKCJTRUxFQ1QgQ09VTlQoKikgRlJPTSBmaWxl
X2RlbHRhcyIpIDw8IGVuZGw7Cn0KCnZvaWQgCmRhdGFiYXNlOjp2ZXJzaW9uKG9zdHJlYW0g
JiBvdXQpCnsKICBzdHJpbmcgaWQ7CiAgY2FsY3VsYXRlX3NjaGVtYV9pZChzcWwoKSwgaWQp
OwogIG91dCA8PCAiZGF0YWJhc2Ugc2NoZW1hIHZlcnNpb246ICIgPDwgaWQgPDwgZW5kbDsK
fQoKdm9pZCAKZGF0YWJhc2U6Om1pZ3JhdGUoKQp7ICAKICBOKGZpbGVuYW1lLnN0cmluZygp
ICE9ICIiLAogICAgRigibmVlZCBkYXRhYmFzZSBuYW1lIikpOwogIGNoYXIgKiBlcnJtc2cg
PSBOVUxMOwogIF9fc3FsID0gc3FsaXRlX29wZW4oZmlsZW5hbWUuc3RyaW5nKCkuY19zdHIo
KSwgMDc1NSwgJmVycm1zZyk7CiAgaWYgKCEgX19zcWwpCiAgICB0aHJvdyBvb3BzKHN0cmlu
ZygiY291bGQgbm90IG9wZW4gZGF0YWJhc2U6ICIpICsgZmlsZW5hbWUuc3RyaW5nKCkgKyAK
ICAgICAgICAgICAgICAgKGVycm1zZyA/ICgiOiAiICsgc3RyaW5nKGVycm1zZykpIDogIiIp
KTsKICBtaWdyYXRlX21vbm90b25lX3NjaGVtYShfX3NxbCk7CiAgc3FsaXRlX2Nsb3NlKF9f
c3FsKTsKfQoKdm9pZCAKZGF0YWJhc2U6OnJlaGFzaCgpCnsKICB0cmFuc2FjdGlvbl9ndWFy
ZCBndWFyZCgqdGhpcyk7CiAgdGlja2VyIG1jZXJ0cygibWNlcnRzIiwgIm0iLCAxKTsKICB0
aWNrZXIgZmNlcnRzKCJmY2VydHMiLCAiZiIsIDEpOwogIHRpY2tlciBwdWJrZXlzKCJwdWJr
ZXlzIiwgIisiLCAxKTsKICB0aWNrZXIgcHJpdmtleXMoInByaXZrZXlzIiwgIiEiLCAxKTsK
ICAKICB7CiAgICAvLyByZWhhc2ggYWxsIG1jZXJ0cwogICAgcmVzdWx0cyByZXM7CiAgICB2
ZWN0b3I8Y2VydD4gY2VydHM7CiAgICBmZXRjaChyZXMsIDUsIGFueV9yb3dzLCAKICAgICAg
ICAgICJTRUxFQ1QgaWQsIG5hbWUsIHZhbHVlLCBrZXlwYWlyLCBzaWduYXR1cmUgIgogICAg
ICAgICAgIkZST00gbWFuaWZlc3RfY2VydHMiKTsKICAgIHJlc3VsdHNfdG9fY2VydHMocmVz
LCBjZXJ0cyk7CiAgICBleGVjdXRlKCJERUxFVEUgRlJPTSBtYW5pZmVzdF9jZXJ0cyIpOwog
ICAgZm9yKHZlY3RvcjxjZXJ0Pjo6Y29uc3RfaXRlcmF0b3IgaSA9IGNlcnRzLmJlZ2luKCk7
IGkgIT0gY2VydHMuZW5kKCk7ICsraSkKICAgICAgewogICAgICAgIHB1dF9jZXJ0KCppLCAi
bWFuaWZlc3RfY2VydHMiKTsKICAgICAgICArK21jZXJ0czsKICAgICAgfQogIH0KCiAgewog
ICAgLy8gcmVoYXNoIGFsbCBmY2VydHMKICAgIHJlc3VsdHMgcmVzOwogICAgdmVjdG9yPGNl
cnQ+IGNlcnRzOyAgICAKICAgIGZldGNoKHJlcywgNSwgYW55X3Jvd3MsIAogICAgICAgICAg
IlNFTEVDVCBpZCwgbmFtZSwgdmFsdWUsIGtleXBhaXIsIHNpZ25hdHVyZSAiCiAgICAgICAg
ICAiRlJPTSBmaWxlX2NlcnRzIik7CiAgICByZXN1bHRzX3RvX2NlcnRzKHJlcywgY2VydHMp
OwogICAgZXhlY3V0ZSgiREVMRVRFIEZST00gZmlsZV9jZXJ0cyIpOwogICAgZm9yKHZlY3Rv
cjxjZXJ0Pjo6Y29uc3RfaXRlcmF0b3IgaSA9IGNlcnRzLmJlZ2luKCk7IGkgIT0gY2VydHMu
ZW5kKCk7ICsraSkKICAgICAgewogICAgICAgIHB1dF9jZXJ0KCppLCAiZmlsZV9jZXJ0cyIp
OwogICAgICAgICsrZmNlcnRzOwogICAgICB9CiAgfQogIAoKICB7CiAgICAvLyByZWhhc2gg
YWxsIHB1YmtleXMKICAgIHJlc3VsdHMgcmVzOwogICAgZmV0Y2gocmVzLCAyLCBhbnlfcm93
cywgIlNFTEVDVCBpZCwga2V5ZGF0YSBGUk9NIHB1YmxpY19rZXlzIik7CiAgICBleGVjdXRl
KCJERUxFVEUgRlJPTSBwdWJsaWNfa2V5cyIpOwogICAgZm9yIChzaXplX3QgaSA9IDA7IGkg
PCByZXMuc2l6ZSgpOyArK2kpCiAgICAgIHsKICAgICAgICBoZXhlbmM8aWQ+IHRtcDsKICAg
ICAgICBrZXlfaGFzaF9jb2RlKHJzYV9rZXlwYWlyX2lkKHJlc1tpXVswXSksIGJhc2U2NDxy
c2FfcHViX2tleT4ocmVzW2ldWzFdKSwgdG1wKTsKICAgICAgICBleGVjdXRlKCJJTlNFUlQg
SU5UTyBwdWJsaWNfa2V5cyBWQUxVRVMoJyVxJywgJyVxJywgJyVxJykiLCAKICAgICAgICAg
ICAgICAgIHRtcCgpLmNfc3RyKCksIHJlc1tpXVswXS5jX3N0cigpLCByZXNbaV1bMV0uY19z
dHIoKSk7CiAgICAgICAgKytwdWJrZXlzOwogICAgICB9CiAgfQoKewogICAgLy8gcmVoYXNo
IGFsbCBwcml2a2V5cwogICAgcmVzdWx0cyByZXM7CiAgICBmZXRjaChyZXMsIDIsIGFueV9y
b3dzLCAiU0VMRUNUIGlkLCBrZXlkYXRhIEZST00gcHJpdmF0ZV9rZXlzIik7CiAgICBleGVj
dXRlKCJERUxFVEUgRlJPTSBwcml2YXRlX2tleXMiKTsKICAgIGZvciAoc2l6ZV90IGkgPSAw
OyBpIDwgcmVzLnNpemUoKTsgKytpKQogICAgICB7CiAgICAgICAgaGV4ZW5jPGlkPiB0bXA7
CiAgICAgICAga2V5X2hhc2hfY29kZShyc2Ffa2V5cGFpcl9pZChyZXNbaV1bMF0pLCBiYXNl
NjQ8IGFyYzQ8cnNhX3ByaXZfa2V5PiA+KHJlc1tpXVsxXSksIHRtcCk7CiAgICAgICAgZXhl
Y3V0ZSgiSU5TRVJUIElOVE8gcHJpdmF0ZV9rZXlzIFZBTFVFUygnJXEnLCAnJXEnLCAnJXEn
KSIsIAogICAgICAgICAgICAgICAgdG1wKCkuY19zdHIoKSwgcmVzW2ldWzBdLmNfc3RyKCks
IHJlc1tpXVsxXS5jX3N0cigpKTsKICAgICAgICArK3ByaXZrZXlzOwogICAgICB9CiAgfQoK
ICBndWFyZC5jb21taXQoKTsKfQoKdm9pZCAKZGF0YWJhc2U6OmVuc3VyZV9vcGVuKCkKewog
IHNxbGl0ZSAqcyA9IHNxbCgpOwogIEkocyAhPSBOVUxMKTsKfQoKZGF0YWJhc2U6On5kYXRh
YmFzZSgpIAp7CiAgaWYgKF9fc3FsKQogICAgewogICAgICBzcWxpdGVfY2xvc2UoX19zcWwp
OwogICAgICBfX3NxbCA9IDA7CiAgICB9Cn0KCnN0YXRpYyB2b2lkIAphc3NlcnRfc3FsaXRl
X29rKGludCByZXMpCnsKICBzd2l0Y2ggKHJlcykKICAgIHsgICAgICAKICAgIGNhc2UgU1FM
SVRFX09LOiAKICAgICAgYnJlYWs7CgogICAgY2FzZSBTUUxJVEVfRVJST1I6CiAgICAgIHRo
cm93IG9vcHMoIlNRTCBlcnJvciBvciBtaXNzaW5nIGRhdGFiYXNlIik7CiAgICAgIGJyZWFr
OwoKICAgIGNhc2UgU1FMSVRFX0lOVEVSTkFMOgogICAgICB0aHJvdyBvb3BzKCJBbiBpbnRl
cm5hbCBsb2dpYyBlcnJvciBpbiBTUUxpdGUiKTsKICAgICAgYnJlYWs7CgogICAgY2FzZSBT
UUxJVEVfUEVSTToKICAgICAgdGhyb3cgb29wcygiQWNjZXNzIHBlcm1pc3Npb24gZGVuaWVk
Iik7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgU1FMSVRFX0FCT1JUOgogICAgICB0aHJvdyBv
b3BzKCJDYWxsYmFjayByb3V0aW5lIHJlcXVlc3RlZCBhbiBhYm9ydCIpOwogICAgICBicmVh
azsKCiAgICBjYXNlIFNRTElURV9CVVNZOgogICAgICB0aHJvdyBvb3BzKCJUaGUgZGF0YWJh
c2UgZmlsZSBpcyBsb2NrZWQiKTsKICAgICAgYnJlYWs7CgogICAgY2FzZSBTUUxJVEVfTE9D
S0VEOgogICAgICB0aHJvdyBvb3BzKCJBIHRhYmxlIGluIHRoZSBkYXRhYmFzZSBpcyBsb2Nr
ZWQiKTsKICAgICAgYnJlYWs7CgogICAgY2FzZSBTUUxJVEVfTk9NRU06CiAgICAgIHRocm93
IG9vcHMoIkEgbWFsbG9jKCkgZmFpbGVkIik7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgU1FM
SVRFX1JFQURPTkxZOgogICAgICB0aHJvdyBvb3BzKCJBdHRlbXB0IHRvIHdyaXRlIGEgcmVh
ZG9ubHkgZGF0YWJhc2UiKTsKICAgICAgYnJlYWs7CgogICAgY2FzZSBTUUxJVEVfSU5URVJS
VVBUOgogICAgICB0aHJvdyBvb3BzKCJPcGVyYXRpb24gdGVybWluYXRlZCBieSBzcWxpdGVf
aW50ZXJydXB0KCkiKTsKICAgICAgYnJlYWs7CgogICAgY2FzZSBTUUxJVEVfSU9FUlI6CiAg
ICAgIHRocm93IG9vcHMoIlNvbWUga2luZCBvZiBkaXNrIEkvTyBlcnJvciBvY2N1cnJlZCIp
OwogICAgICBicmVhazsKCiAgICBjYXNlIFNRTElURV9DT1JSVVBUOgogICAgICB0aHJvdyBv
b3BzKCJUaGUgZGF0YWJhc2UgZGlzayBpbWFnZSBpcyBtYWxmb3JtZWQiKTsKICAgICAgYnJl
YWs7CgogICAgY2FzZSBTUUxJVEVfTk9URk9VTkQ6CiAgICAgIHRocm93IG9vcHMoIihJbnRl
cm5hbCBPbmx5KSBUYWJsZSBvciByZWNvcmQgbm90IGZvdW5kIik7CiAgICAgIGJyZWFrOwoK
ICAgIGNhc2UgU1FMSVRFX0ZVTEw6CiAgICAgIHRocm93IG9vcHMoIkluc2VydGlvbiBmYWls
ZWQgYmVjYXVzZSBkYXRhYmFzZSBpcyBmdWxsIik7CiAgICAgIGJyZWFrOwoKICAgIGNhc2Ug
U1FMSVRFX0NBTlRPUEVOOgogICAgICB0aHJvdyBvb3BzKCJVbmFibGUgdG8gb3BlbiB0aGUg
ZGF0YWJhc2UgZmlsZSIpOwogICAgICBicmVhazsKCiAgICBjYXNlIFNRTElURV9QUk9UT0NP
TDoKICAgICAgdGhyb3cgb29wcygiZGF0YWJhc2UgbG9jayBwcm90b2NvbCBlcnJvciIpOwog
ICAgICBicmVhazsKCiAgICBjYXNlIFNRTElURV9FTVBUWToKICAgICAgdGhyb3cgb29wcygi
KEludGVybmFsIE9ubHkpIGRhdGFiYXNlIHRhYmxlIGlzIGVtcHR5Iik7CiAgICAgIGJyZWFr
OwoKICAgIGNhc2UgU1FMSVRFX1NDSEVNQToKICAgICAgdGhyb3cgb29wcygiVGhlIGRhdGFi
YXNlIHNjaGVtYSBjaGFuZ2VkIik7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgU1FMSVRFX1RP
T0JJRzoKICAgICAgdGhyb3cgb29wcygiVG9vIG11Y2ggZGF0YSBmb3Igb25lIHJvdyBvZiBh
IHRhYmxlIik7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgU1FMSVRFX0NPTlNUUkFJTlQ6CiAg
ICAgIHRocm93IG9vcHMoIkFib3J0IGR1ZSB0byBjb250cmFpbnQgdmlvbGF0aW9uIik7CiAg
ICAgIGJyZWFrOwoKICAgIGNhc2UgU1FMSVRFX01JU01BVENIOgogICAgICB0aHJvdyBvb3Bz
KCJEYXRhIHR5cGUgbWlzbWF0Y2giKTsKICAgICAgYnJlYWs7CgogICAgY2FzZSBTUUxJVEVf
TUlTVVNFOgogICAgICB0aHJvdyBvb3BzKCJMaWJyYXJ5IHVzZWQgaW5jb3JyZWN0bHkiKTsK
ICAgICAgYnJlYWs7CgogICAgZGVmYXVsdDoKICAgICAgdGhyb3cgb29wcyhzdHJpbmcoIlVu
a25vd24gREIgcmVzdWx0IGNvZGU6ICIpICsgbGV4aWNhbF9jYXN0PHN0cmluZz4ocmVzKSk7
CiAgICAgIGJyZWFrOwogICAgfQp9Cgp2b2lkIApkYXRhYmFzZTo6ZXhlY3V0ZShjaGFyIGNv
bnN0ICogcXVlcnksIC4uLikKewogIHZhX2xpc3QgYXA7CiAgaW50IHJlczsKICBjaGFyICog
ZXJybXNnID0gTlVMTDsKCiAgdmFfc3RhcnQoYXAsIHF1ZXJ5KTsKCiAgLy8gbG9nIGl0CiAg
Y2hhciAqIGZvcm1hdHRlZCA9IHNxbGl0ZV92bXByaW50ZihxdWVyeSwgYXApOwogIHN0cmlu
ZyBxcShmb3JtYXR0ZWQpOwogIGlmIChxcS5zaXplKCkgPiBjb25zdGFudHM6OmRiX2xvZ19s
aW5lX3N6KSAKICAgIHFxID0gcXEuc3Vic3RyKDAsIGNvbnN0YW50czo6ZGJfbG9nX2xpbmVf
c3opICsgc3RyaW5nKCIgLi4uIik7CiAgTChGKCJkYi5leGVjdXRlKFwiJXNcIilcbiIpICUg
cXEpOwogIHNxbGl0ZV9mcmVlbWVtKGZvcm1hdHRlZCk7CgogIHZhX2VuZChhcCk7CiAgdmFf
c3RhcnQoYXAsIHF1ZXJ5KTsKCiAgLy8gZG8gaXQKICByZXMgPSBzcWxpdGVfZXhlY192cHJp
bnRmKHNxbCgpLCBxdWVyeSwgTlVMTCwgTlVMTCwgJmVycm1zZywgYXApOwoKICB2YV9lbmQo
YXApOwoKICBpZiAoZXJybXNnKQogICAgdGhyb3cgb29wcyhzdHJpbmcoInNxbGl0ZSBleGVj
IGVycm9yICIpICsgZXJybXNnKTsKCiAgYXNzZXJ0X3NxbGl0ZV9vayhyZXMpOwoKfQoKdm9p
ZCAKZGF0YWJhc2U6OmZldGNoKHJlc3VsdHMgJiByZXMsIAogICAgICAgICAgICAgICAgaW50
IGNvbnN0IHdhbnRfY29scywgCiAgICAgICAgICAgICAgICBpbnQgY29uc3Qgd2FudF9yb3dz
LCAKICAgICAgICAgICAgICAgIGNoYXIgY29uc3QgKiBxdWVyeSwgLi4uKQp7CiAgY2hhciAq
KiByZXN1bHQgPSBOVUxMOwogIGludCBucm93OwogIGludCBuY29sOwogIGNoYXIgKiBlcnJt
c2cgPSBOVUxMOwogIGludCByZXNjb2RlOwoKICB2YV9saXN0IGFwOwogIHJlcy5jbGVhcigp
OwogIHJlcy5yZXNpemUoMCk7CiAgdmFfc3RhcnQoYXAsIHF1ZXJ5KTsKCiAgLy8gbG9nIGl0
CiAgY2hhciAqIGZvcm1hdHRlZCA9IHNxbGl0ZV92bXByaW50ZihxdWVyeSwgYXApOwogIHN0
cmluZyBxcShmb3JtYXR0ZWQpOwogIGlmIChxcS5zaXplKCkgPiBjb25zdGFudHM6OmxvZ19s
aW5lX3N6KSAKICAgIHFxID0gcXEuc3Vic3RyKDAsIGNvbnN0YW50czo6bG9nX2xpbmVfc3op
ICsgc3RyaW5nKCIgLi4uIik7CiAgTChGKCJkYi5mZXRjaChcIiVzXCIpXG4iKSAlIHFxKTsK
ICBzcWxpdGVfZnJlZW1lbShmb3JtYXR0ZWQpOwoKICB2YV9lbmQoYXApOwogIHZhX3N0YXJ0
KGFwLCBxdWVyeSk7CgogIC8vIGRvIGl0CiAgcmVzY29kZSA9IHNxbGl0ZV9nZXRfdGFibGVf
dnByaW50ZihzcWwoKSwgcXVlcnksICZyZXN1bHQsICZucm93LCAmbmNvbCwgJmVycm1zZywg
YXApOwoKICB2YV9lbmQoYXApOwoKICBjbGVhbnVwX3B0cjxjaGFyICoqLCB2b2lkPiAKICAg
IHJlc3VsdF9ndWFyZChyZXN1bHQsICZzcWxpdGVfZnJlZV90YWJsZSk7CgogIHN0cmluZyBj
dHggPSBzdHJpbmcoImRiIHF1ZXJ5IFsiKSArIHN0cmluZyhxdWVyeSkgKyAiXTogIjsKCiAg
aWYgKGVycm1zZykKICAgIHRocm93IG9vcHMoY3R4ICsgc3RyaW5nKCJzcWxpdGUgZXJyb3Ig
IikgKyBlcnJtc2cpOwogIGFzc2VydF9zcWxpdGVfb2socmVzY29kZSk7CgogIGlmICh3YW50
X2NvbHMgPT0gMCAmJiBuY29sID09IDApIHJldHVybjsKICBpZiAod2FudF9yb3dzID09IDAg
JiYgbnJvdyA9PSAwKSByZXR1cm47CiAgaWYgKHdhbnRfY29scyA9PSBhbnlfcm93cyAmJiBu
Y29sID09IDApIHJldHVybjsKICBpZiAod2FudF9yb3dzID09IGFueV9yb3dzICYmIG5yb3cg
PT0gMCkgcmV0dXJuOwoKICBpZiAod2FudF9jb2xzICE9IGFueV9jb2xzICYmCiAgICAgIG5j
b2wgIT0gd2FudF9jb2xzKQogICAgdGhyb3cgb29wcygoRigiJXMgd2FudGVkICVkIGNvbHVt
bnMsIGdvdCAlcyIpCiAgICAgICAgICAgICAgICAlIGN0eCAlIHdhbnRfY29scyAlIG5jb2wp
LnN0cigpKTsKCiAgaWYgKHdhbnRfcm93cyAhPSBhbnlfcm93cyAmJgogICAgICBucm93ICE9
IHdhbnRfcm93cykKICAgIHRocm93IG9vcHMoKEYoIiVzIHdhbnRlZCAlZCByb3dzLCBnb3Qg
JXMiKQogICAgICAgICAgICAgICAgJSBjdHggJSB3YW50X3Jvd3MgJSBucm93KS5zdHIoKSk7
CgogIGlmICghcmVzdWx0KQogICAgdGhyb3cgb29wcyhjdHggKyAibnVsbCByZXN1bHQgc2V0
Iik7CgogIGZvciAoaW50IGkgPSAwOyBpIDwgbmNvbDsgKytpKSAKICAgIGlmICghcmVzdWx0
W2ldKQogICAgICB0aHJvdyBvb3BzKGN0eCArICJudWxsIGNvbHVtbiBuYW1lIik7CgogIGZv
ciAoaW50IHJvdyA9IDA7IHJvdyA8IG5yb3c7ICsrcm93KSAKICAgIHsKICAgICAgdmVjdG9y
PHN0cmluZz4gcm93dmVjOwogICAgICBmb3IgKGludCBjb2wgPSAwOyBjb2wgPCBuY29sOyAr
K2NvbCkKICAgICAgICB7CiAgICAgICAgICBpbnQgaSA9ICgoMSArIHJvdykgKiBuY29sKSAr
IGNvbDsKICAgICAgICAgIGlmICghcmVzdWx0W2ldKQogICAgICAgICAgICB0aHJvdyBvb3Bz
KGN0eCArICJudWxsIHJlc3VsdCB2YWx1ZSIpOwogICAgICAgICAgZWxzZQogICAgICAgICAg
ICByb3d2ZWMucHVzaF9iYWNrKHJlc3VsdFtpXSk7CiAgICAgICAgfQogICAgICByZXMucHVz
aF9iYWNrKHJvd3ZlYyk7CiAgICB9Cn0KCi8vIGdlbmVyYWwgYXBwbGljYXRpb24tbGV2ZWwg
bG9naWMKCnZvaWQgCmRhdGFiYXNlOjpzZXRfZmlsZW5hbWUoZnM6OnBhdGggY29uc3QgJiBm
aWxlKQp7CiAgaWYgKF9fc3FsKQogICAgewogICAgICB0aHJvdyBvb3BzKCJjYW5ub3QgY2hh
bmdlIGZpbGVuYW1lIHRvICIgKyBmaWxlLnN0cmluZygpICsgIiB3aGlsZSBkYiBpcyBvcGVu
Iik7CiAgICB9CiAgZmlsZW5hbWUgPSBmaWxlOwp9Cgp2b2lkIApkYXRhYmFzZTo6YmVnaW5f
dHJhbnNhY3Rpb24oKSAKewogIGlmICh0cmFuc2FjdGlvbl9sZXZlbCA9PSAwKQogICAgICBl
eGVjdXRlKCJCRUdJTiIpOwogIHRyYW5zYWN0aW9uX2xldmVsKys7Cn0KCnZvaWQgCmRhdGFi
YXNlOjpjb21taXRfdHJhbnNhY3Rpb24oKQp7CiAgaWYgKHRyYW5zYWN0aW9uX2xldmVsID09
IDEpCiAgICBleGVjdXRlKCJDT01NSVQiKTsKICB0cmFuc2FjdGlvbl9sZXZlbC0tOwp9Cgp2
b2lkIApkYXRhYmFzZTo6cm9sbGJhY2tfdHJhbnNhY3Rpb24oKQp7CiAgaWYgKHRyYW5zYWN0
aW9uX2xldmVsID09IDEpCiAgICBleGVjdXRlKCJST0xMQkFDSyIpOwogIHRyYW5zYWN0aW9u
X2xldmVsLS07Cn0KCgpib29sIApkYXRhYmFzZTo6ZXhpc3RzKGhleGVuYzxpZD4gY29uc3Qg
JiBpZGVudCwKICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBjb25zdCAmIHRhYmxlKQp7
CiAgcmVzdWx0cyByZXM7CiAgZmV0Y2gocmVzLCBvbmVfY29sLCBhbnlfcm93cywgCiAgICAg
ICAgIlNFTEVDVCBpZCBGUk9NICclcScgV0hFUkUgaWQgPSAnJXEnIiwKICAgICAgICB0YWJs
ZS5jX3N0cigpLCBpZGVudCgpLmNfc3RyKCkpOwogIEkoKHJlcy5zaXplKCkgPT0gMSkgfHwg
KHJlcy5zaXplKCkgPT0gMCkpOwogIHJldHVybiByZXMuc2l6ZSgpID09IDE7Cn0KCgpib29s
IApkYXRhYmFzZTo6ZGVsdGFfZXhpc3RzKGhleGVuYzxpZD4gY29uc3QgJiBpZGVudCwKICAg
ICAgICAgICAgICAgICAgICAgICBzdHJpbmcgY29uc3QgJiB0YWJsZSkKewogIHJlc3VsdHMg
cmVzOwogIGZldGNoKHJlcywgb25lX2NvbCwgYW55X3Jvd3MsIAogICAgICAgICJTRUxFQ1Qg
aWQgRlJPTSAnJXEnIFdIRVJFIGlkID0gJyVxJyIsCiAgICAgICAgdGFibGUuY19zdHIoKSwg
aWRlbnQoKS5jX3N0cigpKTsKICByZXR1cm4gcmVzLnNpemUoKSA+IDA7Cn0KCmJvb2wgCmRh
dGFiYXNlOjpkZWx0YV9leGlzdHMoaGV4ZW5jPGlkPiBjb25zdCAmIGlkZW50LAogICAgICAg
ICAgICAgICAgICAgICAgIGhleGVuYzxpZD4gY29uc3QgJiBiYXNlLAogICAgICAgICAgICAg
ICAgICAgICAgIHN0cmluZyBjb25zdCAmIHRhYmxlKQp7CiAgcmVzdWx0cyByZXM7CiAgZmV0
Y2gocmVzLCBvbmVfY29sLCBhbnlfcm93cywgCiAgICAgICAgIlNFTEVDVCBpZCBGUk9NICcl
cScgV0hFUkUgaWQgPSAnJXEnIEFORCBiYXNlID0gJyVxJyIsCiAgICAgICAgdGFibGUuY19z
dHIoKSwgaWRlbnQoKS5jX3N0cigpLCBiYXNlKCkuY19zdHIoKSk7CiAgSSgocmVzLnNpemUo
KSA9PSAxKSB8fCAocmVzLnNpemUoKSA9PSAwKSk7CiAgcmV0dXJuIHJlcy5zaXplKCkgPT0g
MTsKfQoKaW50IApkYXRhYmFzZTo6Y291bnQoc3RyaW5nIGNvbnN0ICYgdGFibGUpCnsKICBy
ZXN1bHRzIHJlczsKICBmZXRjaChyZXMsIG9uZV9jb2wsIG9uZV9yb3csIAogICAgICAgICJT
RUxFQ1QgQ09VTlQoKikgRlJPTSAnJXEnIiwgCiAgICAgICAgdGFibGUuY19zdHIoKSk7CiAg
cmV0dXJuIGxleGljYWxfY2FzdDxpbnQ+KHJlc1swXVswXSk7ICAKfQoKdm9pZCAKZGF0YWJh
c2U6OmdldChoZXhlbmM8aWQ+IGNvbnN0ICYgaWRlbnQsCiAgICAgICAgICAgICAgYmFzZTY0
PCBnemlwPGRhdGE+ID4gJiBkYXQsCiAgICAgICAgICAgICAgc3RyaW5nIGNvbnN0ICYgdGFi
bGUpCnsKICByZXN1bHRzIHJlczsKICBmZXRjaChyZXMsIG9uZV9jb2wsIG9uZV9yb3csCiAg
ICAgICAgIlNFTEVDVCBkYXRhIEZST00gJyVxJyBXSEVSRSBpZCA9ICclcSciLCAKICAgICAg
ICB0YWJsZS5jX3N0cigpLCBpZGVudCgpLmNfc3RyKCkpOwoKICAvLyBjb25zaXN0ZW5jeSBj
aGVjawogIGJhc2U2NDxnemlwPGRhdGE+ID4gcmRhdGEocmVzWzBdWzBdKTsKICBoZXhlbmM8
aWQ+IHRpZDsKICBjYWxjdWxhdGVfaWRlbnQocmRhdGEsIHRpZCk7CiAgSSh0aWQgPT0gaWRl
bnQpOwoKICBkYXQgPSByZGF0YTsKfQoKdm9pZCAKZGF0YWJhc2U6OmdldF9kZWx0YShoZXhl
bmM8aWQ+IGNvbnN0ICYgaWRlbnQsCiAgICAgICAgICAgICAgICAgICAgaGV4ZW5jPGlkPiBj
b25zdCAmIGJhc2UsCiAgICAgICAgICAgICAgICAgICAgYmFzZTY0PCBnemlwPGRlbHRhPiA+
ICYgZGVsLAogICAgICAgICAgICAgICAgICAgIHN0cmluZyBjb25zdCAmIHRhYmxlKQp7CiAg
SShpZGVudCgpICE9ICIiKTsKICBJKGJhc2UoKSAhPSAiIik7CiAgcmVzdWx0cyByZXM7CiAg
ZmV0Y2gocmVzLCBvbmVfY29sLCBvbmVfcm93LAogICAgICAgICJTRUxFQ1QgZGVsdGEgRlJP
TSAnJXEnIFdIRVJFIGlkID0gJyVxJyBBTkQgYmFzZSA9ICclcSciLCAKICAgICAgICB0YWJs
ZS5jX3N0cigpLCBpZGVudCgpLmNfc3RyKCksIGJhc2UoKS5jX3N0cigpKTsKICBkZWwgPSBy
ZXNbMF1bMF07Cn0KCnZvaWQgCmRhdGFiYXNlOjpwdXQoaGV4ZW5jPGlkPiBjb25zdCAmIGlk
ZW50LAogICAgICAgICAgICAgIGJhc2U2NDwgZ3ppcDxkYXRhPiA+IGNvbnN0ICYgZGF0LAog
ICAgICAgICAgICAgIHN0cmluZyBjb25zdCAmIHRhYmxlKQp7CiAgLy8gY29uc2lzdGVuY3kg
Y2hlY2sKICBJKGlkZW50KCkgIT0gIiIpOwogIGhleGVuYzxpZD4gdGlkOwogIGNhbGN1bGF0
ZV9pZGVudChkYXQsIHRpZCk7CiAgSSh0aWQgPT0gaWRlbnQpOwogIAogIGV4ZWN1dGUoIklO
U0VSVCBJTlRPICclcScgVkFMVUVTKCclcScsICclcScpIiwgCiAgICAgICAgICB0YWJsZS5j
X3N0cigpLCBpZGVudCgpLmNfc3RyKCksIGRhdCgpLmNfc3RyKCkpOwp9CgoKdm9pZCAKZGF0
YWJhc2U6OnB1dF9kZWx0YShoZXhlbmM8aWQ+IGNvbnN0ICYgaWRlbnQsCiAgICAgICAgICAg
ICAgICAgICAgaGV4ZW5jPGlkPiBjb25zdCAmIGJhc2UsCiAgICAgICAgICAgICAgICAgICAg
YmFzZTY0PGd6aXA8ZGVsdGE+ID4gY29uc3QgJiBkZWwsCiAgICAgICAgICAgICAgICAgICAg
c3RyaW5nIGNvbnN0ICYgdGFibGUpCnsKICAvLyBuYjogZGVsdGEgc2NoZW1hIGlzIChpZCwg
YmFzZSwgZGVsdGEpCiAgSShpZGVudCgpICE9ICIiKTsKICBJKGJhc2UoKSAhPSAiIik7CiAg
ZXhlY3V0ZSgiSU5TRVJUIElOVE8gJyVxJyBWQUxVRVMoJyVxJywgJyVxJywgJyVxJykiLCAK
ICAgICAgICAgIHRhYmxlLmNfc3RyKCksIAogICAgICAgICAgaWRlbnQoKS5jX3N0cigpLCBi
YXNlKCkuY19zdHIoKSwgZGVsKCkuY19zdHIoKSk7Cn0KCnZvaWQgCmRhdGFiYXNlOjpnZXRf
dmVyc2lvbihoZXhlbmM8aWQ+IGNvbnN0ICYgaWRlbnQsCiAgICAgICAgICAgICAgICAgICAg
ICBiYXNlNjQ8IGd6aXA8ZGF0YT4gPiAmIGRhdCwKICAgICAgICAgICAgICAgICAgICAgIHN0
cmluZyBjb25zdCAmIGRhdGFfdGFibGUsCiAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcg
Y29uc3QgJiBkZWx0YV90YWJsZSkKewogIEkoaWRlbnQoKSAhPSAiIik7CiAgaWYgKGV4aXN0
cyhpZGVudCwgZGF0YV90YWJsZSkpCiAgICB7CiAgICAgIC8vIGVhc3kgcGF0aAogICAgICBn
ZXQoaWRlbnQsIGRhdCwgZGF0YV90YWJsZSk7CiAgICB9CiAgZWxzZQogICAgewogICAgICAv
LyB0cmlja3kgcGF0aAoKICAgICAgLy8gd2Ugc3RhcnQgZnJvbSB0aGUgZmlsZSB3ZSB3YW50
IHRvIHJlY29uc3RydWN0IGFuZCB3b3JrICpmb3J3YXJkcyoKICAgICAgLy8gdGhyb3VnaCB0
aGUgZGF0YWJhc2UsIHVudGlsIHdlIGdldCB0byBhIGZ1bGwgZGF0YSBvYmplY3QuIHdlIHRo
ZW4KICAgICAgLy8gdHJhY2UgYmFjayB0aHJvdWdoIHRoZSBsaXN0IG9mIGVkZ2VzIHdlIGZv
bGxvd2VkIHRvIGdldCB0byB0aGUgZGF0YQogICAgICAvLyBvYmplY3QsIGFwcGx5aW5nIHJl
dmVyc2UgZGVsdGFzLgogICAgICAvLwogICAgICAvLyB0aGUgZWZmZWN0IG9mIHRoaXMgYWxn
b3JpdGhtIGlzIGJyZWFkdGgtZmlyc3Qgc2VhcmNoLCBiYWNrd2FyZHMKICAgICAgLy8gdGhy
b3VnaCB0aGUgc3RvcmFnZSBncmFwaCwgdG8gZGlzY292ZXIgYSBmb3J3YXJkcyBzaG9ydGVz
dCBwYXRoLCBhbmQKICAgICAgLy8gdGhlbiBmb2xsb3dpbmcgdGhhdCBzaG9ydGVzdCBwYXRo
IHdpdGggZGVsdGEgYXBwbGljYXRpb24uCiAgICAgIC8vCiAgICAgIC8vIHdlIHVzZWQgdG8g
ZG8gdGhpcyB3aXRoIHRoZSBib29zdCBncmFwaCBsaWJyYXJ5LCBidXQgaXQgaW52b3ZsZWQK
ICAgICAgLy8gbG9hZGluZyB0b28gbXVjaCBvZiB0aGUgc3RvcmFnZSBncmFwaCBpbnRvIG1l
bW9yeSBhdCBhbnkgbW9tZW50LiB0aGlzCiAgICAgIC8vIGltcGVyYXRpdmUgdmVyc2lvbiBv
bmx5IGxvYWRzIHRoZSBkZXNjZW5kZW50cyBvZiB0aGUgcmVjb25zdHJ1Y3Rpb24KICAgICAg
Ly8gbm9kZSwgc28gaXQgbXVjaCBjaGVhcGVyIGluIHRlcm1zIG9mIG1lbW9yeS4KICAgICAg
Ly8KICAgICAgLy8gd2UgYWxzbyBtYWludGFpbiBhIGN5Y2xlLWRldGVjdGluZyBzZXQsIGp1
c3QgdG8gYmUgc2FmZQogICAgICAKICAgICAgTChGKCJyZWNvbnN0cnVjdGluZyAlcyBpbiAl
c1xuIikgJSBpZGVudCAlIGRlbHRhX3RhYmxlKTsKICAgICAgSShkZWx0YV9leGlzdHMoaWRl
bnQsIGRlbHRhX3RhYmxlKSk7CiAgICAgIAogICAgICAvLyBuYjogYW4gZWRnZSBtYXAgZ29l
cyBpbiB0aGUgZGlyZWN0aW9uIG9mIHRoZQogICAgICAvLyBkZWx0YSwgKm5vdCogdGhlIGRp
cmVjdGlvbiB3ZSBkaXNjb3ZlciB0aGluZ3MgaW4sCiAgICAgIC8vIGkuZS4gZWFjaCBtYXAg
aXMgb2YgdGhlIGZvcm0gW25ld2lkXSAtPiBbb2xkaWRdCgogICAgICB0eXBlZGVmIG1hcDwg
aGV4ZW5jPGlkPiwgaGV4ZW5jPGlkPiA+IGVkZ2VtYXA7CiAgICAgIGxpc3Q8IHNoYXJlZF9w
dHI8ZWRnZW1hcD4gPiBwYXRoczsKCiAgICAgIHNldDwgaGV4ZW5jPGlkPiA+IGZyb250aWVy
LCBjeWNsZXM7CiAgICAgIGZyb250aWVyLmluc2VydChpZGVudCk7CgogICAgICBib29sIGZv
dW5kX3Jvb3QgPSBmYWxzZTsKICAgICAgaGV4ZW5jPGlkPiByb290KCIiKTsKCiAgICAgIHdo
aWxlICghIGZvdW5kX3Jvb3QpCiAgICAgICAgewogICAgICAgICAgc2V0PCBoZXhlbmM8aWQ+
ID4gbmV4dF9mcm9udGllcjsKICAgICAgICAgIHNoYXJlZF9wdHI8ZWRnZW1hcD4gZnJvbnRp
ZXJfbWFwKG5ldyBlZGdlbWFwKCkpOwoKICAgICAgICAgIEkoIWZyb250aWVyLmVtcHR5KCkp
OwoKICAgICAgICAgIGZvciAoc2V0PCBoZXhlbmM8aWQ+ID46OmNvbnN0X2l0ZXJhdG9yIGkg
PSBmcm9udGllci5iZWdpbigpOwogICAgICAgICAgICAgICBpICE9IGZyb250aWVyLmVuZCgp
OyArK2kpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBpZiAoZXhpc3RzKCppLCBkYXRh
X3RhYmxlKSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgcm9vdCA9ICpp
OwogICAgICAgICAgICAgICAgICBmb3VuZF9yb290ID0gdHJ1ZTsKICAgICAgICAgICAgICAg
ICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZQogICAgICAg
ICAgICAgICAgewogICAgICAgICAgICAgICAgICBjeWNsZXMuaW5zZXJ0KCppKTsKICAgICAg
ICAgICAgICAgICAgcmVzdWx0cyByZXM7CiAgICAgICAgICAgICAgICAgIGZldGNoKHJlcywg
b25lX2NvbCwgYW55X3Jvd3MsICJTRUxFQ1QgYmFzZSBmcm9tICclcScgV0hFUkUgaWQgPSAn
JXEnIiwKICAgICAgICAgICAgICAgICAgICAgICAgZGVsdGFfdGFibGUuY19zdHIoKSwgKCpp
KSgpLmNfc3RyKCkpOwogICAgICAgICAgICAgICAgICBmb3IgKHNpemVfdCBrID0gMDsgayA8
IHJlcy5zaXplKCk7ICsraykKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAg
ICAgICAgICBoZXhlbmM8aWQ+IGNvbnN0IG54dChyZXNba11bMF0pOwoKICAgICAgICAgICAg
ICAgICAgICAgIGlmIChjeWNsZXMuZmluZChueHQpICE9IGN5Y2xlcy5lbmQoKSkKICAgICAg
ICAgICAgICAgICAgICAgICAgdGhyb3cgb29wcygiY3ljbGUgaW4gdGFibGUgJyIgKyBkZWx0
YV90YWJsZSArICInLCBhdCBub2RlICIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgKyAoKmkpKCkgKyAiIDwtICIgKyBueHQoKSk7CgogICAgICAgICAgICAgICAgICAg
ICAgbmV4dF9mcm9udGllci5pbnNlcnQobnh0KTsKCiAgICAgICAgICAgICAgICAgICAgICBp
ZiAoZnJvbnRpZXJfbWFwLT5maW5kKG54dCkgPT0gZnJvbnRpZXJfbWFwLT5lbmQoKSkKICAg
ICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgIEwoRigi
aW5zZXJ0aW5nIGVkZ2U6ICVzIDwtICVzXG4iKSAlICgqaSkgJSBueHQpOwogICAgICAgICAg
ICAgICAgICAgICAgICAgIGZyb250aWVyX21hcC0+aW5zZXJ0KG1ha2VfcGFpcihueHQsICpp
KSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGVs
c2UKICAgICAgICAgICAgICAgICAgICAgICAgTChGKCJza2lwcGluZyBtZXJnZSBlZGdlICVz
IDwtICVzXG4iKSAlICgqaSkgJSBueHQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg
ICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgaWYgKCFmb3VuZF9yb290KQog
ICAgICAgICAgICB7CiAgICAgICAgICAgICAgZnJvbnRpZXIgPSBuZXh0X2Zyb250aWVyOwog
ICAgICAgICAgICAgIHBhdGhzLnB1c2hfZnJvbnQoZnJvbnRpZXJfbWFwKTsKICAgICAgICAg
ICAgfQogICAgICAgIH0KCiAgICAgIC8vIHBhdGggYnVpbHQsIG5vdyBhbGwgd2UgbmVlZCB0
byBkbyBpcyBmb2xsb3cgaXQgYmFjawoKICAgICAgSShmb3VuZF9yb290KTsKICAgICAgSShy
b290KCkgIT0gIiIpOwogICAgICBiYXNlNjQ8IGd6aXA8ZGF0YT4gPiBiZWdpbl9wYWNrZWQ7
CiAgICAgIGRhdGEgYmVnaW47ICAgICAgCiAgICAgIGdldChyb290LCBiZWdpbl9wYWNrZWQs
IGRhdGFfdGFibGUpOwogICAgICB1bnBhY2soYmVnaW5fcGFja2VkLCBiZWdpbik7CiAgICAg
IGhleGVuYzxpZD4gY3VyciA9IHJvb3Q7CgogICAgICBib29zdDo6c2hhcmVkX3B0cjxkZWx0
YV9hcHBsaWNhdG9yPiBhcHAgPSBuZXdfcGllY2V3aXNlX2FwcGxpY2F0b3IoKTsKICAgICAg
YXBwLT5iZWdpbihiZWdpbigpKTsKICAgICAgCiAgICAgIGZvciAobGlzdDwgc2hhcmVkX3B0
cjxlZGdlbWFwPiA+Ojpjb25zdF9pdGVyYXRvciBwID0gcGF0aHMuYmVnaW4oKTsKICAgICAg
ICAgICBwICE9IHBhdGhzLmVuZCgpOyArK3ApCiAgICAgICAgewogICAgICAgICAgc2hhcmVk
X3B0cjxlZGdlbWFwPiBpID0gKnA7CiAgICAgICAgICBJKGktPmZpbmQoY3VycikgIT0gaS0+
ZW5kKCkpOwogICAgICAgICAgaGV4ZW5jPGlkPiBjb25zdCBueHQgPSBpLT5maW5kKGN1cnIp
LT5zZWNvbmQ7CgogICAgICAgICAgTChGKCJmb2xsb3dpbmcgZGVsdGEgJXMgLT4gJXNcbiIp
ICUgY3VyciAlIG54dCk7CiAgICAgICAgICBiYXNlNjQ8IGd6aXA8ZGVsdGE+ID4gZGVsX3Bh
Y2tlZDsKICAgICAgICAgIGdldF9kZWx0YShueHQsIGN1cnIsIGRlbF9wYWNrZWQsIGRlbHRh
X3RhYmxlKTsKICAgICAgICAgIGRlbHRhIGRlbDsKICAgICAgICAgIHVucGFjayhkZWxfcGFj
a2VkLCBkZWwpOwogICAgICAgICAgYXBwbHlfZGVsdGEgKGFwcCwgZGVsKCkpOwogICAgICAg
ICAgYXBwLT5uZXh0KCk7CiAgICAgICAgICBjdXJyID0gbnh0OwogICAgICAgIH0KCiAgICAg
IHN0cmluZyB0bXA7CiAgICAgIGFwcC0+ZmluaXNoKHRtcCk7CiAgICAgIGRhdGEgZW5kKHRt
cCk7CgogICAgICBoZXhlbmM8aWQ+IGZpbmFsOwogICAgICBjYWxjdWxhdGVfaWRlbnQoZW5k
LCBmaW5hbCk7CiAgICAgIEkoZmluYWwgPT0gaWRlbnQpOwogICAgICBwYWNrKGVuZCwgZGF0
KTsKICAgIH0KfQoKCnZvaWQgCmRhdGFiYXNlOjpkcm9wKGhleGVuYzxpZD4gY29uc3QgJiBp
ZGVudCwgCiAgICAgICAgICAgICAgIHN0cmluZyBjb25zdCAmIHRhYmxlKQp7CiAgZXhlY3V0
ZSgiREVMRVRFIEZST00gJyVxJyBXSEVSRSBpZCA9ICclcSciLCAgCiAgICAgICAgICB0YWJs
ZS5jX3N0cigpLAogICAgICAgICAgaWRlbnQoKS5jX3N0cigpKTsKfQoKdm9pZCAKZGF0YWJh
c2U6OnB1dF92ZXJzaW9uKGhleGVuYzxpZD4gY29uc3QgJiBvbGRfaWQsCiAgICAgICAgICAg
ICAgICAgICAgICBoZXhlbmM8aWQ+IGNvbnN0ICYgbmV3X2lkLAogICAgICAgICAgICAgICAg
ICAgICAgYmFzZTY0PCBnemlwPGRlbHRhPiA+IGNvbnN0ICYgZGVsLAogICAgICAgICAgICAg
ICAgICAgICAgc3RyaW5nIGNvbnN0ICYgZGF0YV90YWJsZSwKICAgICAgICAgICAgICAgICAg
ICAgIHN0cmluZyBjb25zdCAmIGRlbHRhX3RhYmxlKQp7CgogIGJhc2U2NDwgZ3ppcDxkYXRh
PiA+IG9sZF9kYXRhLCBuZXdfZGF0YTsKICBiYXNlNjQ8IGd6aXA8ZGVsdGE+ID4gcmV2ZXJz
ZV9kZWx0YTsKICAKICBnZXRfdmVyc2lvbihvbGRfaWQsIG9sZF9kYXRhLCBkYXRhX3RhYmxl
LCBkZWx0YV90YWJsZSk7CiAgcGF0Y2gob2xkX2RhdGEsIGRlbCwgbmV3X2RhdGEpOwogIGRp
ZmYobmV3X2RhdGEsIG9sZF9kYXRhLCByZXZlcnNlX2RlbHRhKTsKICAgICAgCiAgdHJhbnNh
Y3Rpb25fZ3VhcmQgZ3VhcmQoKnRoaXMpOwogIGlmIChleGlzdHMob2xkX2lkLCBkYXRhX3Rh
YmxlKSkKICAgIHsKICAgICAgLy8gZGVzY2VuZGVudCBvZiBhIGhlYWQgdmVyc2lvbiByZXBs
YWNlcyB0aGUgaGVhZCwgdGhlcmVmb3JlIG9sZCBoZWFkCiAgICAgIC8vIG11c3QgYmUgZGlz
cG9zZWQgb2YKICAgICAgZHJvcChvbGRfaWQsIGRhdGFfdGFibGUpOwogICAgfQogIHB1dChu
ZXdfaWQsIG5ld19kYXRhLCBkYXRhX3RhYmxlKTsKICBwdXRfZGVsdGEob2xkX2lkLCBuZXdf
aWQsIHJldmVyc2VfZGVsdGEsIGRlbHRhX3RhYmxlKTsKICBndWFyZC5jb21taXQoKTsKfQoK
dm9pZCAKZGF0YWJhc2U6OnB1dF9yZXZlcnNlX3ZlcnNpb24oaGV4ZW5jPGlkPiBjb25zdCAm
IG5ld19pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGV4ZW5jPGlkPiBjb25z
dCAmIG9sZF9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFzZTY0PCBnemlw
PGRlbHRhPiA+IGNvbnN0ICYgcmV2ZXJzZV9kZWwsCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHN0cmluZyBjb25zdCAmIGRhdGFfdGFibGUsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHN0cmluZyBjb25zdCAmIGRlbHRhX3RhYmxlKQp7CiAgYmFzZTY0PCBnemlw
PGRhdGE+ID4gb2xkX2RhdGEsIG5ld19kYXRhOwogIAogIGdldF92ZXJzaW9uKG5ld19pZCwg
bmV3X2RhdGEsIGRhdGFfdGFibGUsIGRlbHRhX3RhYmxlKTsKICBwYXRjaChuZXdfZGF0YSwg
cmV2ZXJzZV9kZWwsIG9sZF9kYXRhKTsKICBoZXhlbmM8aWQ+IGNoZWNrOwogIGNhbGN1bGF0
ZV9pZGVudChvbGRfZGF0YSwgY2hlY2spOwogIEkob2xkX2lkID09IGNoZWNrKTsKICAgICAg
CiAgdHJhbnNhY3Rpb25fZ3VhcmQgZ3VhcmQoKnRoaXMpOwogIHB1dF9kZWx0YShvbGRfaWQs
IG5ld19pZCwgcmV2ZXJzZV9kZWwsIGRlbHRhX3RhYmxlKTsKICBndWFyZC5jb21taXQoKTsK
fQoKCgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0KLy8gLS0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIC0tCi8vIC0tICAgICAgICAgICAgICBwdWJsaWMgaW50
ZXJmYWNlIGZvbGxvd3MgICAgICAgICAgICAgICAgICAtLQovLyAtLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0KLy8gLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
Cgpib29sIApkYXRhYmFzZTo6ZmlsZV92ZXJzaW9uX2V4aXN0cyhmaWxlX2lkIGNvbnN0ICYg
aWQpCnsKICByZXR1cm4gZGVsdGFfZXhpc3RzKGlkLmlubmVyKCksICJmaWxlX2RlbHRhcyIp
IAogICAgfHwgZXhpc3RzKGlkLmlubmVyKCksICJmaWxlcyIpOwp9Cgpib29sIApkYXRhYmFz
ZTo6bWFuaWZlc3RfdmVyc2lvbl9leGlzdHMobWFuaWZlc3RfaWQgY29uc3QgJiBpZCkKewog
IHJldHVybiBkZWx0YV9leGlzdHMoaWQuaW5uZXIoKSwgIm1hbmlmZXN0X2RlbHRhcyIpIAog
ICAgfHwgZXhpc3RzKGlkLmlubmVyKCksICJtYW5pZmVzdHMiKTsKfQoKYm9vbCAKZGF0YWJh
c2U6OnJldmlzaW9uX2V4aXN0cyhyZXZpc2lvbl9pZCBjb25zdCAmIGlkKQp7CiAgcmV0dXJu
IGV4aXN0cyhpZC5pbm5lcigpLCAicmV2aXNpb25zIik7Cn0KCgp2b2lkIApkYXRhYmFzZTo6
Z2V0X2ZpbGVfdmVyc2lvbihmaWxlX2lkIGNvbnN0ICYgaWQsCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGZpbGVfZGF0YSAmIGRhdCkKewogIGJhc2U2NDwgZ3ppcDxkYXRhPiA+IHRt
cDsKICBnZXRfdmVyc2lvbihpZC5pbm5lcigpLCB0bXAsICJmaWxlcyIsICJmaWxlX2RlbHRh
cyIpOwogIGRhdCA9IHRtcDsKfQoKdm9pZCAKZGF0YWJhc2U6OmdldF9tYW5pZmVzdF92ZXJz
aW9uKG1hbmlmZXN0X2lkIGNvbnN0ICYgaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBtYW5pZmVzdF9kYXRhICYgZGF0KQp7CiAgYmFzZTY0PCBnemlwPGRhdGE+ID4gdG1w
OwogIGdldF92ZXJzaW9uKGlkLmlubmVyKCksIHRtcCwgIm1hbmlmZXN0cyIsICJtYW5pZmVz
dF9kZWx0YXMiKTsKICBkYXQgPSB0bXA7Cn0KCnZvaWQgCmRhdGFiYXNlOjpnZXRfbWFuaWZl
c3QobWFuaWZlc3RfaWQgY29uc3QgJiBpZCwKICAgICAgICAgICAgICAgICAgICAgICBtYW5p
ZmVzdF9tYXAgJiBtbSkKewogIG1hbmlmZXN0X2RhdGEgbWRhdDsKICBnZXRfbWFuaWZlc3Rf
dmVyc2lvbihpZCwgbWRhdCk7CiAgcmVhZF9tYW5pZmVzdF9tYXAobWRhdCwgbW0pOwp9CgoK
dm9pZCAKZGF0YWJhc2U6OnB1dF9maWxlKGZpbGVfaWQgY29uc3QgJiBpZCwKICAgICAgICAg
ICAgICAgICAgIGZpbGVfZGF0YSBjb25zdCAmIGRhdCkKewogIHB1dChpZC5pbm5lcigpLCBk
YXQuaW5uZXIoKSwgImZpbGVzIik7Cn0KCnZvaWQgCmRhdGFiYXNlOjpwdXRfZmlsZV92ZXJz
aW9uKGZpbGVfaWQgY29uc3QgJiBvbGRfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAg
IGZpbGVfaWQgY29uc3QgJiBuZXdfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGZp
bGVfZGVsdGEgY29uc3QgJiBkZWwpCnsKICBwdXRfdmVyc2lvbihvbGRfaWQuaW5uZXIoKSwg
bmV3X2lkLmlubmVyKCksIGRlbC5pbm5lcigpLCAKICAgICAgICAgICAgICAiZmlsZXMiLCAi
ZmlsZV9kZWx0YXMiKTsKfQoKdm9pZCAKZGF0YWJhc2U6OnB1dF9maWxlX3JldmVyc2VfdmVy
c2lvbihmaWxlX2lkIGNvbnN0ICYgbmV3X2lkLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGZpbGVfaWQgY29uc3QgJiBvbGRfaWQsICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9k
ZWx0YSBjb25zdCAmIGRlbCkKewogIHB1dF9yZXZlcnNlX3ZlcnNpb24obmV3X2lkLmlubmVy
KCksIG9sZF9pZC5pbm5lcigpLCBkZWwuaW5uZXIoKSwgCiAgICAgICAgICAgICAgICAgICAg
ICAiZmlsZXMiLCAiZmlsZV9kZWx0YXMiKTsKfQoKCnZvaWQgCmRhdGFiYXNlOjpwdXRfbWFu
aWZlc3QobWFuaWZlc3RfaWQgY29uc3QgJiBpZCwKICAgICAgICAgICAgICAgICAgICAgICBt
YW5pZmVzdF9kYXRhIGNvbnN0ICYgZGF0KQp7CiAgcHV0KGlkLmlubmVyKCksIGRhdC5pbm5l
cigpLCAibWFuaWZlc3RzIik7Cn0KCnZvaWQgCmRhdGFiYXNlOjpwdXRfbWFuaWZlc3RfdmVy
c2lvbihtYW5pZmVzdF9pZCBjb25zdCAmIG9sZF9pZCwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIG1hbmlmZXN0X2lkIGNvbnN0ICYgbmV3X2lkLAogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgbWFuaWZlc3RfZGVsdGEgY29uc3QgJiBkZWwpCnsKICBwdXRfdmVy
c2lvbihvbGRfaWQuaW5uZXIoKSwgbmV3X2lkLmlubmVyKCksIGRlbC5pbm5lcigpLCAKICAg
ICAgICAgICAgICAibWFuaWZlc3RzIiwgIm1hbmlmZXN0X2RlbHRhcyIpOwp9Cgp2b2lkIApk
YXRhYmFzZTo6cHV0X21hbmlmZXN0X3JldmVyc2VfdmVyc2lvbihtYW5pZmVzdF9pZCBjb25z
dCAmIG5ld19pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFu
aWZlc3RfaWQgY29uc3QgJiBvbGRfaWQsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hbmlmZXN0X2Rl
bHRhIGNvbnN0ICYgZGVsKQp7CiAgcHV0X3JldmVyc2VfdmVyc2lvbihuZXdfaWQuaW5uZXIo
KSwgb2xkX2lkLmlubmVyKCksIGRlbC5pbm5lcigpLCAKICAgICAgICAgICAgICAgICAgICAg
ICJtYW5pZmVzdHMiLCAibWFuaWZlc3RfZGVsdGFzIik7Cn0KCgp2b2lkIApkYXRhYmFzZTo6
Z2V0X3JldmlzaW9uX2FuY2VzdHJ5KHN0ZDo6c2V0PHN0ZDo6cGFpcjxyZXZpc2lvbl9pZCwg
cmV2aXNpb25faWQ+ID4gJiBncmFwaCkKewogIHJlc3VsdHMgcmVzOwogIGdyYXBoLmNsZWFy
KCk7CiAgZmV0Y2gocmVzLCAyLCBhbnlfcm93cywgCiAgICAgICAgIlNFTEVDVCBwYXJlbnQs
Y2hpbGQgRlJPTSByZXZpc2lvbl9hbmNlc3RyeSIpOwogIGZvciAoc2l6ZV90IGkgPSAwOyBp
IDwgcmVzLnNpemUoKTsgKytpKQogICAgZ3JhcGguaW5zZXJ0KHN0ZDo6bWFrZV9wYWlyKHJl
dmlzaW9uX2lkKHJlc1tpXVswXSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
cmV2aXNpb25faWQocmVzW2ldWzFdKSkpOwp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X3Jldmlz
aW9uX3BhcmVudHMocmV2aXNpb25faWQgY29uc3QgJiBpZCwKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgc2V0PHJldmlzaW9uX2lkPiAmIHBhcmVudHMpCnsKICByZXN1bHRzIHJl
czsKICBwYXJlbnRzLmNsZWFyKCk7CiAgZmV0Y2gocmVzLCBvbmVfY29sLCBhbnlfcm93cywg
CiAgICAgICAgIlNFTEVDVCBwYXJlbnQgRlJPTSByZXZpc2lvbl9hbmNlc3RyeSBXSEVSRSBj
aGlsZCA9ICclcSciLAogICAgICAgIGlkLmlubmVyKCkoKS5jX3N0cigpKTsKICBmb3IgKHNp
emVfdCBpID0gMDsgaSA8IHJlcy5zaXplKCk7ICsraSkKICAgIHBhcmVudHMuaW5zZXJ0KHJl
dmlzaW9uX2lkKHJlc1tpXVswXSkpOwp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X3JldmlzaW9u
X2NoaWxkcmVuKHJldmlzaW9uX2lkIGNvbnN0ICYgaWQsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgc2V0PHJldmlzaW9uX2lkPiAmIGNoaWxkcmVuKQp7CiAgcmVzdWx0cyBy
ZXM7CiAgY2hpbGRyZW4uY2xlYXIoKTsKICBmZXRjaChyZXMsIG9uZV9jb2wsIGFueV9yb3dz
LCAKICAgICAgICAiU0VMRUNUIGNoaWxkIEZST00gcmV2aXNpb25fYW5jZXN0cnkgV0hFUkUg
cGFyZW50ID0gJyVxJyIsCiAgICAgICAgaWQuaW5uZXIoKSgpLmNfc3RyKCkpOwogIGZvciAo
c2l6ZV90IGkgPSAwOyBpIDwgcmVzLnNpemUoKTsgKytpKQogICAgY2hpbGRyZW4uaW5zZXJ0
KHJldmlzaW9uX2lkKHJlc1tpXVswXSkpOwp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X3Jldmlz
aW9uX21hbmlmZXN0KHJldmlzaW9uX2lkIGNvbnN0ICYgcmlkLAogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgbWFuaWZlc3RfaWQgJiBtaWQpCnsKICByZXZpc2lvbl9zZXQgcmV2
OwogIGdldF9yZXZpc2lvbihyaWQsIHJldik7CiAgbWlkID0gcmV2Lm5ld19tYW5pZmVzdDsK
fQoKdm9pZCAKZGF0YWJhc2U6OmdldF9yZXZpc2lvbihyZXZpc2lvbl9pZCBjb25zdCAmIGlk
LAogICAgICAgICAgICAgICAgICAgICAgIHJldmlzaW9uX3NldCAmIHJldikKewogIHJldmlz
aW9uX2RhdGEgZDsKICBnZXRfcmV2aXNpb24oaWQsIGQpOwogIHJlYWRfcmV2aXNpb25fc2V0
KGQsIHJldik7Cn0KCnZvaWQgCmRhdGFiYXNlOjpnZXRfcmV2aXNpb24ocmV2aXNpb25faWQg
Y29uc3QgJiBpZCwKICAgICAgICAgICAgICAgICAgICAgICByZXZpc2lvbl9kYXRhICYgZGF0
KQp7CiAgcmVzdWx0cyByZXM7CiAgZmV0Y2gocmVzLCBvbmVfY29sLCBvbmVfcm93LCAKICAg
ICAgICAiU0VMRUNUIGRhdGEgRlJPTSByZXZpc2lvbnMgV0hFUkUgaWQgPSAnJXEnIiwKICAg
ICAgICBpZC5pbm5lcigpKCkuY19zdHIoKSk7CgogIGRhdCA9IHJldmlzaW9uX2RhdGEocmVz
WzBdWzBdKTsKCiAgLy8gdmVyaWZ5IHRoYXQgd2UgZ290IGEgcmV2aXNpb24gd2l0aCB0aGUg
cmlnaHQgaWQKICB7CiAgICByZXZpc2lvbl9pZCB0bXA7CiAgICBjYWxjdWxhdGVfaWRlbnQo
ZGF0LCB0bXApOwogICAgSShpZCA9PSB0bXApOwogIH0KfQoKdm9pZCAKZGF0YWJhc2U6OnB1
dF9yZXZpc2lvbihyZXZpc2lvbl9pZCBjb25zdCAmIG5ld19pZCwKICAgICAgICAgICAgICAg
ICAgICAgICByZXZpc2lvbl9zZXQgY29uc3QgJiByZXYpCnsKCiAgSSghcmV2aXNpb25fZXhp
c3RzKG5ld19pZCkpOwogIHJldmlzaW9uX2RhdGEgZDsKCiAgd3JpdGVfcmV2aXNpb25fc2V0
KHJldiwgZCk7CiAgcmV2aXNpb25faWQgdG1wOwogIGNhbGN1bGF0ZV9pZGVudChkLCB0bXAp
OwogIEkodG1wID09IG5ld19pZCk7CgogIHRyYW5zYWN0aW9uX2d1YXJkIGd1YXJkKCp0aGlz
KTsKCiAgZXhlY3V0ZSgiSU5TRVJUIElOVE8gcmV2aXNpb25zIFZBTFVFUygnJXEnLCAnJXEn
KSIsIAogICAgICAgICAgbmV3X2lkLmlubmVyKCkoKS5jX3N0cigpLCAKICAgICAgICAgIGQu
aW5uZXIoKSgpLmNfc3RyKCkpOwoKICBmb3IgKGVkZ2VfbWFwOjpjb25zdF9pdGVyYXRvciBl
ID0gcmV2LmVkZ2VzLmJlZ2luKCk7CiAgICAgICBlICE9IHJldi5lZGdlcy5lbmQoKTsgKytl
KQogICAgewogICAgICBleGVjdXRlKCJJTlNFUlQgSU5UTyByZXZpc2lvbl9hbmNlc3RyeSBW
QUxVRVMoJyVxJywgJyVxJykiLCAKICAgICAgICAgICAgICBlZGdlX29sZF9yZXZpc2lvbihl
KS5pbm5lcigpKCkuY19zdHIoKSwKICAgICAgICAgICAgICBuZXdfaWQuaW5uZXIoKSgpLmNf
c3RyKCkpOwogICAgfQoKICBndWFyZC5jb21taXQoKTsKfQoKdm9pZCAKZGF0YWJhc2U6OnB1
dF9yZXZpc2lvbihyZXZpc2lvbl9pZCBjb25zdCAmIG5ld19pZCwKICAgICAgICAgICAgICAg
ICAgICAgICByZXZpc2lvbl9kYXRhIGNvbnN0ICYgZGF0KQp7CiAgcmV2aXNpb25fc2V0IHJl
djsKICByZWFkX3JldmlzaW9uX3NldChkYXQsIHJldik7CiAgcHV0X3JldmlzaW9uKG5ld19p
ZCwgcmV2KTsKfQoKCi8vIGNyeXB0byBrZXkgbWFuYWdlbWVudAoKdm9pZCAKZGF0YWJhc2U6
OmdldF9rZXlfaWRzKHN0cmluZyBjb25zdCAmIHBhdHRlcm4sCiAgICAgICAgICAgICAgICAg
ICAgICB2ZWN0b3I8cnNhX2tleXBhaXJfaWQ+ICYgcHVia2V5cywKICAgICAgICAgICAgICAg
ICAgICAgIHZlY3Rvcjxyc2Ffa2V5cGFpcl9pZD4gJiBwcml2a2V5cykKewogIHB1YmtleXMu
Y2xlYXIoKTsKICBwcml2a2V5cy5jbGVhcigpOwogIHJlc3VsdHMgcmVzOwoKICBpZiAocGF0
dGVybiAhPSAiIikKICAgIGZldGNoKHJlcywgb25lX2NvbCwgYW55X3Jvd3MsIAogICAgICAg
ICAgIlNFTEVDVCBpZCBmcm9tIHB1YmxpY19rZXlzIFdIRVJFIGlkIEdMT0IgJyVxJyIsCiAg
ICAgICAgICBwYXR0ZXJuLmNfc3RyKCkpOwogIGVsc2UKICAgIGZldGNoKHJlcywgb25lX2Nv
bCwgYW55X3Jvd3MsIAogICAgICAgICAgIlNFTEVDVCBpZCBmcm9tIHB1YmxpY19rZXlzIik7
CgogIGZvciAoc2l6ZV90IGkgPSAwOyBpIDwgcmVzLnNpemUoKTsgKytpKQogICAgcHVia2V5
cy5wdXNoX2JhY2socmVzW2ldWzBdKTsKCiAgaWYgKHBhdHRlcm4gIT0gIiIpCiAgICBmZXRj
aChyZXMsIG9uZV9jb2wsIGFueV9yb3dzLCAKICAgICAgICAgICJTRUxFQ1QgaWQgZnJvbSBw
cml2YXRlX2tleXMgV0hFUkUgaWQgR0xPQiAnJXEnIiwKICAgICAgICAgIHBhdHRlcm4uY19z
dHIoKSk7CiAgZWxzZQogICAgZmV0Y2gocmVzLCBvbmVfY29sLCBhbnlfcm93cywgCiAgICAg
ICAgICAiU0VMRUNUIGlkIGZyb20gcHJpdmF0ZV9rZXlzIik7CgogIGZvciAoc2l6ZV90IGkg
PSAwOyBpIDwgcmVzLnNpemUoKTsgKytpKQogICAgcHJpdmtleXMucHVzaF9iYWNrKHJlc1tp
XVswXSk7Cn0KCnZvaWQgCmRhdGFiYXNlOjpnZXRfcHJpdmF0ZV9rZXlzKHZlY3Rvcjxyc2Ff
a2V5cGFpcl9pZD4gJiBwcml2a2V5cykKewogIHByaXZrZXlzLmNsZWFyKCk7CiAgcmVzdWx0
cyByZXM7CiAgZmV0Y2gocmVzLCBvbmVfY29sLCBhbnlfcm93cywgICJTRUxFQ1QgaWQgZnJv
bSBwcml2YXRlX2tleXMiKTsKICBmb3IgKHNpemVfdCBpID0gMDsgaSA8IHJlcy5zaXplKCk7
ICsraSkKICAgIHByaXZrZXlzLnB1c2hfYmFjayhyZXNbaV1bMF0pOwp9Cgpib29sIApkYXRh
YmFzZTo6cHVibGljX2tleV9leGlzdHMoaGV4ZW5jPGlkPiBjb25zdCAmIGhhc2gpCnsKICBy
ZXN1bHRzIHJlczsKICBmZXRjaChyZXMsIG9uZV9jb2wsIGFueV9yb3dzLCAKICAgICAgICAi
U0VMRUNUIGlkIEZST00gcHVibGljX2tleXMgV0hFUkUgaGFzaCA9ICclcSciLAogICAgICAg
IGhhc2goKS5jX3N0cigpKTsKICBJKChyZXMuc2l6ZSgpID09IDEpIHx8IChyZXMuc2l6ZSgp
ID09IDApKTsKICBpZiAocmVzLnNpemUoKSA9PSAxKSAKICAgIHJldHVybiB0cnVlOwogIHJl
dHVybiBmYWxzZTsKfQoKYm9vbCAKZGF0YWJhc2U6OnB1YmxpY19rZXlfZXhpc3RzKHJzYV9r
ZXlwYWlyX2lkIGNvbnN0ICYgaWQpCnsKICByZXN1bHRzIHJlczsKICBmZXRjaChyZXMsIG9u
ZV9jb2wsIGFueV9yb3dzLCAKICAgICAgICAiU0VMRUNUIGlkIEZST00gcHVibGljX2tleXMg
V0hFUkUgaWQgPSAnJXEnIiwKICAgICAgICBpZCgpLmNfc3RyKCkpOwogIEkoKHJlcy5zaXpl
KCkgPT0gMSkgfHwgKHJlcy5zaXplKCkgPT0gMCkpOwogIGlmIChyZXMuc2l6ZSgpID09IDEp
IAogICAgcmV0dXJuIHRydWU7CiAgcmV0dXJuIGZhbHNlOwp9Cgpib29sIApkYXRhYmFzZTo6
cHJpdmF0ZV9rZXlfZXhpc3RzKHJzYV9rZXlwYWlyX2lkIGNvbnN0ICYgaWQpCnsKICByZXN1
bHRzIHJlczsKICBmZXRjaChyZXMsIG9uZV9jb2wsIGFueV9yb3dzLAogICAgICAgICJTRUxF
Q1QgaWQgRlJPTSBwcml2YXRlX2tleXMgV0hFUkUgaWQgPSAnJXEnIiwKICAgICAgICBpZCgp
LmNfc3RyKCkpOwogIEkoKHJlcy5zaXplKCkgPT0gMSkgfHwgKHJlcy5zaXplKCkgPT0gMCkp
OwogIGlmIChyZXMuc2l6ZSgpID09IDEpCiAgICByZXR1cm4gdHJ1ZTsKICByZXR1cm4gZmFs
c2U7Cn0KCmJvb2wgCmRhdGFiYXNlOjprZXlfZXhpc3RzKHJzYV9rZXlwYWlyX2lkIGNvbnN0
ICYgaWQpCnsKICByZXR1cm4gcHVibGljX2tleV9leGlzdHMoaWQpIHx8IHByaXZhdGVfa2V5
X2V4aXN0cyhpZCk7Cn0KCnZvaWQgCmRhdGFiYXNlOjpnZXRfcHVia2V5KGhleGVuYzxpZD4g
Y29uc3QgJiBoYXNoLCAKICAgICAgICAgICAgICAgICAgICAgcnNhX2tleXBhaXJfaWQgJiBp
ZCwKICAgICAgICAgICAgICAgICAgICAgYmFzZTY0PHJzYV9wdWJfa2V5PiAmIHB1Yl9lbmNv
ZGVkKQp7CiAgcmVzdWx0cyByZXM7CiAgZmV0Y2gocmVzLCAyLCBvbmVfcm93LCAKICAgICAg
ICAiU0VMRUNUIGlkLCBrZXlkYXRhIEZST00gcHVibGljX2tleXMgd2hlcmUgaGFzaCA9ICcl
cSciLCAKICAgICAgICBoYXNoKCkuY19zdHIoKSk7CiAgaWQgPSByZXNbMF1bMF07CiAgcHVi
X2VuY29kZWQgPSByZXNbMF1bMV07Cn0KCnZvaWQgCmRhdGFiYXNlOjpnZXRfa2V5KHJzYV9r
ZXlwYWlyX2lkIGNvbnN0ICYgcHViX2lkLCAKICAgICAgICAgICAgICAgICAgYmFzZTY0PHJz
YV9wdWJfa2V5PiAmIHB1Yl9lbmNvZGVkKQp7CiAgcmVzdWx0cyByZXM7CiAgZmV0Y2gocmVz
LCBvbmVfY29sLCBvbmVfcm93LCAKICAgICAgICAiU0VMRUNUIGtleWRhdGEgRlJPTSBwdWJs
aWNfa2V5cyB3aGVyZSBpZCA9ICclcSciLCAKICAgICAgICBwdWJfaWQoKS5jX3N0cigpKTsK
ICBwdWJfZW5jb2RlZCA9IHJlc1swXVswXTsKfQoKdm9pZCAKZGF0YWJhc2U6OmdldF9rZXko
cnNhX2tleXBhaXJfaWQgY29uc3QgJiBwcml2X2lkLCAKICAgICAgICAgICAgICAgICAgYmFz
ZTY0PCBhcmM0PHJzYV9wcml2X2tleT4gPiAmIHByaXZfZW5jb2RlZCkKewogIHJlc3VsdHMg
cmVzOwogIGZldGNoKHJlcywgb25lX2NvbCwgb25lX2NvbCwgCiAgICAgICAgIlNFTEVDVCBr
ZXlkYXRhIEZST00gcHJpdmF0ZV9rZXlzIHdoZXJlIGlkID0gJyVxJyIsIAogICAgICAgIHBy
aXZfaWQoKS5jX3N0cigpKTsKICBwcml2X2VuY29kZWQgPSByZXNbMF1bMF07Cn0KCgp2b2lk
IApkYXRhYmFzZTo6cHV0X2tleShyc2Ffa2V5cGFpcl9pZCBjb25zdCAmIHB1Yl9pZCwgCiAg
ICAgICAgICAgICAgICAgIGJhc2U2NDxyc2FfcHViX2tleT4gY29uc3QgJiBwdWJfZW5jb2Rl
ZCkKewogIGhleGVuYzxpZD4gdGhhc2g7CiAga2V5X2hhc2hfY29kZShwdWJfaWQsIHB1Yl9l
bmNvZGVkLCB0aGFzaCk7CiAgZXhlY3V0ZSgiSU5TRVJUIElOVE8gcHVibGljX2tleXMgVkFM
VUVTKCclcScsICclcScsICclcScpIiwgCiAgICAgICAgICB0aGFzaCgpLmNfc3RyKCksIHB1
Yl9pZCgpLmNfc3RyKCksIHB1Yl9lbmNvZGVkKCkuY19zdHIoKSk7Cn0KCnZvaWQgCmRhdGFi
YXNlOjpwdXRfa2V5KHJzYV9rZXlwYWlyX2lkIGNvbnN0ICYgcHJpdl9pZCwgCiAgICAgICAg
ICAgICAgICAgIGJhc2U2NDwgYXJjNDxyc2FfcHJpdl9rZXk+ID4gY29uc3QgJiBwcml2X2Vu
Y29kZWQpCnsKICAKICBoZXhlbmM8aWQ+IHRoYXNoOwogIGtleV9oYXNoX2NvZGUocHJpdl9p
ZCwgcHJpdl9lbmNvZGVkLCB0aGFzaCk7CiAgZXhlY3V0ZSgiSU5TRVJUIElOVE8gcHJpdmF0
ZV9rZXlzIFZBTFVFUygnJXEnLCAnJXEnLCAnJXEnKSIsIAogICAgICAgICAgdGhhc2goKS5j
X3N0cigpLCBwcml2X2lkKCkuY19zdHIoKSwgcHJpdl9lbmNvZGVkKCkuY19zdHIoKSk7Cn0K
CnZvaWQgCmRhdGFiYXNlOjpwdXRfa2V5X3BhaXIocnNhX2tleXBhaXJfaWQgY29uc3QgJiBp
ZCwgCiAgICAgICAgICAgICAgICAgICAgICAgYmFzZTY0PHJzYV9wdWJfa2V5PiBjb25zdCAm
IHB1Yl9lbmNvZGVkLAogICAgICAgICAgICAgICAgICAgICAgIGJhc2U2NDwgYXJjNDxyc2Ff
cHJpdl9rZXk+ID4gY29uc3QgJiBwcml2X2VuY29kZWQpCnsKICB0cmFuc2FjdGlvbl9ndWFy
ZCBndWFyZCgqdGhpcyk7CiAgcHV0X2tleShpZCwgcHViX2VuY29kZWQpOwogIHB1dF9rZXko
aWQsIHByaXZfZW5jb2RlZCk7CiAgZ3VhcmQuY29tbWl0KCk7Cn0KCgovLyBjZXJ0IG1hbmFn
ZW1lbnQKCmJvb2wgCmRhdGFiYXNlOjpjZXJ0X2V4aXN0cyhjZXJ0IGNvbnN0ICYgdCwKICAg
ICAgICAgICAgICAgICAgICAgIHN0cmluZyBjb25zdCAmIHRhYmxlKQp7CiAgcmVzdWx0cyBy
ZXM7CiAgZmV0Y2gocmVzLCAxLCBhbnlfcm93cywKICAgICAgICAiU0VMRUNUIGlkIEZST00g
JyVxJyBXSEVSRSBpZCA9ICclcScgIgogICAgICAgICJBTkQgbmFtZSA9ICclcScgQU5EIHZh
bHVlID0gJyVxJyAiIAogICAgICAgICJBTkQga2V5cGFpciA9ICclcScgQU5EIHNpZ25hdHVy
ZSA9ICclcScgIiwKICAgICAgICB0YWJsZS5jX3N0cigpLAogICAgICAgIHQuaWRlbnQoKS5j
X3N0cigpLAogICAgICAgIHQubmFtZSgpLmNfc3RyKCksCiAgICAgICAgdC52YWx1ZSgpLmNf
c3RyKCksCiAgICAgICAgdC5rZXkoKS5jX3N0cigpLAogICAgICAgIHQuc2lnKCkuY19zdHIo
KSk7CiAgSShyZXMuc2l6ZSgpID09IDAgfHwgcmVzLnNpemUoKSA9PSAxKTsKICByZXR1cm4g
cmVzLnNpemUoKSA9PSAxOwp9Cgp2b2lkIApkYXRhYmFzZTo6cHV0X2NlcnQoY2VydCBjb25z
dCAmIHQsCiAgICAgICAgICAgICAgICAgICBzdHJpbmcgY29uc3QgJiB0YWJsZSkKewogIGhl
eGVuYzxpZD4gdGhhc2g7CiAgY2VydF9oYXNoX2NvZGUodCwgdGhhc2gpOwogIGV4ZWN1dGUo
IklOU0VSVCBJTlRPICclcScgVkFMVUVTKCclcScsICclcScsICclcScsICclcScsICclcScs
ICclcScpIiwgCiAgICAgICAgICB0YWJsZS5jX3N0cigpLAogICAgICAgICAgdGhhc2goKS5j
X3N0cigpLAogICAgICAgICAgdC5pZGVudCgpLmNfc3RyKCksCiAgICAgICAgICB0Lm5hbWUo
KS5jX3N0cigpLCAKICAgICAgICAgIHQudmFsdWUoKS5jX3N0cigpLAogICAgICAgICAgdC5r
ZXkoKS5jX3N0cigpLAogICAgICAgICAgdC5zaWcoKS5jX3N0cigpKTsKfQoKdm9pZCAKZGF0
YWJhc2U6OnJlc3VsdHNfdG9fY2VydHMocmVzdWx0cyBjb25zdCAmIHJlcywKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgdmVjdG9yPGNlcnQ+ICYgY2VydHMpCnsKICBjZXJ0cy5jbGVh
cigpOwogIGZvciAoc2l6ZV90IGkgPSAwOyBpIDwgcmVzLnNpemUoKTsgKytpKQogICAgewog
ICAgICBjZXJ0IHQ7CiAgICAgIHQgPSBjZXJ0KGhleGVuYzxpZD4ocmVzW2ldWzBdKSwgCiAg
ICAgICAgICAgICAgY2VydF9uYW1lKHJlc1tpXVsxXSksCiAgICAgICAgICAgICAgYmFzZTY0
PGNlcnRfdmFsdWU+KHJlc1tpXVsyXSksCiAgICAgICAgICAgICAgcnNhX2tleXBhaXJfaWQo
cmVzW2ldWzNdKSwKICAgICAgICAgICAgICBiYXNlNjQ8cnNhX3NoYTFfc2lnbmF0dXJlPihy
ZXNbaV1bNF0pKTsKICAgICAgY2VydHMucHVzaF9iYWNrKHQpOwogICAgfQp9CgoKc3RydWN0
IHZhbGlkX2NlcnRzCnsKICBzZXQ8cnNhX2tleXBhaXJfaWQ+IHZhbGlkX3NpZ25lcnM7CiAg
aGV4ZW5jPGlkPiBpZGVudDsKICBjZXJ0X25hbWUgbmFtZTsKICBiYXNlNjQ8Y2VydF92YWx1
ZT4gdmFsOwogIHN0cmluZyBzaWduYXR1cmVfdHlwZTsKCiAgdmFsaWRfY2VydHMoc3RyaW5n
IGNvbnN0ICYgdHkpIAogICAgOiBzaWduYXR1cmVfdHlwZSh0eSkgCiAgewogICAgTChGKCJj
b25zdHJ1Y3RpbmcgdmFsaWRpdHkgY2hlY2tlciBmb3IgJXMgY2VydHNcbiIpICUgdHkpOwog
IH0KCiAgYm9vbCBjaGVja19zaWduZXJfdHJ1c3QoYXBwX3N0YXRlICYgYXBwKQogIHsKICAg
IGJvb2wgdHJ1c3RlZCA9IGZhbHNlOwoKICAgIEwoRigiY2hlY2tpbmcgJWQgc2lnbmVyICVz
IGNlcnQgdHJ1c3Qgc2V0XG4iKSAKICAgICAgJSB2YWxpZF9zaWduZXJzLnNpemUoKSAlIHNp
Z25hdHVyZV90eXBlKTsKICAgIHRyeQogICAgICB7CiAgICAgICAgY2VydF92YWx1ZSB2Owog
ICAgICAgIGRlY29kZV9iYXNlNjQodmFsLCB2KTsKICAgICAgICAvLyBGSVhNRTogbGFtZSBz
dHJpbmctbWFrZXMtdGhlLW1vZGUgYXJndW1lbnQKICAgICAgICBpZiAoc2lnbmF0dXJlX3R5
cGUgPT0gInJldmlzaW9uIikKICAgICAgICAgIHRydXN0ZWQgPSBhcHAubHVhLmhvb2tfZ2V0
X3JldmlzaW9uX2NlcnRfdHJ1c3QodmFsaWRfc2lnbmVycywKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZGVudCwgbmFtZSwgdik7
CiAgICAgICAgZWxzZSBpZiAoc2lnbmF0dXJlX3R5cGUgPT0gIm1hbmlmZXN0IikKICAgICAg
ICAgIHRydXN0ZWQgPSBhcHAubHVhLmhvb2tfZ2V0X21hbmlmZXN0X2NlcnRfdHJ1c3QodmFs
aWRfc2lnbmVycywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgaWRlbnQsIG5hbWUsIHYpOwogICAgICAgIGVsc2UgaWYgKHNpZ25h
dHVyZV90eXBlID09ICJmaWxlIikKICAgICAgICAgIHRydXN0ZWQgPSBhcHAubHVhLmhvb2tf
Z2V0X2ZpbGVfY2VydF90cnVzdCh2YWxpZF9zaWduZXJzLAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkZW50LCBuYW1lLCB2KTsKICAg
ICAgICBlbHNlCiAgICAgICAgICBJKGZhbHNlKTsgLy8gc2hvdWxkIGJlIGlsbGVnYWwKICAg
ICAgfQogICAgY2F0Y2ggKC4uLikKICAgICAgewogICAgICAgIFcoRigiZXhjZXB0aW9uIGlu
IHNxbGl0ZSB2YWxpZF9jZXJ0czo6Y2hlY2tfc2V0X3RydXN0XG4iKSk7CiAgICAgIH0KICAg
IAogICAgaWYgKHRydXN0ZWQpCiAgICAgIEwoRigidHJ1c3QgZnVuY3Rpb24gbGlrZWQgJWQg
JXMgc2lnbmVyc1xuIikgCiAgICAgICAgJSB2YWxpZF9zaWduZXJzLnNpemUoKSAlIHNpZ25h
dHVyZV90eXBlKTsKICAgIGVsc2UKICAgICAgTChGKCJ0cnVzdCBmdW5jdGlvbiBkaXNsaWtl
ZCAlZCAlcyBzaWduZXJzXG4iKSAKICAgICAgICAlIHZhbGlkX3NpZ25lcnMuc2l6ZSgpICUg
c2lnbmF0dXJlX3R5cGUpOwogICAgCiAgICByZXR1cm4gdHJ1c3RlZDsKICB9CgogIHZvaWQg
Y2hlY2tfc2luZ2xlX3NpZ25lcihhcHBfc3RhdGUgJiBhcHAsCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGludCBhcmdjLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhciBj
b25zdCAqKiBhcmd2KQogIHsKICAgIHRyeQogICAgICB7CiAgICAgICAgLy8gYXJncyBhcmU6
IGhhc2gsIGlkLCBuYW1lLCB2YWx1ZSwga2V5cGFpciwgcHVia2V5LCBzaWduYXR1cmUKICAg
ICAgICAvLyBMKEYoImVudHJpZXMgYXJlIFslc10gWyVzXSBbJXNdIFslc10gWyVzXSBbJXNd
IFslc11cbiIpIAogICAgICAgIC8vICAgICAgICAlIGFyZ3ZbMF0gJSBhcmd2WzFdICUgYXJn
dlsyXSAlIGFyZ3ZbM10gJSBhcmd2WzRdICUgYXJndls1XSAlIGFyZ3ZbNl0pOwoKICAgICAg
ICBjZXJ0IHRtcCA9IGNlcnQoaGV4ZW5jPGlkPihhcmd2WzFdKSwgCiAgICAgICAgICAgICAg
ICAgICAgICAgIGNlcnRfbmFtZShhcmd2WzJdKSwKICAgICAgICAgICAgICAgICAgICAgICAg
YmFzZTY0PGNlcnRfdmFsdWU+KGFyZ3ZbM10pLAogICAgICAgICAgICAgICAgICAgICAgICBy
c2Ffa2V5cGFpcl9pZChhcmd2WzRdKSwKICAgICAgICAgICAgICAgICAgICAgICAgYmFzZTY0
PHJzYV9zaGExX3NpZ25hdHVyZT4oYXJndls2XSkpOwoKICAgICAgICBiYXNlNjQ8cnNhX3B1
Yl9rZXk+IHBrKGFyZ3ZbNV0pOwoKICAgICAgICBpZiAoaWRlbnQoKS5lbXB0eSgpKQogICAg
ICAgICAgaWRlbnQgPSB0bXAuaWRlbnQ7CiAgICAgICAgZWxzZQogICAgICAgICAgSShpZGVu
dCA9PSB0bXAuaWRlbnQpOwoKICAgICAgICBpZiAobmFtZSgpLmVtcHR5KCkpCiAgICAgICAg
ICBuYW1lID0gdG1wLm5hbWU7CiAgICAgICAgZWxzZQogICAgICAgICAgSShuYW1lID09IHRt
cC5uYW1lKTsKCiAgICAgICAgaWYgKHZhbCgpLmVtcHR5KCkpCiAgICAgICAgICB2YWwgPSB0
bXAudmFsdWU7CiAgICAgICAgZWxzZQogICAgICAgICAgSSh2YWwgPT0gdG1wLnZhbHVlKTsK
CiAgICAgICAgLy8gICAgICBMKEYoImV4YW1pbmluZyAnJXMnICVzIGNlcnQgZnJvbSAlc1xu
IikgCiAgICAgICAgLy8gICAgICAgICUgbmFtZSAlIHNpZ25hdHVyZV90eXBlICUgaWRlbnQp
OwoKICAgICAgICBzdHJpbmcgdHh0OwogICAgICAgIGNlcnRfc2lnbmFibGVfdGV4dCh0bXAs
IHR4dCk7CiAgICAgICAgaWYgKGNoZWNrX3NpZ25hdHVyZShhcHAubHVhLCB0bXAua2V5LCBw
aywgdHh0LCB0bXAuc2lnKSkKICAgICAgICAgIHsKICAgICAgICAgICAgTChGKCJvayAnJXMn
ICVzIGNlcnQgZnJvbSAlc1xuIikgCiAgICAgICAgICAgICAgJSBuYW1lICUgc2lnbmF0dXJl
X3R5cGUgJSB0bXAua2V5KTsKICAgICAgICAgICAgdmFsaWRfc2lnbmVycy5pbnNlcnQodG1w
LmtleSk7CiAgICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgICAgewogICAgICAgICAg
ICBXKEYoImJhZCAnJXMnICVzIGNlcnQgZnJvbSAlc1xuIikgCiAgICAgICAgICAgICAgJSBu
YW1lICUgc2lnbmF0dXJlX3R5cGUgJSB0bXAua2V5KTsKICAgICAgICAgIH0KICAgICAgfQog
ICAgY2F0Y2ggKHN0ZDo6ZXhjZXB0aW9uICYgZSkKICAgICAgewogICAgICAgIFcoRigic3Rk
OjpleGNlcHRpb24gaW4gc3FsaXRlIHZhbGlkX2NlcnRzOjpjaGVja19zaW5nbGVfc2lnbmVy
OiAlc1xuIikgJSBlLndoYXQoKSk7CiAgICAgIH0KICAgIGNhdGNoICguLi4pCiAgICAgIHsK
ICAgICAgICBXKEYoInVua25vd24gZXhjZXB0aW9uIGluIHNxbGl0ZSB2YWxpZF9jZXJ0czo6
Y2hlY2tfc2luZ2xlX3NpZ25lclxuIikpOwogICAgICB9CiAgfQp9OwoKZXh0ZXJuICJDIgp7
CgpzdGF0aWMgdm9pZAp0cnVzdGVkX3N0ZXBfY2FsbGJhY2soc3FsaXRlX2Z1bmMgKiBmbl9j
dHgsIAogICAgICAgICAgICAgICAgICAgICAgaW50IGFyZ2MsIAogICAgICAgICAgICAgICAg
ICAgICAgY2hhciBjb25zdCAqKiBhcmd2KQp7CiAgYXBwX3N0YXRlICogYXBwID0gTlVMTDsg
CiAgdmFsaWRfY2VydHMgKiogdnBwOwoKICBJKGZuX2N0eCk7CiAgSShhcmdjID09IDgpOwog
IEkoYXJndik7CiAgZm9yIChzaXplX3QgaSA9IDA7IGkgPCA4OyArK2kpCiAgICBJKGFyZ3Zb
aV0pOwoKICBhcHAgPSBzdGF0aWNfY2FzdDxhcHBfc3RhdGUgKj4oc3FsaXRlX3VzZXJfZGF0
YShmbl9jdHgpKTsKICBJKGFwcCk7CiAgdnBwID0gc3RhdGljX2Nhc3Q8dmFsaWRfY2VydHMg
Kio+KHNxbGl0ZV9hZ2dyZWdhdGVfY29udGV4dChmbl9jdHgsIHNpemVvZih2YWxpZF9jZXJ0
cyAqKSkpOwogIEkodnBwKTsKICBpZiAoISAoKnZwcCkpCiAgICAqdnBwID0gbmV3IHZhbGlk
X2NlcnRzKHN0cmluZyhhcmd2WzBdKSk7CiAgSSgqdnBwKTsKICAoKnZwcCktPmNoZWNrX3Np
bmdsZV9zaWduZXIoKmFwcCwgYXJnYy0xLCBhcmd2KzEpOyAgCn0KCnN0YXRpYyB2b2lkCnRy
dXN0ZWRfZmluYWxpemVfY2FsbGJhY2soc3FsaXRlX2Z1bmMgKiBmbl9jdHgpCnsKICBhcHBf
c3RhdGUgKiBhcHAgPSBOVUxMOyAKICB2YWxpZF9jZXJ0cyAqKiB2cHA7CiAgYXBwID0gc3Rh
dGljX2Nhc3Q8YXBwX3N0YXRlICo+KHNxbGl0ZV91c2VyX2RhdGEoZm5fY3R4KSk7CiAgSShh
cHApOwogIHZwcCA9IHN0YXRpY19jYXN0PHZhbGlkX2NlcnRzICoqPihzcWxpdGVfYWdncmVn
YXRlX2NvbnRleHQoZm5fY3R4LCBzaXplb2YodmFsaWRfY2VydHMgKikpKTsKCiAgSSh2cHAp
OwogIEkoKnZwcCk7CgogIGlmICgoKnZwcCktPmNoZWNrX3NpZ25lcl90cnVzdCgqYXBwKSkK
ICAgIHNxbGl0ZV9zZXRfcmVzdWx0X2ludChmbl9jdHgsIDEpOwogIGVsc2UKICAgIHNxbGl0
ZV9zZXRfcmVzdWx0X2ludChmbl9jdHgsIDApOwoKICBkZWxldGUgKCp2cHApOwp9Cn0KCgp2
b2lkCmRhdGFiYXNlOjppbnN0YWxsX2Z1bmN0aW9ucyhhcHBfc3RhdGUgKiBhcHApCnsKICAv
LyByZWdpc3RlciBhbnkgZnVuY3Rpb25zIHdlJ3JlIGdvaW5nIHRvIHVzZQogIEkoc3FsaXRl
X2NyZWF0ZV9mdW5jdGlvbihzcWwoKSwgInVuYmFzZTY0IiwgLTEsIAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAmc3FsaXRlX3VuYmFzZTY0X2ZuLCAKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgTlVMTCkgPT0gMCk7CgogIEkoc3FsaXRlX2NyZWF0ZV9hZ2dyZWdhdGUoc3Fs
KCksICJ0cnVzdGVkIiwgOCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAmdHJ1c3Rl
ZF9zdGVwX2NhbGxiYWNrLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJnRydXN0ZWRf
ZmluYWxpemVfY2FsbGJhY2ssCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHApID09
IDApOwp9Cgp2b2lkCmRhdGFiYXNlOjppbnN0YWxsX3ZpZXdzKCkKewogIC8vIGRlbGV0ZSBh
bnkgZXhpc3Rpbmcgdmlld3MKICByZXN1bHRzIHJlczsKICBmZXRjaChyZXMsIG9uZV9jb2ws
IGFueV9yb3dzLAogICAgICAgICJTRUxFQ1QgbmFtZSBGUk9NIHNxbGl0ZV9tYXN0ZXIgV0hF
UkUgdHlwZT0ndmlldyciKTsKICBmb3IgKHNpemVfdCBpID0gMDsgaSA8IHJlcy5zaXplKCk7
ICsraSkKICAgIHsKICAgICAgZXhlY3V0ZSgiRFJPUCBWSUVXICclcSciLCByZXNbaV1bMF0u
Y19zdHIoKSk7CiAgICB9CiAgLy8gcmVnaXN0ZXIgYW55IHZpZXdzIHdlJ3JlIGdvaW5nIHRv
IHVzZQogIGV4ZWN1dGUodmlld3NfY29uc3RhbnQpOwp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0
X2hlYWRzKGJhc2U2NDxjZXJ0X3ZhbHVlPiBjb25zdCAmIGJyYW5jaCwKICAgICAgICAgICAg
ICAgICAgICBzdGQ6OnNldDxyZXZpc2lvbl9pZD4gJiBoZWFkcykKewogIHJlc3VsdHMgcmVz
OwogIGZldGNoKHJlcywgb25lX2NvbCwgYW55X3Jvd3MsCiAgICAgICAgIlNFTEVDVCBwYXJl
bnQgIgogICAgICAgICJGUk9NIGJyYW5jaF9oZWFkcyAiCiAgICAgICAgIldIRVJFIHZhbHVl
ID0gJyVxJyIsCiAgICAgICAgYnJhbmNoKCkuY19zdHIoKSk7CiAgaGVhZHMuY2xlYXIoKTsK
ICBmb3IgKHNpemVfdCBpID0gMDsgaSA8IHJlcy5zaXplKCk7ICsraSkKICAgIHsKICAgICAg
aGVhZHMuaW5zZXJ0KHJldmlzaW9uX2lkKHJlc1tpXVswXSkpOwogICAgfQp9Cgp2b2lkIApk
YXRhYmFzZTo6Z2V0X2NlcnRzKGhleGVuYzxpZD4gY29uc3QgJiBpZGVudCwgCiAgICAgICAg
ICAgICAgICAgICAgdmVjdG9yPGNlcnQ+ICYgY2VydHMsICAgICAgICAgICAgICAgICAgICAg
ICAKICAgICAgICAgICAgICAgICAgICBzdHJpbmcgY29uc3QgJiB0YWJsZSkKewogIHJlc3Vs
dHMgcmVzOwogIGZldGNoKHJlcywgNSwgYW55X3Jvd3MsIAogICAgICAgICJTRUxFQ1QgaWQs
IG5hbWUsIHZhbHVlLCBrZXlwYWlyLCBzaWduYXR1cmUgRlJPTSAnJXEnICIKICAgICAgICAi
V0hFUkUgaWQgPSAnJXEnIiwgCiAgICAgICAgdGFibGUuY19zdHIoKSwgIAogICAgICAgIGlk
ZW50KCkuY19zdHIoKSk7CiAgcmVzdWx0c190b19jZXJ0cyhyZXMsIGNlcnRzKTsKfQoKCnZv
aWQgCmRhdGFiYXNlOjpnZXRfY2VydHMoY2VydF9uYW1lIGNvbnN0ICYgbmFtZSwgICAgICAg
ICAgIAogICAgICAgICAgICAgICAgICAgIHZlY3RvcjxjZXJ0PiAmIGNlcnRzLAogICAgICAg
ICAgICAgICAgICAgIHN0cmluZyBjb25zdCAmIHRhYmxlKQp7CiAgcmVzdWx0cyByZXM7CiAg
ZmV0Y2gocmVzLCA1LCBhbnlfcm93cywgCiAgICAgICAgIlNFTEVDVCBpZCwgbmFtZSwgdmFs
dWUsIGtleXBhaXIsIHNpZ25hdHVyZSAiCiAgICAgICAgIkZST00gJyVxJyBXSEVSRSBuYW1l
ID0gJyVxJyIsIAogICAgICAgIHRhYmxlLmNfc3RyKCksICAKICAgICAgICBuYW1lKCkuY19z
dHIoKSk7CiAgcmVzdWx0c190b19jZXJ0cyhyZXMsIGNlcnRzKTsKfQoKCnZvaWQgCmRhdGFi
YXNlOjpnZXRfY2VydHMoaGV4ZW5jPGlkPiBjb25zdCAmIGlkZW50LCAKICAgICAgICAgICAg
ICAgICAgICBjZXJ0X25hbWUgY29uc3QgJiBuYW1lLCAgICAgICAgICAgCiAgICAgICAgICAg
ICAgICAgICAgdmVjdG9yPGNlcnQ+ICYgY2VydHMsCiAgICAgICAgICAgICAgICAgICAgc3Ry
aW5nIGNvbnN0ICYgdGFibGUpCnsKICByZXN1bHRzIHJlczsKICBmZXRjaChyZXMsIDUsIGFu
eV9yb3dzLCAKICAgICAgICAiU0VMRUNUIGlkLCBuYW1lLCB2YWx1ZSwga2V5cGFpciwgc2ln
bmF0dXJlICIKICAgICAgICAiRlJPTSAnJXEnICIKICAgICAgICAiV0hFUkUgaWQgPSAnJXEn
IEFORCBuYW1lID0gJyVxJyIsIAogICAgICAgIHRhYmxlLmNfc3RyKCksICAKICAgICAgICBp
ZGVudCgpLmNfc3RyKCksCiAgICAgICAgbmFtZSgpLmNfc3RyKCkpOwogIHJlc3VsdHNfdG9f
Y2VydHMocmVzLCBjZXJ0cyk7Cn0KCnZvaWQgCmRhdGFiYXNlOjpnZXRfY2VydHMoY2VydF9u
YW1lIGNvbnN0ICYgbmFtZSwKICAgICAgICAgICAgICAgICAgICBiYXNlNjQ8Y2VydF92YWx1
ZT4gY29uc3QgJiB2YWwsIAogICAgICAgICAgICAgICAgICAgIHZlY3RvcjxjZXJ0PiAmIGNl
cnRzLAogICAgICAgICAgICAgICAgICAgIHN0cmluZyBjb25zdCAmIHRhYmxlKQp7CiAgcmVz
dWx0cyByZXM7CiAgZmV0Y2gocmVzLCA1LCBhbnlfcm93cywgCiAgICAgICAgIlNFTEVDVCBp
ZCwgbmFtZSwgdmFsdWUsIGtleXBhaXIsIHNpZ25hdHVyZSAiCiAgICAgICAgIkZST00gJyVx
JyAiCiAgICAgICAgIldIRVJFIG5hbWUgPSAnJXEnIEFORCB2YWx1ZSA9ICclcSciLCAKICAg
ICAgICB0YWJsZS5jX3N0cigpLCAgCiAgICAgICAgbmFtZSgpLmNfc3RyKCksCiAgICAgICAg
dmFsKCkuY19zdHIoKSk7CiAgcmVzdWx0c190b19jZXJ0cyhyZXMsIGNlcnRzKTsKfQoKCnZv
aWQgCmRhdGFiYXNlOjpnZXRfY2VydHMoaGV4ZW5jPGlkPiBjb25zdCAmIGlkZW50LCAKICAg
ICAgICAgICAgICAgICAgICBjZXJ0X25hbWUgY29uc3QgJiBuYW1lLCAgICAgICAgICAgCiAg
ICAgICAgICAgICAgICAgICAgYmFzZTY0PGNlcnRfdmFsdWU+IGNvbnN0ICYgdmFsdWUsCiAg
ICAgICAgICAgICAgICAgICAgdmVjdG9yPGNlcnQ+ICYgY2VydHMsCiAgICAgICAgICAgICAg
ICAgICAgc3RyaW5nIGNvbnN0ICYgdGFibGUpCnsKICByZXN1bHRzIHJlczsKICBmZXRjaChy
ZXMsIDUsIGFueV9yb3dzLCAKICAgICAgICAiU0VMRUNUIGlkLCBuYW1lLCB2YWx1ZSwga2V5
cGFpciwgc2lnbmF0dXJlICIKICAgICAgICAiRlJPTSAnJXEnICIKICAgICAgICAiV0hFUkUg
aWQgPSAnJXEnIEFORCBuYW1lID0gJyVxJyBBTkQgdmFsdWUgPSAnJXEnIiwgCiAgICAgICAg
dGFibGUuY19zdHIoKSwgIAogICAgICAgIGlkZW50KCkuY19zdHIoKSwKICAgICAgICBuYW1l
KCkuY19zdHIoKSwKICAgICAgICB2YWx1ZSgpLmNfc3RyKCkpOwogIHJlc3VsdHNfdG9fY2Vy
dHMocmVzLCBjZXJ0cyk7Cn0KCgoKYm9vbCAKZGF0YWJhc2U6OnJldmlzaW9uX2NlcnRfZXhp
c3RzKHJldmlzaW9uPGNlcnQ+IGNvbnN0ICYgY2VydCkKeyAKICByZXR1cm4gY2VydF9leGlz
dHMoY2VydC5pbm5lcigpLCAicmV2aXNpb25fY2VydHMiKTsgCn0KCmJvb2wgCmRhdGFiYXNl
OjptYW5pZmVzdF9jZXJ0X2V4aXN0cyhtYW5pZmVzdDxjZXJ0PiBjb25zdCAmIGNlcnQpCnsg
CiAgcmV0dXJuIGNlcnRfZXhpc3RzKGNlcnQuaW5uZXIoKSwgIm1hbmlmZXN0X2NlcnRzIik7
IAp9Cgpib29sIApkYXRhYmFzZTo6ZmlsZV9jZXJ0X2V4aXN0cyhmaWxlPGNlcnQ+IGNvbnN0
ICYgY2VydCkKeyAKICByZXR1cm4gY2VydF9leGlzdHMoY2VydC5pbm5lcigpLCAiZmlsZV9j
ZXJ0cyIpOyAKfQoKdm9pZCAKZGF0YWJhc2U6OnB1dF9tYW5pZmVzdF9jZXJ0KG1hbmlmZXN0
PGNlcnQ+IGNvbnN0ICYgY2VydCkKeyAKICBwdXRfY2VydChjZXJ0LmlubmVyKCksICJtYW5p
ZmVzdF9jZXJ0cyIpOyAKfQoKdm9pZCAKZGF0YWJhc2U6OnB1dF9yZXZpc2lvbl9jZXJ0KHJl
dmlzaW9uPGNlcnQ+IGNvbnN0ICYgY2VydCkKeyAKICBwdXRfY2VydChjZXJ0LmlubmVyKCks
ICJyZXZpc2lvbl9jZXJ0cyIpOyAKfQoKdm9pZCAKZGF0YWJhc2U6OnB1dF9maWxlX2NlcnQo
ZmlsZTxjZXJ0PiBjb25zdCAmIGNlcnQpCnsgCiAgcHV0X2NlcnQoY2VydC5pbm5lcigpLCAi
ZmlsZV9jZXJ0cyIpOyAKfQoKdm9pZCAKZGF0YWJhc2U6OmdldF9maWxlX2NlcnRzKGNlcnRf
bmFtZSBjb25zdCAmIG5hbWUsIAogICAgICAgICAgICAgICAgICAgICAgICAgdmVjdG9yPCBm
aWxlPGNlcnQ+ID4gJiB0cykKewogIHZlY3RvcjxjZXJ0PiBjZXJ0czsKICBnZXRfY2VydHMo
bmFtZSwgY2VydHMsICJmaWxlX2NlcnRzIik7CiAgdHMuY2xlYXIoKTsKICBjb3B5KGNlcnRz
LmJlZ2luKCksIGNlcnRzLmVuZCgpLCBiYWNrX2luc2VydGVyKHRzKSk7ICAKfQoKdm9pZCAK
ZGF0YWJhc2U6OmdldF9maWxlX2NlcnRzKGZpbGVfaWQgY29uc3QgJiBpZCwgCiAgICAgICAg
ICAgICAgICAgICAgICAgICBjZXJ0X25hbWUgY29uc3QgJiBuYW1lLCAKICAgICAgICAgICAg
ICAgICAgICAgICAgIHZlY3RvcjwgZmlsZTxjZXJ0PiA+ICYgdHMpCnsKICB2ZWN0b3I8Y2Vy
dD4gY2VydHM7CiAgZ2V0X2NlcnRzKGlkLmlubmVyKCksIG5hbWUsIGNlcnRzLCAiZmlsZV9j
ZXJ0cyIpOwogIHRzLmNsZWFyKCk7CiAgY29weShjZXJ0cy5iZWdpbigpLCBjZXJ0cy5lbmQo
KSwgYmFja19pbnNlcnRlcih0cykpOyAgICAKfQoKdm9pZCAKZGF0YWJhc2U6OmdldF9maWxl
X2NlcnRzKGNlcnRfbmFtZSBjb25zdCAmIG5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAg
ICBiYXNlNjQ8Y2VydF92YWx1ZT4gY29uc3QgJiB2YWwsIAogICAgICAgICAgICAgICAgICAg
ICAgICAgdmVjdG9yPCBmaWxlPGNlcnQ+ID4gJiB0cykKewogIHZlY3RvcjxjZXJ0PiBjZXJ0
czsKICBnZXRfY2VydHMobmFtZSwgdmFsLCBjZXJ0cywgImZpbGVfY2VydHMiKTsKICB0cy5j
bGVhcigpOwogIGNvcHkoY2VydHMuYmVnaW4oKSwgY2VydHMuZW5kKCksIGJhY2tfaW5zZXJ0
ZXIodHMpKTsgIAp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X2ZpbGVfY2VydHMoZmlsZV9pZCBj
b25zdCAmIGlkLCAKICAgICAgICAgICAgICAgICAgICAgICAgIGNlcnRfbmFtZSBjb25zdCAm
IG5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICBiYXNlNjQ8Y2VydF92YWx1ZT4gY29u
c3QgJiB2YWwsIAogICAgICAgICAgICAgICAgICAgICAgICAgdmVjdG9yPCBmaWxlPGNlcnQ+
ID4gJiB0cykKewogIHZlY3RvcjxjZXJ0PiBjZXJ0czsKICBnZXRfY2VydHMoaWQuaW5uZXIo
KSwgbmFtZSwgdmFsLCBjZXJ0cywgImZpbGVfY2VydHMiKTsKICB0cy5jbGVhcigpOwogIGNv
cHkoY2VydHMuYmVnaW4oKSwgY2VydHMuZW5kKCksIGJhY2tfaW5zZXJ0ZXIodHMpKTsgIAp9
Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X2ZpbGVfY2VydHMoZmlsZV9pZCBjb25zdCAmIGlkLCAK
ICAgICAgICAgICAgICAgICAgICAgICAgIHZlY3RvcjwgZmlsZTxjZXJ0PiA+ICYgdHMpCnsg
CiAgdmVjdG9yPGNlcnQ+IGNlcnRzOwogIGdldF9jZXJ0cyhpZC5pbm5lcigpLCBjZXJ0cywg
ImZpbGVfY2VydHMiKTsgCiAgdHMuY2xlYXIoKTsKICBjb3B5KGNlcnRzLmJlZ2luKCksIGNl
cnRzLmVuZCgpLCBiYWNrX2luc2VydGVyKHRzKSk7Cn0KCgpib29sIApkYXRhYmFzZTo6Zmls
ZV9jZXJ0X2V4aXN0cyhoZXhlbmM8aWQ+IGNvbnN0ICYgaGFzaCkKewogIHJlc3VsdHMgcmVz
OwogIHZlY3RvcjxjZXJ0PiBjZXJ0czsKICBmZXRjaChyZXMsIG9uZV9jb2wsIGFueV9yb3dz
LCAKICAgICAgICAiU0VMRUNUIGlkICIKICAgICAgICAiRlJPTSBmaWxlX2NlcnRzICIKICAg
ICAgICAiV0hFUkUgaGFzaCA9ICclcSciLCAKICAgICAgICBoYXNoKCkuY19zdHIoKSk7CiAg
SShyZXMuc2l6ZSgpID09IDAgfHwgcmVzLnNpemUoKSA9PSAxKTsKICByZXR1cm4gKHJlcy5z
aXplKCkgPT0gMSk7Cn0KCnZvaWQgCmRhdGFiYXNlOjpnZXRfZmlsZV9jZXJ0KGhleGVuYzxp
ZD4gY29uc3QgJiBoYXNoLAogICAgICAgICAgICAgICAgICAgICAgICBmaWxlPGNlcnQ+ICYg
YykKewogIHJlc3VsdHMgcmVzOwogIHZlY3RvcjxjZXJ0PiBjZXJ0czsKICBmZXRjaChyZXMs
IDUsIG9uZV9yb3csIAogICAgICAgICJTRUxFQ1QgaWQsIG5hbWUsIHZhbHVlLCBrZXlwYWly
LCBzaWduYXR1cmUgIgogICAgICAgICJGUk9NIGZpbGVfY2VydHMgIgogICAgICAgICJXSEVS
RSBoYXNoID0gJyVxJyIsIAogICAgICAgIGhhc2goKS5jX3N0cigpKTsKICByZXN1bHRzX3Rv
X2NlcnRzKHJlcywgY2VydHMpOwogIEkoY2VydHMuc2l6ZSgpID09IDEpOwogIGMgPSBmaWxl
PGNlcnQ+KGNlcnRzWzBdKTsKfQoKCgp2b2lkIApkYXRhYmFzZTo6Z2V0X3JldmlzaW9uX2Nl
cnRzKGNlcnRfbmFtZSBjb25zdCAmIG5hbWUsIAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgdmVjdG9yPCByZXZpc2lvbjxjZXJ0PiA+ICYgdHMpCnsKICB2ZWN0b3I8Y2VydD4gY2Vy
dHM7CiAgZ2V0X2NlcnRzKG5hbWUsIGNlcnRzLCAicmV2aXNpb25fY2VydHMiKTsKICB0cy5j
bGVhcigpOwogIGNvcHkoY2VydHMuYmVnaW4oKSwgY2VydHMuZW5kKCksIGJhY2tfaW5zZXJ0
ZXIodHMpKTsgIAp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X3JldmlzaW9uX2NlcnRzKHJldmlz
aW9uX2lkIGNvbnN0ICYgaWQsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VydF9u
YW1lIGNvbnN0ICYgbmFtZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZWN0b3I8
IHJldmlzaW9uPGNlcnQ+ID4gJiB0cykKewogIHZlY3RvcjxjZXJ0PiBjZXJ0czsKICBnZXRf
Y2VydHMoaWQuaW5uZXIoKSwgbmFtZSwgY2VydHMsICJyZXZpc2lvbl9jZXJ0cyIpOwogIHRz
LmNsZWFyKCk7CiAgY29weShjZXJ0cy5iZWdpbigpLCBjZXJ0cy5lbmQoKSwgYmFja19pbnNl
cnRlcih0cykpOyAgCn0KCnZvaWQgCmRhdGFiYXNlOjpnZXRfcmV2aXNpb25fY2VydHMocmV2
aXNpb25faWQgY29uc3QgJiBpZCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZXJ0
X25hbWUgY29uc3QgJiBuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFzZTY0
PGNlcnRfdmFsdWU+IGNvbnN0ICYgdmFsLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHZlY3RvcjwgcmV2aXNpb248Y2VydD4gPiAmIHRzKQp7CiAgdmVjdG9yPGNlcnQ+IGNlcnRz
OwogIGdldF9jZXJ0cyhpZC5pbm5lcigpLCBuYW1lLCB2YWwsIGNlcnRzLCAicmV2aXNpb25f
Y2VydHMiKTsKICB0cy5jbGVhcigpOwogIGNvcHkoY2VydHMuYmVnaW4oKSwgY2VydHMuZW5k
KCksIGJhY2tfaW5zZXJ0ZXIodHMpKTsgIAp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X3Jldmlz
aW9uX2NlcnRzKGNlcnRfbmFtZSBjb25zdCAmIG5hbWUsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBiYXNlNjQ8Y2VydF92YWx1ZT4gY29uc3QgJiB2YWwsIAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgdmVjdG9yPCByZXZpc2lvbjxjZXJ0PiA+ICYgdHMpCnsKICB2ZWN0
b3I8Y2VydD4gY2VydHM7CiAgZ2V0X2NlcnRzKG5hbWUsIHZhbCwgY2VydHMsICJyZXZpc2lv
bl9jZXJ0cyIpOwogIHRzLmNsZWFyKCk7CiAgY29weShjZXJ0cy5iZWdpbigpLCBjZXJ0cy5l
bmQoKSwgYmFja19pbnNlcnRlcih0cykpOyAgCn0KCnZvaWQgCmRhdGFiYXNlOjpnZXRfcmV2
aXNpb25fY2VydHMocmV2aXNpb25faWQgY29uc3QgJiBpZCwgCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICB2ZWN0b3I8IHJldmlzaW9uPGNlcnQ+ID4gJiB0cykKeyAKICB2ZWN0b3I8
Y2VydD4gY2VydHM7CiAgZ2V0X2NlcnRzKGlkLmlubmVyKCksIGNlcnRzLCAicmV2aXNpb25f
Y2VydHMiKTsgCiAgdHMuY2xlYXIoKTsKICBjb3B5KGNlcnRzLmJlZ2luKCksIGNlcnRzLmVu
ZCgpLCBiYWNrX2luc2VydGVyKHRzKSk7Cn0KCnZvaWQgCmRhdGFiYXNlOjpnZXRfcmV2aXNp
b25fY2VydChoZXhlbmM8aWQ+IGNvbnN0ICYgaGFzaCwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgcmV2aXNpb248Y2VydD4gJiBjKQp7CiAgcmVzdWx0cyByZXM7CiAgdmVjdG9yPGNl
cnQ+IGNlcnRzOwogIGZldGNoKHJlcywgNSwgb25lX3JvdywgCiAgICAgICAgIlNFTEVDVCBp
ZCwgbmFtZSwgdmFsdWUsIGtleXBhaXIsIHNpZ25hdHVyZSAiCiAgICAgICAgIkZST00gcmV2
aXNpb25fY2VydHMgIgogICAgICAgICJXSEVSRSBoYXNoID0gJyVxJyIsIAogICAgICAgIGhh
c2goKS5jX3N0cigpKTsKICByZXN1bHRzX3RvX2NlcnRzKHJlcywgY2VydHMpOwogIEkoY2Vy
dHMuc2l6ZSgpID09IDEpOwogIGMgPSByZXZpc2lvbjxjZXJ0PihjZXJ0c1swXSk7Cn0KCmJv
b2wgCmRhdGFiYXNlOjpyZXZpc2lvbl9jZXJ0X2V4aXN0cyhoZXhlbmM8aWQ+IGNvbnN0ICYg
aGFzaCkKewogIHJlc3VsdHMgcmVzOwogIHZlY3RvcjxjZXJ0PiBjZXJ0czsKICBmZXRjaChy
ZXMsIG9uZV9jb2wsIGFueV9yb3dzLCAKICAgICAgICAiU0VMRUNUIGlkICIKICAgICAgICAi
RlJPTSByZXZpc2lvbl9jZXJ0cyAiCiAgICAgICAgIldIRVJFIGhhc2ggPSAnJXEnIiwgCiAg
ICAgICAgaGFzaCgpLmNfc3RyKCkpOwogIEkocmVzLnNpemUoKSA9PSAwIHx8IHJlcy5zaXpl
KCkgPT0gMSk7CiAgcmV0dXJuIChyZXMuc2l6ZSgpID09IDEpOwp9Cgpib29sIApkYXRhYmFz
ZTo6bWFuaWZlc3RfY2VydF9leGlzdHMoaGV4ZW5jPGlkPiBjb25zdCAmIGhhc2gpCnsKICBy
ZXN1bHRzIHJlczsKICB2ZWN0b3I8Y2VydD4gY2VydHM7CiAgZmV0Y2gocmVzLCBvbmVfY29s
LCBhbnlfcm93cywgCiAgICAgICAgIlNFTEVDVCBpZCAiCiAgICAgICAgIkZST00gbWFuaWZl
c3RfY2VydHMgIgogICAgICAgICJXSEVSRSBoYXNoID0gJyVxJyIsIAogICAgICAgIGhhc2go
KS5jX3N0cigpKTsKICBJKHJlcy5zaXplKCkgPT0gMCB8fCByZXMuc2l6ZSgpID09IDEpOwog
IHJldHVybiAocmVzLnNpemUoKSA9PSAxKTsKfQoKdm9pZCAKZGF0YWJhc2U6OmdldF9tYW5p
ZmVzdF9jZXJ0KGhleGVuYzxpZD4gY29uc3QgJiBoYXNoLAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgbWFuaWZlc3Q8Y2VydD4gJiBjKQp7CiAgcmVzdWx0cyByZXM7CiAgdmVjdG9y
PGNlcnQ+IGNlcnRzOwogIGZldGNoKHJlcywgNSwgb25lX3JvdywgCiAgICAgICAgIlNFTEVD
VCBpZCwgbmFtZSwgdmFsdWUsIGtleXBhaXIsIHNpZ25hdHVyZSAiCiAgICAgICAgIkZST00g
bWFuaWZlc3RfY2VydHMgIgogICAgICAgICJXSEVSRSBoYXNoID0gJyVxJyIsIAogICAgICAg
IGhhc2goKS5jX3N0cigpKTsKICByZXN1bHRzX3RvX2NlcnRzKHJlcywgY2VydHMpOwogIEko
Y2VydHMuc2l6ZSgpID09IDEpOwogIGMgPSBtYW5pZmVzdDxjZXJ0PihjZXJ0c1swXSk7Cn0K
CnZvaWQgCmRhdGFiYXNlOjpnZXRfbWFuaWZlc3RfY2VydHMobWFuaWZlc3RfaWQgY29uc3Qg
JiBpZCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVjdG9yPCBtYW5pZmVzdDxj
ZXJ0PiA+ICYgdHMpCnsgCiAgdmVjdG9yPGNlcnQ+IGNlcnRzOwogIGdldF9jZXJ0cyhpZC5p
bm5lcigpLCBjZXJ0cywgIm1hbmlmZXN0X2NlcnRzIik7IAogIHRzLmNsZWFyKCk7CiAgY29w
eShjZXJ0cy5iZWdpbigpLCBjZXJ0cy5lbmQoKSwgYmFja19pbnNlcnRlcih0cykpOwp9CgoK
dm9pZCAKZGF0YWJhc2U6OmdldF9tYW5pZmVzdF9jZXJ0cyhjZXJ0X25hbWUgY29uc3QgJiBu
YW1lLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlY3RvcjwgbWFuaWZlc3Q8Y2Vy
dD4gPiAmIHRzKQp7CiAgdmVjdG9yPGNlcnQ+IGNlcnRzOwogIGdldF9jZXJ0cyhuYW1lLCBj
ZXJ0cywgIm1hbmlmZXN0X2NlcnRzIik7CiAgdHMuY2xlYXIoKTsKICBjb3B5KGNlcnRzLmJl
Z2luKCksIGNlcnRzLmVuZCgpLCBiYWNrX2luc2VydGVyKHRzKSk7ICAKfQoKdm9pZCAKZGF0
YWJhc2U6OmdldF9tYW5pZmVzdF9jZXJ0cyhtYW5pZmVzdF9pZCBjb25zdCAmIGlkLCAKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBjZXJ0X25hbWUgY29uc3QgJiBuYW1lLCAKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICB2ZWN0b3I8IG1hbmlmZXN0PGNlcnQ+ID4gJiB0
cykKewogIHZlY3RvcjxjZXJ0PiBjZXJ0czsKICBnZXRfY2VydHMoaWQuaW5uZXIoKSwgbmFt
ZSwgY2VydHMsICJtYW5pZmVzdF9jZXJ0cyIpOwogIHRzLmNsZWFyKCk7CiAgY29weShjZXJ0
cy5iZWdpbigpLCBjZXJ0cy5lbmQoKSwgYmFja19pbnNlcnRlcih0cykpOyAgCn0KCgovLyBj
b21wbGV0aW9ucwp2b2lkIApkYXRhYmFzZTo6Y29tcGxldGUoc3RyaW5nIGNvbnN0ICYgcGFy
dGlhbCwKICAgICAgICAgICAgICAgICAgIHNldDxyZXZpc2lvbl9pZD4gJiBjb21wbGV0aW9u
cykKewogIHJlc3VsdHMgcmVzOwogIGNvbXBsZXRpb25zLmNsZWFyKCk7CgogIGZldGNoKHJl
cywgMSwgYW55X3Jvd3MsCiAgICAgICAgIlNFTEVDVCBpZCBGUk9NIHJldmlzaW9ucyBXSEVS
RSBpZCBHTE9CICclcSonIiwKICAgICAgICBwYXJ0aWFsLmNfc3RyKCkpOwoKICBmb3IgKHNp
emVfdCBpID0gMDsgaSA8IHJlcy5zaXplKCk7ICsraSkKICAgIGNvbXBsZXRpb25zLmluc2Vy
dChyZXZpc2lvbl9pZChyZXNbaV1bMF0pKTsgIAp9CgoKdm9pZCAKZGF0YWJhc2U6OmNvbXBs
ZXRlKHN0cmluZyBjb25zdCAmIHBhcnRpYWwsCiAgICAgICAgICAgICAgICAgICBzZXQ8bWFu
aWZlc3RfaWQ+ICYgY29tcGxldGlvbnMpCnsKICByZXN1bHRzIHJlczsKICBjb21wbGV0aW9u
cy5jbGVhcigpOwoKICBmZXRjaChyZXMsIDEsIGFueV9yb3dzLAogICAgICAgICJTRUxFQ1Qg
aWQgRlJPTSBtYW5pZmVzdHMgV0hFUkUgaWQgR0xPQiAnJXEqJyIsCiAgICAgICAgcGFydGlh
bC5jX3N0cigpKTsKCiAgZm9yIChzaXplX3QgaSA9IDA7IGkgPCByZXMuc2l6ZSgpOyArK2kp
CiAgICBjb21wbGV0aW9ucy5pbnNlcnQobWFuaWZlc3RfaWQocmVzW2ldWzBdKSk7ICAKICAK
ICByZXMuY2xlYXIoKTsKCiAgZmV0Y2gocmVzLCAxLCBhbnlfcm93cywKICAgICAgICAiU0VM
RUNUIGlkIEZST00gbWFuaWZlc3RfZGVsdGFzIFdIRVJFIGlkIEdMT0IgJyVxKiciLAogICAg
ICAgIHBhcnRpYWwuY19zdHIoKSk7CgogIGZvciAoc2l6ZV90IGkgPSAwOyBpIDwgcmVzLnNp
emUoKTsgKytpKQogICAgY29tcGxldGlvbnMuaW5zZXJ0KG1hbmlmZXN0X2lkKHJlc1tpXVsw
XSkpOyAgCn0KCnZvaWQgCmRhdGFiYXNlOjpjb21wbGV0ZShzdHJpbmcgY29uc3QgJiBwYXJ0
aWFsLAogICAgICAgICAgICAgICAgICAgc2V0PGZpbGVfaWQ+ICYgY29tcGxldGlvbnMpCnsK
ICByZXN1bHRzIHJlczsKICBjb21wbGV0aW9ucy5jbGVhcigpOwoKICBmZXRjaChyZXMsIDEs
IGFueV9yb3dzLAogICAgICAgICJTRUxFQ1QgaWQgRlJPTSBmaWxlcyBXSEVSRSBpZCBHTE9C
ICclcSonIiwKICAgICAgICBwYXJ0aWFsLmNfc3RyKCkpOwoKICBmb3IgKHNpemVfdCBpID0g
MDsgaSA8IHJlcy5zaXplKCk7ICsraSkKICAgIGNvbXBsZXRpb25zLmluc2VydChmaWxlX2lk
KHJlc1tpXVswXSkpOyAgCiAgCiAgcmVzLmNsZWFyKCk7CgogIGZldGNoKHJlcywgMSwgYW55
X3Jvd3MsCiAgICAgICAgIlNFTEVDVCBpZCBGUk9NIGZpbGVfZGVsdGFzIFdIRVJFIGlkIEdM
T0IgJyVxKiciLAogICAgICAgIHBhcnRpYWwuY19zdHIoKSk7CgogIGZvciAoc2l6ZV90IGkg
PSAwOyBpIDwgcmVzLnNpemUoKTsgKytpKQogICAgY29tcGxldGlvbnMuaW5zZXJ0KGZpbGVf
aWQocmVzW2ldWzBdKSk7ICAKfQoKdXNpbmcgY29tbWFuZHM6OnNlbGVjdG9yX3R5cGU7Cgpz
dGF0aWMgdm9pZCBzZWxlY3Rvcl90b19jZXJ0bmFtZShzZWxlY3Rvcl90eXBlIHR5LAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgJiBzKQp7CiAgc3dpdGNoICh0
eSkKICAgIHsKICAgIGNhc2UgY29tbWFuZHM6OnNlbF9hdXRob3I6CiAgICAgIHMgPSBhdXRo
b3JfY2VydF9uYW1lOwogICAgICBicmVhazsKICAgIGNhc2UgY29tbWFuZHM6OnNlbF9icmFu
Y2g6CiAgICAgIHMgPSBicmFuY2hfY2VydF9uYW1lOwogICAgICBicmVhazsKICAgIGNhc2Ug
Y29tbWFuZHM6OnNlbF9kYXRlOgogICAgICBzID0gZGF0ZV9jZXJ0X25hbWU7CiAgICAgIGJy
ZWFrOwogICAgY2FzZSBjb21tYW5kczo6c2VsX3RhZzoKICAgICAgcyA9IHRhZ19jZXJ0X25h
bWU7CiAgICAgIGJyZWFrOwogICAgY2FzZSBjb21tYW5kczo6c2VsX2lkZW50OgogICAgY2Fz
ZSBjb21tYW5kczo6c2VsX3Vua25vd246CiAgICAgIEkoZmFsc2UpOyAvLyBkb24ndCBkbyB0
aGlzLgogICAgICBicmVhazsKICAgIH0KfQoKdm9pZCBkYXRhYmFzZTo6Y29tcGxldGUoc2Vs
ZWN0b3JfdHlwZSB0eSwKICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIGNvbnN0ICYg
cGFydGlhbCwKICAgICAgICAgICAgICAgICAgICAgICAgdmVjdG9yPHBhaXI8c2VsZWN0b3Jf
dHlwZSwgc3RyaW5nPiA+IGNvbnN0ICYgbGltaXQsCiAgICAgICAgICAgICAgICAgICAgICAg
IHNldDxzdHJpbmc+ICYgY29tcGxldGlvbnMpCnsKICBjb21wbGV0aW9ucy5jbGVhcigpOwoK
ICAvLyBzdGVwIDE6IHRoZSBsaW1pdCBpcyB0cmFuc2Zvcm1lZCBpbnRvIGFuIFNRTCBzZWxl
Y3Qgc3RhdGVtZW50IHdoaWNoCiAgLy8gc2VsZWN0cyBhIHNldCBvZiBJRHMgZnJvbSB0aGUg
bWFuaWZlc3RfY2VydHMgdGFibGUgd2hpY2ggbWF0Y2ggdGhlCiAgLy8gbGltaXQuICB0aGlz
IGlzIGRvbmUgYnkgYnVpbGRpbmcgYW4gU1FMIHNlbGVjdCBzdGF0ZW1lbnQgZm9yIGVhY2gg
dGVybQogIC8vIGluIHRoZSBsaW1pdCBhbmQgdGhlbiBJTlRFUlNFQ1RpbmcgdGhlbSBhbGwu
CgogIHN0cmluZyBsaW0gPSAiKCI7CiAgYm9vbCBmaXJzdF9saW1pdCA9IHRydWU7CiAgZm9y
ICh2ZWN0b3I8cGFpcjxzZWxlY3Rvcl90eXBlLCBzdHJpbmc+ID46OmNvbnN0X2l0ZXJhdG9y
IGkgPSBsaW1pdC5iZWdpbigpOwogICAgICAgaSAhPSBsaW1pdC5lbmQoKTsgKytpKQogICAg
ewogICAgICBpZiAoZmlyc3RfbGltaXQpCiAgICAgICAgZmlyc3RfbGltaXQgPSBmYWxzZTsK
ICAgICAgZWxzZQogICAgICAgIGxpbSArPSAiIElOVEVSU0VDVCAiOwogICAgICAKICAgICAg
aWYgKGktPmZpcnN0ID09IGNvbW1hbmRzOjpzZWxfaWRlbnQpCiAgICAgICAgewogICAgICAg
ICAgbGltICs9ICJTRUxFQ1QgaWQgRlJPTSByZXZpc2lvbl9jZXJ0cyAiOwogICAgICAgICAg
bGltICs9IChGKCJXSEVSRSBpZCBHTE9CICclcyonIikgCiAgICAgICAgICAgICAgICAgICUg
aS0+c2Vjb25kKS5zdHIoKTsKICAgICAgICB9CiAgICAgIGVsc2UgaWYgKGktPmZpcnN0ID09
IGNvbW1hbmRzOjpzZWxfdW5rbm93bikKICAgICAgICB7CiAgICAgICAgICBsaW0gKz0gIlNF
TEVDVCBpZCBGUk9NIHJldmlzaW9uX2NlcnRzICI7CiAgICAgICAgICBsaW0gKz0gKEYoIiBX
SEVSRSAobmFtZT0nJXMnIE9SIG5hbWU9JyVzJyBPUiBuYW1lPSclcycpIikKICAgICAgICAg
ICAgICAgICAgJSBhdXRob3JfY2VydF9uYW1lIAogICAgICAgICAgICAgICAgICAlIHRhZ19j
ZXJ0X25hbWUgCiAgICAgICAgICAgICAgICAgICUgYnJhbmNoX2NlcnRfbmFtZSkuc3RyKCk7
CiAgICAgICAgICBsaW0gKz0gKEYoIiBBTkQgdW5iYXNlNjQodmFsdWUpIGdsb2IgJyolcyon
IikKICAgICAgICAgICAgICAgICAgJSBpLT5zZWNvbmQpLnN0cigpOyAgICAgCiAgICAgICAg
fQogICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgc3RyaW5nIGNlcnRuYW1lOwogICAg
ICAgICAgc2VsZWN0b3JfdG9fY2VydG5hbWUoaS0+Zmlyc3QsIGNlcnRuYW1lKTsKICAgICAg
ICAgIGxpbSArPSAiU0VMRUNUIGlkIEZST00gcmV2aXNpb25fY2VydHMgIjsKICAgICAgICAg
IGxpbSArPSAoRigiV0hFUkUgbmFtZT0nJXMnIEFORCB1bmJhc2U2NCh2YWx1ZSkgZ2xvYiAn
KiVzKiciKQogICAgICAgICAgICAgICAgICAlIGNlcnRuYW1lICUgaS0+c2Vjb25kKS5zdHIo
KTsKICAgICAgICB9CiAgICB9CiAgbGltICs9ICIpIjsKICAKICAvLyBzdGVwIDI6IGRlcGVu
ZGluZyBvbiB3aGF0IHdlJ3ZlIGJlZW4gYXNrZWQgdG8gZGlzYW1iaWd1YXRlLCB3ZQogIC8v
IHdpbGwgY29tcGxldGUgZWl0aGVyIHNvbWUgaWRlbnRzLCBvciBjZXJ0IHZhbHVlcywgb3Ig
InVua25vd24iCiAgLy8gd2hpY2ggZ2VuZXJhbGx5IG1lYW5zICJhdXRob3IsIHRhZyBvciBi
cmFuY2giCgogIHN0cmluZyBxdWVyeTsKICBpZiAodHkgPT0gY29tbWFuZHM6OnNlbF9pZGVu
dCkKICAgIHsKICAgICAgcXVlcnkgPSAoRigiU0VMRUNUIGlkIEZST00gJXMiKSAlIGxpbSku
c3RyKCk7CiAgICB9CiAgZWxzZSAKICAgIHsKICAgICAgcXVlcnkgPSAiU0VMRUNUIHZhbHVl
IEZST00gcmV2aXNpb25fY2VydHMgV0hFUkUiOwogICAgICBpZiAodHkgPT0gY29tbWFuZHM6
OnNlbF91bmtub3duKQogICAgICAgIHsgICAgICAgICAgICAgICAKICAgICAgICAgIHF1ZXJ5
ICs9IAogICAgICAgICAgICAoRigiIChuYW1lPSclcycgT1IgbmFtZT0nJXMnIE9SIG5hbWU9
JyVzJykiKQogICAgICAgICAgICAgJSBhdXRob3JfY2VydF9uYW1lIAogICAgICAgICAgICAg
JSB0YWdfY2VydF9uYW1lIAogICAgICAgICAgICAgJSBicmFuY2hfY2VydF9uYW1lKS5zdHIo
KTsKICAgICAgICB9CiAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICBzdHJpbmcgY2Vy
dG5hbWU7CiAgICAgICAgICBzZWxlY3Rvcl90b19jZXJ0bmFtZSh0eSwgY2VydG5hbWUpOwog
ICAgICAgICAgcXVlcnkgKz0gCiAgICAgICAgICAgIChGKCIgKG5hbWU9JyVzJykiKSAlIGNl
cnRuYW1lKS5zdHIoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgIHF1ZXJ5ICs9IChGKCIg
QU5EICh1bmJhc2U2NCh2YWx1ZSkgR0xPQiAnKiVzKicpIikgJSBwYXJ0aWFsKS5zdHIoKTsK
ICAgICAgcXVlcnkgKz0gKEYoIiBBTkQgKGlkIElOICVzKSIpICUgbGltKS5zdHIoKTsKICAg
IH0KCiAgcmVzdWx0cyByZXM7CiAgZmV0Y2gocmVzLCBvbmVfY29sLCBhbnlfcm93cywgcXVl
cnkuY19zdHIoKSk7CiAgZm9yIChzaXplX3QgaSA9IDA7IGkgPCByZXMuc2l6ZSgpOyArK2kp
CiAgICB7CiAgICAgIGlmICh0eSA9PSBjb21tYW5kczo6c2VsX2lkZW50KQogICAgICAgIGNv
bXBsZXRpb25zLmluc2VydChyZXNbaV1bMF0pOwogICAgICBlbHNlCiAgICAgICAgewogICAg
ICAgICAgYmFzZTY0PGRhdGE+IHJvd19lbmNvZGVkKHJlc1tpXVswXSk7CiAgICAgICAgICBk
YXRhIHJvd19kZWNvZGVkOwogICAgICAgICAgZGVjb2RlX2Jhc2U2NChyb3dfZW5jb2RlZCwg
cm93X2RlY29kZWQpOwogICAgICAgICAgY29tcGxldGlvbnMuaW5zZXJ0KHJvd19kZWNvZGVk
KCkpOwogICAgICAgIH0KICAgIH0KfQoKCi8vIG1lcmtsZSBub2RlcwoKYm9vbCAKZGF0YWJh
c2U6Om1lcmtsZV9ub2RlX2V4aXN0cyhzdHJpbmcgY29uc3QgJiB0eXBlLAogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHV0ZjggY29uc3QgJiBjb2xsZWN0aW9uLCAKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBzaXplX3QgbGV2ZWwsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgaGV4ZW5jPHByZWZpeD4gY29uc3QgJiBwcmVmaXgpCnsKICByZXN1bHRzIHJl
czsKICBmZXRjaChyZXMsIG9uZV9jb2wsIG9uZV9yb3csIAogICAgICAgICJTRUxFQ1QgQ09V
TlQoKikgIgogICAgICAgICJGUk9NIG1lcmtsZV9ub2RlcyAiCiAgICAgICAgIldIRVJFIHR5
cGUgPSAnJXEnICIKICAgICAgICAiQU5EIGNvbGxlY3Rpb24gPSAnJXEnICIKICAgICAgICAi
QU5EIGxldmVsID0gJWQgIgogICAgICAgICJBTkQgcHJlZml4ID0gJyVxJyAiLAogICAgICAg
IHR5cGUuY19zdHIoKSwgY29sbGVjdGlvbigpLmNfc3RyKCksIGxldmVsLCBwcmVmaXgoKS5j
X3N0cigpKTsKICBzaXplX3Qgbl9ub2RlcyA9IGxleGljYWxfY2FzdDxzaXplX3Q+KHJlc1sw
XVswXSk7CiAgSShuX25vZGVzID09IDAgfHwgbl9ub2RlcyA9PSAxKTsKICByZXR1cm4gbl9u
b2RlcyA9PSAxOwp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X21lcmtsZV9ub2RlKHN0cmluZyBj
b25zdCAmIHR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgdXRmOCBjb25zdCAmIGNv
bGxlY3Rpb24sIAogICAgICAgICAgICAgICAgICAgICAgICAgIHNpemVfdCBsZXZlbCwKICAg
ICAgICAgICAgICAgICAgICAgICAgICBoZXhlbmM8cHJlZml4PiBjb25zdCAmIHByZWZpeCwK
ICAgICAgICAgICAgICAgICAgICAgICAgICBiYXNlNjQ8bWVya2xlPiAmIG5vZGUpCnsKICBy
ZXN1bHRzIHJlczsKICBmZXRjaChyZXMsIG9uZV9jb2wsIG9uZV9yb3csIAogICAgICAgICJT
RUxFQ1QgYm9keSAiCiAgICAgICAgIkZST00gbWVya2xlX25vZGVzICIKICAgICAgICAiV0hF
UkUgdHlwZSA9ICclcScgIgogICAgICAgICJBTkQgY29sbGVjdGlvbiA9ICclcScgIgogICAg
ICAgICJBTkQgbGV2ZWwgPSAlZCAiCiAgICAgICAgIkFORCBwcmVmaXggPSAnJXEnIiwKICAg
ICAgICB0eXBlLmNfc3RyKCksIGNvbGxlY3Rpb24oKS5jX3N0cigpLCBsZXZlbCwgcHJlZml4
KCkuY19zdHIoKSk7CiAgbm9kZSA9IHJlc1swXVswXTsKfQoKdm9pZCAKZGF0YWJhc2U6OnB1
dF9tZXJrbGVfbm9kZShzdHJpbmcgY29uc3QgJiB0eXBlLAogICAgICAgICAgICAgICAgICAg
ICAgICAgIHV0ZjggY29uc3QgJiBjb2xsZWN0aW9uLCAKICAgICAgICAgICAgICAgICAgICAg
ICAgICBzaXplX3QgbGV2ZWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgaGV4ZW5jPHBy
ZWZpeD4gY29uc3QgJiBwcmVmaXgsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgYmFzZTY0PG1lcmtsZT4gY29uc3Qg
JiBub2RlKQp7CiAgZXhlY3V0ZSgiSU5TRVJUIE9SIFJFUExBQ0UgIgogICAgICAgICAgIklO
VE8gbWVya2xlX25vZGVzICIKICAgICAgICAgICJWQUxVRVMgKCclcScsICclcScsICVkLCAn
JXEnLCAnJXEnKSIsCiAgICAgICAgICB0eXBlLmNfc3RyKCksIGNvbGxlY3Rpb24oKS5jX3N0
cigpLCBsZXZlbCwgcHJlZml4KCkuY19zdHIoKSwgbm9kZSgpLmNfc3RyKCkpOwp9Cgp2b2lk
IApkYXRhYmFzZTo6ZXJhc2VfbWVya2xlX25vZGVzKHN0cmluZyBjb25zdCAmIHR5cGUsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRmOCBjb25zdCAmIGNvbGxlY3Rpb24pCnsK
ICBleGVjdXRlKCJERUxFVEUgRlJPTSBtZXJrbGVfbm9kZXMgIgogICAgICAgICAgIldIRVJF
IHR5cGUgPSAnJXEnICIKICAgICAgICAgICJBTkQgY29sbGVjdGlvbiA9ICclcSciLAogICAg
ICAgICAgdHlwZS5jX3N0cigpLCBjb2xsZWN0aW9uKCkuY19zdHIoKSk7Cn0KCi8vIHRyYW5z
YWN0aW9uIGd1YXJkcwoKdHJhbnNhY3Rpb25fZ3VhcmQ6OnRyYW5zYWN0aW9uX2d1YXJkKGRh
dGFiYXNlICYgZCkgOiBjb21taXR0ZWQoZmFsc2UpLCBkYihkKSAKewogIGRiLmJlZ2luX3Ry
YW5zYWN0aW9uKCk7Cn0KdHJhbnNhY3Rpb25fZ3VhcmQ6On50cmFuc2FjdGlvbl9ndWFyZCgp
CnsKICBpZiAoY29tbWl0dGVkKQogICAgZGIuY29tbWl0X3RyYW5zYWN0aW9uKCk7CiAgZWxz
ZQogICAgZGIucm9sbGJhY2tfdHJhbnNhY3Rpb24oKTsKfQoKdm9pZCAKdHJhbnNhY3Rpb25f
Z3VhcmQ6OmNvbW1pdCgpCnsKICBjb21taXR0ZWQgPSB0cnVlOwp9Cgo=
])

AT_DATA(right.b64, [Ly8gY29weXJpZ2h0IChDKSAyMDAyLCAyMDAzIGdyYXlkb24gaG9hcmUgPGdyYXlkb25AcG9i
b3guY29tPgovLyBhbGwgcmlnaHRzIHJlc2VydmVkLgovLyBsaWNlbnNlZCB0byB0aGUgcHVi
bGljIHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdQTCAoPj0gMikKLy8gc2VlIHRoZSBm
aWxlIENPUFlJTkcgZm9yIGRldGFpbHMKCiNpbmNsdWRlIDxpdGVyYXRvcj4KI2luY2x1ZGUg
PGxpc3Q+CiNpbmNsdWRlIDxzZXQ+CiNpbmNsdWRlIDxzc3RyZWFtPgojaW5jbHVkZSA8dmVj
dG9yPgoKI2luY2x1ZGUgPHN0ZGFyZy5oPgoKI2luY2x1ZGUgPGJvb3N0L3NoYXJlZF9wdHIu
aHBwPgojaW5jbHVkZSA8Ym9vc3QvbGV4aWNhbF9jYXN0LmhwcD4KI2luY2x1ZGUgPGJvb3N0
L2ZpbGVzeXN0ZW0vcGF0aC5ocHA+CiNpbmNsdWRlIDxib29zdC9maWxlc3lzdGVtL29wZXJh
dGlvbnMuaHBwPgoKI2luY2x1ZGUgPHNxbGl0ZS5oPgoKI2luY2x1ZGUgImFwcF9zdGF0ZS5o
aCIKI2luY2x1ZGUgImNlcnQuaGgiCiNpbmNsdWRlICJjbGVhbnVwLmhoIgojaW5jbHVkZSAi
Y29uc3RhbnRzLmhoIgojaW5jbHVkZSAiZGF0YWJhc2UuaGgiCiNpbmNsdWRlICJrZXlzLmho
IgojaW5jbHVkZSAic2FuaXR5LmhoIgojaW5jbHVkZSAic2NoZW1hX21pZ3JhdGlvbi5oaCIK
I2luY2x1ZGUgImNlcnQuaGgiCiNpbmNsdWRlICJ0cmFuc2Zvcm1zLmhoIgojaW5jbHVkZSAi
dWkuaGgiCiNpbmNsdWRlICJ2b2NhYi5oaCIKI2luY2x1ZGUgInhkZWx0YS5oaCIKCi8vIGRl
ZmluZWQgaW4gc2NoZW1hLnNxbCwgY29udmVydGVkIHRvIGhlYWRlcjoKI2luY2x1ZGUgInNj
aGVtYS5oIgoKLy8gZGVmaW5lZCBpbiB2aWV3cy5zcWwsIGNvbnZlcnRlZCB0byBoZWFkZXI6
CiNpbmNsdWRlICJ2aWV3cy5oIgoKLy8gdGhpcyBmaWxlIGRlZmluZXMgYSBwdWJsaWMsIHR5
cGVkIGludGVyZmFjZSB0byB0aGUgZGF0YWJhc2UuCi8vIHRoZSBkYXRhYmFzZSBjbGFzcyBl
bmNhcHN1bGF0ZXMgYWxsIGtub3dsZWRnZSBhYm91dCBzcWxpdGUsCi8vIHRoZSBzY2hlbWEs
IGFuZCBhbGwgU1FMIHN0YXRlbWVudHMgdXNlZCB0byBhY2Nlc3MgdGhlIHNjaGVtYS4KLy8K
Ly8gc2VlIGZpbGUgc2NoZW1hLnNxbCBmb3IgdGhlIHRleHQgb2YgdGhlIHNjaGVtYS4KCnVz
aW5nIGJvb3N0OjpzaGFyZWRfcHRyOwp1c2luZyBib29zdDo6bGV4aWNhbF9jYXN0Owp1c2lu
ZyBuYW1lc3BhY2Ugc3RkOwoKaW50IGNvbnN0IG9uZV9yb3cgPSAxOwppbnQgY29uc3Qgb25l
X2NvbCA9IDE7CmludCBjb25zdCBhbnlfcm93cyA9IC0xOwppbnQgY29uc3QgYW55X2NvbHMg
PSAtMTsKCmV4dGVybiAiQyIgewogIC8vIHN0cmFuZ2VseSB0aGlzIGlzbid0IGRlY2xhcmVk
LCBldmVuIHRob3VnaCBpdCdzIHByZXNlbnQgaW4gbXkgc3FsaXRlLgogIGNoYXIgKnNxbGl0
ZV92bXByaW50Zihjb25zdCBjaGFyICp6Rm9ybWF0LCB2YV9saXN0KTsKfQoKZGF0YWJhc2U6
OmRhdGFiYXNlKGZzOjpwYXRoIGNvbnN0ICYgZm4pIDoKICBmaWxlbmFtZShmbiksCiAgLy8g
bmIuIHVwZGF0ZSB0aGlzIGlmIHlvdSBjaGFuZ2UgdGhlIHNjaGVtYS4gdW5mb3J0dW5hdGVs
eSB3ZSBhcmUgbm90CiAgLy8gdXNpbmcgc2VsZi1kaWdlc3Rpbmcgc2NoZW1hcyBkdWUgdG8g
Y29tbWVudCBpcnJlZ3VsYXJpdGllcyBhbmQKICAvLyBub24tYWxwaGFiZXRpYyBvcmRlcmlu
ZyBvZiB0YWJsZXMgaW4gc3FsIHNvdXJjZSBmaWxlcy4gd2UgY291bGQgY3JlYXRlCiAgLy8g
YSB0ZW1wb3JhcnkgZGIsIHdyaXRlIG91ciBpbnRlbmRlZCBzY2hlbWEgaW50byBpdCwgYW5k
IHJlYWQgaXQgYmFjaywKICAvLyBidXQgdGhpcyBzZWVtcyBsaWtlIGl0IHdvdWxkIGJlIHRv
byBydWRlLiBwb3NzaWJseSByZXZpc2l0IHRoaXMgaXNzdWUuCiAgc2NoZW1hKCJjMWU4NjU4
OGUxMWFkMDdmYTUzZTVkMjk0ZWRjMDQzY2UxZDQwMDVhIiksCiAgX19zcWwoTlVMTCksCiAg
dHJhbnNhY3Rpb25fbGV2ZWwoMCkKe30KCnZvaWQgCmRhdGFiYXNlOjpjaGVja19zY2hlbWEo
KQp7CiAgc3RyaW5nIGRiX3NjaGVtYV9pZDsgIAogIGNhbGN1bGF0ZV9zY2hlbWFfaWQgKF9f
c3FsLCBkYl9zY2hlbWFfaWQpOwogIE4gKHNjaGVtYSA9PSBkYl9zY2hlbWFfaWQsCiAgICAg
RigiZGF0YWJhc2Ugc2NoZW1hcyBkbyBub3QgbWF0Y2g6ICIKICAgICAgICJ3YW50ZWQgJXMs
IGdvdCAlcy4gdHJ5IG1pZ3JhdGluZyBkYXRhYmFzZSIpIAogICAgICUgc2NoZW1hICUgZGJf
c2NoZW1hX2lkKTsKfQoKc3RhdGljIHZvaWQgCnNxbGl0ZV91bmJhc2U2NF9mbihzcWxpdGVf
ZnVuYyAqZiwgaW50IG5hcmdzLCBjaGFyIGNvbnN0ICoqIGFyZ3MpCnsKICBpZiAobmFyZ3Mg
IT0gMSkKICAgIHsKICAgICAgc3FsaXRlX3NldF9yZXN1bHRfZXJyb3IoZiwgIm5lZWQgZXhh
Y3RseSAxIGFyZyB0byB1bmJhc2U2NCgpIiwgLTEpOwogICAgICByZXR1cm47CiAgICB9CiAg
ZGF0YSBkZWNvZGVkOwogIGRlY29kZV9iYXNlNjQoYmFzZTY0PGRhdGE+KHN0cmluZyhhcmdz
WzBdKSksIGRlY29kZWQpOwogIHNxbGl0ZV9zZXRfcmVzdWx0X3N0cmluZyhmLCBkZWNvZGVk
KCkuY19zdHIoKSwgZGVjb2RlZCgpLnNpemUoKSk7Cn0KCnZvaWQgCmRhdGFiYXNlOjpzZXRf
YXBwKGFwcF9zdGF0ZSAqIGFwcCkKewogIF9fYXBwID0gYXBwOwp9CgpzdHJ1Y3Qgc3FsaXRl
ICogCmRhdGFiYXNlOjpzcWwoYm9vbCBpbml0KQp7CiAgaWYgKCEgX19zcWwpCiAgICB7CiAg
ICAgIGlmICghIGluaXQpCgl7CgkgIGlmIChmaWxlbmFtZS5zdHJpbmcoKSA9PSAiIikKCSAg
ICB0aHJvdyBpbmZvcm1hdGl2ZV9mYWlsdXJlKHN0cmluZygibm8gZGF0YWJhc2Ugc3BlY2lm
aWVkIikpOwoJICBlbHNlIGlmICghIGZzOjpleGlzdHMoZmlsZW5hbWUpKQoJICAgIHRocm93
IGluZm9ybWF0aXZlX2ZhaWx1cmUoc3RyaW5nKCJkYXRhYmFzZSAiKSArIGZpbGVuYW1lLnN0
cmluZygpICsKCQkJCSAgICAgIHN0cmluZygiIGRvZXMgbm90IGV4aXN0IikpOwoJfQogICAg
ICBOKGZpbGVuYW1lLnN0cmluZygpICE9ICIiLAoJRigibmVlZCBkYXRhYmFzZSBuYW1lIikp
OwogICAgICBjaGFyICogZXJybXNnID0gTlVMTDsKICAgICAgX19zcWwgPSBzcWxpdGVfb3Bl
bihmaWxlbmFtZS5zdHJpbmcoKS5jX3N0cigpLCAwNzU1LCAmZXJybXNnKTsKICAgICAgaWYg
KCEgX19zcWwpCgl0aHJvdyBvb3BzKHN0cmluZygiY291bGQgbm90IG9wZW4gZGF0YWJhc2U6
ICIpICsgZmlsZW5hbWUuc3RyaW5nKCkgKyAKCQkgICAoZXJybXNnID8gKCI6ICIgKyBzdHJp
bmcoZXJybXNnKSkgOiAiIikpOwogICAgICBpZiAoaW5pdCkKCWV4ZWN1dGUoc2NoZW1hX2Nv
bnN0YW50KTsKCiAgICAgIGNoZWNrX3NjaGVtYSgpOwogICAgICBpbnN0YWxsX2Z1bmN0aW9u
cyhfX2FwcCk7CiAgICAgIGluc3RhbGxfdmlld3MoKTsKICAgIH0KICByZXR1cm4gX19zcWw7
Cn0KCnZvaWQgCmRhdGFiYXNlOjppbml0aWFsaXplKCkKewogIGlmIChfX3NxbCkKICAgIHRo
cm93IG9vcHMoImNhbm5vdCBpbml0aWFsaXplIGRhdGFiYXNlIHdoaWxlIGl0IGlzIG9wZW4i
KTsKCiAgTighZnM6OmV4aXN0cyhmaWxlbmFtZSksCiAgICBGKCJjb3VsZCBub3QgaW5pdGlh
bGl6ZSBkYXRhYmFzZTogJXM6IGFscmVhZHkgZXhpc3RzIikgCiAgICAlIGZpbGVuYW1lLnN0
cmluZygpKTsKCiAgZnM6OnBhdGggam91cm5hbCA9IG1rcGF0aChmaWxlbmFtZS5zdHJpbmco
KSArICItam91cm5hbCIpOwogIE4oIWZzOjpleGlzdHMoam91cm5hbCksCiAgICBGKCJleGlz
dGluZyAocG9zc2libHkgc3RhbGUpIGpvdXJuYWwgZmlsZSAnJXMnIGhhcyBzYW1lIHN0ZW0g
YXMgbmV3IGRhdGFiYXNlICclcyciKQogICAgJSBqb3VybmFsLnN0cmluZygpICUgZmlsZW5h
bWUuc3RyaW5nKCkpOwoKICBzcWxpdGUgKnMgPSBzcWwodHJ1ZSk7CiAgSShzICE9IE5VTEwp
Owp9CgoKc3RydWN0IApkdW1wX3JlcXVlc3QKewogIGR1bXBfcmVxdWVzdCgpIHt9OwogIHN0
cnVjdCBzcWxpdGUgKnNxbDsKICBzdHJpbmcgdGFibGVfbmFtZTsKICBvc3RyZWFtICpvdXQ7
Cn07CgpzdGF0aWMgaW50IApkdW1wX3Jvd19jYih2b2lkICpkYXRhLCBpbnQgbiwgY2hhciAq
KnZhbHMsIGNoYXIgKipjb2xzKQp7CiAgZHVtcF9yZXF1ZXN0ICpkdW1wID0gcmVpbnRlcnBy
ZXRfY2FzdDxkdW1wX3JlcXVlc3QgKj4oZGF0YSk7CiAgSShkdW1wICE9IE5VTEwpOwogIEko
dmFscyAhPSBOVUxMKTsKICBJKGR1bXAtPm91dCAhPSBOVUxMKTsKICAqKGR1bXAtPm91dCkg
PDwgRigiSU5TRVJUIElOVE8gJXMgVkFMVUVTKCIpICUgZHVtcC0+dGFibGVfbmFtZTsKICBm
b3IgKGludCBpID0gMDsgaSA8IG47ICsraSkKICAgIHsKICAgICAgaWYgKGkgIT0gMCkKCSoo
ZHVtcC0+b3V0KSA8PCAnLCc7CgogICAgICBpZiAodmFsc1tpXSA9PSBOVUxMKQoJKihkdW1w
LT5vdXQpIDw8ICJOVUxMIjsKICAgICAgZWxzZQoJewoJICAqKGR1bXAtPm91dCkgPDwgIici
OwoJICBmb3IgKGNoYXIgKmNwID0gdmFsc1tpXTsgKmNwOyArK2NwKQoJICAgIHsKCSAgICAg
IGlmICgqY3AgPT0gJ1wnJykKCQkqKGR1bXAtPm91dCkgPDwgIicnIjsKCSAgICAgIGVsc2UK
CQkqKGR1bXAtPm91dCkgPDwgKmNwOwoJICAgIH0KCSAgKihkdW1wLT5vdXQpIDw8ICInIjsK
CX0KICAgIH0KICAqKGR1bXAtPm91dCkgPDwgIik7XG4iOyAgCiAgcmV0dXJuIDA7Cn0KCnN0
YXRpYyBpbnQgCmR1bXBfdGFibGVfY2Iodm9pZCAqZGF0YSwgaW50IG4sIGNoYXIgKip2YWxz
LCBjaGFyICoqY29scykKewogIGR1bXBfcmVxdWVzdCAqZHVtcCA9IHJlaW50ZXJwcmV0X2Nh
c3Q8ZHVtcF9yZXF1ZXN0ICo+KGRhdGEpOwogIEkoZHVtcCAhPSBOVUxMKTsKICBJKGR1bXAt
PnNxbCAhPSBOVUxMKTsKICBJKHZhbHMgIT0gTlVMTCk7CiAgSSh2YWxzWzBdICE9IE5VTEwp
OwogIEkodmFsc1sxXSAhPSBOVUxMKTsKICBJKHZhbHNbMl0gIT0gTlVMTCk7CiAgSShuID09
IDMpOwogIGlmIChzdHJpbmcodmFsc1sxXSkgPT0gInRhYmxlIikKICAgIHsKICAgICAgKihk
dW1wLT5vdXQpIDw8IHZhbHNbMl0gPDwgIjtcbiI7CiAgICAgIGR1bXAtPnRhYmxlX25hbWUg
PSBzdHJpbmcodmFsc1swXSk7CiAgICAgIHNxbGl0ZV9leGVjX3ByaW50ZihkdW1wLT5zcWws
ICJTRUxFQ1QgKiBGUk9NICclcSciLCAKCQkJIGR1bXBfcm93X2NiLCBkYXRhLCBOVUxMLCB2
YWxzWzBdKTsKICAgIH0KICByZXR1cm4gMDsKfQoKdm9pZCAKZGF0YWJhc2U6OmR1bXAob3N0
cmVhbSAmIG91dCkKewogIGR1bXBfcmVxdWVzdCByZXE7CiAgcmVxLm91dCA9ICZvdXQ7CiAg
cmVxLnNxbCA9IHNxbCgpOwogIG91dCA8PCAiQkVHSU4gVFJBTlNBQ1RJT047XG4iOwogIGlu
dCByZXMgPSBzcWxpdGVfZXhlYyhyZXEuc3FsLAoJCQkiU0VMRUNUIG5hbWUsIHR5cGUsIHNx
bCBGUk9NIHNxbGl0ZV9tYXN0ZXIgIgoJCQkiV0hFUkUgdHlwZT0ndGFibGUnIEFORCBzcWwg
Tk9UIE5VTEwgIgoJCQkiT1JERVIgQlkgc3Vic3RyKHR5cGUsMiwxKSwgbmFtZSIsCgkJCWR1
bXBfdGFibGVfY2IsICZyZXEsIE5VTEwpOwogIEkocmVzID09IFNRTElURV9PSyk7CiAgb3V0
IDw8ICJDT01NSVQ7XG4iOwp9Cgp2b2lkIApkYXRhYmFzZTo6bG9hZChpc3RyZWFtICYgaW4p
CnsKICBjaGFyIGJ1Zltjb25zdGFudHM6OmJ1ZnN6XTsKICBzdHJpbmcgdG1wOwoKICBOKGZp
bGVuYW1lLnN0cmluZygpICE9ICIiLAogICAgRigibmVlZCBkYXRhYmFzZSBuYW1lIikpOwog
IGNoYXIgKiBlcnJtc2cgPSBOVUxMOwogIF9fc3FsID0gc3FsaXRlX29wZW4oZmlsZW5hbWUu
c3RyaW5nKCkuY19zdHIoKSwgMDc1NSwgJmVycm1zZyk7CiAgaWYgKCEgX19zcWwpCiAgICB0
aHJvdyBvb3BzKHN0cmluZygiY291bGQgbm90IG9wZW4gZGF0YWJhc2U6ICIpICsgZmlsZW5h
bWUuc3RyaW5nKCkgKyAKCSAgICAgICAoZXJybXNnID8gKCI6ICIgKyBzdHJpbmcoZXJybXNn
KSkgOiAiIikpOwogIAogIHdoaWxlKGluKQogICAgewogICAgICBpbi5yZWFkKGJ1ZiwgY29u
c3RhbnRzOjpidWZzeik7CiAgICAgIHRtcC5hcHBlbmQoYnVmLCBpbi5nY291bnQoKSk7CiAg
ICB9CgogIGV4ZWN1dGUodG1wLmNfc3RyKCkpOwp9CgoKdm9pZCAKZGF0YWJhc2U6OmRlYnVn
KHN0cmluZyBjb25zdCAmIHNxbCwgb3N0cmVhbSAmIG91dCkKewogIHJlc3VsdHMgcmVzOwog
IGZldGNoKHJlcywgYW55X2NvbHMsIGFueV9yb3dzLCBzcWwuY19zdHIoKSk7CiAgb3V0IDw8
ICInIiA8PCBzcWwgPDwgIicgLT4gIiA8PCByZXMuc2l6ZSgpIDw8ICIgcm93c1xuIiA8PCBl
bmRsOwogIGZvciAoc2l6ZV90IGkgPSAwOyBpIDwgcmVzLnNpemUoKTsgKytpKQogICAgewog
ICAgICBmb3IgKHNpemVfdCBqID0gMDsgaiA8IHJlc1tpXS5zaXplKCk7ICsraikKCXsKCSAg
aWYgKGogIT0gMCkKCSAgICBvdXQgPDwgIiB8ICI7CgkgIG91dCA8PCByZXNbaV1bal07Cgl9
CiAgICAgIG91dCA8PCBlbmRsOwogICAgfQp9Cgp1bnNpZ25lZCBsb25nIApkYXRhYmFzZTo6
Z2V0X3N0YXRpc3RpYyhzdHJpbmcgY29uc3QgJiBxdWVyeSkKewogIHJlc3VsdHMgcmVzOwog
IGZldGNoKHJlcywgMSwgMSwgcXVlcnkuY19zdHIoKSk7CiAgcmV0dXJuIGxleGljYWxfY2Fz
dDx1bnNpZ25lZCBsb25nPihyZXNbMF1bMF0pOwp9Cgp2b2lkIApkYXRhYmFzZTo6aW5mbyhv
c3RyZWFtICYgb3V0KQp7CiAgc3RyaW5nIGlkOwogIGNhbGN1bGF0ZV9zY2hlbWFfaWQoc3Fs
KCksIGlkKTsKICBvdXQgPDwgInNjaGVtYSB2ZXJzaW9uICA6ICIgPDwgaWQgPDwgZW5kbDsK
ICBvdXQgPDwgImZ1bGwgbWFuaWZlc3RzICA6ICIgPDwgZ2V0X3N0YXRpc3RpYygiU0VMRUNU
IENPVU5UKCopIEZST00gbWFuaWZlc3RzIikgPDwgZW5kbDsKICBvdXQgPDwgIm1hbmlmZXN0
IGRlbHRhcyA6ICIgPDwgZ2V0X3N0YXRpc3RpYygiU0VMRUNUIENPVU5UKCopIEZST00gbWFu
aWZlc3RfZGVsdGFzIikgPDwgZW5kbDsKICBvdXQgPDwgImZ1bGwgZmlsZXMgICAgICA6ICIg
PDwgZ2V0X3N0YXRpc3RpYygiU0VMRUNUIENPVU5UKCopIEZST00gZmlsZXMiKSA8PCBlbmRs
OwogIG91dCA8PCAiZmlsZSBkZWx0YXMgICAgIDogIiA8PCBnZXRfc3RhdGlzdGljKCJTRUxF
Q1QgQ09VTlQoKikgRlJPTSBmaWxlX2RlbHRhcyIpIDw8IGVuZGw7Cn0KCnZvaWQgCmRhdGFi
YXNlOjp2ZXJzaW9uKG9zdHJlYW0gJiBvdXQpCnsKICBzdHJpbmcgaWQ7CiAgY2FsY3VsYXRl
X3NjaGVtYV9pZChzcWwoKSwgaWQpOwogIG91dCA8PCAiZGF0YWJhc2Ugc2NoZW1hIHZlcnNp
b246ICIgPDwgaWQgPDwgZW5kbDsKfQoKdm9pZCAKZGF0YWJhc2U6Om1pZ3JhdGUoKQp7ICAK
ICBOKGZpbGVuYW1lLnN0cmluZygpICE9ICIiLAogICAgRigibmVlZCBkYXRhYmFzZSBuYW1l
IikpOwogIGNoYXIgKiBlcnJtc2cgPSBOVUxMOwogIF9fc3FsID0gc3FsaXRlX29wZW4oZmls
ZW5hbWUuc3RyaW5nKCkuY19zdHIoKSwgMDc1NSwgJmVycm1zZyk7CiAgaWYgKCEgX19zcWwp
CiAgICB0aHJvdyBvb3BzKHN0cmluZygiY291bGQgbm90IG9wZW4gZGF0YWJhc2U6ICIpICsg
ZmlsZW5hbWUuc3RyaW5nKCkgKyAKCSAgICAgICAoZXJybXNnID8gKCI6ICIgKyBzdHJpbmco
ZXJybXNnKSkgOiAiIikpOwogIG1pZ3JhdGVfbW9ub3RvbmVfc2NoZW1hKF9fc3FsKTsKICBz
cWxpdGVfY2xvc2UoX19zcWwpOwp9Cgp2b2lkIApkYXRhYmFzZTo6cmVoYXNoKCkKewogIHRy
YW5zYWN0aW9uX2d1YXJkIGd1YXJkKCp0aGlzKTsKICB0aWNrZXIgbWNlcnRzKCJtY2VydHMi
LCAibSIsIDEpOwogIHRpY2tlciBmY2VydHMoImZjZXJ0cyIsICJmIiwgMSk7CiAgdGlja2Vy
IHB1YmtleXMoInB1YmtleXMiLCAiKyIsIDEpOwogIHRpY2tlciBwcml2a2V5cygicHJpdmtl
eXMiLCAiISIsIDEpOwogIAogIHsKICAgIC8vIHJlaGFzaCBhbGwgbWNlcnRzCiAgICByZXN1
bHRzIHJlczsKICAgIHZlY3RvcjxjZXJ0PiBjZXJ0czsKICAgIGZldGNoKHJlcywgNSwgYW55
X3Jvd3MsIAoJICAiU0VMRUNUIGlkLCBuYW1lLCB2YWx1ZSwga2V5cGFpciwgc2lnbmF0dXJl
ICIKCSAgIkZST00gbWFuaWZlc3RfY2VydHMiKTsKICAgIHJlc3VsdHNfdG9fY2VydHMocmVz
LCBjZXJ0cyk7CiAgICBleGVjdXRlKCJERUxFVEUgRlJPTSBtYW5pZmVzdF9jZXJ0cyIpOwog
ICAgZm9yKHZlY3RvcjxjZXJ0Pjo6Y29uc3RfaXRlcmF0b3IgaSA9IGNlcnRzLmJlZ2luKCk7
IGkgIT0gY2VydHMuZW5kKCk7ICsraSkKICAgICAgewoJcHV0X2NlcnQoKmksICJtYW5pZmVz
dF9jZXJ0cyIpOwoJKyttY2VydHM7CiAgICAgIH0KICB9CgogIHsKICAgIC8vIHJlaGFzaCBh
bGwgZmNlcnRzCiAgICByZXN1bHRzIHJlczsKICAgIHZlY3RvcjxjZXJ0PiBjZXJ0czsgICAg
CiAgICBmZXRjaChyZXMsIDUsIGFueV9yb3dzLCAKCSAgIlNFTEVDVCBpZCwgbmFtZSwgdmFs
dWUsIGtleXBhaXIsIHNpZ25hdHVyZSAiCgkgICJGUk9NIGZpbGVfY2VydHMiKTsKICAgIHJl
c3VsdHNfdG9fY2VydHMocmVzLCBjZXJ0cyk7CiAgICBleGVjdXRlKCJERUxFVEUgRlJPTSBm
aWxlX2NlcnRzIik7CiAgICBmb3IodmVjdG9yPGNlcnQ+Ojpjb25zdF9pdGVyYXRvciBpID0g
Y2VydHMuYmVnaW4oKTsgaSAhPSBjZXJ0cy5lbmQoKTsgKytpKQogICAgICB7CglwdXRfY2Vy
dCgqaSwgImZpbGVfY2VydHMiKTsKCSsrZmNlcnRzOwogICAgICB9CiAgfQogIAoKICB7CiAg
ICAvLyByZWhhc2ggYWxsIHB1YmtleXMKICAgIHJlc3VsdHMgcmVzOwogICAgZmV0Y2gocmVz
LCAyLCBhbnlfcm93cywgIlNFTEVDVCBpZCwga2V5ZGF0YSBGUk9NIHB1YmxpY19rZXlzIik7
CiAgICBleGVjdXRlKCJERUxFVEUgRlJPTSBwdWJsaWNfa2V5cyIpOwogICAgZm9yIChzaXpl
X3QgaSA9IDA7IGkgPCByZXMuc2l6ZSgpOyArK2kpCiAgICAgIHsKCWhleGVuYzxpZD4gdG1w
OwoJa2V5X2hhc2hfY29kZShyc2Ffa2V5cGFpcl9pZChyZXNbaV1bMF0pLCBiYXNlNjQ8cnNh
X3B1Yl9rZXk+KHJlc1tpXVsxXSksIHRtcCk7CglleGVjdXRlKCJJTlNFUlQgSU5UTyBwdWJs
aWNfa2V5cyBWQUxVRVMoJyVxJywgJyVxJywgJyVxJykiLCAKCQl0bXAoKS5jX3N0cigpLCBy
ZXNbaV1bMF0uY19zdHIoKSwgcmVzW2ldWzFdLmNfc3RyKCkpOwoJKytwdWJrZXlzOwogICAg
ICB9CiAgfQoKewogICAgLy8gcmVoYXNoIGFsbCBwcml2a2V5cwogICAgcmVzdWx0cyByZXM7
CiAgICBmZXRjaChyZXMsIDIsIGFueV9yb3dzLCAiU0VMRUNUIGlkLCBrZXlkYXRhIEZST00g
cHJpdmF0ZV9rZXlzIik7CiAgICBleGVjdXRlKCJERUxFVEUgRlJPTSBwcml2YXRlX2tleXMi
KTsKICAgIGZvciAoc2l6ZV90IGkgPSAwOyBpIDwgcmVzLnNpemUoKTsgKytpKQogICAgICB7
CgloZXhlbmM8aWQ+IHRtcDsKCWtleV9oYXNoX2NvZGUocnNhX2tleXBhaXJfaWQocmVzW2ld
WzBdKSwgYmFzZTY0PCBhcmM0PHJzYV9wcml2X2tleT4gPihyZXNbaV1bMV0pLCB0bXApOwoJ
ZXhlY3V0ZSgiSU5TRVJUIElOVE8gcHJpdmF0ZV9rZXlzIFZBTFVFUygnJXEnLCAnJXEnLCAn
JXEnKSIsIAoJCXRtcCgpLmNfc3RyKCksIHJlc1tpXVswXS5jX3N0cigpLCByZXNbaV1bMV0u
Y19zdHIoKSk7CgkrK3ByaXZrZXlzOwogICAgICB9CiAgfQoKICBndWFyZC5jb21taXQoKTsK
fQoKdm9pZCAKZGF0YWJhc2U6OmVuc3VyZV9vcGVuKCkKewogIHNxbGl0ZSAqcyA9IHNxbCgp
OwogIEkocyAhPSBOVUxMKTsKfQoKZGF0YWJhc2U6On5kYXRhYmFzZSgpIAp7CiAgaWYgKF9f
c3FsKQogICAgewogICAgICBzcWxpdGVfY2xvc2UoX19zcWwpOwogICAgICBfX3NxbCA9IDA7
CiAgICB9Cn0KCnN0YXRpYyB2b2lkIAphc3NlcnRfc3FsaXRlX29rKGludCByZXMpCnsKICBz
d2l0Y2ggKHJlcykKICAgIHsgICAgICAKICAgIGNhc2UgU1FMSVRFX09LOiAKICAgICAgYnJl
YWs7CgogICAgY2FzZSBTUUxJVEVfRVJST1I6CiAgICAgIHRocm93IG9vcHMoIlNRTCBlcnJv
ciBvciBtaXNzaW5nIGRhdGFiYXNlIik7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgU1FMSVRF
X0lOVEVSTkFMOgogICAgICB0aHJvdyBvb3BzKCJBbiBpbnRlcm5hbCBsb2dpYyBlcnJvciBp
biBTUUxpdGUiKTsKICAgICAgYnJlYWs7CgogICAgY2FzZSBTUUxJVEVfUEVSTToKICAgICAg
dGhyb3cgb29wcygiQWNjZXNzIHBlcm1pc3Npb24gZGVuaWVkIik7CiAgICAgIGJyZWFrOwoK
ICAgIGNhc2UgU1FMSVRFX0FCT1JUOgogICAgICB0aHJvdyBvb3BzKCJDYWxsYmFjayByb3V0
aW5lIHJlcXVlc3RlZCBhbiBhYm9ydCIpOwogICAgICBicmVhazsKCiAgICBjYXNlIFNRTElU
RV9CVVNZOgogICAgICB0aHJvdyBvb3BzKCJUaGUgZGF0YWJhc2UgZmlsZSBpcyBsb2NrZWQi
KTsKICAgICAgYnJlYWs7CgogICAgY2FzZSBTUUxJVEVfTE9DS0VEOgogICAgICB0aHJvdyBv
b3BzKCJBIHRhYmxlIGluIHRoZSBkYXRhYmFzZSBpcyBsb2NrZWQiKTsKICAgICAgYnJlYWs7
CgogICAgY2FzZSBTUUxJVEVfTk9NRU06CiAgICAgIHRocm93IG9vcHMoIkEgbWFsbG9jKCkg
ZmFpbGVkIik7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgU1FMSVRFX1JFQURPTkxZOgogICAg
ICB0aHJvdyBvb3BzKCJBdHRlbXB0IHRvIHdyaXRlIGEgcmVhZG9ubHkgZGF0YWJhc2UiKTsK
ICAgICAgYnJlYWs7CgogICAgY2FzZSBTUUxJVEVfSU5URVJSVVBUOgogICAgICB0aHJvdyBv
b3BzKCJPcGVyYXRpb24gdGVybWluYXRlZCBieSBzcWxpdGVfaW50ZXJydXB0KCkiKTsKICAg
ICAgYnJlYWs7CgogICAgY2FzZSBTUUxJVEVfSU9FUlI6CiAgICAgIHRocm93IG9vcHMoIlNv
bWUga2luZCBvZiBkaXNrIEkvTyBlcnJvciBvY2N1cnJlZCIpOwogICAgICBicmVhazsKCiAg
ICBjYXNlIFNRTElURV9DT1JSVVBUOgogICAgICB0aHJvdyBvb3BzKCJUaGUgZGF0YWJhc2Ug
ZGlzayBpbWFnZSBpcyBtYWxmb3JtZWQiKTsKICAgICAgYnJlYWs7CgogICAgY2FzZSBTUUxJ
VEVfTk9URk9VTkQ6CiAgICAgIHRocm93IG9vcHMoIihJbnRlcm5hbCBPbmx5KSBUYWJsZSBv
ciByZWNvcmQgbm90IGZvdW5kIik7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgU1FMSVRFX0ZV
TEw6CiAgICAgIHRocm93IG9vcHMoIkluc2VydGlvbiBmYWlsZWQgYmVjYXVzZSBkYXRhYmFz
ZSBpcyBmdWxsIik7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgU1FMSVRFX0NBTlRPUEVOOgog
ICAgICB0aHJvdyBvb3BzKCJVbmFibGUgdG8gb3BlbiB0aGUgZGF0YWJhc2UgZmlsZSIpOwog
ICAgICBicmVhazsKCiAgICBjYXNlIFNRTElURV9QUk9UT0NPTDoKICAgICAgdGhyb3cgb29w
cygiZGF0YWJhc2UgbG9jayBwcm90b2NvbCBlcnJvciIpOwogICAgICBicmVhazsKCiAgICBj
YXNlIFNRTElURV9FTVBUWToKICAgICAgdGhyb3cgb29wcygiKEludGVybmFsIE9ubHkpIGRh
dGFiYXNlIHRhYmxlIGlzIGVtcHR5Iik7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgU1FMSVRF
X1NDSEVNQToKICAgICAgdGhyb3cgb29wcygiVGhlIGRhdGFiYXNlIHNjaGVtYSBjaGFuZ2Vk
Iik7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgU1FMSVRFX1RPT0JJRzoKICAgICAgdGhyb3cg
b29wcygiVG9vIG11Y2ggZGF0YSBmb3Igb25lIHJvdyBvZiBhIHRhYmxlIik7CiAgICAgIGJy
ZWFrOwoKICAgIGNhc2UgU1FMSVRFX0NPTlNUUkFJTlQ6CiAgICAgIHRocm93IG9vcHMoIkFi
b3J0IGR1ZSB0byBjb250cmFpbnQgdmlvbGF0aW9uIik7CiAgICAgIGJyZWFrOwoKICAgIGNh
c2UgU1FMSVRFX01JU01BVENIOgogICAgICB0aHJvdyBvb3BzKCJEYXRhIHR5cGUgbWlzbWF0
Y2giKTsKICAgICAgYnJlYWs7CgogICAgY2FzZSBTUUxJVEVfTUlTVVNFOgogICAgICB0aHJv
dyBvb3BzKCJMaWJyYXJ5IHVzZWQgaW5jb3JyZWN0bHkiKTsKICAgICAgYnJlYWs7CgogICAg
ZGVmYXVsdDoKICAgICAgdGhyb3cgb29wcyhzdHJpbmcoIlVua25vd24gREIgcmVzdWx0IGNv
ZGU6ICIpICsgbGV4aWNhbF9jYXN0PHN0cmluZz4ocmVzKSk7CiAgICAgIGJyZWFrOwogICAg
fQp9Cgp2b2lkIApkYXRhYmFzZTo6ZXhlY3V0ZShjaGFyIGNvbnN0ICogcXVlcnksIC4uLikK
ewogIHZhX2xpc3QgYXA7CiAgaW50IHJlczsKICBjaGFyICogZXJybXNnID0gTlVMTDsKCiAg
dmFfc3RhcnQoYXAsIHF1ZXJ5KTsKCiAgLy8gbG9nIGl0CiAgY2hhciAqIGZvcm1hdHRlZCA9
IHNxbGl0ZV92bXByaW50ZihxdWVyeSwgYXApOwogIHN0cmluZyBxcShmb3JtYXR0ZWQpOwog
IGlmIChxcS5zaXplKCkgPiBjb25zdGFudHM6OmRiX2xvZ19saW5lX3N6KSAKICAgIHFxID0g
cXEuc3Vic3RyKDAsIGNvbnN0YW50czo6ZGJfbG9nX2xpbmVfc3opICsgc3RyaW5nKCIgLi4u
Iik7CiAgTChGKCJkYi5leGVjdXRlKFwiJXNcIilcbiIpICUgcXEpOwogIHNxbGl0ZV9mcmVl
bWVtKGZvcm1hdHRlZCk7CgogIHZhX2VuZChhcCk7CiAgdmFfc3RhcnQoYXAsIHF1ZXJ5KTsK
CiAgLy8gZG8gaXQKICByZXMgPSBzcWxpdGVfZXhlY192cHJpbnRmKHNxbCgpLCBxdWVyeSwg
TlVMTCwgTlVMTCwgJmVycm1zZywgYXApOwoKICB2YV9lbmQoYXApOwoKICBpZiAoZXJybXNn
KQogICAgdGhyb3cgb29wcyhzdHJpbmcoInNxbGl0ZSBleGVjIGVycm9yICIpICsgZXJybXNn
KTsKCiAgYXNzZXJ0X3NxbGl0ZV9vayhyZXMpOwoKfQoKdm9pZCAKZGF0YWJhc2U6OmZldGNo
KHJlc3VsdHMgJiByZXMsIAoJCWludCBjb25zdCB3YW50X2NvbHMsIAoJCWludCBjb25zdCB3
YW50X3Jvd3MsIAoJCWNoYXIgY29uc3QgKiBxdWVyeSwgLi4uKQp7CiAgY2hhciAqKiByZXN1
bHQgPSBOVUxMOwogIGludCBucm93OwogIGludCBuY29sOwogIGNoYXIgKiBlcnJtc2cgPSBO
VUxMOwogIGludCByZXNjb2RlOwoKICB2YV9saXN0IGFwOwogIHJlcy5jbGVhcigpOwogIHJl
cy5yZXNpemUoMCk7CiAgdmFfc3RhcnQoYXAsIHF1ZXJ5KTsKCiAgLy8gbG9nIGl0CiAgY2hh
ciAqIGZvcm1hdHRlZCA9IHNxbGl0ZV92bXByaW50ZihxdWVyeSwgYXApOwogIHN0cmluZyBx
cShmb3JtYXR0ZWQpOwogIGlmIChxcS5zaXplKCkgPiBjb25zdGFudHM6OmxvZ19saW5lX3N6
KSAKICAgIHFxID0gcXEuc3Vic3RyKDAsIGNvbnN0YW50czo6bG9nX2xpbmVfc3opICsgc3Ry
aW5nKCIgLi4uIik7CiAgTChGKCJkYi5mZXRjaChcIiVzXCIpXG4iKSAlIHFxKTsKICBzcWxp
dGVfZnJlZW1lbShmb3JtYXR0ZWQpOwoKICB2YV9lbmQoYXApOwogIHZhX3N0YXJ0KGFwLCBx
dWVyeSk7CgogIC8vIGRvIGl0CiAgcmVzY29kZSA9IHNxbGl0ZV9nZXRfdGFibGVfdnByaW50
ZihzcWwoKSwgcXVlcnksICZyZXN1bHQsICZucm93LCAmbmNvbCwgJmVycm1zZywgYXApOwoK
ICB2YV9lbmQoYXApOwoKICBjbGVhbnVwX3B0cjxjaGFyICoqLCB2b2lkPiAKICAgIHJlc3Vs
dF9ndWFyZChyZXN1bHQsICZzcWxpdGVfZnJlZV90YWJsZSk7CgogIHN0cmluZyBjdHggPSBz
dHJpbmcoImRiIHF1ZXJ5IFsiKSArIHN0cmluZyhxdWVyeSkgKyAiXTogIjsKCiAgaWYgKGVy
cm1zZykKICAgIHRocm93IG9vcHMoY3R4ICsgc3RyaW5nKCJzcWxpdGUgZXJyb3IgIikgKyBl
cnJtc2cpOwogIGFzc2VydF9zcWxpdGVfb2socmVzY29kZSk7CgogIGlmICh3YW50X2NvbHMg
PT0gMCAmJiBuY29sID09IDApIHJldHVybjsKICBpZiAod2FudF9yb3dzID09IDAgJiYgbnJv
dyA9PSAwKSByZXR1cm47CiAgaWYgKHdhbnRfY29scyA9PSBhbnlfcm93cyAmJiBuY29sID09
IDApIHJldHVybjsKICBpZiAod2FudF9yb3dzID09IGFueV9yb3dzICYmIG5yb3cgPT0gMCkg
cmV0dXJuOwoKICBpZiAod2FudF9jb2xzICE9IGFueV9jb2xzICYmCiAgICAgIG5jb2wgIT0g
d2FudF9jb2xzKQogICAgdGhyb3cgb29wcygoRigiJXMgd2FudGVkICVkIGNvbHVtbnMsIGdv
dCAlcyIpCgkJJSBjdHggJSB3YW50X2NvbHMgJSBuY29sKS5zdHIoKSk7CgogIGlmICh3YW50
X3Jvd3MgIT0gYW55X3Jvd3MgJiYKICAgICAgbnJvdyAhPSB3YW50X3Jvd3MpCiAgICB0aHJv
dyBvb3BzKChGKCIlcyB3YW50ZWQgJWQgcm93cywgZ290ICVzIikKCQklIGN0eCAlIHdhbnRf
cm93cyAlIG5yb3cpLnN0cigpKTsKCiAgaWYgKCFyZXN1bHQpCiAgICB0aHJvdyBvb3BzKGN0
eCArICJudWxsIHJlc3VsdCBzZXQiKTsKCiAgZm9yIChpbnQgaSA9IDA7IGkgPCBuY29sOyAr
K2kpIAogICAgaWYgKCFyZXN1bHRbaV0pCiAgICAgIHRocm93IG9vcHMoY3R4ICsgIm51bGwg
Y29sdW1uIG5hbWUiKTsKCiAgZm9yIChpbnQgcm93ID0gMDsgcm93IDwgbnJvdzsgKytyb3cp
IAogICAgewogICAgICB2ZWN0b3I8c3RyaW5nPiByb3d2ZWM7CiAgICAgIGZvciAoaW50IGNv
bCA9IDA7IGNvbCA8IG5jb2w7ICsrY29sKQoJewoJICBpbnQgaSA9ICgoMSArIHJvdykgKiBu
Y29sKSArIGNvbDsKCSAgaWYgKCFyZXN1bHRbaV0pCgkgICAgdGhyb3cgb29wcyhjdHggKyAi
bnVsbCByZXN1bHQgdmFsdWUiKTsKCSAgZWxzZQoJICAgIHJvd3ZlYy5wdXNoX2JhY2socmVz
dWx0W2ldKTsKCX0KICAgICAgcmVzLnB1c2hfYmFjayhyb3d2ZWMpOwogICAgfQp9CgovLyBn
ZW5lcmFsIGFwcGxpY2F0aW9uLWxldmVsIGxvZ2ljCgp2b2lkIApkYXRhYmFzZTo6c2V0X2Zp
bGVuYW1lKGZzOjpwYXRoIGNvbnN0ICYgZmlsZSkKewogIGlmIChfX3NxbCkKICAgIHsKICAg
ICAgdGhyb3cgb29wcygiY2Fubm90IGNoYW5nZSBmaWxlbmFtZSB0byAiICsgZmlsZS5zdHJp
bmcoKSArICIgd2hpbGUgZGIgaXMgb3BlbiIpOwogICAgfQogIGZpbGVuYW1lID0gZmlsZTsK
fQoKdm9pZCAKZGF0YWJhc2U6OmJlZ2luX3RyYW5zYWN0aW9uKCkgCnsKICBpZiAodHJhbnNh
Y3Rpb25fbGV2ZWwgPT0gMCkKICAgICAgZXhlY3V0ZSgiQkVHSU4iKTsKICB0cmFuc2FjdGlv
bl9sZXZlbCsrOwp9Cgp2b2lkIApkYXRhYmFzZTo6Y29tbWl0X3RyYW5zYWN0aW9uKCkKewog
IGlmICh0cmFuc2FjdGlvbl9sZXZlbCA9PSAxKQogICAgZXhlY3V0ZSgiQ09NTUlUIik7CiAg
dHJhbnNhY3Rpb25fbGV2ZWwtLTsKfQoKdm9pZCAKZGF0YWJhc2U6OnJvbGxiYWNrX3RyYW5z
YWN0aW9uKCkKewogIGlmICh0cmFuc2FjdGlvbl9sZXZlbCA9PSAxKQogICAgZXhlY3V0ZSgi
Uk9MTEJBQ0siKTsKICB0cmFuc2FjdGlvbl9sZXZlbC0tOwp9CgoKYm9vbCAKZGF0YWJhc2U6
OmV4aXN0cyhoZXhlbmM8aWQ+IGNvbnN0ICYgaWRlbnQsCgkJICAgICAgc3RyaW5nIGNvbnN0
ICYgdGFibGUpCnsKICByZXN1bHRzIHJlczsKICBmZXRjaChyZXMsIG9uZV9jb2wsIGFueV9y
b3dzLCAKCSJTRUxFQ1QgaWQgRlJPTSAnJXEnIFdIRVJFIGlkID0gJyVxJyIsCgl0YWJsZS5j
X3N0cigpLCBpZGVudCgpLmNfc3RyKCkpOwogIEkoKHJlcy5zaXplKCkgPT0gMSkgfHwgKHJl
cy5zaXplKCkgPT0gMCkpOwogIHJldHVybiByZXMuc2l6ZSgpID09IDE7Cn0KCgpib29sIApk
YXRhYmFzZTo6ZGVsdGFfZXhpc3RzKGhleGVuYzxpZD4gY29uc3QgJiBpZGVudCwKCQkgICAg
ICAgc3RyaW5nIGNvbnN0ICYgdGFibGUpCnsKICByZXN1bHRzIHJlczsKICBmZXRjaChyZXMs
IG9uZV9jb2wsIGFueV9yb3dzLCAKCSJTRUxFQ1QgaWQgRlJPTSAnJXEnIFdIRVJFIGlkID0g
JyVxJyIsCgl0YWJsZS5jX3N0cigpLCBpZGVudCgpLmNfc3RyKCkpOwogIHJldHVybiByZXMu
c2l6ZSgpID4gMDsKfQoKYm9vbCAKZGF0YWJhc2U6OmRlbHRhX2V4aXN0cyhoZXhlbmM8aWQ+
IGNvbnN0ICYgaWRlbnQsCgkJICAgICAgIGhleGVuYzxpZD4gY29uc3QgJiBiYXNlLAoJCSAg
ICAgICBzdHJpbmcgY29uc3QgJiB0YWJsZSkKewogIHJlc3VsdHMgcmVzOwogIGZldGNoKHJl
cywgb25lX2NvbCwgYW55X3Jvd3MsIAoJIlNFTEVDVCBpZCBGUk9NICclcScgV0hFUkUgaWQg
PSAnJXEnIEFORCBiYXNlID0gJyVxJyIsCgl0YWJsZS5jX3N0cigpLCBpZGVudCgpLmNfc3Ry
KCksIGJhc2UoKS5jX3N0cigpKTsKICBJKChyZXMuc2l6ZSgpID09IDEpIHx8IChyZXMuc2l6
ZSgpID09IDApKTsKICByZXR1cm4gcmVzLnNpemUoKSA9PSAxOwp9CgppbnQgCmRhdGFiYXNl
Ojpjb3VudChzdHJpbmcgY29uc3QgJiB0YWJsZSkKewogIHJlc3VsdHMgcmVzOwogIGZldGNo
KHJlcywgb25lX2NvbCwgb25lX3JvdywgCgkiU0VMRUNUIENPVU5UKCopIEZST00gJyVxJyIs
IAoJdGFibGUuY19zdHIoKSk7CiAgcmV0dXJuIGxleGljYWxfY2FzdDxpbnQ+KHJlc1swXVsw
XSk7ICAKfQoKdm9pZCAKZGF0YWJhc2U6OmdldChoZXhlbmM8aWQ+IGNvbnN0ICYgaWRlbnQs
CgkgICAgICBiYXNlNjQ8IGd6aXA8ZGF0YT4gPiAmIGRhdCwKCSAgICAgIHN0cmluZyBjb25z
dCAmIHRhYmxlKQp7CiAgcmVzdWx0cyByZXM7CiAgZmV0Y2gocmVzLCBvbmVfY29sLCBvbmVf
cm93LAoJIlNFTEVDVCBkYXRhIEZST00gJyVxJyBXSEVSRSBpZCA9ICclcSciLCAKCXRhYmxl
LmNfc3RyKCksIGlkZW50KCkuY19zdHIoKSk7CgogIC8vIGNvbnNpc3RlbmN5IGNoZWNrCiAg
YmFzZTY0PGd6aXA8ZGF0YT4gPiByZGF0YShyZXNbMF1bMF0pOwogIGhleGVuYzxpZD4gdGlk
OwogIGNhbGN1bGF0ZV9pZGVudChyZGF0YSwgdGlkKTsKICBJKHRpZCA9PSBpZGVudCk7Cgog
IGRhdCA9IHJkYXRhOwp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X2RlbHRhKGhleGVuYzxpZD4g
Y29uc3QgJiBpZGVudCwKCQkgICAgaGV4ZW5jPGlkPiBjb25zdCAmIGJhc2UsCgkJICAgIGJh
c2U2NDwgZ3ppcDxkZWx0YT4gPiAmIGRlbCwKCQkgICAgc3RyaW5nIGNvbnN0ICYgdGFibGUp
CnsKICBJKGlkZW50KCkgIT0gIiIpOwogIEkoYmFzZSgpICE9ICIiKTsKICByZXN1bHRzIHJl
czsKICBmZXRjaChyZXMsIG9uZV9jb2wsIG9uZV9yb3csCgkiU0VMRUNUIGRlbHRhIEZST00g
JyVxJyBXSEVSRSBpZCA9ICclcScgQU5EIGJhc2UgPSAnJXEnIiwgCgl0YWJsZS5jX3N0cigp
LCBpZGVudCgpLmNfc3RyKCksIGJhc2UoKS5jX3N0cigpKTsKICBkZWwgPSByZXNbMF1bMF07
Cn0KCnZvaWQgCmRhdGFiYXNlOjpwdXQoaGV4ZW5jPGlkPiBjb25zdCAmIGlkZW50LAoJICAg
ICAgYmFzZTY0PCBnemlwPGRhdGE+ID4gY29uc3QgJiBkYXQsCgkgICAgICBzdHJpbmcgY29u
c3QgJiB0YWJsZSkKewogIC8vIGNvbnNpc3RlbmN5IGNoZWNrCiAgSShpZGVudCgpICE9ICIi
KTsKICBoZXhlbmM8aWQ+IHRpZDsKICBjYWxjdWxhdGVfaWRlbnQoZGF0LCB0aWQpOwogIEko
dGlkID09IGlkZW50KTsKICAKICBleGVjdXRlKCJJTlNFUlQgSU5UTyAnJXEnIFZBTFVFUygn
JXEnLCAnJXEnKSIsIAoJICB0YWJsZS5jX3N0cigpLCBpZGVudCgpLmNfc3RyKCksIGRhdCgp
LmNfc3RyKCkpOwp9CgoKdm9pZCAKZGF0YWJhc2U6OnB1dF9kZWx0YShoZXhlbmM8aWQ+IGNv
bnN0ICYgaWRlbnQsCgkJICAgIGhleGVuYzxpZD4gY29uc3QgJiBiYXNlLAoJCSAgICBiYXNl
NjQ8Z3ppcDxkZWx0YT4gPiBjb25zdCAmIGRlbCwKCQkgICAgc3RyaW5nIGNvbnN0ICYgdGFi
bGUpCnsKICAvLyBuYjogZGVsdGEgc2NoZW1hIGlzIChpZCwgYmFzZSwgZGVsdGEpCiAgSShp
ZGVudCgpICE9ICIiKTsKICBJKGJhc2UoKSAhPSAiIik7CiAgZXhlY3V0ZSgiSU5TRVJUIElO
VE8gJyVxJyBWQUxVRVMoJyVxJywgJyVxJywgJyVxJykiLCAKCSAgdGFibGUuY19zdHIoKSwg
CgkgIGlkZW50KCkuY19zdHIoKSwgYmFzZSgpLmNfc3RyKCksIGRlbCgpLmNfc3RyKCkpOwp9
Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X3ZlcnNpb24oaGV4ZW5jPGlkPiBjb25zdCAmIGlkZW50
LAoJCSAgICAgIGJhc2U2NDwgZ3ppcDxkYXRhPiA+ICYgZGF0LAoJCSAgICAgIHN0cmluZyBj
b25zdCAmIGRhdGFfdGFibGUsCgkJICAgICAgc3RyaW5nIGNvbnN0ICYgZGVsdGFfdGFibGUp
CnsKICBJKGlkZW50KCkgIT0gIiIpOwogIGlmIChleGlzdHMoaWRlbnQsIGRhdGFfdGFibGUp
KQogICAgewogICAgICAvLyBlYXN5IHBhdGgKICAgICAgZ2V0KGlkZW50LCBkYXQsIGRhdGFf
dGFibGUpOwogICAgfQogIGVsc2UKICAgIHsKICAgICAgLy8gdHJpY2t5IHBhdGgKCiAgICAg
IC8vIHdlIHN0YXJ0IGZyb20gdGhlIGZpbGUgd2Ugd2FudCB0byByZWNvbnN0cnVjdCBhbmQg
d29yayAqZm9yd2FyZHMqCiAgICAgIC8vIHRocm91Z2ggdGhlIGRhdGFiYXNlLCB1bnRpbCB3
ZSBnZXQgdG8gYSBmdWxsIGRhdGEgb2JqZWN0LiB3ZSB0aGVuCiAgICAgIC8vIHRyYWNlIGJh
Y2sgdGhyb3VnaCB0aGUgbGlzdCBvZiBlZGdlcyB3ZSBmb2xsb3dlZCB0byBnZXQgdG8gdGhl
IGRhdGEKICAgICAgLy8gb2JqZWN0LCBhcHBseWluZyByZXZlcnNlIGRlbHRhcy4KICAgICAg
Ly8KICAgICAgLy8gdGhlIGVmZmVjdCBvZiB0aGlzIGFsZ29yaXRobSBpcyBicmVhZHRoLWZp
cnN0IHNlYXJjaCwgYmFja3dhcmRzCiAgICAgIC8vIHRocm91Z2ggdGhlIHN0b3JhZ2UgZ3Jh
cGgsIHRvIGRpc2NvdmVyIGEgZm9yd2FyZHMgc2hvcnRlc3QgcGF0aCwgYW5kCiAgICAgIC8v
IHRoZW4gZm9sbG93aW5nIHRoYXQgc2hvcnRlc3QgcGF0aCB3aXRoIGRlbHRhIGFwcGxpY2F0
aW9uLgogICAgICAvLwogICAgICAvLyB3ZSB1c2VkIHRvIGRvIHRoaXMgd2l0aCB0aGUgYm9v
c3QgZ3JhcGggbGlicmFyeSwgYnV0IGl0IGludm92bGVkCiAgICAgIC8vIGxvYWRpbmcgdG9v
IG11Y2ggb2YgdGhlIHN0b3JhZ2UgZ3JhcGggaW50byBtZW1vcnkgYXQgYW55IG1vbWVudC4g
dGhpcwogICAgICAvLyBpbXBlcmF0aXZlIHZlcnNpb24gb25seSBsb2FkcyB0aGUgZGVzY2Vu
ZGVudHMgb2YgdGhlIHJlY29uc3RydWN0aW9uCiAgICAgIC8vIG5vZGUsIHNvIGl0IG11Y2gg
Y2hlYXBlciBpbiB0ZXJtcyBvZiBtZW1vcnkuCiAgICAgIC8vCiAgICAgIC8vIHdlIGFsc28g
bWFpbnRhaW4gYSBjeWNsZS1kZXRlY3Rpbmcgc2V0LCBqdXN0IHRvIGJlIHNhZmUKICAgICAg
CiAgICAgIEwoRigicmVjb25zdHJ1Y3RpbmcgJXMgaW4gJXNcbiIpICUgaWRlbnQgJSBkZWx0
YV90YWJsZSk7CiAgICAgIEkoZGVsdGFfZXhpc3RzKGlkZW50LCBkZWx0YV90YWJsZSkpOwog
ICAgICAKICAgICAgLy8gbmI6IGFuIGVkZ2UgbWFwIGdvZXMgaW4gdGhlIGRpcmVjdGlvbiBv
ZiB0aGUKICAgICAgLy8gZGVsdGEsICpub3QqIHRoZSBkaXJlY3Rpb24gd2UgZGlzY292ZXIg
dGhpbmdzIGluLAogICAgICAvLyBpLmUuIGVhY2ggbWFwIGlzIG9mIHRoZSBmb3JtIFtuZXdp
ZF0gLT4gW29sZGlkXQoKICAgICAgdHlwZWRlZiBtYXA8IGhleGVuYzxpZD4sIGhleGVuYzxp
ZD4gPiBlZGdlbWFwOwogICAgICBsaXN0PCBzaGFyZWRfcHRyPGVkZ2VtYXA+ID4gcGF0aHM7
CgogICAgICBzZXQ8IGhleGVuYzxpZD4gPiBmcm9udGllciwgY3ljbGVzOwogICAgICBmcm9u
dGllci5pbnNlcnQoaWRlbnQpOwoKICAgICAgYm9vbCBmb3VuZF9yb290ID0gZmFsc2U7CiAg
ICAgIGhleGVuYzxpZD4gcm9vdCgiIik7CgogICAgICB3aGlsZSAoISBmb3VuZF9yb290KQoJ
ewoJICBzZXQ8IGhleGVuYzxpZD4gPiBuZXh0X2Zyb250aWVyOwoJICBzaGFyZWRfcHRyPGVk
Z2VtYXA+IGZyb250aWVyX21hcChuZXcgZWRnZW1hcCgpKTsKCgkgIEkoIWZyb250aWVyLmVt
cHR5KCkpOwoKCSAgZm9yIChzZXQ8IGhleGVuYzxpZD4gPjo6Y29uc3RfaXRlcmF0b3IgaSA9
IGZyb250aWVyLmJlZ2luKCk7CgkgICAgICAgaSAhPSBmcm9udGllci5lbmQoKTsgKytpKQoJ
ICAgIHsKCSAgICAgIGlmIChleGlzdHMoKmksIGRhdGFfdGFibGUpKQoJCXsKCQkgIHJvb3Qg
PSAqaTsKCQkgIGZvdW5kX3Jvb3QgPSB0cnVlOwoJCSAgYnJlYWs7CgkJfQoJICAgICAgZWxz
ZQoJCXsKCQkgIGN5Y2xlcy5pbnNlcnQoKmkpOwoJCSAgcmVzdWx0cyByZXM7CgkJICBmZXRj
aChyZXMsIG9uZV9jb2wsIGFueV9yb3dzLCAiU0VMRUNUIGJhc2UgZnJvbSAnJXEnIFdIRVJF
IGlkID0gJyVxJyIsCgkJCWRlbHRhX3RhYmxlLmNfc3RyKCksICgqaSkoKS5jX3N0cigpKTsK
CQkgIGZvciAoc2l6ZV90IGsgPSAwOyBrIDwgcmVzLnNpemUoKTsgKytrKQoJCSAgICB7CgkJ
ICAgICAgaGV4ZW5jPGlkPiBjb25zdCBueHQocmVzW2tdWzBdKTsKCgkJICAgICAgaWYgKGN5
Y2xlcy5maW5kKG54dCkgIT0gY3ljbGVzLmVuZCgpKQoJCQl0aHJvdyBvb3BzKCJjeWNsZSBp
biB0YWJsZSAnIiArIGRlbHRhX3RhYmxlICsgIicsIGF0IG5vZGUgIiAKCQkJCSAgICsgKCpp
KSgpICsgIiA8LSAiICsgbnh0KCkpOwoKCQkgICAgICBuZXh0X2Zyb250aWVyLmluc2VydChu
eHQpOwoKCQkgICAgICBpZiAoZnJvbnRpZXJfbWFwLT5maW5kKG54dCkgPT0gZnJvbnRpZXJf
bWFwLT5lbmQoKSkKCQkJewoJCQkgIEwoRigiaW5zZXJ0aW5nIGVkZ2U6ICVzIDwtICVzXG4i
KSAlICgqaSkgJSBueHQpOwoJCQkgIGZyb250aWVyX21hcC0+aW5zZXJ0KG1ha2VfcGFpcihu
eHQsICppKSk7CgkJCX0KCQkgICAgICBlbHNlCgkJCUwoRigic2tpcHBpbmcgbWVyZ2UgZWRn
ZSAlcyA8LSAlc1xuIikgJSAoKmkpICUgbnh0KTsKCQkgICAgfQoJCX0KCSAgICB9CgkgIGlm
ICghZm91bmRfcm9vdCkKCSAgICB7CgkgICAgICBmcm9udGllciA9IG5leHRfZnJvbnRpZXI7
CgkgICAgICBwYXRocy5wdXNoX2Zyb250KGZyb250aWVyX21hcCk7CgkgICAgfQoJfQoKICAg
ICAgLy8gcGF0aCBidWlsdCwgbm93IGFsbCB3ZSBuZWVkIHRvIGRvIGlzIGZvbGxvdyBpdCBi
YWNrCgogICAgICBJKGZvdW5kX3Jvb3QpOwogICAgICBJKHJvb3QoKSAhPSAiIik7CiAgICAg
IGJhc2U2NDwgZ3ppcDxkYXRhPiA+IGJlZ2luX3BhY2tlZDsKICAgICAgZGF0YSBiZWdpbjsg
ICAgICAKICAgICAgZ2V0KHJvb3QsIGJlZ2luX3BhY2tlZCwgZGF0YV90YWJsZSk7CiAgICAg
IHVucGFjayhiZWdpbl9wYWNrZWQsIGJlZ2luKTsKICAgICAgaGV4ZW5jPGlkPiBjdXJyID0g
cm9vdDsKCiAgICAgIGJvb3N0OjpzaGFyZWRfcHRyPGRlbHRhX2FwcGxpY2F0b3I+IGFwcCA9
IG5ld19waWVjZXdpc2VfYXBwbGljYXRvcigpOwogICAgICBhcHAtPmJlZ2luKGJlZ2luKCkp
OwogICAgICAKICAgICAgZm9yIChsaXN0PCBzaGFyZWRfcHRyPGVkZ2VtYXA+ID46OmNvbnN0
X2l0ZXJhdG9yIHAgPSBwYXRocy5iZWdpbigpOwoJICAgcCAhPSBwYXRocy5lbmQoKTsgKytw
KQoJewoJICBzaGFyZWRfcHRyPGVkZ2VtYXA+IGkgPSAqcDsKCSAgSShpLT5maW5kKGN1cnIp
ICE9IGktPmVuZCgpKTsKCSAgaGV4ZW5jPGlkPiBjb25zdCBueHQgPSBpLT5maW5kKGN1cnIp
LT5zZWNvbmQ7CgoJICBMKEYoImZvbGxvd2luZyBkZWx0YSAlcyAtPiAlc1xuIikgJSBjdXJy
ICUgbnh0KTsKCSAgYmFzZTY0PCBnemlwPGRlbHRhPiA+IGRlbF9wYWNrZWQ7CgkgIGdldF9k
ZWx0YShueHQsIGN1cnIsIGRlbF9wYWNrZWQsIGRlbHRhX3RhYmxlKTsKCSAgZGVsdGEgZGVs
OwoJICB1bnBhY2soZGVsX3BhY2tlZCwgZGVsKTsKCSAgYXBwbHlfZGVsdGEgKGFwcCwgZGVs
KCkpOwoJICBhcHAtPm5leHQoKTsKCSAgY3VyciA9IG54dDsKCX0KCiAgICAgIHN0cmluZyB0
bXA7CiAgICAgIGFwcC0+ZmluaXNoKHRtcCk7CiAgICAgIGRhdGEgZW5kKHRtcCk7CgogICAg
ICBoZXhlbmM8aWQ+IGZpbmFsOwogICAgICBjYWxjdWxhdGVfaWRlbnQoZW5kLCBmaW5hbCk7
CiAgICAgIEkoZmluYWwgPT0gaWRlbnQpOwogICAgICBwYWNrKGVuZCwgZGF0KTsKICAgIH0K
fQoKCnZvaWQgCmRhdGFiYXNlOjpkcm9wKGhleGVuYzxpZD4gY29uc3QgJiBpZGVudCwgCgkg
ICAgICAgc3RyaW5nIGNvbnN0ICYgdGFibGUpCnsKICBleGVjdXRlKCJERUxFVEUgRlJPTSAn
JXEnIFdIRVJFIGlkID0gJyVxJyIsICAKCSAgdGFibGUuY19zdHIoKSwKCSAgaWRlbnQoKS5j
X3N0cigpKTsKfQoKdm9pZCAKZGF0YWJhc2U6OnB1dF92ZXJzaW9uKGhleGVuYzxpZD4gY29u
c3QgJiBvbGRfaWQsCgkJICAgICAgaGV4ZW5jPGlkPiBjb25zdCAmIG5ld19pZCwKCQkgICAg
ICBiYXNlNjQ8IGd6aXA8ZGVsdGE+ID4gY29uc3QgJiBkZWwsCgkJICAgICAgc3RyaW5nIGNv
bnN0ICYgZGF0YV90YWJsZSwKCQkgICAgICBzdHJpbmcgY29uc3QgJiBkZWx0YV90YWJsZSkK
ewoKICBiYXNlNjQ8IGd6aXA8ZGF0YT4gPiBvbGRfZGF0YSwgbmV3X2RhdGE7CiAgYmFzZTY0
PCBnemlwPGRlbHRhPiA+IHJldmVyc2VfZGVsdGE7CiAgCiAgZ2V0X3ZlcnNpb24ob2xkX2lk
LCBvbGRfZGF0YSwgZGF0YV90YWJsZSwgZGVsdGFfdGFibGUpOwogIHBhdGNoKG9sZF9kYXRh
LCBkZWwsIG5ld19kYXRhKTsKICBkaWZmKG5ld19kYXRhLCBvbGRfZGF0YSwgcmV2ZXJzZV9k
ZWx0YSk7CiAgICAgIAogIHRyYW5zYWN0aW9uX2d1YXJkIGd1YXJkKCp0aGlzKTsKICBpZiAo
ZXhpc3RzKG9sZF9pZCwgZGF0YV90YWJsZSkpCiAgICB7CiAgICAgIC8vIGRlc2NlbmRlbnQg
b2YgYSBoZWFkIHZlcnNpb24gcmVwbGFjZXMgdGhlIGhlYWQsIHRoZXJlZm9yZSBvbGQgaGVh
ZAogICAgICAvLyBtdXN0IGJlIGRpc3Bvc2VkIG9mCiAgICAgIGRyb3Aob2xkX2lkLCBkYXRh
X3RhYmxlKTsKICAgIH0KICBwdXQobmV3X2lkLCBuZXdfZGF0YSwgZGF0YV90YWJsZSk7CiAg
cHV0X2RlbHRhKG9sZF9pZCwgbmV3X2lkLCByZXZlcnNlX2RlbHRhLCBkZWx0YV90YWJsZSk7
CiAgZ3VhcmQuY29tbWl0KCk7Cn0KCnZvaWQgCmRhdGFiYXNlOjpwdXRfcmV2ZXJzZV92ZXJz
aW9uKGhleGVuYzxpZD4gY29uc3QgJiBuZXdfaWQsCgkJCSAgICAgIGhleGVuYzxpZD4gY29u
c3QgJiBvbGRfaWQsCgkJCSAgICAgIGJhc2U2NDwgZ3ppcDxkZWx0YT4gPiBjb25zdCAmIHJl
dmVyc2VfZGVsLAoJCQkgICAgICBzdHJpbmcgY29uc3QgJiBkYXRhX3RhYmxlLAoJCQkgICAg
ICBzdHJpbmcgY29uc3QgJiBkZWx0YV90YWJsZSkKewogIGJhc2U2NDwgZ3ppcDxkYXRhPiA+
IG9sZF9kYXRhLCBuZXdfZGF0YTsKICAKICBnZXRfdmVyc2lvbihuZXdfaWQsIG5ld19kYXRh
LCBkYXRhX3RhYmxlLCBkZWx0YV90YWJsZSk7CiAgcGF0Y2gobmV3X2RhdGEsIHJldmVyc2Vf
ZGVsLCBvbGRfZGF0YSk7CiAgaGV4ZW5jPGlkPiBjaGVjazsKICBjYWxjdWxhdGVfaWRlbnQo
b2xkX2RhdGEsIGNoZWNrKTsKICBJKG9sZF9pZCA9PSBjaGVjayk7CiAgICAgIAogIHRyYW5z
YWN0aW9uX2d1YXJkIGd1YXJkKCp0aGlzKTsKICBwdXRfZGVsdGEob2xkX2lkLCBuZXdfaWQs
IHJldmVyc2VfZGVsLCBkZWx0YV90YWJsZSk7CiAgZ3VhcmQuY29tbWl0KCk7Cn0KCgoKLy8g
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tCi8vIC0tICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAtLQovLyAtLSAgICAgICAgICAgICAgcHVibGljIGludGVyZmFjZSBm
b2xsb3dzICAgICAgICAgICAgICAgICAgLS0KLy8gLS0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tCi8vIC0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKYm9vbCAK
ZGF0YWJhc2U6OmZpbGVfdmVyc2lvbl9leGlzdHMoZmlsZV9pZCBjb25zdCAmIGlkKQp7CiAg
cmV0dXJuIGRlbHRhX2V4aXN0cyhpZC5pbm5lcigpLCAiZmlsZV9kZWx0YXMiKSAKICAgIHx8
IGV4aXN0cyhpZC5pbm5lcigpLCAiZmlsZXMiKTsKfQoKYm9vbCAKZGF0YWJhc2U6Om1hbmlm
ZXN0X3ZlcnNpb25fZXhpc3RzKG1hbmlmZXN0X2lkIGNvbnN0ICYgaWQpCnsKICByZXR1cm4g
ZGVsdGFfZXhpc3RzKGlkLmlubmVyKCksICJtYW5pZmVzdF9kZWx0YXMiKSAKICAgIHx8IGV4
aXN0cyhpZC5pbm5lcigpLCAibWFuaWZlc3RzIik7Cn0KCmJvb2wgCmRhdGFiYXNlOjpyZXZp
c2lvbl9leGlzdHMocmV2aXNpb25faWQgY29uc3QgJiBpZCkKewogIHJldHVybiBleGlzdHMo
aWQuaW5uZXIoKSwgInJldmlzaW9ucyIpOwp9CgoKdm9pZCAKZGF0YWJhc2U6OmdldF9maWxl
X3ZlcnNpb24oZmlsZV9pZCBjb25zdCAmIGlkLAoJCQkgICBmaWxlX2RhdGEgJiBkYXQpCnsK
ICBiYXNlNjQ8IGd6aXA8ZGF0YT4gPiB0bXA7CiAgZ2V0X3ZlcnNpb24oaWQuaW5uZXIoKSwg
dG1wLCAiZmlsZXMiLCAiZmlsZV9kZWx0YXMiKTsKICBkYXQgPSB0bXA7Cn0KCnZvaWQgCmRh
dGFiYXNlOjpnZXRfbWFuaWZlc3RfdmVyc2lvbihtYW5pZmVzdF9pZCBjb25zdCAmIGlkLAoJ
CQkgICAgICAgbWFuaWZlc3RfZGF0YSAmIGRhdCkKewogIGJhc2U2NDwgZ3ppcDxkYXRhPiA+
IHRtcDsKICBnZXRfdmVyc2lvbihpZC5pbm5lcigpLCB0bXAsICJtYW5pZmVzdHMiLCAibWFu
aWZlc3RfZGVsdGFzIik7CiAgZGF0ID0gdG1wOwp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X21h
bmlmZXN0KG1hbmlmZXN0X2lkIGNvbnN0ICYgaWQsCgkJICAgICAgIG1hbmlmZXN0X21hcCAm
IG1tKQp7CiAgbWFuaWZlc3RfZGF0YSBtZGF0OwogIGdldF9tYW5pZmVzdF92ZXJzaW9uKGlk
LCBtZGF0KTsKICByZWFkX21hbmlmZXN0X21hcChtZGF0LCBtbSk7Cn0KCgp2b2lkIApkYXRh
YmFzZTo6cHV0X2ZpbGUoZmlsZV9pZCBjb25zdCAmIGlkLAoJCSAgIGZpbGVfZGF0YSBjb25z
dCAmIGRhdCkKewogIHB1dChpZC5pbm5lcigpLCBkYXQuaW5uZXIoKSwgImZpbGVzIik7Cn0K
CnZvaWQgCmRhdGFiYXNlOjpwdXRfZmlsZV92ZXJzaW9uKGZpbGVfaWQgY29uc3QgJiBvbGRf
aWQsCgkJCSAgIGZpbGVfaWQgY29uc3QgJiBuZXdfaWQsCgkJCSAgIGZpbGVfZGVsdGEgY29u
c3QgJiBkZWwpCnsKICBwdXRfdmVyc2lvbihvbGRfaWQuaW5uZXIoKSwgbmV3X2lkLmlubmVy
KCksIGRlbC5pbm5lcigpLCAKCSAgICAgICJmaWxlcyIsICJmaWxlX2RlbHRhcyIpOwp9Cgp2
b2lkIApkYXRhYmFzZTo6cHV0X2ZpbGVfcmV2ZXJzZV92ZXJzaW9uKGZpbGVfaWQgY29uc3Qg
JiBuZXdfaWQsCgkJCQkgICBmaWxlX2lkIGNvbnN0ICYgb2xkX2lkLAkJCQkgICAKCQkJCSAg
IGZpbGVfZGVsdGEgY29uc3QgJiBkZWwpCnsKICBwdXRfcmV2ZXJzZV92ZXJzaW9uKG5ld19p
ZC5pbm5lcigpLCBvbGRfaWQuaW5uZXIoKSwgZGVsLmlubmVyKCksIAoJCSAgICAgICJmaWxl
cyIsICJmaWxlX2RlbHRhcyIpOwp9CgoKdm9pZCAKZGF0YWJhc2U6OnB1dF9tYW5pZmVzdCht
YW5pZmVzdF9pZCBjb25zdCAmIGlkLAoJCSAgICAgICBtYW5pZmVzdF9kYXRhIGNvbnN0ICYg
ZGF0KQp7CiAgcHV0KGlkLmlubmVyKCksIGRhdC5pbm5lcigpLCAibWFuaWZlc3RzIik7Cn0K
CnZvaWQgCmRhdGFiYXNlOjpwdXRfbWFuaWZlc3RfdmVyc2lvbihtYW5pZmVzdF9pZCBjb25z
dCAmIG9sZF9pZCwKCQkJICAgICAgIG1hbmlmZXN0X2lkIGNvbnN0ICYgbmV3X2lkLAoJCQkg
ICAgICAgbWFuaWZlc3RfZGVsdGEgY29uc3QgJiBkZWwpCnsKICBwdXRfdmVyc2lvbihvbGRf
aWQuaW5uZXIoKSwgbmV3X2lkLmlubmVyKCksIGRlbC5pbm5lcigpLCAKCSAgICAgICJtYW5p
ZmVzdHMiLCAibWFuaWZlc3RfZGVsdGFzIik7Cn0KCnZvaWQgCmRhdGFiYXNlOjpwdXRfbWFu
aWZlc3RfcmV2ZXJzZV92ZXJzaW9uKG1hbmlmZXN0X2lkIGNvbnN0ICYgbmV3X2lkLAoJCQkJ
ICAgICAgIG1hbmlmZXN0X2lkIGNvbnN0ICYgb2xkX2lkLAkJCQkgICAKCQkJCSAgICAgICBt
YW5pZmVzdF9kZWx0YSBjb25zdCAmIGRlbCkKewogIHB1dF9yZXZlcnNlX3ZlcnNpb24obmV3
X2lkLmlubmVyKCksIG9sZF9pZC5pbm5lcigpLCBkZWwuaW5uZXIoKSwgCgkJICAgICAgIm1h
bmlmZXN0cyIsICJtYW5pZmVzdF9kZWx0YXMiKTsKfQoKCnZvaWQgCmRhdGFiYXNlOjpnZXRf
cmV2aXNpb25fYW5jZXN0cnkoc3RkOjpzZXQ8c3RkOjpwYWlyPHJldmlzaW9uX2lkLCByZXZp
c2lvbl9pZD4gPiAmIGdyYXBoKQp7CiAgcmVzdWx0cyByZXM7CiAgZ3JhcGguY2xlYXIoKTsK
ICBmZXRjaChyZXMsIDIsIGFueV9yb3dzLCAKCSJTRUxFQ1QgcGFyZW50LGNoaWxkIEZST00g
cmV2aXNpb25fYW5jZXN0cnkiKTsKICBmb3IgKHNpemVfdCBpID0gMDsgaSA8IHJlcy5zaXpl
KCk7ICsraSkKICAgIGdyYXBoLmluc2VydChzdGQ6Om1ha2VfcGFpcihyZXZpc2lvbl9pZChy
ZXNbaV1bMF0pLAoJCQkJcmV2aXNpb25faWQocmVzW2ldWzFdKSkpOwp9Cgp2b2lkIApkYXRh
YmFzZTo6Z2V0X3JldmlzaW9uX3BhcmVudHMocmV2aXNpb25faWQgY29uc3QgJiBpZCwKCQkJ
ICAgICAgc2V0PHJldmlzaW9uX2lkPiAmIHBhcmVudHMpCnsKICByZXN1bHRzIHJlczsKICBw
YXJlbnRzLmNsZWFyKCk7CiAgZmV0Y2gocmVzLCBvbmVfY29sLCBhbnlfcm93cywgCgkiU0VM
RUNUIHBhcmVudCBGUk9NIHJldmlzaW9uX2FuY2VzdHJ5IFdIRVJFIGNoaWxkID0gJyVxJyIs
CglpZC5pbm5lcigpKCkuY19zdHIoKSk7CiAgZm9yIChzaXplX3QgaSA9IDA7IGkgPCByZXMu
c2l6ZSgpOyArK2kpCiAgICBwYXJlbnRzLmluc2VydChyZXZpc2lvbl9pZChyZXNbaV1bMF0p
KTsKfQoKdm9pZCAKZGF0YWJhc2U6OmdldF9yZXZpc2lvbl9jaGlsZHJlbihyZXZpc2lvbl9p
ZCBjb25zdCAmIGlkLAoJCQkJc2V0PHJldmlzaW9uX2lkPiAmIGNoaWxkcmVuKQp7CiAgcmVz
dWx0cyByZXM7CiAgY2hpbGRyZW4uY2xlYXIoKTsKICBmZXRjaChyZXMsIG9uZV9jb2wsIGFu
eV9yb3dzLCAKCSJTRUxFQ1QgY2hpbGQgRlJPTSByZXZpc2lvbl9hbmNlc3RyeSBXSEVSRSBw
YXJlbnQgPSAnJXEnIiwKCWlkLmlubmVyKCkoKS5jX3N0cigpKTsKICBmb3IgKHNpemVfdCBp
ID0gMDsgaSA8IHJlcy5zaXplKCk7ICsraSkKICAgIGNoaWxkcmVuLmluc2VydChyZXZpc2lv
bl9pZChyZXNbaV1bMF0pKTsKfQoKdm9pZCAKZGF0YWJhc2U6OmdldF9yZXZpc2lvbl9tYW5p
ZmVzdChyZXZpc2lvbl9pZCBjb25zdCAmIHJpZCwKCQkJICAgICAgIG1hbmlmZXN0X2lkICYg
bWlkKQp7CiAgcmV2aXNpb25fc2V0IHJldjsKICBnZXRfcmV2aXNpb24ocmlkLCByZXYpOwog
IG1pZCA9IHJldi5uZXdfbWFuaWZlc3Q7Cn0KCnZvaWQgCmRhdGFiYXNlOjpnZXRfcmV2aXNp
b24ocmV2aXNpb25faWQgY29uc3QgJiBpZCwKCQkgICAgICAgcmV2aXNpb25fc2V0ICYgcmV2
KQp7CiAgcmV2aXNpb25fZGF0YSBkOwogIGdldF9yZXZpc2lvbihpZCwgZCk7CiAgcmVhZF9y
ZXZpc2lvbl9zZXQoZCwgcmV2KTsKfQoKdm9pZCAKZGF0YWJhc2U6OmdldF9yZXZpc2lvbihy
ZXZpc2lvbl9pZCBjb25zdCAmIGlkLAoJCSAgICAgICByZXZpc2lvbl9kYXRhICYgZGF0KQp7
CiAgcmVzdWx0cyByZXM7CiAgZmV0Y2gocmVzLCBvbmVfY29sLCBvbmVfcm93LCAKCSJTRUxF
Q1QgZGF0YSBGUk9NIHJldmlzaW9ucyBXSEVSRSBpZCA9ICclcSciLAoJaWQuaW5uZXIoKSgp
LmNfc3RyKCkpOwoKICBkYXQgPSByZXZpc2lvbl9kYXRhKHJlc1swXVswXSk7CgogIC8vIHZl
cmlmeSB0aGF0IHdlIGdvdCBhIHJldmlzaW9uIHdpdGggdGhlIHJpZ2h0IGlkCiAgewogICAg
cmV2aXNpb25faWQgdG1wOwogICAgY2FsY3VsYXRlX2lkZW50KGRhdCwgdG1wKTsKICAgIEko
aWQgPT0gdG1wKTsKICB9Cn0KCnZvaWQgCmRhdGFiYXNlOjpwdXRfcmV2aXNpb24ocmV2aXNp
b25faWQgY29uc3QgJiBuZXdfaWQsCgkJICAgICAgIHJldmlzaW9uX3NldCBjb25zdCAmIHJl
dikKewoKICBJKCFyZXZpc2lvbl9leGlzdHMobmV3X2lkKSk7CiAgcmV2aXNpb25fZGF0YSBk
OwoKICB3cml0ZV9yZXZpc2lvbl9zZXQocmV2LCBkKTsKICByZXZpc2lvbl9pZCB0bXA7CiAg
Y2FsY3VsYXRlX2lkZW50KGQsIHRtcCk7CiAgSSh0bXAgPT0gbmV3X2lkKTsKCiAgdHJhbnNh
Y3Rpb25fZ3VhcmQgZ3VhcmQoKnRoaXMpOwoKICBleGVjdXRlKCJJTlNFUlQgSU5UTyByZXZp
c2lvbnMgVkFMVUVTKCclcScsICclcScpIiwgCgkgIG5ld19pZC5pbm5lcigpKCkuY19zdHIo
KSwgCgkgIGQuaW5uZXIoKSgpLmNfc3RyKCkpOwoKICBmb3IgKGVkZ2VfbWFwOjpjb25zdF9p
dGVyYXRvciBlID0gcmV2LmVkZ2VzLmJlZ2luKCk7CiAgICAgICBlICE9IHJldi5lZGdlcy5l
bmQoKTsgKytlKQogICAgewogICAgICBleGVjdXRlKCJJTlNFUlQgSU5UTyByZXZpc2lvbl9h
bmNlc3RyeSBWQUxVRVMoJyVxJywgJyVxJykiLCAKCSAgICAgIGVkZ2Vfb2xkX3JldmlzaW9u
KGUpLmlubmVyKCkoKS5jX3N0cigpLAoJICAgICAgbmV3X2lkLmlubmVyKCkoKS5jX3N0cigp
KTsKICAgIH0KCiAgZ3VhcmQuY29tbWl0KCk7Cn0KCnZvaWQgCmRhdGFiYXNlOjpwdXRfcmV2
aXNpb24ocmV2aXNpb25faWQgY29uc3QgJiBuZXdfaWQsCgkJICAgICAgIHJldmlzaW9uX2Rh
dGEgY29uc3QgJiBkYXQpCnsKICByZXZpc2lvbl9zZXQgcmV2OwogIHJlYWRfcmV2aXNpb25f
c2V0KGRhdCwgcmV2KTsKICBwdXRfcmV2aXNpb24obmV3X2lkLCByZXYpOwp9CgoKLy8gY3J5
cHRvIGtleSBtYW5hZ2VtZW50Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X2tleV9pZHMoc3RyaW5n
IGNvbnN0ICYgcGF0dGVybiwKCQkgICAgICB2ZWN0b3I8cnNhX2tleXBhaXJfaWQ+ICYgcHVi
a2V5cywKCQkgICAgICB2ZWN0b3I8cnNhX2tleXBhaXJfaWQ+ICYgcHJpdmtleXMpCnsKICBw
dWJrZXlzLmNsZWFyKCk7CiAgcHJpdmtleXMuY2xlYXIoKTsKICByZXN1bHRzIHJlczsKCiAg
aWYgKHBhdHRlcm4gIT0gIiIpCiAgICBmZXRjaChyZXMsIG9uZV9jb2wsIGFueV9yb3dzLCAK
CSAgIlNFTEVDVCBpZCBmcm9tIHB1YmxpY19rZXlzIFdIRVJFIGlkIEdMT0IgJyVxJyIsCgkg
IHBhdHRlcm4uY19zdHIoKSk7CiAgZWxzZQogICAgZmV0Y2gocmVzLCBvbmVfY29sLCBhbnlf
cm93cywgCgkgICJTRUxFQ1QgaWQgZnJvbSBwdWJsaWNfa2V5cyIpOwoKICBmb3IgKHNpemVf
dCBpID0gMDsgaSA8IHJlcy5zaXplKCk7ICsraSkKICAgIHB1YmtleXMucHVzaF9iYWNrKHJl
c1tpXVswXSk7CgogIGlmIChwYXR0ZXJuICE9ICIiKQogICAgZmV0Y2gocmVzLCBvbmVfY29s
LCBhbnlfcm93cywgCgkgICJTRUxFQ1QgaWQgZnJvbSBwcml2YXRlX2tleXMgV0hFUkUgaWQg
R0xPQiAnJXEnIiwKCSAgcGF0dGVybi5jX3N0cigpKTsKICBlbHNlCiAgICBmZXRjaChyZXMs
IG9uZV9jb2wsIGFueV9yb3dzLCAKCSAgIlNFTEVDVCBpZCBmcm9tIHByaXZhdGVfa2V5cyIp
OwoKICBmb3IgKHNpemVfdCBpID0gMDsgaSA8IHJlcy5zaXplKCk7ICsraSkKICAgIHByaXZr
ZXlzLnB1c2hfYmFjayhyZXNbaV1bMF0pOwp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X3ByaXZh
dGVfa2V5cyh2ZWN0b3I8cnNhX2tleXBhaXJfaWQ+ICYgcHJpdmtleXMpCnsKICBwcml2a2V5
cy5jbGVhcigpOwogIHJlc3VsdHMgcmVzOwogIGZldGNoKHJlcywgb25lX2NvbCwgYW55X3Jv
d3MsICAiU0VMRUNUIGlkIGZyb20gcHJpdmF0ZV9rZXlzIik7CiAgZm9yIChzaXplX3QgaSA9
IDA7IGkgPCByZXMuc2l6ZSgpOyArK2kpCiAgICBwcml2a2V5cy5wdXNoX2JhY2socmVzW2ld
WzBdKTsKfQoKYm9vbCAKZGF0YWJhc2U6OnB1YmxpY19rZXlfZXhpc3RzKGhleGVuYzxpZD4g
Y29uc3QgJiBoYXNoKQp7CiAgcmVzdWx0cyByZXM7CiAgZmV0Y2gocmVzLCBvbmVfY29sLCBh
bnlfcm93cywgCgkiU0VMRUNUIGlkIEZST00gcHVibGljX2tleXMgV0hFUkUgaGFzaCA9ICcl
cSciLAoJaGFzaCgpLmNfc3RyKCkpOwogIEkoKHJlcy5zaXplKCkgPT0gMSkgfHwgKHJlcy5z
aXplKCkgPT0gMCkpOwogIGlmIChyZXMuc2l6ZSgpID09IDEpIAogICAgcmV0dXJuIHRydWU7
CiAgcmV0dXJuIGZhbHNlOwp9Cgpib29sIApkYXRhYmFzZTo6cHVibGljX2tleV9leGlzdHMo
cnNhX2tleXBhaXJfaWQgY29uc3QgJiBpZCkKewogIHJlc3VsdHMgcmVzOwogIGZldGNoKHJl
cywgb25lX2NvbCwgYW55X3Jvd3MsIAoJIlNFTEVDVCBpZCBGUk9NIHB1YmxpY19rZXlzIFdI
RVJFIGlkID0gJyVxJyIsCglpZCgpLmNfc3RyKCkpOwogIEkoKHJlcy5zaXplKCkgPT0gMSkg
fHwgKHJlcy5zaXplKCkgPT0gMCkpOwogIGlmIChyZXMuc2l6ZSgpID09IDEpIAogICAgcmV0
dXJuIHRydWU7CiAgcmV0dXJuIGZhbHNlOwp9Cgpib29sIApkYXRhYmFzZTo6cHJpdmF0ZV9r
ZXlfZXhpc3RzKHJzYV9rZXlwYWlyX2lkIGNvbnN0ICYgaWQpCnsKICByZXN1bHRzIHJlczsK
ICBmZXRjaChyZXMsIG9uZV9jb2wsIGFueV9yb3dzLAoJIlNFTEVDVCBpZCBGUk9NIHByaXZh
dGVfa2V5cyBXSEVSRSBpZCA9ICclcSciLAoJaWQoKS5jX3N0cigpKTsKICBJKChyZXMuc2l6
ZSgpID09IDEpIHx8IChyZXMuc2l6ZSgpID09IDApKTsKICBpZiAocmVzLnNpemUoKSA9PSAx
KQogICAgcmV0dXJuIHRydWU7CiAgcmV0dXJuIGZhbHNlOwp9Cgpib29sIApkYXRhYmFzZTo6
a2V5X2V4aXN0cyhyc2Ffa2V5cGFpcl9pZCBjb25zdCAmIGlkKQp7CiAgcmV0dXJuIHB1Ymxp
Y19rZXlfZXhpc3RzKGlkKSB8fCBwcml2YXRlX2tleV9leGlzdHMoaWQpOwp9Cgp2b2lkIApk
YXRhYmFzZTo6Z2V0X3B1YmtleShoZXhlbmM8aWQ+IGNvbnN0ICYgaGFzaCwgCgkJICAgICBy
c2Ffa2V5cGFpcl9pZCAmIGlkLAoJCSAgICAgYmFzZTY0PHJzYV9wdWJfa2V5PiAmIHB1Yl9l
bmNvZGVkKQp7CiAgcmVzdWx0cyByZXM7CiAgZmV0Y2gocmVzLCAyLCBvbmVfcm93LCAKCSJT
RUxFQ1QgaWQsIGtleWRhdGEgRlJPTSBwdWJsaWNfa2V5cyB3aGVyZSBoYXNoID0gJyVxJyIs
IAoJaGFzaCgpLmNfc3RyKCkpOwogIGlkID0gcmVzWzBdWzBdOwogIHB1Yl9lbmNvZGVkID0g
cmVzWzBdWzFdOwp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X2tleShyc2Ffa2V5cGFpcl9pZCBj
b25zdCAmIHB1Yl9pZCwgCgkJICBiYXNlNjQ8cnNhX3B1Yl9rZXk+ICYgcHViX2VuY29kZWQp
CnsKICByZXN1bHRzIHJlczsKICBmZXRjaChyZXMsIG9uZV9jb2wsIG9uZV9yb3csIAoJIlNF
TEVDVCBrZXlkYXRhIEZST00gcHVibGljX2tleXMgd2hlcmUgaWQgPSAnJXEnIiwgCglwdWJf
aWQoKS5jX3N0cigpKTsKICBwdWJfZW5jb2RlZCA9IHJlc1swXVswXTsKfQoKdm9pZCAKZGF0
YWJhc2U6OmdldF9rZXkocnNhX2tleXBhaXJfaWQgY29uc3QgJiBwcml2X2lkLCAKCQkgIGJh
c2U2NDwgYXJjNDxyc2FfcHJpdl9rZXk+ID4gJiBwcml2X2VuY29kZWQpCnsKICByZXN1bHRz
IHJlczsKICBmZXRjaChyZXMsIG9uZV9jb2wsIG9uZV9jb2wsIAoJIlNFTEVDVCBrZXlkYXRh
IEZST00gcHJpdmF0ZV9rZXlzIHdoZXJlIGlkID0gJyVxJyIsIAoJcHJpdl9pZCgpLmNfc3Ry
KCkpOwogIHByaXZfZW5jb2RlZCA9IHJlc1swXVswXTsKfQoKCnZvaWQgCmRhdGFiYXNlOjpw
dXRfa2V5KHJzYV9rZXlwYWlyX2lkIGNvbnN0ICYgcHViX2lkLCAKCQkgIGJhc2U2NDxyc2Ff
cHViX2tleT4gY29uc3QgJiBwdWJfZW5jb2RlZCkKewogIGhleGVuYzxpZD4gdGhhc2g7CiAg
a2V5X2hhc2hfY29kZShwdWJfaWQsIHB1Yl9lbmNvZGVkLCB0aGFzaCk7CiAgZXhlY3V0ZSgi
SU5TRVJUIElOVE8gcHVibGljX2tleXMgVkFMVUVTKCclcScsICclcScsICclcScpIiwgCgkg
IHRoYXNoKCkuY19zdHIoKSwgcHViX2lkKCkuY19zdHIoKSwgcHViX2VuY29kZWQoKS5jX3N0
cigpKTsKfQoKdm9pZCAKZGF0YWJhc2U6OnB1dF9rZXkocnNhX2tleXBhaXJfaWQgY29uc3Qg
JiBwcml2X2lkLCAKCQkgIGJhc2U2NDwgYXJjNDxyc2FfcHJpdl9rZXk+ID4gY29uc3QgJiBw
cml2X2VuY29kZWQpCnsKICAKICBoZXhlbmM8aWQ+IHRoYXNoOwogIGtleV9oYXNoX2NvZGUo
cHJpdl9pZCwgcHJpdl9lbmNvZGVkLCB0aGFzaCk7CiAgZXhlY3V0ZSgiSU5TRVJUIElOVE8g
cHJpdmF0ZV9rZXlzIFZBTFVFUygnJXEnLCAnJXEnLCAnJXEnKSIsIAoJICB0aGFzaCgpLmNf
c3RyKCksIHByaXZfaWQoKS5jX3N0cigpLCBwcml2X2VuY29kZWQoKS5jX3N0cigpKTsKfQoK
dm9pZCAKZGF0YWJhc2U6OnB1dF9rZXlfcGFpcihyc2Ffa2V5cGFpcl9pZCBjb25zdCAmIGlk
LCAKCQkgICAgICAgYmFzZTY0PHJzYV9wdWJfa2V5PiBjb25zdCAmIHB1Yl9lbmNvZGVkLAoJ
CSAgICAgICBiYXNlNjQ8IGFyYzQ8cnNhX3ByaXZfa2V5PiA+IGNvbnN0ICYgcHJpdl9lbmNv
ZGVkKQp7CiAgdHJhbnNhY3Rpb25fZ3VhcmQgZ3VhcmQoKnRoaXMpOwogIHB1dF9rZXkoaWQs
IHB1Yl9lbmNvZGVkKTsKICBwdXRfa2V5KGlkLCBwcml2X2VuY29kZWQpOwogIGd1YXJkLmNv
bW1pdCgpOwp9Cgp2b2lkCmRhdGFiYXNlOjpkZWxldGVfcHJpdmF0ZV9rZXkocnNhX2tleXBh
aXJfaWQgY29uc3QgJiBwdWJfaWQpCnsKICBleGVjdXRlKCJERUxFVEUgRlJPTSBwcml2YXRl
X2tleXMgV0hFUkUgaWQgPSAnJXEnIiwKCSAgcHViX2lkKCkuY19zdHIoKSk7Cn0KCi8vIGNl
cnQgbWFuYWdlbWVudAoKYm9vbCAKZGF0YWJhc2U6OmNlcnRfZXhpc3RzKGNlcnQgY29uc3Qg
JiB0LAoJCSAgICAgIHN0cmluZyBjb25zdCAmIHRhYmxlKQp7CiAgcmVzdWx0cyByZXM7CiAg
ZmV0Y2gocmVzLCAxLCBhbnlfcm93cywKCSJTRUxFQ1QgaWQgRlJPTSAnJXEnIFdIRVJFIGlk
ID0gJyVxJyAiCgkiQU5EIG5hbWUgPSAnJXEnIEFORCB2YWx1ZSA9ICclcScgIiAKCSJBTkQg
a2V5cGFpciA9ICclcScgQU5EIHNpZ25hdHVyZSA9ICclcScgIiwKCXRhYmxlLmNfc3RyKCks
Cgl0LmlkZW50KCkuY19zdHIoKSwKCXQubmFtZSgpLmNfc3RyKCksCgl0LnZhbHVlKCkuY19z
dHIoKSwKCXQua2V5KCkuY19zdHIoKSwKCXQuc2lnKCkuY19zdHIoKSk7CiAgSShyZXMuc2l6
ZSgpID09IDAgfHwgcmVzLnNpemUoKSA9PSAxKTsKICByZXR1cm4gcmVzLnNpemUoKSA9PSAx
Owp9Cgp2b2lkIApkYXRhYmFzZTo6cHV0X2NlcnQoY2VydCBjb25zdCAmIHQsCgkJICAgc3Ry
aW5nIGNvbnN0ICYgdGFibGUpCnsKICBoZXhlbmM8aWQ+IHRoYXNoOwogIGNlcnRfaGFzaF9j
b2RlKHQsIHRoYXNoKTsKICBleGVjdXRlKCJJTlNFUlQgSU5UTyAnJXEnIFZBTFVFUygnJXEn
LCAnJXEnLCAnJXEnLCAnJXEnLCAnJXEnLCAnJXEnKSIsIAoJICB0YWJsZS5jX3N0cigpLAoJ
ICB0aGFzaCgpLmNfc3RyKCksCgkgIHQuaWRlbnQoKS5jX3N0cigpLAoJICB0Lm5hbWUoKS5j
X3N0cigpLCAKCSAgdC52YWx1ZSgpLmNfc3RyKCksCgkgIHQua2V5KCkuY19zdHIoKSwKCSAg
dC5zaWcoKS5jX3N0cigpKTsKfQoKdm9pZCAKZGF0YWJhc2U6OnJlc3VsdHNfdG9fY2VydHMo
cmVzdWx0cyBjb25zdCAmIHJlcywKCQkJICAgdmVjdG9yPGNlcnQ+ICYgY2VydHMpCnsKICBj
ZXJ0cy5jbGVhcigpOwogIGZvciAoc2l6ZV90IGkgPSAwOyBpIDwgcmVzLnNpemUoKTsgKytp
KQogICAgewogICAgICBjZXJ0IHQ7CiAgICAgIHQgPSBjZXJ0KGhleGVuYzxpZD4ocmVzW2ld
WzBdKSwgCgkgICAgICBjZXJ0X25hbWUocmVzW2ldWzFdKSwKCSAgICAgIGJhc2U2NDxjZXJ0
X3ZhbHVlPihyZXNbaV1bMl0pLAoJICAgICAgcnNhX2tleXBhaXJfaWQocmVzW2ldWzNdKSwK
CSAgICAgIGJhc2U2NDxyc2Ffc2hhMV9zaWduYXR1cmU+KHJlc1tpXVs0XSkpOwogICAgICBj
ZXJ0cy5wdXNoX2JhY2sodCk7CiAgICB9Cn0KCgpzdHJ1Y3QgdmFsaWRfY2VydHMKewogIHNl
dDxyc2Ffa2V5cGFpcl9pZD4gdmFsaWRfc2lnbmVyczsKICBoZXhlbmM8aWQ+IGlkZW50Owog
IGNlcnRfbmFtZSBuYW1lOwogIGJhc2U2NDxjZXJ0X3ZhbHVlPiB2YWw7CiAgc3RyaW5nIHNp
Z25hdHVyZV90eXBlOwoKICB2YWxpZF9jZXJ0cyhzdHJpbmcgY29uc3QgJiB0eSkgCiAgICA6
IHNpZ25hdHVyZV90eXBlKHR5KSAKICB7CiAgICBMKEYoImNvbnN0cnVjdGluZyB2YWxpZGl0
eSBjaGVja2VyIGZvciAlcyBjZXJ0c1xuIikgJSB0eSk7CiAgfQoKICBib29sIGNoZWNrX3Np
Z25lcl90cnVzdChhcHBfc3RhdGUgJiBhcHApCiAgewogICAgYm9vbCB0cnVzdGVkID0gZmFs
c2U7CgogICAgTChGKCJjaGVja2luZyAlZCBzaWduZXIgJXMgY2VydCB0cnVzdCBzZXRcbiIp
IAogICAgICAlIHZhbGlkX3NpZ25lcnMuc2l6ZSgpICUgc2lnbmF0dXJlX3R5cGUpOwogICAg
dHJ5CiAgICAgIHsKCWNlcnRfdmFsdWUgdjsKCWRlY29kZV9iYXNlNjQodmFsLCB2KTsKCS8v
IEZJWE1FOiBsYW1lIHN0cmluZy1tYWtlcy10aGUtbW9kZSBhcmd1bWVudAoJaWYgKHNpZ25h
dHVyZV90eXBlID09ICJyZXZpc2lvbiIpCgkgIHRydXN0ZWQgPSBhcHAubHVhLmhvb2tfZ2V0
X3JldmlzaW9uX2NlcnRfdHJ1c3QodmFsaWRfc2lnbmVycywKCQkJCQkJCWlkZW50LCBuYW1l
LCB2KTsKCWVsc2UgaWYgKHNpZ25hdHVyZV90eXBlID09ICJtYW5pZmVzdCIpCgkgIHRydXN0
ZWQgPSBhcHAubHVhLmhvb2tfZ2V0X21hbmlmZXN0X2NlcnRfdHJ1c3QodmFsaWRfc2lnbmVy
cywKCQkJCQkJCSBpZGVudCwgbmFtZSwgdik7CgllbHNlIGlmIChzaWduYXR1cmVfdHlwZSA9
PSAiZmlsZSIpCgkgIHRydXN0ZWQgPSBhcHAubHVhLmhvb2tfZ2V0X2ZpbGVfY2VydF90cnVz
dCh2YWxpZF9zaWduZXJzLAoJCQkJCQkgICAgIGlkZW50LCBuYW1lLCB2KTsKCWVsc2UKCSAg
SShmYWxzZSk7IC8vIHNob3VsZCBiZSBpbGxlZ2FsCiAgICAgIH0KICAgIGNhdGNoICguLi4p
CiAgICAgIHsKCVcoRigiZXhjZXB0aW9uIGluIHNxbGl0ZSB2YWxpZF9jZXJ0czo6Y2hlY2tf
c2V0X3RydXN0XG4iKSk7CiAgICAgIH0KICAgIAogICAgaWYgKHRydXN0ZWQpCiAgICAgIEwo
RigidHJ1c3QgZnVuY3Rpb24gbGlrZWQgJWQgJXMgc2lnbmVyc1xuIikgCgklIHZhbGlkX3Np
Z25lcnMuc2l6ZSgpICUgc2lnbmF0dXJlX3R5cGUpOwogICAgZWxzZQogICAgICBMKEYoInRy
dXN0IGZ1bmN0aW9uIGRpc2xpa2VkICVkICVzIHNpZ25lcnNcbiIpIAoJJSB2YWxpZF9zaWdu
ZXJzLnNpemUoKSAlIHNpZ25hdHVyZV90eXBlKTsKICAgIAogICAgcmV0dXJuIHRydXN0ZWQ7
CiAgfQoKICB2b2lkIGNoZWNrX3NpbmdsZV9zaWduZXIoYXBwX3N0YXRlICYgYXBwLAoJCQkg
ICBpbnQgYXJnYywgCgkJCSAgIGNoYXIgY29uc3QgKiogYXJndikKICB7CiAgICB0cnkKICAg
ICAgewoJLy8gYXJncyBhcmU6IGhhc2gsIGlkLCBuYW1lLCB2YWx1ZSwga2V5cGFpciwgcHVi
a2V5LCBzaWduYXR1cmUKCS8vIEwoRigiZW50cmllcyBhcmUgWyVzXSBbJXNdIFslc10gWyVz
XSBbJXNdIFslc10gWyVzXVxuIikgCgkvLyAJICAlIGFyZ3ZbMF0gJSBhcmd2WzFdICUgYXJn
dlsyXSAlIGFyZ3ZbM10gJSBhcmd2WzRdICUgYXJndls1XSAlIGFyZ3ZbNl0pOwoKCWNlcnQg
dG1wID0gY2VydChoZXhlbmM8aWQ+KGFyZ3ZbMV0pLCAKCQkJY2VydF9uYW1lKGFyZ3ZbMl0p
LAoJCQliYXNlNjQ8Y2VydF92YWx1ZT4oYXJndlszXSksCgkJCXJzYV9rZXlwYWlyX2lkKGFy
Z3ZbNF0pLAoJCQliYXNlNjQ8cnNhX3NoYTFfc2lnbmF0dXJlPihhcmd2WzZdKSk7CgoJYmFz
ZTY0PHJzYV9wdWJfa2V5PiBwayhhcmd2WzVdKTsKCglpZiAoaWRlbnQoKS5lbXB0eSgpKQoJ
ICBpZGVudCA9IHRtcC5pZGVudDsKCWVsc2UKCSAgSShpZGVudCA9PSB0bXAuaWRlbnQpOwoK
CWlmIChuYW1lKCkuZW1wdHkoKSkKCSAgbmFtZSA9IHRtcC5uYW1lOwoJZWxzZQoJICBJKG5h
bWUgPT0gdG1wLm5hbWUpOwoKCWlmICh2YWwoKS5lbXB0eSgpKQoJICB2YWwgPSB0bXAudmFs
dWU7CgllbHNlCgkgIEkodmFsID09IHRtcC52YWx1ZSk7CgoJLy8gCUwoRigiZXhhbWluaW5n
ICclcycgJXMgY2VydCBmcm9tICVzXG4iKSAKCS8vIAkgICUgbmFtZSAlIHNpZ25hdHVyZV90
eXBlICUgaWRlbnQpOwoKCXN0cmluZyB0eHQ7CgljZXJ0X3NpZ25hYmxlX3RleHQodG1wLCB0
eHQpOwoJaWYgKGNoZWNrX3NpZ25hdHVyZShhcHAubHVhLCB0bXAua2V5LCBwaywgdHh0LCB0
bXAuc2lnKSkKCSAgewoJICAgIEwoRigib2sgJyVzJyAlcyBjZXJ0IGZyb20gJXNcbiIpIAoJ
ICAgICAgJSBuYW1lICUgc2lnbmF0dXJlX3R5cGUgJSB0bXAua2V5KTsKCSAgICB2YWxpZF9z
aWduZXJzLmluc2VydCh0bXAua2V5KTsKCSAgfQoJZWxzZQoJICB7CgkgICAgVyhGKCJiYWQg
JyVzJyAlcyBjZXJ0IGZyb20gJXNcbiIpIAoJICAgICAgJSBuYW1lICUgc2lnbmF0dXJlX3R5
cGUgJSB0bXAua2V5KTsKCSAgfQogICAgICB9CiAgICBjYXRjaCAoc3RkOjpleGNlcHRpb24g
JiBlKQogICAgICB7CglXKEYoInN0ZDo6ZXhjZXB0aW9uIGluIHNxbGl0ZSB2YWxpZF9jZXJ0
czo6Y2hlY2tfc2luZ2xlX3NpZ25lcjogJXNcbiIpICUgZS53aGF0KCkpOwogICAgICB9CiAg
ICBjYXRjaCAoLi4uKQogICAgICB7CglXKEYoInVua25vd24gZXhjZXB0aW9uIGluIHNxbGl0
ZSB2YWxpZF9jZXJ0czo6Y2hlY2tfc2luZ2xlX3NpZ25lclxuIikpOwogICAgICB9CiAgfQp9
OwoKZXh0ZXJuICJDIgp7CgpzdGF0aWMgdm9pZAp0cnVzdGVkX3N0ZXBfY2FsbGJhY2soc3Fs
aXRlX2Z1bmMgKiBmbl9jdHgsIAoJCSAgICAgIGludCBhcmdjLCAKCQkgICAgICBjaGFyIGNv
bnN0ICoqIGFyZ3YpCnsKICBhcHBfc3RhdGUgKiBhcHAgPSBOVUxMOyAKICB2YWxpZF9jZXJ0
cyAqKiB2cHA7CgogIEkoZm5fY3R4KTsKICBJKGFyZ2MgPT0gOCk7CiAgSShhcmd2KTsKICBm
b3IgKHNpemVfdCBpID0gMDsgaSA8IDg7ICsraSkKICAgIEkoYXJndltpXSk7CgogIGFwcCA9
IHN0YXRpY19jYXN0PGFwcF9zdGF0ZSAqPihzcWxpdGVfdXNlcl9kYXRhKGZuX2N0eCkpOwog
IEkoYXBwKTsKICB2cHAgPSBzdGF0aWNfY2FzdDx2YWxpZF9jZXJ0cyAqKj4oc3FsaXRlX2Fn
Z3JlZ2F0ZV9jb250ZXh0KGZuX2N0eCwgc2l6ZW9mKHZhbGlkX2NlcnRzICopKSk7CiAgSSh2
cHApOwogIGlmICghICgqdnBwKSkKICAgICp2cHAgPSBuZXcgdmFsaWRfY2VydHMoc3RyaW5n
KGFyZ3ZbMF0pKTsKICBJKCp2cHApOwogICgqdnBwKS0+Y2hlY2tfc2luZ2xlX3NpZ25lcigq
YXBwLCBhcmdjLTEsIGFyZ3YrMSk7ICAKfQoKc3RhdGljIHZvaWQKdHJ1c3RlZF9maW5hbGl6
ZV9jYWxsYmFjayhzcWxpdGVfZnVuYyAqIGZuX2N0eCkKewogIGFwcF9zdGF0ZSAqIGFwcCA9
IE5VTEw7IAogIHZhbGlkX2NlcnRzICoqIHZwcDsKICBhcHAgPSBzdGF0aWNfY2FzdDxhcHBf
c3RhdGUgKj4oc3FsaXRlX3VzZXJfZGF0YShmbl9jdHgpKTsKICBJKGFwcCk7CiAgdnBwID0g
c3RhdGljX2Nhc3Q8dmFsaWRfY2VydHMgKio+KHNxbGl0ZV9hZ2dyZWdhdGVfY29udGV4dChm
bl9jdHgsIHNpemVvZih2YWxpZF9jZXJ0cyAqKSkpOwoKICBJKHZwcCk7CiAgSSgqdnBwKTsK
CiAgaWYgKCgqdnBwKS0+Y2hlY2tfc2lnbmVyX3RydXN0KCphcHApKQogICAgc3FsaXRlX3Nl
dF9yZXN1bHRfaW50KGZuX2N0eCwgMSk7CiAgZWxzZQogICAgc3FsaXRlX3NldF9yZXN1bHRf
aW50KGZuX2N0eCwgMCk7CgogIGRlbGV0ZSAoKnZwcCk7Cn0KfQoKCnZvaWQKZGF0YWJhc2U6
Omluc3RhbGxfZnVuY3Rpb25zKGFwcF9zdGF0ZSAqIGFwcCkKewogIC8vIHJlZ2lzdGVyIGFu
eSBmdW5jdGlvbnMgd2UncmUgZ29pbmcgdG8gdXNlCiAgSShzcWxpdGVfY3JlYXRlX2Z1bmN0
aW9uKHNxbCgpLCAidW5iYXNlNjQiLCAtMSwgCgkJCSAgICZzcWxpdGVfdW5iYXNlNjRfZm4s
IAoJCQkgICBOVUxMKSA9PSAwKTsKCiAgSShzcWxpdGVfY3JlYXRlX2FnZ3JlZ2F0ZShzcWwo
KSwgInRydXN0ZWQiLCA4LCAKCQkJICAgICZ0cnVzdGVkX3N0ZXBfY2FsbGJhY2ssCgkJCSAg
ICAmdHJ1c3RlZF9maW5hbGl6ZV9jYWxsYmFjaywKCQkJICAgIGFwcCkgPT0gMCk7Cn0KCnZv
aWQKZGF0YWJhc2U6Omluc3RhbGxfdmlld3MoKQp7CiAgLy8gZGVsZXRlIGFueSBleGlzdGlu
ZyB2aWV3cwogIHJlc3VsdHMgcmVzOwogIGZldGNoKHJlcywgb25lX2NvbCwgYW55X3Jvd3Ms
CgkiU0VMRUNUIG5hbWUgRlJPTSBzcWxpdGVfbWFzdGVyIFdIRVJFIHR5cGU9J3ZpZXcnIik7
CiAgZm9yIChzaXplX3QgaSA9IDA7IGkgPCByZXMuc2l6ZSgpOyArK2kpCiAgICB7CiAgICAg
IGV4ZWN1dGUoIkRST1AgVklFVyAnJXEnIiwgcmVzW2ldWzBdLmNfc3RyKCkpOwogICAgfQog
IC8vIHJlZ2lzdGVyIGFueSB2aWV3cyB3ZSdyZSBnb2luZyB0byB1c2UKICBleGVjdXRlKHZp
ZXdzX2NvbnN0YW50KTsKfQoKdm9pZCAKZGF0YWJhc2U6OmdldF9oZWFkcyhiYXNlNjQ8Y2Vy
dF92YWx1ZT4gY29uc3QgJiBicmFuY2gsCgkJICAgIHN0ZDo6c2V0PHJldmlzaW9uX2lkPiAm
IGhlYWRzKQp7CiAgcmVzdWx0cyByZXM7CiAgZmV0Y2gocmVzLCBvbmVfY29sLCBhbnlfcm93
cywKCSJTRUxFQ1QgaWQgIgoJIkZST00gYnJhbmNoX2hlYWRzICIKCSJXSEVSRSB2YWx1ZSA9
ICclcSciLAoJYnJhbmNoKCkuY19zdHIoKSk7CiAgaGVhZHMuY2xlYXIoKTsKICBmb3IgKHNp
emVfdCBpID0gMDsgaSA8IHJlcy5zaXplKCk7ICsraSkKICAgIHsKICAgICAgaGVhZHMuaW5z
ZXJ0KHJldmlzaW9uX2lkKHJlc1tpXVswXSkpOwogICAgfQp9Cgp2b2lkIApkYXRhYmFzZTo6
Z2V0X2NlcnRzKGhleGVuYzxpZD4gY29uc3QgJiBpZGVudCwgCgkJICAgIHZlY3RvcjxjZXJ0
PiAmIGNlcnRzLAkJCQoJCSAgICBzdHJpbmcgY29uc3QgJiB0YWJsZSkKewogIHJlc3VsdHMg
cmVzOwogIGZldGNoKHJlcywgNSwgYW55X3Jvd3MsIAoJIlNFTEVDVCBpZCwgbmFtZSwgdmFs
dWUsIGtleXBhaXIsIHNpZ25hdHVyZSBGUk9NICclcScgIgoJIldIRVJFIGlkID0gJyVxJyIs
IAoJdGFibGUuY19zdHIoKSwgCQoJaWRlbnQoKS5jX3N0cigpKTsKICByZXN1bHRzX3RvX2Nl
cnRzKHJlcywgY2VydHMpOwp9CgoKdm9pZCAKZGF0YWJhc2U6OmdldF9jZXJ0cyhjZXJ0X25h
bWUgY29uc3QgJiBuYW1lLCAJICAgICAgCgkJICAgIHZlY3RvcjxjZXJ0PiAmIGNlcnRzLAoJ
CSAgICBzdHJpbmcgY29uc3QgJiB0YWJsZSkKewogIHJlc3VsdHMgcmVzOwogIGZldGNoKHJl
cywgNSwgYW55X3Jvd3MsIAoJIlNFTEVDVCBpZCwgbmFtZSwgdmFsdWUsIGtleXBhaXIsIHNp
Z25hdHVyZSAiCgkiRlJPTSAnJXEnIFdIRVJFIG5hbWUgPSAnJXEnIiwgCgl0YWJsZS5jX3N0
cigpLCAJCgluYW1lKCkuY19zdHIoKSk7CiAgcmVzdWx0c190b19jZXJ0cyhyZXMsIGNlcnRz
KTsKfQoKCnZvaWQgCmRhdGFiYXNlOjpnZXRfY2VydHMoaGV4ZW5jPGlkPiBjb25zdCAmIGlk
ZW50LCAKCQkgICAgY2VydF9uYW1lIGNvbnN0ICYgbmFtZSwgCSAgICAgIAoJCSAgICB2ZWN0
b3I8Y2VydD4gJiBjZXJ0cywKCQkgICAgc3RyaW5nIGNvbnN0ICYgdGFibGUpCnsKICByZXN1
bHRzIHJlczsKICBmZXRjaChyZXMsIDUsIGFueV9yb3dzLCAKCSJTRUxFQ1QgaWQsIG5hbWUs
IHZhbHVlLCBrZXlwYWlyLCBzaWduYXR1cmUgIgoJIkZST00gJyVxJyAiCgkiV0hFUkUgaWQg
PSAnJXEnIEFORCBuYW1lID0gJyVxJyIsIAoJdGFibGUuY19zdHIoKSwgCQoJaWRlbnQoKS5j
X3N0cigpLAoJbmFtZSgpLmNfc3RyKCkpOwogIHJlc3VsdHNfdG9fY2VydHMocmVzLCBjZXJ0
cyk7Cn0KCnZvaWQgCmRhdGFiYXNlOjpnZXRfY2VydHMoY2VydF9uYW1lIGNvbnN0ICYgbmFt
ZSwKCQkgICAgYmFzZTY0PGNlcnRfdmFsdWU+IGNvbnN0ICYgdmFsLCAKCQkgICAgdmVjdG9y
PGNlcnQ+ICYgY2VydHMsCgkJICAgIHN0cmluZyBjb25zdCAmIHRhYmxlKQp7CiAgcmVzdWx0
cyByZXM7CiAgZmV0Y2gocmVzLCA1LCBhbnlfcm93cywgCgkiU0VMRUNUIGlkLCBuYW1lLCB2
YWx1ZSwga2V5cGFpciwgc2lnbmF0dXJlICIKCSJGUk9NICclcScgIgoJIldIRVJFIG5hbWUg
PSAnJXEnIEFORCB2YWx1ZSA9ICclcSciLCAKCXRhYmxlLmNfc3RyKCksIAkKCW5hbWUoKS5j
X3N0cigpLAoJdmFsKCkuY19zdHIoKSk7CiAgcmVzdWx0c190b19jZXJ0cyhyZXMsIGNlcnRz
KTsKfQoKCnZvaWQgCmRhdGFiYXNlOjpnZXRfY2VydHMoaGV4ZW5jPGlkPiBjb25zdCAmIGlk
ZW50LCAKCQkgICAgY2VydF9uYW1lIGNvbnN0ICYgbmFtZSwgCSAgICAgIAoJCSAgICBiYXNl
NjQ8Y2VydF92YWx1ZT4gY29uc3QgJiB2YWx1ZSwKCQkgICAgdmVjdG9yPGNlcnQ+ICYgY2Vy
dHMsCgkJICAgIHN0cmluZyBjb25zdCAmIHRhYmxlKQp7CiAgcmVzdWx0cyByZXM7CiAgZmV0
Y2gocmVzLCA1LCBhbnlfcm93cywgCgkiU0VMRUNUIGlkLCBuYW1lLCB2YWx1ZSwga2V5cGFp
ciwgc2lnbmF0dXJlICIKCSJGUk9NICclcScgIgoJIldIRVJFIGlkID0gJyVxJyBBTkQgbmFt
ZSA9ICclcScgQU5EIHZhbHVlID0gJyVxJyIsIAoJdGFibGUuY19zdHIoKSwgCQoJaWRlbnQo
KS5jX3N0cigpLAoJbmFtZSgpLmNfc3RyKCksCgl2YWx1ZSgpLmNfc3RyKCkpOwogIHJlc3Vs
dHNfdG9fY2VydHMocmVzLCBjZXJ0cyk7Cn0KCgoKYm9vbCAKZGF0YWJhc2U6OnJldmlzaW9u
X2NlcnRfZXhpc3RzKHJldmlzaW9uPGNlcnQ+IGNvbnN0ICYgY2VydCkKeyAKICByZXR1cm4g
Y2VydF9leGlzdHMoY2VydC5pbm5lcigpLCAicmV2aXNpb25fY2VydHMiKTsgCn0KCmJvb2wg
CmRhdGFiYXNlOjptYW5pZmVzdF9jZXJ0X2V4aXN0cyhtYW5pZmVzdDxjZXJ0PiBjb25zdCAm
IGNlcnQpCnsgCiAgcmV0dXJuIGNlcnRfZXhpc3RzKGNlcnQuaW5uZXIoKSwgIm1hbmlmZXN0
X2NlcnRzIik7IAp9Cgpib29sIApkYXRhYmFzZTo6ZmlsZV9jZXJ0X2V4aXN0cyhmaWxlPGNl
cnQ+IGNvbnN0ICYgY2VydCkKeyAKICByZXR1cm4gY2VydF9leGlzdHMoY2VydC5pbm5lcigp
LCAiZmlsZV9jZXJ0cyIpOyAKfQoKdm9pZCAKZGF0YWJhc2U6OnB1dF9tYW5pZmVzdF9jZXJ0
KG1hbmlmZXN0PGNlcnQ+IGNvbnN0ICYgY2VydCkKeyAKICBwdXRfY2VydChjZXJ0LmlubmVy
KCksICJtYW5pZmVzdF9jZXJ0cyIpOyAKfQoKdm9pZCAKZGF0YWJhc2U6OnB1dF9yZXZpc2lv
bl9jZXJ0KHJldmlzaW9uPGNlcnQ+IGNvbnN0ICYgY2VydCkKeyAKICBwdXRfY2VydChjZXJ0
LmlubmVyKCksICJyZXZpc2lvbl9jZXJ0cyIpOyAKfQoKdm9pZCAKZGF0YWJhc2U6OnB1dF9m
aWxlX2NlcnQoZmlsZTxjZXJ0PiBjb25zdCAmIGNlcnQpCnsgCiAgcHV0X2NlcnQoY2VydC5p
bm5lcigpLCAiZmlsZV9jZXJ0cyIpOyAKfQoKdm9pZCAKZGF0YWJhc2U6OmdldF9maWxlX2Nl
cnRzKGNlcnRfbmFtZSBjb25zdCAmIG5hbWUsIAoJCQkgdmVjdG9yPCBmaWxlPGNlcnQ+ID4g
JiB0cykKewogIHZlY3RvcjxjZXJ0PiBjZXJ0czsKICBnZXRfY2VydHMobmFtZSwgY2VydHMs
ICJmaWxlX2NlcnRzIik7CiAgdHMuY2xlYXIoKTsKICBjb3B5KGNlcnRzLmJlZ2luKCksIGNl
cnRzLmVuZCgpLCBiYWNrX2luc2VydGVyKHRzKSk7ICAKfQoKdm9pZCAKZGF0YWJhc2U6Omdl
dF9maWxlX2NlcnRzKGZpbGVfaWQgY29uc3QgJiBpZCwgCgkJCSBjZXJ0X25hbWUgY29uc3Qg
JiBuYW1lLCAKCQkJIHZlY3RvcjwgZmlsZTxjZXJ0PiA+ICYgdHMpCnsKICB2ZWN0b3I8Y2Vy
dD4gY2VydHM7CiAgZ2V0X2NlcnRzKGlkLmlubmVyKCksIG5hbWUsIGNlcnRzLCAiZmlsZV9j
ZXJ0cyIpOwogIHRzLmNsZWFyKCk7CiAgY29weShjZXJ0cy5iZWdpbigpLCBjZXJ0cy5lbmQo
KSwgYmFja19pbnNlcnRlcih0cykpOyAgICAKfQoKdm9pZCAKZGF0YWJhc2U6OmdldF9maWxl
X2NlcnRzKGNlcnRfbmFtZSBjb25zdCAmIG5hbWUsCgkJCSBiYXNlNjQ8Y2VydF92YWx1ZT4g
Y29uc3QgJiB2YWwsIAoJCQkgdmVjdG9yPCBmaWxlPGNlcnQ+ID4gJiB0cykKewogIHZlY3Rv
cjxjZXJ0PiBjZXJ0czsKICBnZXRfY2VydHMobmFtZSwgdmFsLCBjZXJ0cywgImZpbGVfY2Vy
dHMiKTsKICB0cy5jbGVhcigpOwogIGNvcHkoY2VydHMuYmVnaW4oKSwgY2VydHMuZW5kKCks
IGJhY2tfaW5zZXJ0ZXIodHMpKTsgIAp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X2ZpbGVfY2Vy
dHMoZmlsZV9pZCBjb25zdCAmIGlkLCAKCQkJIGNlcnRfbmFtZSBjb25zdCAmIG5hbWUsCgkJ
CSBiYXNlNjQ8Y2VydF92YWx1ZT4gY29uc3QgJiB2YWwsIAoJCQkgdmVjdG9yPCBmaWxlPGNl
cnQ+ID4gJiB0cykKewogIHZlY3RvcjxjZXJ0PiBjZXJ0czsKICBnZXRfY2VydHMoaWQuaW5u
ZXIoKSwgbmFtZSwgdmFsLCBjZXJ0cywgImZpbGVfY2VydHMiKTsKICB0cy5jbGVhcigpOwog
IGNvcHkoY2VydHMuYmVnaW4oKSwgY2VydHMuZW5kKCksIGJhY2tfaW5zZXJ0ZXIodHMpKTsg
IAp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X2ZpbGVfY2VydHMoZmlsZV9pZCBjb25zdCAmIGlk
LCAKCQkJIHZlY3RvcjwgZmlsZTxjZXJ0PiA+ICYgdHMpCnsgCiAgdmVjdG9yPGNlcnQ+IGNl
cnRzOwogIGdldF9jZXJ0cyhpZC5pbm5lcigpLCBjZXJ0cywgImZpbGVfY2VydHMiKTsgCiAg
dHMuY2xlYXIoKTsKICBjb3B5KGNlcnRzLmJlZ2luKCksIGNlcnRzLmVuZCgpLCBiYWNrX2lu
c2VydGVyKHRzKSk7Cn0KCgpib29sIApkYXRhYmFzZTo6ZmlsZV9jZXJ0X2V4aXN0cyhoZXhl
bmM8aWQ+IGNvbnN0ICYgaGFzaCkKewogIHJlc3VsdHMgcmVzOwogIHZlY3RvcjxjZXJ0PiBj
ZXJ0czsKICBmZXRjaChyZXMsIG9uZV9jb2wsIGFueV9yb3dzLCAKCSJTRUxFQ1QgaWQgIgoJ
IkZST00gZmlsZV9jZXJ0cyAiCgkiV0hFUkUgaGFzaCA9ICclcSciLCAKCWhhc2goKS5jX3N0
cigpKTsKICBJKHJlcy5zaXplKCkgPT0gMCB8fCByZXMuc2l6ZSgpID09IDEpOwogIHJldHVy
biAocmVzLnNpemUoKSA9PSAxKTsKfQoKdm9pZCAKZGF0YWJhc2U6OmdldF9maWxlX2NlcnQo
aGV4ZW5jPGlkPiBjb25zdCAmIGhhc2gsCgkJCWZpbGU8Y2VydD4gJiBjKQp7CiAgcmVzdWx0
cyByZXM7CiAgdmVjdG9yPGNlcnQ+IGNlcnRzOwogIGZldGNoKHJlcywgNSwgb25lX3Jvdywg
CgkiU0VMRUNUIGlkLCBuYW1lLCB2YWx1ZSwga2V5cGFpciwgc2lnbmF0dXJlICIKCSJGUk9N
IGZpbGVfY2VydHMgIgoJIldIRVJFIGhhc2ggPSAnJXEnIiwgCgloYXNoKCkuY19zdHIoKSk7
CiAgcmVzdWx0c190b19jZXJ0cyhyZXMsIGNlcnRzKTsKICBJKGNlcnRzLnNpemUoKSA9PSAx
KTsKICBjID0gZmlsZTxjZXJ0PihjZXJ0c1swXSk7Cn0KCgoKdm9pZCAKZGF0YWJhc2U6Omdl
dF9yZXZpc2lvbl9jZXJ0cyhjZXJ0X25hbWUgY29uc3QgJiBuYW1lLCAKCQkJICAgIHZlY3Rv
cjwgcmV2aXNpb248Y2VydD4gPiAmIHRzKQp7CiAgdmVjdG9yPGNlcnQ+IGNlcnRzOwogIGdl
dF9jZXJ0cyhuYW1lLCBjZXJ0cywgInJldmlzaW9uX2NlcnRzIik7CiAgdHMuY2xlYXIoKTsK
ICBjb3B5KGNlcnRzLmJlZ2luKCksIGNlcnRzLmVuZCgpLCBiYWNrX2luc2VydGVyKHRzKSk7
ICAKfQoKdm9pZCAKZGF0YWJhc2U6OmdldF9yZXZpc2lvbl9jZXJ0cyhyZXZpc2lvbl9pZCBj
b25zdCAmIGlkLCAKCQkJICAgIGNlcnRfbmFtZSBjb25zdCAmIG5hbWUsIAoJCQkgICAgdmVj
dG9yPCByZXZpc2lvbjxjZXJ0PiA+ICYgdHMpCnsKICB2ZWN0b3I8Y2VydD4gY2VydHM7CiAg
Z2V0X2NlcnRzKGlkLmlubmVyKCksIG5hbWUsIGNlcnRzLCAicmV2aXNpb25fY2VydHMiKTsK
ICB0cy5jbGVhcigpOwogIGNvcHkoY2VydHMuYmVnaW4oKSwgY2VydHMuZW5kKCksIGJhY2tf
aW5zZXJ0ZXIodHMpKTsgIAp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X3JldmlzaW9uX2NlcnRz
KHJldmlzaW9uX2lkIGNvbnN0ICYgaWQsIAoJCQkgICAgY2VydF9uYW1lIGNvbnN0ICYgbmFt
ZSwKCQkJICAgIGJhc2U2NDxjZXJ0X3ZhbHVlPiBjb25zdCAmIHZhbCwgCgkJCSAgICB2ZWN0
b3I8IHJldmlzaW9uPGNlcnQ+ID4gJiB0cykKewogIHZlY3RvcjxjZXJ0PiBjZXJ0czsKICBn
ZXRfY2VydHMoaWQuaW5uZXIoKSwgbmFtZSwgdmFsLCBjZXJ0cywgInJldmlzaW9uX2NlcnRz
Iik7CiAgdHMuY2xlYXIoKTsKICBjb3B5KGNlcnRzLmJlZ2luKCksIGNlcnRzLmVuZCgpLCBi
YWNrX2luc2VydGVyKHRzKSk7ICAKfQoKdm9pZCAKZGF0YWJhc2U6OmdldF9yZXZpc2lvbl9j
ZXJ0cyhjZXJ0X25hbWUgY29uc3QgJiBuYW1lLAoJCQkgICAgYmFzZTY0PGNlcnRfdmFsdWU+
IGNvbnN0ICYgdmFsLCAKCQkJICAgIHZlY3RvcjwgcmV2aXNpb248Y2VydD4gPiAmIHRzKQp7
CiAgdmVjdG9yPGNlcnQ+IGNlcnRzOwogIGdldF9jZXJ0cyhuYW1lLCB2YWwsIGNlcnRzLCAi
cmV2aXNpb25fY2VydHMiKTsKICB0cy5jbGVhcigpOwogIGNvcHkoY2VydHMuYmVnaW4oKSwg
Y2VydHMuZW5kKCksIGJhY2tfaW5zZXJ0ZXIodHMpKTsgIAp9Cgp2b2lkIApkYXRhYmFzZTo6
Z2V0X3JldmlzaW9uX2NlcnRzKHJldmlzaW9uX2lkIGNvbnN0ICYgaWQsIAoJCQkgICAgdmVj
dG9yPCByZXZpc2lvbjxjZXJ0PiA+ICYgdHMpCnsgCiAgdmVjdG9yPGNlcnQ+IGNlcnRzOwog
IGdldF9jZXJ0cyhpZC5pbm5lcigpLCBjZXJ0cywgInJldmlzaW9uX2NlcnRzIik7IAogIHRz
LmNsZWFyKCk7CiAgY29weShjZXJ0cy5iZWdpbigpLCBjZXJ0cy5lbmQoKSwgYmFja19pbnNl
cnRlcih0cykpOwp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X3JldmlzaW9uX2NlcnQoaGV4ZW5j
PGlkPiBjb25zdCAmIGhhc2gsCgkJCSAgIHJldmlzaW9uPGNlcnQ+ICYgYykKewogIHJlc3Vs
dHMgcmVzOwogIHZlY3RvcjxjZXJ0PiBjZXJ0czsKICBmZXRjaChyZXMsIDUsIG9uZV9yb3cs
IAoJIlNFTEVDVCBpZCwgbmFtZSwgdmFsdWUsIGtleXBhaXIsIHNpZ25hdHVyZSAiCgkiRlJP
TSByZXZpc2lvbl9jZXJ0cyAiCgkiV0hFUkUgaGFzaCA9ICclcSciLCAKCWhhc2goKS5jX3N0
cigpKTsKICByZXN1bHRzX3RvX2NlcnRzKHJlcywgY2VydHMpOwogIEkoY2VydHMuc2l6ZSgp
ID09IDEpOwogIGMgPSByZXZpc2lvbjxjZXJ0PihjZXJ0c1swXSk7Cn0KCmJvb2wgCmRhdGFi
YXNlOjpyZXZpc2lvbl9jZXJ0X2V4aXN0cyhoZXhlbmM8aWQ+IGNvbnN0ICYgaGFzaCkKewog
IHJlc3VsdHMgcmVzOwogIHZlY3RvcjxjZXJ0PiBjZXJ0czsKICBmZXRjaChyZXMsIG9uZV9j
b2wsIGFueV9yb3dzLCAKCSJTRUxFQ1QgaWQgIgoJIkZST00gcmV2aXNpb25fY2VydHMgIgoJ
IldIRVJFIGhhc2ggPSAnJXEnIiwgCgloYXNoKCkuY19zdHIoKSk7CiAgSShyZXMuc2l6ZSgp
ID09IDAgfHwgcmVzLnNpemUoKSA9PSAxKTsKICByZXR1cm4gKHJlcy5zaXplKCkgPT0gMSk7
Cn0KCmJvb2wgCmRhdGFiYXNlOjptYW5pZmVzdF9jZXJ0X2V4aXN0cyhoZXhlbmM8aWQ+IGNv
bnN0ICYgaGFzaCkKewogIHJlc3VsdHMgcmVzOwogIHZlY3RvcjxjZXJ0PiBjZXJ0czsKICBm
ZXRjaChyZXMsIG9uZV9jb2wsIGFueV9yb3dzLCAKCSJTRUxFQ1QgaWQgIgoJIkZST00gbWFu
aWZlc3RfY2VydHMgIgoJIldIRVJFIGhhc2ggPSAnJXEnIiwgCgloYXNoKCkuY19zdHIoKSk7
CiAgSShyZXMuc2l6ZSgpID09IDAgfHwgcmVzLnNpemUoKSA9PSAxKTsKICByZXR1cm4gKHJl
cy5zaXplKCkgPT0gMSk7Cn0KCnZvaWQgCmRhdGFiYXNlOjpnZXRfbWFuaWZlc3RfY2VydCho
ZXhlbmM8aWQ+IGNvbnN0ICYgaGFzaCwKCQkJICAgIG1hbmlmZXN0PGNlcnQ+ICYgYykKewog
IHJlc3VsdHMgcmVzOwogIHZlY3RvcjxjZXJ0PiBjZXJ0czsKICBmZXRjaChyZXMsIDUsIG9u
ZV9yb3csIAoJIlNFTEVDVCBpZCwgbmFtZSwgdmFsdWUsIGtleXBhaXIsIHNpZ25hdHVyZSAi
CgkiRlJPTSBtYW5pZmVzdF9jZXJ0cyAiCgkiV0hFUkUgaGFzaCA9ICclcSciLCAKCWhhc2go
KS5jX3N0cigpKTsKICByZXN1bHRzX3RvX2NlcnRzKHJlcywgY2VydHMpOwogIEkoY2VydHMu
c2l6ZSgpID09IDEpOwogIGMgPSBtYW5pZmVzdDxjZXJ0PihjZXJ0c1swXSk7Cn0KCnZvaWQg
CmRhdGFiYXNlOjpnZXRfbWFuaWZlc3RfY2VydHMobWFuaWZlc3RfaWQgY29uc3QgJiBpZCwg
CgkJCSAgICAgdmVjdG9yPCBtYW5pZmVzdDxjZXJ0PiA+ICYgdHMpCnsgCiAgdmVjdG9yPGNl
cnQ+IGNlcnRzOwogIGdldF9jZXJ0cyhpZC5pbm5lcigpLCBjZXJ0cywgIm1hbmlmZXN0X2Nl
cnRzIik7IAogIHRzLmNsZWFyKCk7CiAgY29weShjZXJ0cy5iZWdpbigpLCBjZXJ0cy5lbmQo
KSwgYmFja19pbnNlcnRlcih0cykpOwp9CgoKdm9pZCAKZGF0YWJhc2U6OmdldF9tYW5pZmVz
dF9jZXJ0cyhjZXJ0X25hbWUgY29uc3QgJiBuYW1lLCAKCQkJICAgIHZlY3RvcjwgbWFuaWZl
c3Q8Y2VydD4gPiAmIHRzKQp7CiAgdmVjdG9yPGNlcnQ+IGNlcnRzOwogIGdldF9jZXJ0cyhu
YW1lLCBjZXJ0cywgIm1hbmlmZXN0X2NlcnRzIik7CiAgdHMuY2xlYXIoKTsKICBjb3B5KGNl
cnRzLmJlZ2luKCksIGNlcnRzLmVuZCgpLCBiYWNrX2luc2VydGVyKHRzKSk7ICAKfQoKdm9p
ZCAKZGF0YWJhc2U6OmdldF9tYW5pZmVzdF9jZXJ0cyhtYW5pZmVzdF9pZCBjb25zdCAmIGlk
LCAKCQkJICAgICBjZXJ0X25hbWUgY29uc3QgJiBuYW1lLCAKCQkJICAgICB2ZWN0b3I8IG1h
bmlmZXN0PGNlcnQ+ID4gJiB0cykKewogIHZlY3RvcjxjZXJ0PiBjZXJ0czsKICBnZXRfY2Vy
dHMoaWQuaW5uZXIoKSwgbmFtZSwgY2VydHMsICJtYW5pZmVzdF9jZXJ0cyIpOwogIHRzLmNs
ZWFyKCk7CiAgY29weShjZXJ0cy5iZWdpbigpLCBjZXJ0cy5lbmQoKSwgYmFja19pbnNlcnRl
cih0cykpOyAgCn0KCgovLyBjb21wbGV0aW9ucwp2b2lkIApkYXRhYmFzZTo6Y29tcGxldGUo
c3RyaW5nIGNvbnN0ICYgcGFydGlhbCwKCQkgICBzZXQ8cmV2aXNpb25faWQ+ICYgY29tcGxl
dGlvbnMpCnsKICByZXN1bHRzIHJlczsKICBjb21wbGV0aW9ucy5jbGVhcigpOwoKICBmZXRj
aChyZXMsIDEsIGFueV9yb3dzLAoJIlNFTEVDVCBpZCBGUk9NIHJldmlzaW9ucyBXSEVSRSBp
ZCBHTE9CICclcSonIiwKCXBhcnRpYWwuY19zdHIoKSk7CgogIGZvciAoc2l6ZV90IGkgPSAw
OyBpIDwgcmVzLnNpemUoKTsgKytpKQogICAgY29tcGxldGlvbnMuaW5zZXJ0KHJldmlzaW9u
X2lkKHJlc1tpXVswXSkpOyAgCn0KCgp2b2lkIApkYXRhYmFzZTo6Y29tcGxldGUoc3RyaW5n
IGNvbnN0ICYgcGFydGlhbCwKCQkgICBzZXQ8bWFuaWZlc3RfaWQ+ICYgY29tcGxldGlvbnMp
CnsKICByZXN1bHRzIHJlczsKICBjb21wbGV0aW9ucy5jbGVhcigpOwoKICBmZXRjaChyZXMs
IDEsIGFueV9yb3dzLAoJIlNFTEVDVCBpZCBGUk9NIG1hbmlmZXN0cyBXSEVSRSBpZCBHTE9C
ICclcSonIiwKCXBhcnRpYWwuY19zdHIoKSk7CgogIGZvciAoc2l6ZV90IGkgPSAwOyBpIDwg
cmVzLnNpemUoKTsgKytpKQogICAgY29tcGxldGlvbnMuaW5zZXJ0KG1hbmlmZXN0X2lkKHJl
c1tpXVswXSkpOyAgCiAgCiAgcmVzLmNsZWFyKCk7CgogIGZldGNoKHJlcywgMSwgYW55X3Jv
d3MsCgkiU0VMRUNUIGlkIEZST00gbWFuaWZlc3RfZGVsdGFzIFdIRVJFIGlkIEdMT0IgJyVx
KiciLAoJcGFydGlhbC5jX3N0cigpKTsKCiAgZm9yIChzaXplX3QgaSA9IDA7IGkgPCByZXMu
c2l6ZSgpOyArK2kpCiAgICBjb21wbGV0aW9ucy5pbnNlcnQobWFuaWZlc3RfaWQocmVzW2ld
WzBdKSk7ICAKfQoKdm9pZCAKZGF0YWJhc2U6OmNvbXBsZXRlKHN0cmluZyBjb25zdCAmIHBh
cnRpYWwsCgkJICAgc2V0PGZpbGVfaWQ+ICYgY29tcGxldGlvbnMpCnsKICByZXN1bHRzIHJl
czsKICBjb21wbGV0aW9ucy5jbGVhcigpOwoKICBmZXRjaChyZXMsIDEsIGFueV9yb3dzLAoJ
IlNFTEVDVCBpZCBGUk9NIGZpbGVzIFdIRVJFIGlkIEdMT0IgJyVxKiciLAoJcGFydGlhbC5j
X3N0cigpKTsKCiAgZm9yIChzaXplX3QgaSA9IDA7IGkgPCByZXMuc2l6ZSgpOyArK2kpCiAg
ICBjb21wbGV0aW9ucy5pbnNlcnQoZmlsZV9pZChyZXNbaV1bMF0pKTsgIAogIAogIHJlcy5j
bGVhcigpOwoKICBmZXRjaChyZXMsIDEsIGFueV9yb3dzLAoJIlNFTEVDVCBpZCBGUk9NIGZp
bGVfZGVsdGFzIFdIRVJFIGlkIEdMT0IgJyVxKiciLAoJcGFydGlhbC5jX3N0cigpKTsKCiAg
Zm9yIChzaXplX3QgaSA9IDA7IGkgPCByZXMuc2l6ZSgpOyArK2kpCiAgICBjb21wbGV0aW9u
cy5pbnNlcnQoZmlsZV9pZChyZXNbaV1bMF0pKTsgIAp9Cgp1c2luZyBjb21tYW5kczo6c2Vs
ZWN0b3JfdHlwZTsKCnN0YXRpYyB2b2lkIHNlbGVjdG9yX3RvX2NlcnRuYW1lKHNlbGVjdG9y
X3R5cGUgdHksCgkJCQkgc3RyaW5nICYgcykKewogIHN3aXRjaCAodHkpCiAgICB7CiAgICBj
YXNlIGNvbW1hbmRzOjpzZWxfYXV0aG9yOgogICAgICBzID0gYXV0aG9yX2NlcnRfbmFtZTsK
ICAgICAgYnJlYWs7CiAgICBjYXNlIGNvbW1hbmRzOjpzZWxfYnJhbmNoOgogICAgICBzID0g
YnJhbmNoX2NlcnRfbmFtZTsKICAgICAgYnJlYWs7CiAgICBjYXNlIGNvbW1hbmRzOjpzZWxf
ZGF0ZToKICAgICAgcyA9IGRhdGVfY2VydF9uYW1lOwogICAgICBicmVhazsKICAgIGNhc2Ug
Y29tbWFuZHM6OnNlbF90YWc6CiAgICAgIHMgPSB0YWdfY2VydF9uYW1lOwogICAgICBicmVh
azsKICAgIGNhc2UgY29tbWFuZHM6OnNlbF9pZGVudDoKICAgIGNhc2UgY29tbWFuZHM6OnNl
bF91bmtub3duOgogICAgICBJKGZhbHNlKTsgLy8gZG9uJ3QgZG8gdGhpcy4KICAgICAgYnJl
YWs7CiAgICB9Cn0KCnZvaWQgZGF0YWJhc2U6OmNvbXBsZXRlKHNlbGVjdG9yX3R5cGUgdHks
CgkJCXN0cmluZyBjb25zdCAmIHBhcnRpYWwsCgkJCXZlY3RvcjxwYWlyPHNlbGVjdG9yX3R5
cGUsIHN0cmluZz4gPiBjb25zdCAmIGxpbWl0LAoJCQlzZXQ8c3RyaW5nPiAmIGNvbXBsZXRp
b25zKQp7CiAgY29tcGxldGlvbnMuY2xlYXIoKTsKCiAgLy8gc3RlcCAxOiB0aGUgbGltaXQg
aXMgdHJhbnNmb3JtZWQgaW50byBhbiBTUUwgc2VsZWN0IHN0YXRlbWVudCB3aGljaAogIC8v
IHNlbGVjdHMgYSBzZXQgb2YgSURzIGZyb20gdGhlIG1hbmlmZXN0X2NlcnRzIHRhYmxlIHdo
aWNoIG1hdGNoIHRoZQogIC8vIGxpbWl0LiAgdGhpcyBpcyBkb25lIGJ5IGJ1aWxkaW5nIGFu
IFNRTCBzZWxlY3Qgc3RhdGVtZW50IGZvciBlYWNoIHRlcm0KICAvLyBpbiB0aGUgbGltaXQg
YW5kIHRoZW4gSU5URVJTRUNUaW5nIHRoZW0gYWxsLgoKICBzdHJpbmcgbGltID0gIigiOwog
IGJvb2wgZmlyc3RfbGltaXQgPSB0cnVlOwogIGZvciAodmVjdG9yPHBhaXI8c2VsZWN0b3Jf
dHlwZSwgc3RyaW5nPiA+Ojpjb25zdF9pdGVyYXRvciBpID0gbGltaXQuYmVnaW4oKTsKICAg
ICAgIGkgIT0gbGltaXQuZW5kKCk7ICsraSkKICAgIHsKICAgICAgaWYgKGZpcnN0X2xpbWl0
KQoJZmlyc3RfbGltaXQgPSBmYWxzZTsKICAgICAgZWxzZQoJbGltICs9ICIgSU5URVJTRUNU
ICI7CiAgICAgIAogICAgICBpZiAoaS0+Zmlyc3QgPT0gY29tbWFuZHM6OnNlbF9pZGVudCkK
CXsKCSAgbGltICs9ICJTRUxFQ1QgaWQgRlJPTSByZXZpc2lvbl9jZXJ0cyAiOwoJICBsaW0g
Kz0gKEYoIldIRVJFIGlkIEdMT0IgJyVzKiciKSAKCQkgICUgaS0+c2Vjb25kKS5zdHIoKTsK
CX0KICAgICAgZWxzZSBpZiAoaS0+Zmlyc3QgPT0gY29tbWFuZHM6OnNlbF91bmtub3duKQoJ
ewoJICBsaW0gKz0gIlNFTEVDVCBpZCBGUk9NIHJldmlzaW9uX2NlcnRzICI7CgkgIGxpbSAr
PSAoRigiIFdIRVJFIChuYW1lPSclcycgT1IgbmFtZT0nJXMnIE9SIG5hbWU9JyVzJykiKQoJ
CSAgJSBhdXRob3JfY2VydF9uYW1lIAoJCSAgJSB0YWdfY2VydF9uYW1lIAoJCSAgJSBicmFu
Y2hfY2VydF9uYW1lKS5zdHIoKTsKCSAgbGltICs9IChGKCIgQU5EIHVuYmFzZTY0KHZhbHVl
KSBnbG9iICcqJXMqJyIpCgkJICAlIGktPnNlY29uZCkuc3RyKCk7CSAgCgl9CiAgICAgIGVs
c2UKCXsKCSAgc3RyaW5nIGNlcnRuYW1lOwoJICBzZWxlY3Rvcl90b19jZXJ0bmFtZShpLT5m
aXJzdCwgY2VydG5hbWUpOwoJICBsaW0gKz0gIlNFTEVDVCBpZCBGUk9NIHJldmlzaW9uX2Nl
cnRzICI7CgkgIGxpbSArPSAoRigiV0hFUkUgbmFtZT0nJXMnIEFORCB1bmJhc2U2NCh2YWx1
ZSkgZ2xvYiAnKiVzKiciKQoJCSAgJSBjZXJ0bmFtZSAlIGktPnNlY29uZCkuc3RyKCk7Cgl9
CiAgICB9CiAgbGltICs9ICIpIjsKICAKICAvLyBzdGVwIDI6IGRlcGVuZGluZyBvbiB3aGF0
IHdlJ3ZlIGJlZW4gYXNrZWQgdG8gZGlzYW1iaWd1YXRlLCB3ZQogIC8vIHdpbGwgY29tcGxl
dGUgZWl0aGVyIHNvbWUgaWRlbnRzLCBvciBjZXJ0IHZhbHVlcywgb3IgInVua25vd24iCiAg
Ly8gd2hpY2ggZ2VuZXJhbGx5IG1lYW5zICJhdXRob3IsIHRhZyBvciBicmFuY2giCgogIHN0
cmluZyBxdWVyeTsKICBpZiAodHkgPT0gY29tbWFuZHM6OnNlbF9pZGVudCkKICAgIHsKICAg
ICAgcXVlcnkgPSAoRigiU0VMRUNUIGlkIEZST00gJXMiKSAlIGxpbSkuc3RyKCk7CiAgICB9
CiAgZWxzZSAKICAgIHsKICAgICAgcXVlcnkgPSAiU0VMRUNUIHZhbHVlIEZST00gcmV2aXNp
b25fY2VydHMgV0hFUkUiOwogICAgICBpZiAodHkgPT0gY29tbWFuZHM6OnNlbF91bmtub3du
KQoJewkgIAkKCSAgcXVlcnkgKz0gCgkgICAgKEYoIiAobmFtZT0nJXMnIE9SIG5hbWU9JyVz
JyBPUiBuYW1lPSclcycpIikKCSAgICAgJSBhdXRob3JfY2VydF9uYW1lIAoJICAgICAlIHRh
Z19jZXJ0X25hbWUgCgkgICAgICUgYnJhbmNoX2NlcnRfbmFtZSkuc3RyKCk7Cgl9CiAgICAg
IGVsc2UKCXsKCSAgc3RyaW5nIGNlcnRuYW1lOwoJICBzZWxlY3Rvcl90b19jZXJ0bmFtZSh0
eSwgY2VydG5hbWUpOwoJICBxdWVyeSArPSAKCSAgICAoRigiIChuYW1lPSclcycpIikgJSBj
ZXJ0bmFtZSkuc3RyKCk7Cgl9CiAgICAgICAgCiAgICAgIHF1ZXJ5ICs9IChGKCIgQU5EICh1
bmJhc2U2NCh2YWx1ZSkgR0xPQiAnKiVzKicpIikgJSBwYXJ0aWFsKS5zdHIoKTsKICAgICAg
cXVlcnkgKz0gKEYoIiBBTkQgKGlkIElOICVzKSIpICUgbGltKS5zdHIoKTsKICAgIH0KCiAg
cmVzdWx0cyByZXM7CiAgZmV0Y2gocmVzLCBvbmVfY29sLCBhbnlfcm93cywgcXVlcnkuY19z
dHIoKSk7CiAgZm9yIChzaXplX3QgaSA9IDA7IGkgPCByZXMuc2l6ZSgpOyArK2kpCiAgICB7
CiAgICAgIGlmICh0eSA9PSBjb21tYW5kczo6c2VsX2lkZW50KQoJY29tcGxldGlvbnMuaW5z
ZXJ0KHJlc1tpXVswXSk7CiAgICAgIGVsc2UKCXsKCSAgYmFzZTY0PGRhdGE+IHJvd19lbmNv
ZGVkKHJlc1tpXVswXSk7CgkgIGRhdGEgcm93X2RlY29kZWQ7CgkgIGRlY29kZV9iYXNlNjQo
cm93X2VuY29kZWQsIHJvd19kZWNvZGVkKTsKCSAgY29tcGxldGlvbnMuaW5zZXJ0KHJvd19k
ZWNvZGVkKCkpOwoJfQogICAgfQp9CgoKLy8gbWVya2xlIG5vZGVzCgpib29sIApkYXRhYmFz
ZTo6bWVya2xlX25vZGVfZXhpc3RzKHN0cmluZyBjb25zdCAmIHR5cGUsCgkJCSAgICAgdXRm
OCBjb25zdCAmIGNvbGxlY3Rpb24sIAoJCQkgICAgIHNpemVfdCBsZXZlbCwKCQkJICAgICBo
ZXhlbmM8cHJlZml4PiBjb25zdCAmIHByZWZpeCkKewogIHJlc3VsdHMgcmVzOwogIGZldGNo
KHJlcywgb25lX2NvbCwgb25lX3JvdywgCgkiU0VMRUNUIENPVU5UKCopICIKCSJGUk9NIG1l
cmtsZV9ub2RlcyAiCgkiV0hFUkUgdHlwZSA9ICclcScgIgoJIkFORCBjb2xsZWN0aW9uID0g
JyVxJyAiCgkiQU5EIGxldmVsID0gJWQgIgoJIkFORCBwcmVmaXggPSAnJXEnICIsCgl0eXBl
LmNfc3RyKCksIGNvbGxlY3Rpb24oKS5jX3N0cigpLCBsZXZlbCwgcHJlZml4KCkuY19zdHIo
KSk7CiAgc2l6ZV90IG5fbm9kZXMgPSBsZXhpY2FsX2Nhc3Q8c2l6ZV90PihyZXNbMF1bMF0p
OwogIEkobl9ub2RlcyA9PSAwIHx8IG5fbm9kZXMgPT0gMSk7CiAgcmV0dXJuIG5fbm9kZXMg
PT0gMTsKfQoKdm9pZCAKZGF0YWJhc2U6OmdldF9tZXJrbGVfbm9kZShzdHJpbmcgY29uc3Qg
JiB0eXBlLAoJCQkgIHV0ZjggY29uc3QgJiBjb2xsZWN0aW9uLCAKCQkJICBzaXplX3QgbGV2
ZWwsCgkJCSAgaGV4ZW5jPHByZWZpeD4gY29uc3QgJiBwcmVmaXgsCgkJCSAgYmFzZTY0PG1l
cmtsZT4gJiBub2RlKQp7CiAgcmVzdWx0cyByZXM7CiAgZmV0Y2gocmVzLCBvbmVfY29sLCBv
bmVfcm93LCAKCSJTRUxFQ1QgYm9keSAiCgkiRlJPTSBtZXJrbGVfbm9kZXMgIgoJIldIRVJF
IHR5cGUgPSAnJXEnICIKCSJBTkQgY29sbGVjdGlvbiA9ICclcScgIgoJIkFORCBsZXZlbCA9
ICVkICIKCSJBTkQgcHJlZml4ID0gJyVxJyIsCgl0eXBlLmNfc3RyKCksIGNvbGxlY3Rpb24o
KS5jX3N0cigpLCBsZXZlbCwgcHJlZml4KCkuY19zdHIoKSk7CiAgbm9kZSA9IHJlc1swXVsw
XTsKfQoKdm9pZCAKZGF0YWJhc2U6OnB1dF9tZXJrbGVfbm9kZShzdHJpbmcgY29uc3QgJiB0
eXBlLAoJCQkgIHV0ZjggY29uc3QgJiBjb2xsZWN0aW9uLCAKCQkJICBzaXplX3QgbGV2ZWws
CgkJCSAgaGV4ZW5jPHByZWZpeD4gY29uc3QgJiBwcmVmaXgsCQkJCSAgICAgICAKCQkJICBi
YXNlNjQ8bWVya2xlPiBjb25zdCAmIG5vZGUpCnsKICBleGVjdXRlKCJJTlNFUlQgT1IgUkVQ
TEFDRSAiCgkgICJJTlRPIG1lcmtsZV9ub2RlcyAiCgkgICJWQUxVRVMgKCclcScsICclcScs
ICVkLCAnJXEnLCAnJXEnKSIsCgkgIHR5cGUuY19zdHIoKSwgY29sbGVjdGlvbigpLmNfc3Ry
KCksIGxldmVsLCBwcmVmaXgoKS5jX3N0cigpLCBub2RlKCkuY19zdHIoKSk7Cn0KCnZvaWQg
CmRhdGFiYXNlOjplcmFzZV9tZXJrbGVfbm9kZXMoc3RyaW5nIGNvbnN0ICYgdHlwZSwKCQkJ
ICAgICB1dGY4IGNvbnN0ICYgY29sbGVjdGlvbikKewogIGV4ZWN1dGUoIkRFTEVURSBGUk9N
IG1lcmtsZV9ub2RlcyAiCgkgICJXSEVSRSB0eXBlID0gJyVxJyAiCgkgICJBTkQgY29sbGVj
dGlvbiA9ICclcSciLAoJICB0eXBlLmNfc3RyKCksIGNvbGxlY3Rpb24oKS5jX3N0cigpKTsK
fQoKLy8gdHJhbnNhY3Rpb24gZ3VhcmRzCgp0cmFuc2FjdGlvbl9ndWFyZDo6dHJhbnNhY3Rp
b25fZ3VhcmQoZGF0YWJhc2UgJiBkKSA6IGNvbW1pdHRlZChmYWxzZSksIGRiKGQpIAp7CiAg
ZGIuYmVnaW5fdHJhbnNhY3Rpb24oKTsKfQp0cmFuc2FjdGlvbl9ndWFyZDo6fnRyYW5zYWN0
aW9uX2d1YXJkKCkKewogIGlmIChjb21taXR0ZWQpCiAgICBkYi5jb21taXRfdHJhbnNhY3Rp
b24oKTsKICBlbHNlCiAgICBkYi5yb2xsYmFja190cmFuc2FjdGlvbigpOwp9Cgp2b2lkIAp0
cmFuc2FjdGlvbl9ndWFyZDo6Y29tbWl0KCkKewogIGNvbW1pdHRlZCA9IHRydWU7Cn0KCg==
])

AT_DATA(correct.b64, [Ly8gY29weXJpZ2h0IChDKSAyMDAyLCAyMDAzIGdyYXlkb24gaG9hcmUgPGdyYXlkb25AcG9i
b3guY29tPgovLyBhbGwgcmlnaHRzIHJlc2VydmVkLgovLyBsaWNlbnNlZCB0byB0aGUgcHVi
bGljIHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdQTCAoPj0gMikKLy8gc2VlIHRoZSBm
aWxlIENPUFlJTkcgZm9yIGRldGFpbHMKCiNpbmNsdWRlIDxpdGVyYXRvcj4KI2luY2x1ZGUg
PGxpc3Q+CiNpbmNsdWRlIDxzZXQ+CiNpbmNsdWRlIDxzc3RyZWFtPgojaW5jbHVkZSA8dmVj
dG9yPgoKI2luY2x1ZGUgPHN0ZGFyZy5oPgoKI2luY2x1ZGUgPGJvb3N0L3NoYXJlZF9wdHIu
aHBwPgojaW5jbHVkZSA8Ym9vc3QvbGV4aWNhbF9jYXN0LmhwcD4KI2luY2x1ZGUgPGJvb3N0
L2ZpbGVzeXN0ZW0vcGF0aC5ocHA+CiNpbmNsdWRlIDxib29zdC9maWxlc3lzdGVtL29wZXJh
dGlvbnMuaHBwPgoKI2luY2x1ZGUgPHNxbGl0ZS5oPgoKI2luY2x1ZGUgImFwcF9zdGF0ZS5o
aCIKI2luY2x1ZGUgImNlcnQuaGgiCiNpbmNsdWRlICJjbGVhbnVwLmhoIgojaW5jbHVkZSAi
Y29uc3RhbnRzLmhoIgojaW5jbHVkZSAiZGF0YWJhc2UuaGgiCiNpbmNsdWRlICJrZXlzLmho
IgojaW5jbHVkZSAic2FuaXR5LmhoIgojaW5jbHVkZSAic2NoZW1hX21pZ3JhdGlvbi5oaCIK
I2luY2x1ZGUgImNlcnQuaGgiCiNpbmNsdWRlICJ0cmFuc2Zvcm1zLmhoIgojaW5jbHVkZSAi
dWkuaGgiCiNpbmNsdWRlICJ2b2NhYi5oaCIKI2luY2x1ZGUgInhkZWx0YS5oaCIKCi8vIGRl
ZmluZWQgaW4gc2NoZW1hLnNxbCwgY29udmVydGVkIHRvIGhlYWRlcjoKI2luY2x1ZGUgInNj
aGVtYS5oIgoKLy8gZGVmaW5lZCBpbiB2aWV3cy5zcWwsIGNvbnZlcnRlZCB0byBoZWFkZXI6
CiNpbmNsdWRlICJ2aWV3cy5oIgoKLy8gdGhpcyBmaWxlIGRlZmluZXMgYSBwdWJsaWMsIHR5
cGVkIGludGVyZmFjZSB0byB0aGUgZGF0YWJhc2UuCi8vIHRoZSBkYXRhYmFzZSBjbGFzcyBl
bmNhcHN1bGF0ZXMgYWxsIGtub3dsZWRnZSBhYm91dCBzcWxpdGUsCi8vIHRoZSBzY2hlbWEs
IGFuZCBhbGwgU1FMIHN0YXRlbWVudHMgdXNlZCB0byBhY2Nlc3MgdGhlIHNjaGVtYS4KLy8K
Ly8gc2VlIGZpbGUgc2NoZW1hLnNxbCBmb3IgdGhlIHRleHQgb2YgdGhlIHNjaGVtYS4KCnVz
aW5nIGJvb3N0OjpzaGFyZWRfcHRyOwp1c2luZyBib29zdDo6bGV4aWNhbF9jYXN0Owp1c2lu
ZyBuYW1lc3BhY2Ugc3RkOwoKaW50IGNvbnN0IG9uZV9yb3cgPSAxOwppbnQgY29uc3Qgb25l
X2NvbCA9IDE7CmludCBjb25zdCBhbnlfcm93cyA9IC0xOwppbnQgY29uc3QgYW55X2NvbHMg
PSAtMTsKCmV4dGVybiAiQyIgewogIC8vIHN0cmFuZ2VseSB0aGlzIGlzbid0IGRlY2xhcmVk
LCBldmVuIHRob3VnaCBpdCdzIHByZXNlbnQgaW4gbXkgc3FsaXRlLgogIGNoYXIgKnNxbGl0
ZV92bXByaW50Zihjb25zdCBjaGFyICp6Rm9ybWF0LCB2YV9saXN0KTsKfQoKZGF0YWJhc2U6
OmRhdGFiYXNlKGZzOjpwYXRoIGNvbnN0ICYgZm4pIDoKICBmaWxlbmFtZShmbiksCiAgLy8g
bmIuIHVwZGF0ZSB0aGlzIGlmIHlvdSBjaGFuZ2UgdGhlIHNjaGVtYS4gdW5mb3J0dW5hdGVs
eSB3ZSBhcmUgbm90CiAgLy8gdXNpbmcgc2VsZi1kaWdlc3Rpbmcgc2NoZW1hcyBkdWUgdG8g
Y29tbWVudCBpcnJlZ3VsYXJpdGllcyBhbmQKICAvLyBub24tYWxwaGFiZXRpYyBvcmRlcmlu
ZyBvZiB0YWJsZXMgaW4gc3FsIHNvdXJjZSBmaWxlcy4gd2UgY291bGQgY3JlYXRlCiAgLy8g
YSB0ZW1wb3JhcnkgZGIsIHdyaXRlIG91ciBpbnRlbmRlZCBzY2hlbWEgaW50byBpdCwgYW5k
IHJlYWQgaXQgYmFjaywKICAvLyBidXQgdGhpcyBzZWVtcyBsaWtlIGl0IHdvdWxkIGJlIHRv
byBydWRlLiBwb3NzaWJseSByZXZpc2l0IHRoaXMgaXNzdWUuCiAgc2NoZW1hKCJjMWU4NjU4
OGUxMWFkMDdmYTUzZTVkMjk0ZWRjMDQzY2UxZDQwMDVhIiksCiAgX19zcWwoTlVMTCksCiAg
dHJhbnNhY3Rpb25fbGV2ZWwoMCkKe30KCnZvaWQgCmRhdGFiYXNlOjpjaGVja19zY2hlbWEo
KQp7CiAgc3RyaW5nIGRiX3NjaGVtYV9pZDsgIAogIGNhbGN1bGF0ZV9zY2hlbWFfaWQgKF9f
c3FsLCBkYl9zY2hlbWFfaWQpOwogIE4gKHNjaGVtYSA9PSBkYl9zY2hlbWFfaWQsCiAgICAg
RigiZGF0YWJhc2Ugc2NoZW1hcyBkbyBub3QgbWF0Y2g6ICIKICAgICAgICJ3YW50ZWQgJXMs
IGdvdCAlcy4gdHJ5IG1pZ3JhdGluZyBkYXRhYmFzZSIpIAogICAgICUgc2NoZW1hICUgZGJf
c2NoZW1hX2lkKTsKfQoKc3RhdGljIHZvaWQgCnNxbGl0ZV91bmJhc2U2NF9mbihzcWxpdGVf
ZnVuYyAqZiwgaW50IG5hcmdzLCBjaGFyIGNvbnN0ICoqIGFyZ3MpCnsKICBpZiAobmFyZ3Mg
IT0gMSkKICAgIHsKICAgICAgc3FsaXRlX3NldF9yZXN1bHRfZXJyb3IoZiwgIm5lZWQgZXhh
Y3RseSAxIGFyZyB0byB1bmJhc2U2NCgpIiwgLTEpOwogICAgICByZXR1cm47CiAgICB9CiAg
ZGF0YSBkZWNvZGVkOwogIGRlY29kZV9iYXNlNjQoYmFzZTY0PGRhdGE+KHN0cmluZyhhcmdz
WzBdKSksIGRlY29kZWQpOwogIHNxbGl0ZV9zZXRfcmVzdWx0X3N0cmluZyhmLCBkZWNvZGVk
KCkuY19zdHIoKSwgZGVjb2RlZCgpLnNpemUoKSk7Cn0KCnZvaWQgCmRhdGFiYXNlOjpzZXRf
YXBwKGFwcF9zdGF0ZSAqIGFwcCkKewogIF9fYXBwID0gYXBwOwp9CgpzdHJ1Y3Qgc3FsaXRl
ICogCmRhdGFiYXNlOjpzcWwoYm9vbCBpbml0KQp7CiAgaWYgKCEgX19zcWwpCiAgICB7CiAg
ICAgIGlmICghIGluaXQpCiAgICAgICAgewogICAgICAgICAgaWYgKGZpbGVuYW1lLnN0cmlu
ZygpID09ICIiKQogICAgICAgICAgICB0aHJvdyBpbmZvcm1hdGl2ZV9mYWlsdXJlKHN0cmlu
Zygibm8gZGF0YWJhc2Ugc3BlY2lmaWVkIikpOwogICAgICAgICAgZWxzZSBpZiAoISBmczo6
ZXhpc3RzKGZpbGVuYW1lKSkKICAgICAgICAgICAgdGhyb3cgaW5mb3JtYXRpdmVfZmFpbHVy
ZShzdHJpbmcoImRhdGFiYXNlICIpICsgZmlsZW5hbWUuc3RyaW5nKCkgKwogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZygiIGRvZXMgbm90IGV4aXN0Iikp
OwogICAgICAgIH0KICAgICAgTihmaWxlbmFtZS5zdHJpbmcoKSAhPSAiIiwKICAgICAgICBG
KCJuZWVkIGRhdGFiYXNlIG5hbWUiKSk7CiAgICAgIGNoYXIgKiBlcnJtc2cgPSBOVUxMOwog
ICAgICBfX3NxbCA9IHNxbGl0ZV9vcGVuKGZpbGVuYW1lLnN0cmluZygpLmNfc3RyKCksIDA3
NTUsICZlcnJtc2cpOwogICAgICBpZiAoISBfX3NxbCkKICAgICAgICB0aHJvdyBvb3BzKHN0
cmluZygiY291bGQgbm90IG9wZW4gZGF0YWJhc2U6ICIpICsgZmlsZW5hbWUuc3RyaW5nKCkg
KyAKICAgICAgICAgICAgICAgICAgIChlcnJtc2cgPyAoIjogIiArIHN0cmluZyhlcnJtc2cp
KSA6ICIiKSk7CiAgICAgIGlmIChpbml0KQogICAgICAgIGV4ZWN1dGUoc2NoZW1hX2NvbnN0
YW50KTsKCiAgICAgIGNoZWNrX3NjaGVtYSgpOwogICAgICBpbnN0YWxsX2Z1bmN0aW9ucyhf
X2FwcCk7CiAgICAgIGluc3RhbGxfdmlld3MoKTsKICAgIH0KICByZXR1cm4gX19zcWw7Cn0K
CnZvaWQgCmRhdGFiYXNlOjppbml0aWFsaXplKCkKewogIGlmIChfX3NxbCkKICAgIHRocm93
IG9vcHMoImNhbm5vdCBpbml0aWFsaXplIGRhdGFiYXNlIHdoaWxlIGl0IGlzIG9wZW4iKTsK
CiAgTighZnM6OmV4aXN0cyhmaWxlbmFtZSksCiAgICBGKCJjb3VsZCBub3QgaW5pdGlhbGl6
ZSBkYXRhYmFzZTogJXM6IGFscmVhZHkgZXhpc3RzIikgCiAgICAlIGZpbGVuYW1lLnN0cmlu
ZygpKTsKCiAgZnM6OnBhdGggam91cm5hbCA9IG1rcGF0aChmaWxlbmFtZS5zdHJpbmcoKSAr
ICItam91cm5hbCIpOwogIE4oIWZzOjpleGlzdHMoam91cm5hbCksCiAgICBGKCJleGlzdGlu
ZyAocG9zc2libHkgc3RhbGUpIGpvdXJuYWwgZmlsZSAnJXMnIGhhcyBzYW1lIHN0ZW0gYXMg
bmV3IGRhdGFiYXNlICclcyciKQogICAgJSBqb3VybmFsLnN0cmluZygpICUgZmlsZW5hbWUu
c3RyaW5nKCkpOwoKICBzcWxpdGUgKnMgPSBzcWwodHJ1ZSk7CiAgSShzICE9IE5VTEwpOwp9
CgoKc3RydWN0IApkdW1wX3JlcXVlc3QKewogIGR1bXBfcmVxdWVzdCgpIHt9OwogIHN0cnVj
dCBzcWxpdGUgKnNxbDsKICBzdHJpbmcgdGFibGVfbmFtZTsKICBvc3RyZWFtICpvdXQ7Cn07
CgpzdGF0aWMgaW50IApkdW1wX3Jvd19jYih2b2lkICpkYXRhLCBpbnQgbiwgY2hhciAqKnZh
bHMsIGNoYXIgKipjb2xzKQp7CiAgZHVtcF9yZXF1ZXN0ICpkdW1wID0gcmVpbnRlcnByZXRf
Y2FzdDxkdW1wX3JlcXVlc3QgKj4oZGF0YSk7CiAgSShkdW1wICE9IE5VTEwpOwogIEkodmFs
cyAhPSBOVUxMKTsKICBJKGR1bXAtPm91dCAhPSBOVUxMKTsKICAqKGR1bXAtPm91dCkgPDwg
RigiSU5TRVJUIElOVE8gJXMgVkFMVUVTKCIpICUgZHVtcC0+dGFibGVfbmFtZTsKICBmb3Ig
KGludCBpID0gMDsgaSA8IG47ICsraSkKICAgIHsKICAgICAgaWYgKGkgIT0gMCkKICAgICAg
ICAqKGR1bXAtPm91dCkgPDwgJywnOwoKICAgICAgaWYgKHZhbHNbaV0gPT0gTlVMTCkKICAg
ICAgICAqKGR1bXAtPm91dCkgPDwgIk5VTEwiOwogICAgICBlbHNlCiAgICAgICAgewogICAg
ICAgICAgKihkdW1wLT5vdXQpIDw8ICInIjsKICAgICAgICAgIGZvciAoY2hhciAqY3AgPSB2
YWxzW2ldOyAqY3A7ICsrY3ApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBpZiAoKmNw
ID09ICdcJycpCiAgICAgICAgICAgICAgICAqKGR1bXAtPm91dCkgPDwgIicnIjsKICAgICAg
ICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAqKGR1bXAtPm91dCkgPDwgKmNwOwogICAg
ICAgICAgICB9CiAgICAgICAgICAqKGR1bXAtPm91dCkgPDwgIiciOwogICAgICAgIH0KICAg
IH0KICAqKGR1bXAtPm91dCkgPDwgIik7XG4iOyAgCiAgcmV0dXJuIDA7Cn0KCnN0YXRpYyBp
bnQgCmR1bXBfdGFibGVfY2Iodm9pZCAqZGF0YSwgaW50IG4sIGNoYXIgKip2YWxzLCBjaGFy
ICoqY29scykKewogIGR1bXBfcmVxdWVzdCAqZHVtcCA9IHJlaW50ZXJwcmV0X2Nhc3Q8ZHVt
cF9yZXF1ZXN0ICo+KGRhdGEpOwogIEkoZHVtcCAhPSBOVUxMKTsKICBJKGR1bXAtPnNxbCAh
PSBOVUxMKTsKICBJKHZhbHMgIT0gTlVMTCk7CiAgSSh2YWxzWzBdICE9IE5VTEwpOwogIEko
dmFsc1sxXSAhPSBOVUxMKTsKICBJKHZhbHNbMl0gIT0gTlVMTCk7CiAgSShuID09IDMpOwog
IGlmIChzdHJpbmcodmFsc1sxXSkgPT0gInRhYmxlIikKICAgIHsKICAgICAgKihkdW1wLT5v
dXQpIDw8IHZhbHNbMl0gPDwgIjtcbiI7CiAgICAgIGR1bXAtPnRhYmxlX25hbWUgPSBzdHJp
bmcodmFsc1swXSk7CiAgICAgIHNxbGl0ZV9leGVjX3ByaW50ZihkdW1wLT5zcWwsICJTRUxF
Q1QgKiBGUk9NICclcSciLCAKICAgICAgICAgICAgICAgICAgICAgICAgIGR1bXBfcm93X2Ni
LCBkYXRhLCBOVUxMLCB2YWxzWzBdKTsKICAgIH0KICByZXR1cm4gMDsKfQoKdm9pZCAKZGF0
YWJhc2U6OmR1bXAob3N0cmVhbSAmIG91dCkKewogIGR1bXBfcmVxdWVzdCByZXE7CiAgcmVx
Lm91dCA9ICZvdXQ7CiAgcmVxLnNxbCA9IHNxbCgpOwogIG91dCA8PCAiQkVHSU4gVFJBTlNB
Q1RJT047XG4iOwogIGludCByZXMgPSBzcWxpdGVfZXhlYyhyZXEuc3FsLAogICAgICAgICAg
ICAgICAgICAgICAgICAiU0VMRUNUIG5hbWUsIHR5cGUsIHNxbCBGUk9NIHNxbGl0ZV9tYXN0
ZXIgIgogICAgICAgICAgICAgICAgICAgICAgICAiV0hFUkUgdHlwZT0ndGFibGUnIEFORCBz
cWwgTk9UIE5VTEwgIgogICAgICAgICAgICAgICAgICAgICAgICAiT1JERVIgQlkgc3Vic3Ry
KHR5cGUsMiwxKSwgbmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGR1bXBfdGFibGVf
Y2IsICZyZXEsIE5VTEwpOwogIEkocmVzID09IFNRTElURV9PSyk7CiAgb3V0IDw8ICJDT01N
SVQ7XG4iOwp9Cgp2b2lkIApkYXRhYmFzZTo6bG9hZChpc3RyZWFtICYgaW4pCnsKICBjaGFy
IGJ1Zltjb25zdGFudHM6OmJ1ZnN6XTsKICBzdHJpbmcgdG1wOwoKICBOKGZpbGVuYW1lLnN0
cmluZygpICE9ICIiLAogICAgRigibmVlZCBkYXRhYmFzZSBuYW1lIikpOwogIGNoYXIgKiBl
cnJtc2cgPSBOVUxMOwogIF9fc3FsID0gc3FsaXRlX29wZW4oZmlsZW5hbWUuc3RyaW5nKCku
Y19zdHIoKSwgMDc1NSwgJmVycm1zZyk7CiAgaWYgKCEgX19zcWwpCiAgICB0aHJvdyBvb3Bz
KHN0cmluZygiY291bGQgbm90IG9wZW4gZGF0YWJhc2U6ICIpICsgZmlsZW5hbWUuc3RyaW5n
KCkgKyAKICAgICAgICAgICAgICAgKGVycm1zZyA/ICgiOiAiICsgc3RyaW5nKGVycm1zZykp
IDogIiIpKTsKICAKICB3aGlsZShpbikKICAgIHsKICAgICAgaW4ucmVhZChidWYsIGNvbnN0
YW50czo6YnVmc3opOwogICAgICB0bXAuYXBwZW5kKGJ1ZiwgaW4uZ2NvdW50KCkpOwogICAg
fQoKICBleGVjdXRlKHRtcC5jX3N0cigpKTsKfQoKCnZvaWQgCmRhdGFiYXNlOjpkZWJ1Zyhz
dHJpbmcgY29uc3QgJiBzcWwsIG9zdHJlYW0gJiBvdXQpCnsKICByZXN1bHRzIHJlczsKICBm
ZXRjaChyZXMsIGFueV9jb2xzLCBhbnlfcm93cywgc3FsLmNfc3RyKCkpOwogIG91dCA8PCAi
JyIgPDwgc3FsIDw8ICInIC0+ICIgPDwgcmVzLnNpemUoKSA8PCAiIHJvd3NcbiIgPDwgZW5k
bDsKICBmb3IgKHNpemVfdCBpID0gMDsgaSA8IHJlcy5zaXplKCk7ICsraSkKICAgIHsKICAg
ICAgZm9yIChzaXplX3QgaiA9IDA7IGogPCByZXNbaV0uc2l6ZSgpOyArK2opCiAgICAgICAg
ewogICAgICAgICAgaWYgKGogIT0gMCkKICAgICAgICAgICAgb3V0IDw8ICIgfCAiOwogICAg
ICAgICAgb3V0IDw8IHJlc1tpXVtqXTsKICAgICAgICB9CiAgICAgIG91dCA8PCBlbmRsOwog
ICAgfQp9Cgp1bnNpZ25lZCBsb25nIApkYXRhYmFzZTo6Z2V0X3N0YXRpc3RpYyhzdHJpbmcg
Y29uc3QgJiBxdWVyeSkKewogIHJlc3VsdHMgcmVzOwogIGZldGNoKHJlcywgMSwgMSwgcXVl
cnkuY19zdHIoKSk7CiAgcmV0dXJuIGxleGljYWxfY2FzdDx1bnNpZ25lZCBsb25nPihyZXNb
MF1bMF0pOwp9Cgp2b2lkIApkYXRhYmFzZTo6aW5mbyhvc3RyZWFtICYgb3V0KQp7CiAgc3Ry
aW5nIGlkOwogIGNhbGN1bGF0ZV9zY2hlbWFfaWQoc3FsKCksIGlkKTsKICBvdXQgPDwgInNj
aGVtYSB2ZXJzaW9uICA6ICIgPDwgaWQgPDwgZW5kbDsKICBvdXQgPDwgImZ1bGwgbWFuaWZl
c3RzICA6ICIgPDwgZ2V0X3N0YXRpc3RpYygiU0VMRUNUIENPVU5UKCopIEZST00gbWFuaWZl
c3RzIikgPDwgZW5kbDsKICBvdXQgPDwgIm1hbmlmZXN0IGRlbHRhcyA6ICIgPDwgZ2V0X3N0
YXRpc3RpYygiU0VMRUNUIENPVU5UKCopIEZST00gbWFuaWZlc3RfZGVsdGFzIikgPDwgZW5k
bDsKICBvdXQgPDwgImZ1bGwgZmlsZXMgICAgICA6ICIgPDwgZ2V0X3N0YXRpc3RpYygiU0VM
RUNUIENPVU5UKCopIEZST00gZmlsZXMiKSA8PCBlbmRsOwogIG91dCA8PCAiZmlsZSBkZWx0
YXMgICAgIDogIiA8PCBnZXRfc3RhdGlzdGljKCJTRUxFQ1QgQ09VTlQoKikgRlJPTSBmaWxl
X2RlbHRhcyIpIDw8IGVuZGw7Cn0KCnZvaWQgCmRhdGFiYXNlOjp2ZXJzaW9uKG9zdHJlYW0g
JiBvdXQpCnsKICBzdHJpbmcgaWQ7CiAgY2FsY3VsYXRlX3NjaGVtYV9pZChzcWwoKSwgaWQp
OwogIG91dCA8PCAiZGF0YWJhc2Ugc2NoZW1hIHZlcnNpb246ICIgPDwgaWQgPDwgZW5kbDsK
fQoKdm9pZCAKZGF0YWJhc2U6Om1pZ3JhdGUoKQp7ICAKICBOKGZpbGVuYW1lLnN0cmluZygp
ICE9ICIiLAogICAgRigibmVlZCBkYXRhYmFzZSBuYW1lIikpOwogIGNoYXIgKiBlcnJtc2cg
PSBOVUxMOwogIF9fc3FsID0gc3FsaXRlX29wZW4oZmlsZW5hbWUuc3RyaW5nKCkuY19zdHIo
KSwgMDc1NSwgJmVycm1zZyk7CiAgaWYgKCEgX19zcWwpCiAgICB0aHJvdyBvb3BzKHN0cmlu
ZygiY291bGQgbm90IG9wZW4gZGF0YWJhc2U6ICIpICsgZmlsZW5hbWUuc3RyaW5nKCkgKyAK
ICAgICAgICAgICAgICAgKGVycm1zZyA/ICgiOiAiICsgc3RyaW5nKGVycm1zZykpIDogIiIp
KTsKICBtaWdyYXRlX21vbm90b25lX3NjaGVtYShfX3NxbCk7CiAgc3FsaXRlX2Nsb3NlKF9f
c3FsKTsKfQoKdm9pZCAKZGF0YWJhc2U6OnJlaGFzaCgpCnsKICB0cmFuc2FjdGlvbl9ndWFy
ZCBndWFyZCgqdGhpcyk7CiAgdGlja2VyIG1jZXJ0cygibWNlcnRzIiwgIm0iLCAxKTsKICB0
aWNrZXIgZmNlcnRzKCJmY2VydHMiLCAiZiIsIDEpOwogIHRpY2tlciBwdWJrZXlzKCJwdWJr
ZXlzIiwgIisiLCAxKTsKICB0aWNrZXIgcHJpdmtleXMoInByaXZrZXlzIiwgIiEiLCAxKTsK
ICAKICB7CiAgICAvLyByZWhhc2ggYWxsIG1jZXJ0cwogICAgcmVzdWx0cyByZXM7CiAgICB2
ZWN0b3I8Y2VydD4gY2VydHM7CiAgICBmZXRjaChyZXMsIDUsIGFueV9yb3dzLCAKICAgICAg
ICAgICJTRUxFQ1QgaWQsIG5hbWUsIHZhbHVlLCBrZXlwYWlyLCBzaWduYXR1cmUgIgogICAg
ICAgICAgIkZST00gbWFuaWZlc3RfY2VydHMiKTsKICAgIHJlc3VsdHNfdG9fY2VydHMocmVz
LCBjZXJ0cyk7CiAgICBleGVjdXRlKCJERUxFVEUgRlJPTSBtYW5pZmVzdF9jZXJ0cyIpOwog
ICAgZm9yKHZlY3RvcjxjZXJ0Pjo6Y29uc3RfaXRlcmF0b3IgaSA9IGNlcnRzLmJlZ2luKCk7
IGkgIT0gY2VydHMuZW5kKCk7ICsraSkKICAgICAgewogICAgICAgIHB1dF9jZXJ0KCppLCAi
bWFuaWZlc3RfY2VydHMiKTsKICAgICAgICArK21jZXJ0czsKICAgICAgfQogIH0KCiAgewog
ICAgLy8gcmVoYXNoIGFsbCBmY2VydHMKICAgIHJlc3VsdHMgcmVzOwogICAgdmVjdG9yPGNl
cnQ+IGNlcnRzOyAgICAKICAgIGZldGNoKHJlcywgNSwgYW55X3Jvd3MsIAogICAgICAgICAg
IlNFTEVDVCBpZCwgbmFtZSwgdmFsdWUsIGtleXBhaXIsIHNpZ25hdHVyZSAiCiAgICAgICAg
ICAiRlJPTSBmaWxlX2NlcnRzIik7CiAgICByZXN1bHRzX3RvX2NlcnRzKHJlcywgY2VydHMp
OwogICAgZXhlY3V0ZSgiREVMRVRFIEZST00gZmlsZV9jZXJ0cyIpOwogICAgZm9yKHZlY3Rv
cjxjZXJ0Pjo6Y29uc3RfaXRlcmF0b3IgaSA9IGNlcnRzLmJlZ2luKCk7IGkgIT0gY2VydHMu
ZW5kKCk7ICsraSkKICAgICAgewogICAgICAgIHB1dF9jZXJ0KCppLCAiZmlsZV9jZXJ0cyIp
OwogICAgICAgICsrZmNlcnRzOwogICAgICB9CiAgfQogIAoKICB7CiAgICAvLyByZWhhc2gg
YWxsIHB1YmtleXMKICAgIHJlc3VsdHMgcmVzOwogICAgZmV0Y2gocmVzLCAyLCBhbnlfcm93
cywgIlNFTEVDVCBpZCwga2V5ZGF0YSBGUk9NIHB1YmxpY19rZXlzIik7CiAgICBleGVjdXRl
KCJERUxFVEUgRlJPTSBwdWJsaWNfa2V5cyIpOwogICAgZm9yIChzaXplX3QgaSA9IDA7IGkg
PCByZXMuc2l6ZSgpOyArK2kpCiAgICAgIHsKICAgICAgICBoZXhlbmM8aWQ+IHRtcDsKICAg
ICAgICBrZXlfaGFzaF9jb2RlKHJzYV9rZXlwYWlyX2lkKHJlc1tpXVswXSksIGJhc2U2NDxy
c2FfcHViX2tleT4ocmVzW2ldWzFdKSwgdG1wKTsKICAgICAgICBleGVjdXRlKCJJTlNFUlQg
SU5UTyBwdWJsaWNfa2V5cyBWQUxVRVMoJyVxJywgJyVxJywgJyVxJykiLCAKICAgICAgICAg
ICAgICAgIHRtcCgpLmNfc3RyKCksIHJlc1tpXVswXS5jX3N0cigpLCByZXNbaV1bMV0uY19z
dHIoKSk7CiAgICAgICAgKytwdWJrZXlzOwogICAgICB9CiAgfQoKewogICAgLy8gcmVoYXNo
IGFsbCBwcml2a2V5cwogICAgcmVzdWx0cyByZXM7CiAgICBmZXRjaChyZXMsIDIsIGFueV9y
b3dzLCAiU0VMRUNUIGlkLCBrZXlkYXRhIEZST00gcHJpdmF0ZV9rZXlzIik7CiAgICBleGVj
dXRlKCJERUxFVEUgRlJPTSBwcml2YXRlX2tleXMiKTsKICAgIGZvciAoc2l6ZV90IGkgPSAw
OyBpIDwgcmVzLnNpemUoKTsgKytpKQogICAgICB7CiAgICAgICAgaGV4ZW5jPGlkPiB0bXA7
CiAgICAgICAga2V5X2hhc2hfY29kZShyc2Ffa2V5cGFpcl9pZChyZXNbaV1bMF0pLCBiYXNl
NjQ8IGFyYzQ8cnNhX3ByaXZfa2V5PiA+KHJlc1tpXVsxXSksIHRtcCk7CiAgICAgICAgZXhl
Y3V0ZSgiSU5TRVJUIElOVE8gcHJpdmF0ZV9rZXlzIFZBTFVFUygnJXEnLCAnJXEnLCAnJXEn
KSIsIAogICAgICAgICAgICAgICAgdG1wKCkuY19zdHIoKSwgcmVzW2ldWzBdLmNfc3RyKCks
IHJlc1tpXVsxXS5jX3N0cigpKTsKICAgICAgICArK3ByaXZrZXlzOwogICAgICB9CiAgfQoK
ICBndWFyZC5jb21taXQoKTsKfQoKdm9pZCAKZGF0YWJhc2U6OmVuc3VyZV9vcGVuKCkKewog
IHNxbGl0ZSAqcyA9IHNxbCgpOwogIEkocyAhPSBOVUxMKTsKfQoKZGF0YWJhc2U6On5kYXRh
YmFzZSgpIAp7CiAgaWYgKF9fc3FsKQogICAgewogICAgICBzcWxpdGVfY2xvc2UoX19zcWwp
OwogICAgICBfX3NxbCA9IDA7CiAgICB9Cn0KCnN0YXRpYyB2b2lkIAphc3NlcnRfc3FsaXRl
X29rKGludCByZXMpCnsKICBzd2l0Y2ggKHJlcykKICAgIHsgICAgICAKICAgIGNhc2UgU1FM
SVRFX09LOiAKICAgICAgYnJlYWs7CgogICAgY2FzZSBTUUxJVEVfRVJST1I6CiAgICAgIHRo
cm93IG9vcHMoIlNRTCBlcnJvciBvciBtaXNzaW5nIGRhdGFiYXNlIik7CiAgICAgIGJyZWFr
OwoKICAgIGNhc2UgU1FMSVRFX0lOVEVSTkFMOgogICAgICB0aHJvdyBvb3BzKCJBbiBpbnRl
cm5hbCBsb2dpYyBlcnJvciBpbiBTUUxpdGUiKTsKICAgICAgYnJlYWs7CgogICAgY2FzZSBT
UUxJVEVfUEVSTToKICAgICAgdGhyb3cgb29wcygiQWNjZXNzIHBlcm1pc3Npb24gZGVuaWVk
Iik7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgU1FMSVRFX0FCT1JUOgogICAgICB0aHJvdyBv
b3BzKCJDYWxsYmFjayByb3V0aW5lIHJlcXVlc3RlZCBhbiBhYm9ydCIpOwogICAgICBicmVh
azsKCiAgICBjYXNlIFNRTElURV9CVVNZOgogICAgICB0aHJvdyBvb3BzKCJUaGUgZGF0YWJh
c2UgZmlsZSBpcyBsb2NrZWQiKTsKICAgICAgYnJlYWs7CgogICAgY2FzZSBTUUxJVEVfTE9D
S0VEOgogICAgICB0aHJvdyBvb3BzKCJBIHRhYmxlIGluIHRoZSBkYXRhYmFzZSBpcyBsb2Nr
ZWQiKTsKICAgICAgYnJlYWs7CgogICAgY2FzZSBTUUxJVEVfTk9NRU06CiAgICAgIHRocm93
IG9vcHMoIkEgbWFsbG9jKCkgZmFpbGVkIik7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgU1FM
SVRFX1JFQURPTkxZOgogICAgICB0aHJvdyBvb3BzKCJBdHRlbXB0IHRvIHdyaXRlIGEgcmVh
ZG9ubHkgZGF0YWJhc2UiKTsKICAgICAgYnJlYWs7CgogICAgY2FzZSBTUUxJVEVfSU5URVJS
VVBUOgogICAgICB0aHJvdyBvb3BzKCJPcGVyYXRpb24gdGVybWluYXRlZCBieSBzcWxpdGVf
aW50ZXJydXB0KCkiKTsKICAgICAgYnJlYWs7CgogICAgY2FzZSBTUUxJVEVfSU9FUlI6CiAg
ICAgIHRocm93IG9vcHMoIlNvbWUga2luZCBvZiBkaXNrIEkvTyBlcnJvciBvY2N1cnJlZCIp
OwogICAgICBicmVhazsKCiAgICBjYXNlIFNRTElURV9DT1JSVVBUOgogICAgICB0aHJvdyBv
b3BzKCJUaGUgZGF0YWJhc2UgZGlzayBpbWFnZSBpcyBtYWxmb3JtZWQiKTsKICAgICAgYnJl
YWs7CgogICAgY2FzZSBTUUxJVEVfTk9URk9VTkQ6CiAgICAgIHRocm93IG9vcHMoIihJbnRl
cm5hbCBPbmx5KSBUYWJsZSBvciByZWNvcmQgbm90IGZvdW5kIik7CiAgICAgIGJyZWFrOwoK
ICAgIGNhc2UgU1FMSVRFX0ZVTEw6CiAgICAgIHRocm93IG9vcHMoIkluc2VydGlvbiBmYWls
ZWQgYmVjYXVzZSBkYXRhYmFzZSBpcyBmdWxsIik7CiAgICAgIGJyZWFrOwoKICAgIGNhc2Ug
U1FMSVRFX0NBTlRPUEVOOgogICAgICB0aHJvdyBvb3BzKCJVbmFibGUgdG8gb3BlbiB0aGUg
ZGF0YWJhc2UgZmlsZSIpOwogICAgICBicmVhazsKCiAgICBjYXNlIFNRTElURV9QUk9UT0NP
TDoKICAgICAgdGhyb3cgb29wcygiZGF0YWJhc2UgbG9jayBwcm90b2NvbCBlcnJvciIpOwog
ICAgICBicmVhazsKCiAgICBjYXNlIFNRTElURV9FTVBUWToKICAgICAgdGhyb3cgb29wcygi
KEludGVybmFsIE9ubHkpIGRhdGFiYXNlIHRhYmxlIGlzIGVtcHR5Iik7CiAgICAgIGJyZWFr
OwoKICAgIGNhc2UgU1FMSVRFX1NDSEVNQToKICAgICAgdGhyb3cgb29wcygiVGhlIGRhdGFi
YXNlIHNjaGVtYSBjaGFuZ2VkIik7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgU1FMSVRFX1RP
T0JJRzoKICAgICAgdGhyb3cgb29wcygiVG9vIG11Y2ggZGF0YSBmb3Igb25lIHJvdyBvZiBh
IHRhYmxlIik7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgU1FMSVRFX0NPTlNUUkFJTlQ6CiAg
ICAgIHRocm93IG9vcHMoIkFib3J0IGR1ZSB0byBjb250cmFpbnQgdmlvbGF0aW9uIik7CiAg
ICAgIGJyZWFrOwoKICAgIGNhc2UgU1FMSVRFX01JU01BVENIOgogICAgICB0aHJvdyBvb3Bz
KCJEYXRhIHR5cGUgbWlzbWF0Y2giKTsKICAgICAgYnJlYWs7CgogICAgY2FzZSBTUUxJVEVf
TUlTVVNFOgogICAgICB0aHJvdyBvb3BzKCJMaWJyYXJ5IHVzZWQgaW5jb3JyZWN0bHkiKTsK
ICAgICAgYnJlYWs7CgogICAgZGVmYXVsdDoKICAgICAgdGhyb3cgb29wcyhzdHJpbmcoIlVu
a25vd24gREIgcmVzdWx0IGNvZGU6ICIpICsgbGV4aWNhbF9jYXN0PHN0cmluZz4ocmVzKSk7
CiAgICAgIGJyZWFrOwogICAgfQp9Cgp2b2lkIApkYXRhYmFzZTo6ZXhlY3V0ZShjaGFyIGNv
bnN0ICogcXVlcnksIC4uLikKewogIHZhX2xpc3QgYXA7CiAgaW50IHJlczsKICBjaGFyICog
ZXJybXNnID0gTlVMTDsKCiAgdmFfc3RhcnQoYXAsIHF1ZXJ5KTsKCiAgLy8gbG9nIGl0CiAg
Y2hhciAqIGZvcm1hdHRlZCA9IHNxbGl0ZV92bXByaW50ZihxdWVyeSwgYXApOwogIHN0cmlu
ZyBxcShmb3JtYXR0ZWQpOwogIGlmIChxcS5zaXplKCkgPiBjb25zdGFudHM6OmRiX2xvZ19s
aW5lX3N6KSAKICAgIHFxID0gcXEuc3Vic3RyKDAsIGNvbnN0YW50czo6ZGJfbG9nX2xpbmVf
c3opICsgc3RyaW5nKCIgLi4uIik7CiAgTChGKCJkYi5leGVjdXRlKFwiJXNcIilcbiIpICUg
cXEpOwogIHNxbGl0ZV9mcmVlbWVtKGZvcm1hdHRlZCk7CgogIHZhX2VuZChhcCk7CiAgdmFf
c3RhcnQoYXAsIHF1ZXJ5KTsKCiAgLy8gZG8gaXQKICByZXMgPSBzcWxpdGVfZXhlY192cHJp
bnRmKHNxbCgpLCBxdWVyeSwgTlVMTCwgTlVMTCwgJmVycm1zZywgYXApOwoKICB2YV9lbmQo
YXApOwoKICBpZiAoZXJybXNnKQogICAgdGhyb3cgb29wcyhzdHJpbmcoInNxbGl0ZSBleGVj
IGVycm9yICIpICsgZXJybXNnKTsKCiAgYXNzZXJ0X3NxbGl0ZV9vayhyZXMpOwoKfQoKdm9p
ZCAKZGF0YWJhc2U6OmZldGNoKHJlc3VsdHMgJiByZXMsIAogICAgICAgICAgICAgICAgaW50
IGNvbnN0IHdhbnRfY29scywgCiAgICAgICAgICAgICAgICBpbnQgY29uc3Qgd2FudF9yb3dz
LCAKICAgICAgICAgICAgICAgIGNoYXIgY29uc3QgKiBxdWVyeSwgLi4uKQp7CiAgY2hhciAq
KiByZXN1bHQgPSBOVUxMOwogIGludCBucm93OwogIGludCBuY29sOwogIGNoYXIgKiBlcnJt
c2cgPSBOVUxMOwogIGludCByZXNjb2RlOwoKICB2YV9saXN0IGFwOwogIHJlcy5jbGVhcigp
OwogIHJlcy5yZXNpemUoMCk7CiAgdmFfc3RhcnQoYXAsIHF1ZXJ5KTsKCiAgLy8gbG9nIGl0
CiAgY2hhciAqIGZvcm1hdHRlZCA9IHNxbGl0ZV92bXByaW50ZihxdWVyeSwgYXApOwogIHN0
cmluZyBxcShmb3JtYXR0ZWQpOwogIGlmIChxcS5zaXplKCkgPiBjb25zdGFudHM6OmxvZ19s
aW5lX3N6KSAKICAgIHFxID0gcXEuc3Vic3RyKDAsIGNvbnN0YW50czo6bG9nX2xpbmVfc3op
ICsgc3RyaW5nKCIgLi4uIik7CiAgTChGKCJkYi5mZXRjaChcIiVzXCIpXG4iKSAlIHFxKTsK
ICBzcWxpdGVfZnJlZW1lbShmb3JtYXR0ZWQpOwoKICB2YV9lbmQoYXApOwogIHZhX3N0YXJ0
KGFwLCBxdWVyeSk7CgogIC8vIGRvIGl0CiAgcmVzY29kZSA9IHNxbGl0ZV9nZXRfdGFibGVf
dnByaW50ZihzcWwoKSwgcXVlcnksICZyZXN1bHQsICZucm93LCAmbmNvbCwgJmVycm1zZywg
YXApOwoKICB2YV9lbmQoYXApOwoKICBjbGVhbnVwX3B0cjxjaGFyICoqLCB2b2lkPiAKICAg
IHJlc3VsdF9ndWFyZChyZXN1bHQsICZzcWxpdGVfZnJlZV90YWJsZSk7CgogIHN0cmluZyBj
dHggPSBzdHJpbmcoImRiIHF1ZXJ5IFsiKSArIHN0cmluZyhxdWVyeSkgKyAiXTogIjsKCiAg
aWYgKGVycm1zZykKICAgIHRocm93IG9vcHMoY3R4ICsgc3RyaW5nKCJzcWxpdGUgZXJyb3Ig
IikgKyBlcnJtc2cpOwogIGFzc2VydF9zcWxpdGVfb2socmVzY29kZSk7CgogIGlmICh3YW50
X2NvbHMgPT0gMCAmJiBuY29sID09IDApIHJldHVybjsKICBpZiAod2FudF9yb3dzID09IDAg
JiYgbnJvdyA9PSAwKSByZXR1cm47CiAgaWYgKHdhbnRfY29scyA9PSBhbnlfcm93cyAmJiBu
Y29sID09IDApIHJldHVybjsKICBpZiAod2FudF9yb3dzID09IGFueV9yb3dzICYmIG5yb3cg
PT0gMCkgcmV0dXJuOwoKICBpZiAod2FudF9jb2xzICE9IGFueV9jb2xzICYmCiAgICAgIG5j
b2wgIT0gd2FudF9jb2xzKQogICAgdGhyb3cgb29wcygoRigiJXMgd2FudGVkICVkIGNvbHVt
bnMsIGdvdCAlcyIpCiAgICAgICAgICAgICAgICAlIGN0eCAlIHdhbnRfY29scyAlIG5jb2wp
LnN0cigpKTsKCiAgaWYgKHdhbnRfcm93cyAhPSBhbnlfcm93cyAmJgogICAgICBucm93ICE9
IHdhbnRfcm93cykKICAgIHRocm93IG9vcHMoKEYoIiVzIHdhbnRlZCAlZCByb3dzLCBnb3Qg
JXMiKQogICAgICAgICAgICAgICAgJSBjdHggJSB3YW50X3Jvd3MgJSBucm93KS5zdHIoKSk7
CgogIGlmICghcmVzdWx0KQogICAgdGhyb3cgb29wcyhjdHggKyAibnVsbCByZXN1bHQgc2V0
Iik7CgogIGZvciAoaW50IGkgPSAwOyBpIDwgbmNvbDsgKytpKSAKICAgIGlmICghcmVzdWx0
W2ldKQogICAgICB0aHJvdyBvb3BzKGN0eCArICJudWxsIGNvbHVtbiBuYW1lIik7CgogIGZv
ciAoaW50IHJvdyA9IDA7IHJvdyA8IG5yb3c7ICsrcm93KSAKICAgIHsKICAgICAgdmVjdG9y
PHN0cmluZz4gcm93dmVjOwogICAgICBmb3IgKGludCBjb2wgPSAwOyBjb2wgPCBuY29sOyAr
K2NvbCkKICAgICAgICB7CiAgICAgICAgICBpbnQgaSA9ICgoMSArIHJvdykgKiBuY29sKSAr
IGNvbDsKICAgICAgICAgIGlmICghcmVzdWx0W2ldKQogICAgICAgICAgICB0aHJvdyBvb3Bz
KGN0eCArICJudWxsIHJlc3VsdCB2YWx1ZSIpOwogICAgICAgICAgZWxzZQogICAgICAgICAg
ICByb3d2ZWMucHVzaF9iYWNrKHJlc3VsdFtpXSk7CiAgICAgICAgfQogICAgICByZXMucHVz
aF9iYWNrKHJvd3ZlYyk7CiAgICB9Cn0KCi8vIGdlbmVyYWwgYXBwbGljYXRpb24tbGV2ZWwg
bG9naWMKCnZvaWQgCmRhdGFiYXNlOjpzZXRfZmlsZW5hbWUoZnM6OnBhdGggY29uc3QgJiBm
aWxlKQp7CiAgaWYgKF9fc3FsKQogICAgewogICAgICB0aHJvdyBvb3BzKCJjYW5ub3QgY2hh
bmdlIGZpbGVuYW1lIHRvICIgKyBmaWxlLnN0cmluZygpICsgIiB3aGlsZSBkYiBpcyBvcGVu
Iik7CiAgICB9CiAgZmlsZW5hbWUgPSBmaWxlOwp9Cgp2b2lkIApkYXRhYmFzZTo6YmVnaW5f
dHJhbnNhY3Rpb24oKSAKewogIGlmICh0cmFuc2FjdGlvbl9sZXZlbCA9PSAwKQogICAgICBl
eGVjdXRlKCJCRUdJTiIpOwogIHRyYW5zYWN0aW9uX2xldmVsKys7Cn0KCnZvaWQgCmRhdGFi
YXNlOjpjb21taXRfdHJhbnNhY3Rpb24oKQp7CiAgaWYgKHRyYW5zYWN0aW9uX2xldmVsID09
IDEpCiAgICBleGVjdXRlKCJDT01NSVQiKTsKICB0cmFuc2FjdGlvbl9sZXZlbC0tOwp9Cgp2
b2lkIApkYXRhYmFzZTo6cm9sbGJhY2tfdHJhbnNhY3Rpb24oKQp7CiAgaWYgKHRyYW5zYWN0
aW9uX2xldmVsID09IDEpCiAgICBleGVjdXRlKCJST0xMQkFDSyIpOwogIHRyYW5zYWN0aW9u
X2xldmVsLS07Cn0KCgpib29sIApkYXRhYmFzZTo6ZXhpc3RzKGhleGVuYzxpZD4gY29uc3Qg
JiBpZGVudCwKICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBjb25zdCAmIHRhYmxlKQp7
CiAgcmVzdWx0cyByZXM7CiAgZmV0Y2gocmVzLCBvbmVfY29sLCBhbnlfcm93cywgCiAgICAg
ICAgIlNFTEVDVCBpZCBGUk9NICclcScgV0hFUkUgaWQgPSAnJXEnIiwKICAgICAgICB0YWJs
ZS5jX3N0cigpLCBpZGVudCgpLmNfc3RyKCkpOwogIEkoKHJlcy5zaXplKCkgPT0gMSkgfHwg
KHJlcy5zaXplKCkgPT0gMCkpOwogIHJldHVybiByZXMuc2l6ZSgpID09IDE7Cn0KCgpib29s
IApkYXRhYmFzZTo6ZGVsdGFfZXhpc3RzKGhleGVuYzxpZD4gY29uc3QgJiBpZGVudCwKICAg
ICAgICAgICAgICAgICAgICAgICBzdHJpbmcgY29uc3QgJiB0YWJsZSkKewogIHJlc3VsdHMg
cmVzOwogIGZldGNoKHJlcywgb25lX2NvbCwgYW55X3Jvd3MsIAogICAgICAgICJTRUxFQ1Qg
aWQgRlJPTSAnJXEnIFdIRVJFIGlkID0gJyVxJyIsCiAgICAgICAgdGFibGUuY19zdHIoKSwg
aWRlbnQoKS5jX3N0cigpKTsKICByZXR1cm4gcmVzLnNpemUoKSA+IDA7Cn0KCmJvb2wgCmRh
dGFiYXNlOjpkZWx0YV9leGlzdHMoaGV4ZW5jPGlkPiBjb25zdCAmIGlkZW50LAogICAgICAg
ICAgICAgICAgICAgICAgIGhleGVuYzxpZD4gY29uc3QgJiBiYXNlLAogICAgICAgICAgICAg
ICAgICAgICAgIHN0cmluZyBjb25zdCAmIHRhYmxlKQp7CiAgcmVzdWx0cyByZXM7CiAgZmV0
Y2gocmVzLCBvbmVfY29sLCBhbnlfcm93cywgCiAgICAgICAgIlNFTEVDVCBpZCBGUk9NICcl
cScgV0hFUkUgaWQgPSAnJXEnIEFORCBiYXNlID0gJyVxJyIsCiAgICAgICAgdGFibGUuY19z
dHIoKSwgaWRlbnQoKS5jX3N0cigpLCBiYXNlKCkuY19zdHIoKSk7CiAgSSgocmVzLnNpemUo
KSA9PSAxKSB8fCAocmVzLnNpemUoKSA9PSAwKSk7CiAgcmV0dXJuIHJlcy5zaXplKCkgPT0g
MTsKfQoKaW50IApkYXRhYmFzZTo6Y291bnQoc3RyaW5nIGNvbnN0ICYgdGFibGUpCnsKICBy
ZXN1bHRzIHJlczsKICBmZXRjaChyZXMsIG9uZV9jb2wsIG9uZV9yb3csIAogICAgICAgICJT
RUxFQ1QgQ09VTlQoKikgRlJPTSAnJXEnIiwgCiAgICAgICAgdGFibGUuY19zdHIoKSk7CiAg
cmV0dXJuIGxleGljYWxfY2FzdDxpbnQ+KHJlc1swXVswXSk7ICAKfQoKdm9pZCAKZGF0YWJh
c2U6OmdldChoZXhlbmM8aWQ+IGNvbnN0ICYgaWRlbnQsCiAgICAgICAgICAgICAgYmFzZTY0
PCBnemlwPGRhdGE+ID4gJiBkYXQsCiAgICAgICAgICAgICAgc3RyaW5nIGNvbnN0ICYgdGFi
bGUpCnsKICByZXN1bHRzIHJlczsKICBmZXRjaChyZXMsIG9uZV9jb2wsIG9uZV9yb3csCiAg
ICAgICAgIlNFTEVDVCBkYXRhIEZST00gJyVxJyBXSEVSRSBpZCA9ICclcSciLCAKICAgICAg
ICB0YWJsZS5jX3N0cigpLCBpZGVudCgpLmNfc3RyKCkpOwoKICAvLyBjb25zaXN0ZW5jeSBj
aGVjawogIGJhc2U2NDxnemlwPGRhdGE+ID4gcmRhdGEocmVzWzBdWzBdKTsKICBoZXhlbmM8
aWQ+IHRpZDsKICBjYWxjdWxhdGVfaWRlbnQocmRhdGEsIHRpZCk7CiAgSSh0aWQgPT0gaWRl
bnQpOwoKICBkYXQgPSByZGF0YTsKfQoKdm9pZCAKZGF0YWJhc2U6OmdldF9kZWx0YShoZXhl
bmM8aWQ+IGNvbnN0ICYgaWRlbnQsCiAgICAgICAgICAgICAgICAgICAgaGV4ZW5jPGlkPiBj
b25zdCAmIGJhc2UsCiAgICAgICAgICAgICAgICAgICAgYmFzZTY0PCBnemlwPGRlbHRhPiA+
ICYgZGVsLAogICAgICAgICAgICAgICAgICAgIHN0cmluZyBjb25zdCAmIHRhYmxlKQp7CiAg
SShpZGVudCgpICE9ICIiKTsKICBJKGJhc2UoKSAhPSAiIik7CiAgcmVzdWx0cyByZXM7CiAg
ZmV0Y2gocmVzLCBvbmVfY29sLCBvbmVfcm93LAogICAgICAgICJTRUxFQ1QgZGVsdGEgRlJP
TSAnJXEnIFdIRVJFIGlkID0gJyVxJyBBTkQgYmFzZSA9ICclcSciLCAKICAgICAgICB0YWJs
ZS5jX3N0cigpLCBpZGVudCgpLmNfc3RyKCksIGJhc2UoKS5jX3N0cigpKTsKICBkZWwgPSBy
ZXNbMF1bMF07Cn0KCnZvaWQgCmRhdGFiYXNlOjpwdXQoaGV4ZW5jPGlkPiBjb25zdCAmIGlk
ZW50LAogICAgICAgICAgICAgIGJhc2U2NDwgZ3ppcDxkYXRhPiA+IGNvbnN0ICYgZGF0LAog
ICAgICAgICAgICAgIHN0cmluZyBjb25zdCAmIHRhYmxlKQp7CiAgLy8gY29uc2lzdGVuY3kg
Y2hlY2sKICBJKGlkZW50KCkgIT0gIiIpOwogIGhleGVuYzxpZD4gdGlkOwogIGNhbGN1bGF0
ZV9pZGVudChkYXQsIHRpZCk7CiAgSSh0aWQgPT0gaWRlbnQpOwogIAogIGV4ZWN1dGUoIklO
U0VSVCBJTlRPICclcScgVkFMVUVTKCclcScsICclcScpIiwgCiAgICAgICAgICB0YWJsZS5j
X3N0cigpLCBpZGVudCgpLmNfc3RyKCksIGRhdCgpLmNfc3RyKCkpOwp9CgoKdm9pZCAKZGF0
YWJhc2U6OnB1dF9kZWx0YShoZXhlbmM8aWQ+IGNvbnN0ICYgaWRlbnQsCiAgICAgICAgICAg
ICAgICAgICAgaGV4ZW5jPGlkPiBjb25zdCAmIGJhc2UsCiAgICAgICAgICAgICAgICAgICAg
YmFzZTY0PGd6aXA8ZGVsdGE+ID4gY29uc3QgJiBkZWwsCiAgICAgICAgICAgICAgICAgICAg
c3RyaW5nIGNvbnN0ICYgdGFibGUpCnsKICAvLyBuYjogZGVsdGEgc2NoZW1hIGlzIChpZCwg
YmFzZSwgZGVsdGEpCiAgSShpZGVudCgpICE9ICIiKTsKICBJKGJhc2UoKSAhPSAiIik7CiAg
ZXhlY3V0ZSgiSU5TRVJUIElOVE8gJyVxJyBWQUxVRVMoJyVxJywgJyVxJywgJyVxJykiLCAK
ICAgICAgICAgIHRhYmxlLmNfc3RyKCksIAogICAgICAgICAgaWRlbnQoKS5jX3N0cigpLCBi
YXNlKCkuY19zdHIoKSwgZGVsKCkuY19zdHIoKSk7Cn0KCnZvaWQgCmRhdGFiYXNlOjpnZXRf
dmVyc2lvbihoZXhlbmM8aWQ+IGNvbnN0ICYgaWRlbnQsCiAgICAgICAgICAgICAgICAgICAg
ICBiYXNlNjQ8IGd6aXA8ZGF0YT4gPiAmIGRhdCwKICAgICAgICAgICAgICAgICAgICAgIHN0
cmluZyBjb25zdCAmIGRhdGFfdGFibGUsCiAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcg
Y29uc3QgJiBkZWx0YV90YWJsZSkKewogIEkoaWRlbnQoKSAhPSAiIik7CiAgaWYgKGV4aXN0
cyhpZGVudCwgZGF0YV90YWJsZSkpCiAgICB7CiAgICAgIC8vIGVhc3kgcGF0aAogICAgICBn
ZXQoaWRlbnQsIGRhdCwgZGF0YV90YWJsZSk7CiAgICB9CiAgZWxzZQogICAgewogICAgICAv
LyB0cmlja3kgcGF0aAoKICAgICAgLy8gd2Ugc3RhcnQgZnJvbSB0aGUgZmlsZSB3ZSB3YW50
IHRvIHJlY29uc3RydWN0IGFuZCB3b3JrICpmb3J3YXJkcyoKICAgICAgLy8gdGhyb3VnaCB0
aGUgZGF0YWJhc2UsIHVudGlsIHdlIGdldCB0byBhIGZ1bGwgZGF0YSBvYmplY3QuIHdlIHRo
ZW4KICAgICAgLy8gdHJhY2UgYmFjayB0aHJvdWdoIHRoZSBsaXN0IG9mIGVkZ2VzIHdlIGZv
bGxvd2VkIHRvIGdldCB0byB0aGUgZGF0YQogICAgICAvLyBvYmplY3QsIGFwcGx5aW5nIHJl
dmVyc2UgZGVsdGFzLgogICAgICAvLwogICAgICAvLyB0aGUgZWZmZWN0IG9mIHRoaXMgYWxn
b3JpdGhtIGlzIGJyZWFkdGgtZmlyc3Qgc2VhcmNoLCBiYWNrd2FyZHMKICAgICAgLy8gdGhy
b3VnaCB0aGUgc3RvcmFnZSBncmFwaCwgdG8gZGlzY292ZXIgYSBmb3J3YXJkcyBzaG9ydGVz
dCBwYXRoLCBhbmQKICAgICAgLy8gdGhlbiBmb2xsb3dpbmcgdGhhdCBzaG9ydGVzdCBwYXRo
IHdpdGggZGVsdGEgYXBwbGljYXRpb24uCiAgICAgIC8vCiAgICAgIC8vIHdlIHVzZWQgdG8g
ZG8gdGhpcyB3aXRoIHRoZSBib29zdCBncmFwaCBsaWJyYXJ5LCBidXQgaXQgaW52b3ZsZWQK
ICAgICAgLy8gbG9hZGluZyB0b28gbXVjaCBvZiB0aGUgc3RvcmFnZSBncmFwaCBpbnRvIG1l
bW9yeSBhdCBhbnkgbW9tZW50LiB0aGlzCiAgICAgIC8vIGltcGVyYXRpdmUgdmVyc2lvbiBv
bmx5IGxvYWRzIHRoZSBkZXNjZW5kZW50cyBvZiB0aGUgcmVjb25zdHJ1Y3Rpb24KICAgICAg
Ly8gbm9kZSwgc28gaXQgbXVjaCBjaGVhcGVyIGluIHRlcm1zIG9mIG1lbW9yeS4KICAgICAg
Ly8KICAgICAgLy8gd2UgYWxzbyBtYWludGFpbiBhIGN5Y2xlLWRldGVjdGluZyBzZXQsIGp1
c3QgdG8gYmUgc2FmZQogICAgICAKICAgICAgTChGKCJyZWNvbnN0cnVjdGluZyAlcyBpbiAl
c1xuIikgJSBpZGVudCAlIGRlbHRhX3RhYmxlKTsKICAgICAgSShkZWx0YV9leGlzdHMoaWRl
bnQsIGRlbHRhX3RhYmxlKSk7CiAgICAgIAogICAgICAvLyBuYjogYW4gZWRnZSBtYXAgZ29l
cyBpbiB0aGUgZGlyZWN0aW9uIG9mIHRoZQogICAgICAvLyBkZWx0YSwgKm5vdCogdGhlIGRp
cmVjdGlvbiB3ZSBkaXNjb3ZlciB0aGluZ3MgaW4sCiAgICAgIC8vIGkuZS4gZWFjaCBtYXAg
aXMgb2YgdGhlIGZvcm0gW25ld2lkXSAtPiBbb2xkaWRdCgogICAgICB0eXBlZGVmIG1hcDwg
aGV4ZW5jPGlkPiwgaGV4ZW5jPGlkPiA+IGVkZ2VtYXA7CiAgICAgIGxpc3Q8IHNoYXJlZF9w
dHI8ZWRnZW1hcD4gPiBwYXRoczsKCiAgICAgIHNldDwgaGV4ZW5jPGlkPiA+IGZyb250aWVy
LCBjeWNsZXM7CiAgICAgIGZyb250aWVyLmluc2VydChpZGVudCk7CgogICAgICBib29sIGZv
dW5kX3Jvb3QgPSBmYWxzZTsKICAgICAgaGV4ZW5jPGlkPiByb290KCIiKTsKCiAgICAgIHdo
aWxlICghIGZvdW5kX3Jvb3QpCiAgICAgICAgewogICAgICAgICAgc2V0PCBoZXhlbmM8aWQ+
ID4gbmV4dF9mcm9udGllcjsKICAgICAgICAgIHNoYXJlZF9wdHI8ZWRnZW1hcD4gZnJvbnRp
ZXJfbWFwKG5ldyBlZGdlbWFwKCkpOwoKICAgICAgICAgIEkoIWZyb250aWVyLmVtcHR5KCkp
OwoKICAgICAgICAgIGZvciAoc2V0PCBoZXhlbmM8aWQ+ID46OmNvbnN0X2l0ZXJhdG9yIGkg
PSBmcm9udGllci5iZWdpbigpOwogICAgICAgICAgICAgICBpICE9IGZyb250aWVyLmVuZCgp
OyArK2kpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBpZiAoZXhpc3RzKCppLCBkYXRh
X3RhYmxlKSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgcm9vdCA9ICpp
OwogICAgICAgICAgICAgICAgICBmb3VuZF9yb290ID0gdHJ1ZTsKICAgICAgICAgICAgICAg
ICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZQogICAgICAg
ICAgICAgICAgewogICAgICAgICAgICAgICAgICBjeWNsZXMuaW5zZXJ0KCppKTsKICAgICAg
ICAgICAgICAgICAgcmVzdWx0cyByZXM7CiAgICAgICAgICAgICAgICAgIGZldGNoKHJlcywg
b25lX2NvbCwgYW55X3Jvd3MsICJTRUxFQ1QgYmFzZSBmcm9tICclcScgV0hFUkUgaWQgPSAn
JXEnIiwKICAgICAgICAgICAgICAgICAgICAgICAgZGVsdGFfdGFibGUuY19zdHIoKSwgKCpp
KSgpLmNfc3RyKCkpOwogICAgICAgICAgICAgICAgICBmb3IgKHNpemVfdCBrID0gMDsgayA8
IHJlcy5zaXplKCk7ICsraykKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAg
ICAgICAgICBoZXhlbmM8aWQ+IGNvbnN0IG54dChyZXNba11bMF0pOwoKICAgICAgICAgICAg
ICAgICAgICAgIGlmIChjeWNsZXMuZmluZChueHQpICE9IGN5Y2xlcy5lbmQoKSkKICAgICAg
ICAgICAgICAgICAgICAgICAgdGhyb3cgb29wcygiY3ljbGUgaW4gdGFibGUgJyIgKyBkZWx0
YV90YWJsZSArICInLCBhdCBub2RlICIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgKyAoKmkpKCkgKyAiIDwtICIgKyBueHQoKSk7CgogICAgICAgICAgICAgICAgICAg
ICAgbmV4dF9mcm9udGllci5pbnNlcnQobnh0KTsKCiAgICAgICAgICAgICAgICAgICAgICBp
ZiAoZnJvbnRpZXJfbWFwLT5maW5kKG54dCkgPT0gZnJvbnRpZXJfbWFwLT5lbmQoKSkKICAg
ICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgIEwoRigi
aW5zZXJ0aW5nIGVkZ2U6ICVzIDwtICVzXG4iKSAlICgqaSkgJSBueHQpOwogICAgICAgICAg
ICAgICAgICAgICAgICAgIGZyb250aWVyX21hcC0+aW5zZXJ0KG1ha2VfcGFpcihueHQsICpp
KSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGVs
c2UKICAgICAgICAgICAgICAgICAgICAgICAgTChGKCJza2lwcGluZyBtZXJnZSBlZGdlICVz
IDwtICVzXG4iKSAlICgqaSkgJSBueHQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg
ICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgaWYgKCFmb3VuZF9yb290KQog
ICAgICAgICAgICB7CiAgICAgICAgICAgICAgZnJvbnRpZXIgPSBuZXh0X2Zyb250aWVyOwog
ICAgICAgICAgICAgIHBhdGhzLnB1c2hfZnJvbnQoZnJvbnRpZXJfbWFwKTsKICAgICAgICAg
ICAgfQogICAgICAgIH0KCiAgICAgIC8vIHBhdGggYnVpbHQsIG5vdyBhbGwgd2UgbmVlZCB0
byBkbyBpcyBmb2xsb3cgaXQgYmFjawoKICAgICAgSShmb3VuZF9yb290KTsKICAgICAgSShy
b290KCkgIT0gIiIpOwogICAgICBiYXNlNjQ8IGd6aXA8ZGF0YT4gPiBiZWdpbl9wYWNrZWQ7
CiAgICAgIGRhdGEgYmVnaW47ICAgICAgCiAgICAgIGdldChyb290LCBiZWdpbl9wYWNrZWQs
IGRhdGFfdGFibGUpOwogICAgICB1bnBhY2soYmVnaW5fcGFja2VkLCBiZWdpbik7CiAgICAg
IGhleGVuYzxpZD4gY3VyciA9IHJvb3Q7CgogICAgICBib29zdDo6c2hhcmVkX3B0cjxkZWx0
YV9hcHBsaWNhdG9yPiBhcHAgPSBuZXdfcGllY2V3aXNlX2FwcGxpY2F0b3IoKTsKICAgICAg
YXBwLT5iZWdpbihiZWdpbigpKTsKICAgICAgCiAgICAgIGZvciAobGlzdDwgc2hhcmVkX3B0
cjxlZGdlbWFwPiA+Ojpjb25zdF9pdGVyYXRvciBwID0gcGF0aHMuYmVnaW4oKTsKICAgICAg
ICAgICBwICE9IHBhdGhzLmVuZCgpOyArK3ApCiAgICAgICAgewogICAgICAgICAgc2hhcmVk
X3B0cjxlZGdlbWFwPiBpID0gKnA7CiAgICAgICAgICBJKGktPmZpbmQoY3VycikgIT0gaS0+
ZW5kKCkpOwogICAgICAgICAgaGV4ZW5jPGlkPiBjb25zdCBueHQgPSBpLT5maW5kKGN1cnIp
LT5zZWNvbmQ7CgogICAgICAgICAgTChGKCJmb2xsb3dpbmcgZGVsdGEgJXMgLT4gJXNcbiIp
ICUgY3VyciAlIG54dCk7CiAgICAgICAgICBiYXNlNjQ8IGd6aXA8ZGVsdGE+ID4gZGVsX3Bh
Y2tlZDsKICAgICAgICAgIGdldF9kZWx0YShueHQsIGN1cnIsIGRlbF9wYWNrZWQsIGRlbHRh
X3RhYmxlKTsKICAgICAgICAgIGRlbHRhIGRlbDsKICAgICAgICAgIHVucGFjayhkZWxfcGFj
a2VkLCBkZWwpOwogICAgICAgICAgYXBwbHlfZGVsdGEgKGFwcCwgZGVsKCkpOwogICAgICAg
ICAgYXBwLT5uZXh0KCk7CiAgICAgICAgICBjdXJyID0gbnh0OwogICAgICAgIH0KCiAgICAg
IHN0cmluZyB0bXA7CiAgICAgIGFwcC0+ZmluaXNoKHRtcCk7CiAgICAgIGRhdGEgZW5kKHRt
cCk7CgogICAgICBoZXhlbmM8aWQ+IGZpbmFsOwogICAgICBjYWxjdWxhdGVfaWRlbnQoZW5k
LCBmaW5hbCk7CiAgICAgIEkoZmluYWwgPT0gaWRlbnQpOwogICAgICBwYWNrKGVuZCwgZGF0
KTsKICAgIH0KfQoKCnZvaWQgCmRhdGFiYXNlOjpkcm9wKGhleGVuYzxpZD4gY29uc3QgJiBp
ZGVudCwgCiAgICAgICAgICAgICAgIHN0cmluZyBjb25zdCAmIHRhYmxlKQp7CiAgZXhlY3V0
ZSgiREVMRVRFIEZST00gJyVxJyBXSEVSRSBpZCA9ICclcSciLCAgCiAgICAgICAgICB0YWJs
ZS5jX3N0cigpLAogICAgICAgICAgaWRlbnQoKS5jX3N0cigpKTsKfQoKdm9pZCAKZGF0YWJh
c2U6OnB1dF92ZXJzaW9uKGhleGVuYzxpZD4gY29uc3QgJiBvbGRfaWQsCiAgICAgICAgICAg
ICAgICAgICAgICBoZXhlbmM8aWQ+IGNvbnN0ICYgbmV3X2lkLAogICAgICAgICAgICAgICAg
ICAgICAgYmFzZTY0PCBnemlwPGRlbHRhPiA+IGNvbnN0ICYgZGVsLAogICAgICAgICAgICAg
ICAgICAgICAgc3RyaW5nIGNvbnN0ICYgZGF0YV90YWJsZSwKICAgICAgICAgICAgICAgICAg
ICAgIHN0cmluZyBjb25zdCAmIGRlbHRhX3RhYmxlKQp7CgogIGJhc2U2NDwgZ3ppcDxkYXRh
PiA+IG9sZF9kYXRhLCBuZXdfZGF0YTsKICBiYXNlNjQ8IGd6aXA8ZGVsdGE+ID4gcmV2ZXJz
ZV9kZWx0YTsKICAKICBnZXRfdmVyc2lvbihvbGRfaWQsIG9sZF9kYXRhLCBkYXRhX3RhYmxl
LCBkZWx0YV90YWJsZSk7CiAgcGF0Y2gob2xkX2RhdGEsIGRlbCwgbmV3X2RhdGEpOwogIGRp
ZmYobmV3X2RhdGEsIG9sZF9kYXRhLCByZXZlcnNlX2RlbHRhKTsKICAgICAgCiAgdHJhbnNh
Y3Rpb25fZ3VhcmQgZ3VhcmQoKnRoaXMpOwogIGlmIChleGlzdHMob2xkX2lkLCBkYXRhX3Rh
YmxlKSkKICAgIHsKICAgICAgLy8gZGVzY2VuZGVudCBvZiBhIGhlYWQgdmVyc2lvbiByZXBs
YWNlcyB0aGUgaGVhZCwgdGhlcmVmb3JlIG9sZCBoZWFkCiAgICAgIC8vIG11c3QgYmUgZGlz
cG9zZWQgb2YKICAgICAgZHJvcChvbGRfaWQsIGRhdGFfdGFibGUpOwogICAgfQogIHB1dChu
ZXdfaWQsIG5ld19kYXRhLCBkYXRhX3RhYmxlKTsKICBwdXRfZGVsdGEob2xkX2lkLCBuZXdf
aWQsIHJldmVyc2VfZGVsdGEsIGRlbHRhX3RhYmxlKTsKICBndWFyZC5jb21taXQoKTsKfQoK
dm9pZCAKZGF0YWJhc2U6OnB1dF9yZXZlcnNlX3ZlcnNpb24oaGV4ZW5jPGlkPiBjb25zdCAm
IG5ld19pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGV4ZW5jPGlkPiBjb25z
dCAmIG9sZF9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFzZTY0PCBnemlw
PGRlbHRhPiA+IGNvbnN0ICYgcmV2ZXJzZV9kZWwsCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHN0cmluZyBjb25zdCAmIGRhdGFfdGFibGUsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHN0cmluZyBjb25zdCAmIGRlbHRhX3RhYmxlKQp7CiAgYmFzZTY0PCBnemlw
PGRhdGE+ID4gb2xkX2RhdGEsIG5ld19kYXRhOwogIAogIGdldF92ZXJzaW9uKG5ld19pZCwg
bmV3X2RhdGEsIGRhdGFfdGFibGUsIGRlbHRhX3RhYmxlKTsKICBwYXRjaChuZXdfZGF0YSwg
cmV2ZXJzZV9kZWwsIG9sZF9kYXRhKTsKICBoZXhlbmM8aWQ+IGNoZWNrOwogIGNhbGN1bGF0
ZV9pZGVudChvbGRfZGF0YSwgY2hlY2spOwogIEkob2xkX2lkID09IGNoZWNrKTsKICAgICAg
CiAgdHJhbnNhY3Rpb25fZ3VhcmQgZ3VhcmQoKnRoaXMpOwogIHB1dF9kZWx0YShvbGRfaWQs
IG5ld19pZCwgcmV2ZXJzZV9kZWwsIGRlbHRhX3RhYmxlKTsKICBndWFyZC5jb21taXQoKTsK
fQoKCgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0KLy8gLS0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIC0tCi8vIC0tICAgICAgICAgICAgICBwdWJsaWMgaW50
ZXJmYWNlIGZvbGxvd3MgICAgICAgICAgICAgICAgICAtLQovLyAtLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0KLy8gLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
Cgpib29sIApkYXRhYmFzZTo6ZmlsZV92ZXJzaW9uX2V4aXN0cyhmaWxlX2lkIGNvbnN0ICYg
aWQpCnsKICByZXR1cm4gZGVsdGFfZXhpc3RzKGlkLmlubmVyKCksICJmaWxlX2RlbHRhcyIp
IAogICAgfHwgZXhpc3RzKGlkLmlubmVyKCksICJmaWxlcyIpOwp9Cgpib29sIApkYXRhYmFz
ZTo6bWFuaWZlc3RfdmVyc2lvbl9leGlzdHMobWFuaWZlc3RfaWQgY29uc3QgJiBpZCkKewog
IHJldHVybiBkZWx0YV9leGlzdHMoaWQuaW5uZXIoKSwgIm1hbmlmZXN0X2RlbHRhcyIpIAog
ICAgfHwgZXhpc3RzKGlkLmlubmVyKCksICJtYW5pZmVzdHMiKTsKfQoKYm9vbCAKZGF0YWJh
c2U6OnJldmlzaW9uX2V4aXN0cyhyZXZpc2lvbl9pZCBjb25zdCAmIGlkKQp7CiAgcmV0dXJu
IGV4aXN0cyhpZC5pbm5lcigpLCAicmV2aXNpb25zIik7Cn0KCgp2b2lkIApkYXRhYmFzZTo6
Z2V0X2ZpbGVfdmVyc2lvbihmaWxlX2lkIGNvbnN0ICYgaWQsCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGZpbGVfZGF0YSAmIGRhdCkKewogIGJhc2U2NDwgZ3ppcDxkYXRhPiA+IHRt
cDsKICBnZXRfdmVyc2lvbihpZC5pbm5lcigpLCB0bXAsICJmaWxlcyIsICJmaWxlX2RlbHRh
cyIpOwogIGRhdCA9IHRtcDsKfQoKdm9pZCAKZGF0YWJhc2U6OmdldF9tYW5pZmVzdF92ZXJz
aW9uKG1hbmlmZXN0X2lkIGNvbnN0ICYgaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBtYW5pZmVzdF9kYXRhICYgZGF0KQp7CiAgYmFzZTY0PCBnemlwPGRhdGE+ID4gdG1w
OwogIGdldF92ZXJzaW9uKGlkLmlubmVyKCksIHRtcCwgIm1hbmlmZXN0cyIsICJtYW5pZmVz
dF9kZWx0YXMiKTsKICBkYXQgPSB0bXA7Cn0KCnZvaWQgCmRhdGFiYXNlOjpnZXRfbWFuaWZl
c3QobWFuaWZlc3RfaWQgY29uc3QgJiBpZCwKICAgICAgICAgICAgICAgICAgICAgICBtYW5p
ZmVzdF9tYXAgJiBtbSkKewogIG1hbmlmZXN0X2RhdGEgbWRhdDsKICBnZXRfbWFuaWZlc3Rf
dmVyc2lvbihpZCwgbWRhdCk7CiAgcmVhZF9tYW5pZmVzdF9tYXAobWRhdCwgbW0pOwp9CgoK
dm9pZCAKZGF0YWJhc2U6OnB1dF9maWxlKGZpbGVfaWQgY29uc3QgJiBpZCwKICAgICAgICAg
ICAgICAgICAgIGZpbGVfZGF0YSBjb25zdCAmIGRhdCkKewogIHB1dChpZC5pbm5lcigpLCBk
YXQuaW5uZXIoKSwgImZpbGVzIik7Cn0KCnZvaWQgCmRhdGFiYXNlOjpwdXRfZmlsZV92ZXJz
aW9uKGZpbGVfaWQgY29uc3QgJiBvbGRfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAg
IGZpbGVfaWQgY29uc3QgJiBuZXdfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGZp
bGVfZGVsdGEgY29uc3QgJiBkZWwpCnsKICBwdXRfdmVyc2lvbihvbGRfaWQuaW5uZXIoKSwg
bmV3X2lkLmlubmVyKCksIGRlbC5pbm5lcigpLCAKICAgICAgICAgICAgICAiZmlsZXMiLCAi
ZmlsZV9kZWx0YXMiKTsKfQoKdm9pZCAKZGF0YWJhc2U6OnB1dF9maWxlX3JldmVyc2VfdmVy
c2lvbihmaWxlX2lkIGNvbnN0ICYgbmV3X2lkLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGZpbGVfaWQgY29uc3QgJiBvbGRfaWQsICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9k
ZWx0YSBjb25zdCAmIGRlbCkKewogIHB1dF9yZXZlcnNlX3ZlcnNpb24obmV3X2lkLmlubmVy
KCksIG9sZF9pZC5pbm5lcigpLCBkZWwuaW5uZXIoKSwgCiAgICAgICAgICAgICAgICAgICAg
ICAiZmlsZXMiLCAiZmlsZV9kZWx0YXMiKTsKfQoKCnZvaWQgCmRhdGFiYXNlOjpwdXRfbWFu
aWZlc3QobWFuaWZlc3RfaWQgY29uc3QgJiBpZCwKICAgICAgICAgICAgICAgICAgICAgICBt
YW5pZmVzdF9kYXRhIGNvbnN0ICYgZGF0KQp7CiAgcHV0KGlkLmlubmVyKCksIGRhdC5pbm5l
cigpLCAibWFuaWZlc3RzIik7Cn0KCnZvaWQgCmRhdGFiYXNlOjpwdXRfbWFuaWZlc3RfdmVy
c2lvbihtYW5pZmVzdF9pZCBjb25zdCAmIG9sZF9pZCwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIG1hbmlmZXN0X2lkIGNvbnN0ICYgbmV3X2lkLAogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgbWFuaWZlc3RfZGVsdGEgY29uc3QgJiBkZWwpCnsKICBwdXRfdmVy
c2lvbihvbGRfaWQuaW5uZXIoKSwgbmV3X2lkLmlubmVyKCksIGRlbC5pbm5lcigpLCAKICAg
ICAgICAgICAgICAibWFuaWZlc3RzIiwgIm1hbmlmZXN0X2RlbHRhcyIpOwp9Cgp2b2lkIApk
YXRhYmFzZTo6cHV0X21hbmlmZXN0X3JldmVyc2VfdmVyc2lvbihtYW5pZmVzdF9pZCBjb25z
dCAmIG5ld19pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFu
aWZlc3RfaWQgY29uc3QgJiBvbGRfaWQsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hbmlmZXN0X2Rl
bHRhIGNvbnN0ICYgZGVsKQp7CiAgcHV0X3JldmVyc2VfdmVyc2lvbihuZXdfaWQuaW5uZXIo
KSwgb2xkX2lkLmlubmVyKCksIGRlbC5pbm5lcigpLCAKICAgICAgICAgICAgICAgICAgICAg
ICJtYW5pZmVzdHMiLCAibWFuaWZlc3RfZGVsdGFzIik7Cn0KCgp2b2lkIApkYXRhYmFzZTo6
Z2V0X3JldmlzaW9uX2FuY2VzdHJ5KHN0ZDo6c2V0PHN0ZDo6cGFpcjxyZXZpc2lvbl9pZCwg
cmV2aXNpb25faWQ+ID4gJiBncmFwaCkKewogIHJlc3VsdHMgcmVzOwogIGdyYXBoLmNsZWFy
KCk7CiAgZmV0Y2gocmVzLCAyLCBhbnlfcm93cywgCiAgICAgICAgIlNFTEVDVCBwYXJlbnQs
Y2hpbGQgRlJPTSByZXZpc2lvbl9hbmNlc3RyeSIpOwogIGZvciAoc2l6ZV90IGkgPSAwOyBp
IDwgcmVzLnNpemUoKTsgKytpKQogICAgZ3JhcGguaW5zZXJ0KHN0ZDo6bWFrZV9wYWlyKHJl
dmlzaW9uX2lkKHJlc1tpXVswXSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
cmV2aXNpb25faWQocmVzW2ldWzFdKSkpOwp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X3Jldmlz
aW9uX3BhcmVudHMocmV2aXNpb25faWQgY29uc3QgJiBpZCwKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgc2V0PHJldmlzaW9uX2lkPiAmIHBhcmVudHMpCnsKICByZXN1bHRzIHJl
czsKICBwYXJlbnRzLmNsZWFyKCk7CiAgZmV0Y2gocmVzLCBvbmVfY29sLCBhbnlfcm93cywg
CiAgICAgICAgIlNFTEVDVCBwYXJlbnQgRlJPTSByZXZpc2lvbl9hbmNlc3RyeSBXSEVSRSBj
aGlsZCA9ICclcSciLAogICAgICAgIGlkLmlubmVyKCkoKS5jX3N0cigpKTsKICBmb3IgKHNp
emVfdCBpID0gMDsgaSA8IHJlcy5zaXplKCk7ICsraSkKICAgIHBhcmVudHMuaW5zZXJ0KHJl
dmlzaW9uX2lkKHJlc1tpXVswXSkpOwp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X3JldmlzaW9u
X2NoaWxkcmVuKHJldmlzaW9uX2lkIGNvbnN0ICYgaWQsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgc2V0PHJldmlzaW9uX2lkPiAmIGNoaWxkcmVuKQp7CiAgcmVzdWx0cyBy
ZXM7CiAgY2hpbGRyZW4uY2xlYXIoKTsKICBmZXRjaChyZXMsIG9uZV9jb2wsIGFueV9yb3dz
LCAKICAgICAgICAiU0VMRUNUIGNoaWxkIEZST00gcmV2aXNpb25fYW5jZXN0cnkgV0hFUkUg
cGFyZW50ID0gJyVxJyIsCiAgICAgICAgaWQuaW5uZXIoKSgpLmNfc3RyKCkpOwogIGZvciAo
c2l6ZV90IGkgPSAwOyBpIDwgcmVzLnNpemUoKTsgKytpKQogICAgY2hpbGRyZW4uaW5zZXJ0
KHJldmlzaW9uX2lkKHJlc1tpXVswXSkpOwp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X3Jldmlz
aW9uX21hbmlmZXN0KHJldmlzaW9uX2lkIGNvbnN0ICYgcmlkLAogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgbWFuaWZlc3RfaWQgJiBtaWQpCnsKICByZXZpc2lvbl9zZXQgcmV2
OwogIGdldF9yZXZpc2lvbihyaWQsIHJldik7CiAgbWlkID0gcmV2Lm5ld19tYW5pZmVzdDsK
fQoKdm9pZCAKZGF0YWJhc2U6OmdldF9yZXZpc2lvbihyZXZpc2lvbl9pZCBjb25zdCAmIGlk
LAogICAgICAgICAgICAgICAgICAgICAgIHJldmlzaW9uX3NldCAmIHJldikKewogIHJldmlz
aW9uX2RhdGEgZDsKICBnZXRfcmV2aXNpb24oaWQsIGQpOwogIHJlYWRfcmV2aXNpb25fc2V0
KGQsIHJldik7Cn0KCnZvaWQgCmRhdGFiYXNlOjpnZXRfcmV2aXNpb24ocmV2aXNpb25faWQg
Y29uc3QgJiBpZCwKICAgICAgICAgICAgICAgICAgICAgICByZXZpc2lvbl9kYXRhICYgZGF0
KQp7CiAgcmVzdWx0cyByZXM7CiAgZmV0Y2gocmVzLCBvbmVfY29sLCBvbmVfcm93LCAKICAg
ICAgICAiU0VMRUNUIGRhdGEgRlJPTSByZXZpc2lvbnMgV0hFUkUgaWQgPSAnJXEnIiwKICAg
ICAgICBpZC5pbm5lcigpKCkuY19zdHIoKSk7CgogIGRhdCA9IHJldmlzaW9uX2RhdGEocmVz
WzBdWzBdKTsKCiAgLy8gdmVyaWZ5IHRoYXQgd2UgZ290IGEgcmV2aXNpb24gd2l0aCB0aGUg
cmlnaHQgaWQKICB7CiAgICByZXZpc2lvbl9pZCB0bXA7CiAgICBjYWxjdWxhdGVfaWRlbnQo
ZGF0LCB0bXApOwogICAgSShpZCA9PSB0bXApOwogIH0KfQoKdm9pZCAKZGF0YWJhc2U6OnB1
dF9yZXZpc2lvbihyZXZpc2lvbl9pZCBjb25zdCAmIG5ld19pZCwKICAgICAgICAgICAgICAg
ICAgICAgICByZXZpc2lvbl9zZXQgY29uc3QgJiByZXYpCnsKCiAgSSghcmV2aXNpb25fZXhp
c3RzKG5ld19pZCkpOwogIHJldmlzaW9uX2RhdGEgZDsKCiAgd3JpdGVfcmV2aXNpb25fc2V0
KHJldiwgZCk7CiAgcmV2aXNpb25faWQgdG1wOwogIGNhbGN1bGF0ZV9pZGVudChkLCB0bXAp
OwogIEkodG1wID09IG5ld19pZCk7CgogIHRyYW5zYWN0aW9uX2d1YXJkIGd1YXJkKCp0aGlz
KTsKCiAgZXhlY3V0ZSgiSU5TRVJUIElOVE8gcmV2aXNpb25zIFZBTFVFUygnJXEnLCAnJXEn
KSIsIAogICAgICAgICAgbmV3X2lkLmlubmVyKCkoKS5jX3N0cigpLCAKICAgICAgICAgIGQu
aW5uZXIoKSgpLmNfc3RyKCkpOwoKICBmb3IgKGVkZ2VfbWFwOjpjb25zdF9pdGVyYXRvciBl
ID0gcmV2LmVkZ2VzLmJlZ2luKCk7CiAgICAgICBlICE9IHJldi5lZGdlcy5lbmQoKTsgKytl
KQogICAgewogICAgICBleGVjdXRlKCJJTlNFUlQgSU5UTyByZXZpc2lvbl9hbmNlc3RyeSBW
QUxVRVMoJyVxJywgJyVxJykiLCAKICAgICAgICAgICAgICBlZGdlX29sZF9yZXZpc2lvbihl
KS5pbm5lcigpKCkuY19zdHIoKSwKICAgICAgICAgICAgICBuZXdfaWQuaW5uZXIoKSgpLmNf
c3RyKCkpOwogICAgfQoKICBndWFyZC5jb21taXQoKTsKfQoKdm9pZCAKZGF0YWJhc2U6OnB1
dF9yZXZpc2lvbihyZXZpc2lvbl9pZCBjb25zdCAmIG5ld19pZCwKICAgICAgICAgICAgICAg
ICAgICAgICByZXZpc2lvbl9kYXRhIGNvbnN0ICYgZGF0KQp7CiAgcmV2aXNpb25fc2V0IHJl
djsKICByZWFkX3JldmlzaW9uX3NldChkYXQsIHJldik7CiAgcHV0X3JldmlzaW9uKG5ld19p
ZCwgcmV2KTsKfQoKCi8vIGNyeXB0byBrZXkgbWFuYWdlbWVudAoKdm9pZCAKZGF0YWJhc2U6
OmdldF9rZXlfaWRzKHN0cmluZyBjb25zdCAmIHBhdHRlcm4sCiAgICAgICAgICAgICAgICAg
ICAgICB2ZWN0b3I8cnNhX2tleXBhaXJfaWQ+ICYgcHVia2V5cywKICAgICAgICAgICAgICAg
ICAgICAgIHZlY3Rvcjxyc2Ffa2V5cGFpcl9pZD4gJiBwcml2a2V5cykKewogIHB1YmtleXMu
Y2xlYXIoKTsKICBwcml2a2V5cy5jbGVhcigpOwogIHJlc3VsdHMgcmVzOwoKICBpZiAocGF0
dGVybiAhPSAiIikKICAgIGZldGNoKHJlcywgb25lX2NvbCwgYW55X3Jvd3MsIAogICAgICAg
ICAgIlNFTEVDVCBpZCBmcm9tIHB1YmxpY19rZXlzIFdIRVJFIGlkIEdMT0IgJyVxJyIsCiAg
ICAgICAgICBwYXR0ZXJuLmNfc3RyKCkpOwogIGVsc2UKICAgIGZldGNoKHJlcywgb25lX2Nv
bCwgYW55X3Jvd3MsIAogICAgICAgICAgIlNFTEVDVCBpZCBmcm9tIHB1YmxpY19rZXlzIik7
CgogIGZvciAoc2l6ZV90IGkgPSAwOyBpIDwgcmVzLnNpemUoKTsgKytpKQogICAgcHVia2V5
cy5wdXNoX2JhY2socmVzW2ldWzBdKTsKCiAgaWYgKHBhdHRlcm4gIT0gIiIpCiAgICBmZXRj
aChyZXMsIG9uZV9jb2wsIGFueV9yb3dzLCAKICAgICAgICAgICJTRUxFQ1QgaWQgZnJvbSBw
cml2YXRlX2tleXMgV0hFUkUgaWQgR0xPQiAnJXEnIiwKICAgICAgICAgIHBhdHRlcm4uY19z
dHIoKSk7CiAgZWxzZQogICAgZmV0Y2gocmVzLCBvbmVfY29sLCBhbnlfcm93cywgCiAgICAg
ICAgICAiU0VMRUNUIGlkIGZyb20gcHJpdmF0ZV9rZXlzIik7CgogIGZvciAoc2l6ZV90IGkg
PSAwOyBpIDwgcmVzLnNpemUoKTsgKytpKQogICAgcHJpdmtleXMucHVzaF9iYWNrKHJlc1tp
XVswXSk7Cn0KCnZvaWQgCmRhdGFiYXNlOjpnZXRfcHJpdmF0ZV9rZXlzKHZlY3Rvcjxyc2Ff
a2V5cGFpcl9pZD4gJiBwcml2a2V5cykKewogIHByaXZrZXlzLmNsZWFyKCk7CiAgcmVzdWx0
cyByZXM7CiAgZmV0Y2gocmVzLCBvbmVfY29sLCBhbnlfcm93cywgICJTRUxFQ1QgaWQgZnJv
bSBwcml2YXRlX2tleXMiKTsKICBmb3IgKHNpemVfdCBpID0gMDsgaSA8IHJlcy5zaXplKCk7
ICsraSkKICAgIHByaXZrZXlzLnB1c2hfYmFjayhyZXNbaV1bMF0pOwp9Cgpib29sIApkYXRh
YmFzZTo6cHVibGljX2tleV9leGlzdHMoaGV4ZW5jPGlkPiBjb25zdCAmIGhhc2gpCnsKICBy
ZXN1bHRzIHJlczsKICBmZXRjaChyZXMsIG9uZV9jb2wsIGFueV9yb3dzLCAKICAgICAgICAi
U0VMRUNUIGlkIEZST00gcHVibGljX2tleXMgV0hFUkUgaGFzaCA9ICclcSciLAogICAgICAg
IGhhc2goKS5jX3N0cigpKTsKICBJKChyZXMuc2l6ZSgpID09IDEpIHx8IChyZXMuc2l6ZSgp
ID09IDApKTsKICBpZiAocmVzLnNpemUoKSA9PSAxKSAKICAgIHJldHVybiB0cnVlOwogIHJl
dHVybiBmYWxzZTsKfQoKYm9vbCAKZGF0YWJhc2U6OnB1YmxpY19rZXlfZXhpc3RzKHJzYV9r
ZXlwYWlyX2lkIGNvbnN0ICYgaWQpCnsKICByZXN1bHRzIHJlczsKICBmZXRjaChyZXMsIG9u
ZV9jb2wsIGFueV9yb3dzLCAKICAgICAgICAiU0VMRUNUIGlkIEZST00gcHVibGljX2tleXMg
V0hFUkUgaWQgPSAnJXEnIiwKICAgICAgICBpZCgpLmNfc3RyKCkpOwogIEkoKHJlcy5zaXpl
KCkgPT0gMSkgfHwgKHJlcy5zaXplKCkgPT0gMCkpOwogIGlmIChyZXMuc2l6ZSgpID09IDEp
IAogICAgcmV0dXJuIHRydWU7CiAgcmV0dXJuIGZhbHNlOwp9Cgpib29sIApkYXRhYmFzZTo6
cHJpdmF0ZV9rZXlfZXhpc3RzKHJzYV9rZXlwYWlyX2lkIGNvbnN0ICYgaWQpCnsKICByZXN1
bHRzIHJlczsKICBmZXRjaChyZXMsIG9uZV9jb2wsIGFueV9yb3dzLAogICAgICAgICJTRUxF
Q1QgaWQgRlJPTSBwcml2YXRlX2tleXMgV0hFUkUgaWQgPSAnJXEnIiwKICAgICAgICBpZCgp
LmNfc3RyKCkpOwogIEkoKHJlcy5zaXplKCkgPT0gMSkgfHwgKHJlcy5zaXplKCkgPT0gMCkp
OwogIGlmIChyZXMuc2l6ZSgpID09IDEpCiAgICByZXR1cm4gdHJ1ZTsKICByZXR1cm4gZmFs
c2U7Cn0KCmJvb2wgCmRhdGFiYXNlOjprZXlfZXhpc3RzKHJzYV9rZXlwYWlyX2lkIGNvbnN0
ICYgaWQpCnsKICByZXR1cm4gcHVibGljX2tleV9leGlzdHMoaWQpIHx8IHByaXZhdGVfa2V5
X2V4aXN0cyhpZCk7Cn0KCnZvaWQgCmRhdGFiYXNlOjpnZXRfcHVia2V5KGhleGVuYzxpZD4g
Y29uc3QgJiBoYXNoLCAKICAgICAgICAgICAgICAgICAgICAgcnNhX2tleXBhaXJfaWQgJiBp
ZCwKICAgICAgICAgICAgICAgICAgICAgYmFzZTY0PHJzYV9wdWJfa2V5PiAmIHB1Yl9lbmNv
ZGVkKQp7CiAgcmVzdWx0cyByZXM7CiAgZmV0Y2gocmVzLCAyLCBvbmVfcm93LCAKICAgICAg
ICAiU0VMRUNUIGlkLCBrZXlkYXRhIEZST00gcHVibGljX2tleXMgd2hlcmUgaGFzaCA9ICcl
cSciLCAKICAgICAgICBoYXNoKCkuY19zdHIoKSk7CiAgaWQgPSByZXNbMF1bMF07CiAgcHVi
X2VuY29kZWQgPSByZXNbMF1bMV07Cn0KCnZvaWQgCmRhdGFiYXNlOjpnZXRfa2V5KHJzYV9r
ZXlwYWlyX2lkIGNvbnN0ICYgcHViX2lkLCAKICAgICAgICAgICAgICAgICAgYmFzZTY0PHJz
YV9wdWJfa2V5PiAmIHB1Yl9lbmNvZGVkKQp7CiAgcmVzdWx0cyByZXM7CiAgZmV0Y2gocmVz
LCBvbmVfY29sLCBvbmVfcm93LCAKICAgICAgICAiU0VMRUNUIGtleWRhdGEgRlJPTSBwdWJs
aWNfa2V5cyB3aGVyZSBpZCA9ICclcSciLCAKICAgICAgICBwdWJfaWQoKS5jX3N0cigpKTsK
ICBwdWJfZW5jb2RlZCA9IHJlc1swXVswXTsKfQoKdm9pZCAKZGF0YWJhc2U6OmdldF9rZXko
cnNhX2tleXBhaXJfaWQgY29uc3QgJiBwcml2X2lkLCAKICAgICAgICAgICAgICAgICAgYmFz
ZTY0PCBhcmM0PHJzYV9wcml2X2tleT4gPiAmIHByaXZfZW5jb2RlZCkKewogIHJlc3VsdHMg
cmVzOwogIGZldGNoKHJlcywgb25lX2NvbCwgb25lX2NvbCwgCiAgICAgICAgIlNFTEVDVCBr
ZXlkYXRhIEZST00gcHJpdmF0ZV9rZXlzIHdoZXJlIGlkID0gJyVxJyIsIAogICAgICAgIHBy
aXZfaWQoKS5jX3N0cigpKTsKICBwcml2X2VuY29kZWQgPSByZXNbMF1bMF07Cn0KCgp2b2lk
IApkYXRhYmFzZTo6cHV0X2tleShyc2Ffa2V5cGFpcl9pZCBjb25zdCAmIHB1Yl9pZCwgCiAg
ICAgICAgICAgICAgICAgIGJhc2U2NDxyc2FfcHViX2tleT4gY29uc3QgJiBwdWJfZW5jb2Rl
ZCkKewogIGhleGVuYzxpZD4gdGhhc2g7CiAga2V5X2hhc2hfY29kZShwdWJfaWQsIHB1Yl9l
bmNvZGVkLCB0aGFzaCk7CiAgZXhlY3V0ZSgiSU5TRVJUIElOVE8gcHVibGljX2tleXMgVkFM
VUVTKCclcScsICclcScsICclcScpIiwgCiAgICAgICAgICB0aGFzaCgpLmNfc3RyKCksIHB1
Yl9pZCgpLmNfc3RyKCksIHB1Yl9lbmNvZGVkKCkuY19zdHIoKSk7Cn0KCnZvaWQgCmRhdGFi
YXNlOjpwdXRfa2V5KHJzYV9rZXlwYWlyX2lkIGNvbnN0ICYgcHJpdl9pZCwgCiAgICAgICAg
ICAgICAgICAgIGJhc2U2NDwgYXJjNDxyc2FfcHJpdl9rZXk+ID4gY29uc3QgJiBwcml2X2Vu
Y29kZWQpCnsKICAKICBoZXhlbmM8aWQ+IHRoYXNoOwogIGtleV9oYXNoX2NvZGUocHJpdl9p
ZCwgcHJpdl9lbmNvZGVkLCB0aGFzaCk7CiAgZXhlY3V0ZSgiSU5TRVJUIElOVE8gcHJpdmF0
ZV9rZXlzIFZBTFVFUygnJXEnLCAnJXEnLCAnJXEnKSIsIAogICAgICAgICAgdGhhc2goKS5j
X3N0cigpLCBwcml2X2lkKCkuY19zdHIoKSwgcHJpdl9lbmNvZGVkKCkuY19zdHIoKSk7Cn0K
CnZvaWQgCmRhdGFiYXNlOjpwdXRfa2V5X3BhaXIocnNhX2tleXBhaXJfaWQgY29uc3QgJiBp
ZCwgCiAgICAgICAgICAgICAgICAgICAgICAgYmFzZTY0PHJzYV9wdWJfa2V5PiBjb25zdCAm
IHB1Yl9lbmNvZGVkLAogICAgICAgICAgICAgICAgICAgICAgIGJhc2U2NDwgYXJjNDxyc2Ff
cHJpdl9rZXk+ID4gY29uc3QgJiBwcml2X2VuY29kZWQpCnsKICB0cmFuc2FjdGlvbl9ndWFy
ZCBndWFyZCgqdGhpcyk7CiAgcHV0X2tleShpZCwgcHViX2VuY29kZWQpOwogIHB1dF9rZXko
aWQsIHByaXZfZW5jb2RlZCk7CiAgZ3VhcmQuY29tbWl0KCk7Cn0KCnZvaWQKZGF0YWJhc2U6
OmRlbGV0ZV9wcml2YXRlX2tleShyc2Ffa2V5cGFpcl9pZCBjb25zdCAmIHB1Yl9pZCkKewog
IGV4ZWN1dGUoIkRFTEVURSBGUk9NIHByaXZhdGVfa2V5cyBXSEVSRSBpZCA9ICclcSciLAoJ
ICBwdWJfaWQoKS5jX3N0cigpKTsKfQoKLy8gY2VydCBtYW5hZ2VtZW50Cgpib29sIApkYXRh
YmFzZTo6Y2VydF9leGlzdHMoY2VydCBjb25zdCAmIHQsCiAgICAgICAgICAgICAgICAgICAg
ICBzdHJpbmcgY29uc3QgJiB0YWJsZSkKewogIHJlc3VsdHMgcmVzOwogIGZldGNoKHJlcywg
MSwgYW55X3Jvd3MsCiAgICAgICAgIlNFTEVDVCBpZCBGUk9NICclcScgV0hFUkUgaWQgPSAn
JXEnICIKICAgICAgICAiQU5EIG5hbWUgPSAnJXEnIEFORCB2YWx1ZSA9ICclcScgIiAKICAg
ICAgICAiQU5EIGtleXBhaXIgPSAnJXEnIEFORCBzaWduYXR1cmUgPSAnJXEnICIsCiAgICAg
ICAgdGFibGUuY19zdHIoKSwKICAgICAgICB0LmlkZW50KCkuY19zdHIoKSwKICAgICAgICB0
Lm5hbWUoKS5jX3N0cigpLAogICAgICAgIHQudmFsdWUoKS5jX3N0cigpLAogICAgICAgIHQu
a2V5KCkuY19zdHIoKSwKICAgICAgICB0LnNpZygpLmNfc3RyKCkpOwogIEkocmVzLnNpemUo
KSA9PSAwIHx8IHJlcy5zaXplKCkgPT0gMSk7CiAgcmV0dXJuIHJlcy5zaXplKCkgPT0gMTsK
fQoKdm9pZCAKZGF0YWJhc2U6OnB1dF9jZXJ0KGNlcnQgY29uc3QgJiB0LAogICAgICAgICAg
ICAgICAgICAgc3RyaW5nIGNvbnN0ICYgdGFibGUpCnsKICBoZXhlbmM8aWQ+IHRoYXNoOwog
IGNlcnRfaGFzaF9jb2RlKHQsIHRoYXNoKTsKICBleGVjdXRlKCJJTlNFUlQgSU5UTyAnJXEn
IFZBTFVFUygnJXEnLCAnJXEnLCAnJXEnLCAnJXEnLCAnJXEnLCAnJXEnKSIsIAogICAgICAg
ICAgdGFibGUuY19zdHIoKSwKICAgICAgICAgIHRoYXNoKCkuY19zdHIoKSwKICAgICAgICAg
IHQuaWRlbnQoKS5jX3N0cigpLAogICAgICAgICAgdC5uYW1lKCkuY19zdHIoKSwgCiAgICAg
ICAgICB0LnZhbHVlKCkuY19zdHIoKSwKICAgICAgICAgIHQua2V5KCkuY19zdHIoKSwKICAg
ICAgICAgIHQuc2lnKCkuY19zdHIoKSk7Cn0KCnZvaWQgCmRhdGFiYXNlOjpyZXN1bHRzX3Rv
X2NlcnRzKHJlc3VsdHMgY29uc3QgJiByZXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAg
IHZlY3RvcjxjZXJ0PiAmIGNlcnRzKQp7CiAgY2VydHMuY2xlYXIoKTsKICBmb3IgKHNpemVf
dCBpID0gMDsgaSA8IHJlcy5zaXplKCk7ICsraSkKICAgIHsKICAgICAgY2VydCB0OwogICAg
ICB0ID0gY2VydChoZXhlbmM8aWQ+KHJlc1tpXVswXSksIAogICAgICAgICAgICAgIGNlcnRf
bmFtZShyZXNbaV1bMV0pLAogICAgICAgICAgICAgIGJhc2U2NDxjZXJ0X3ZhbHVlPihyZXNb
aV1bMl0pLAogICAgICAgICAgICAgIHJzYV9rZXlwYWlyX2lkKHJlc1tpXVszXSksCiAgICAg
ICAgICAgICAgYmFzZTY0PHJzYV9zaGExX3NpZ25hdHVyZT4ocmVzW2ldWzRdKSk7CiAgICAg
IGNlcnRzLnB1c2hfYmFjayh0KTsKICAgIH0KfQoKCnN0cnVjdCB2YWxpZF9jZXJ0cwp7CiAg
c2V0PHJzYV9rZXlwYWlyX2lkPiB2YWxpZF9zaWduZXJzOwogIGhleGVuYzxpZD4gaWRlbnQ7
CiAgY2VydF9uYW1lIG5hbWU7CiAgYmFzZTY0PGNlcnRfdmFsdWU+IHZhbDsKICBzdHJpbmcg
c2lnbmF0dXJlX3R5cGU7CgogIHZhbGlkX2NlcnRzKHN0cmluZyBjb25zdCAmIHR5KSAKICAg
IDogc2lnbmF0dXJlX3R5cGUodHkpIAogIHsKICAgIEwoRigiY29uc3RydWN0aW5nIHZhbGlk
aXR5IGNoZWNrZXIgZm9yICVzIGNlcnRzXG4iKSAlIHR5KTsKICB9CgogIGJvb2wgY2hlY2tf
c2lnbmVyX3RydXN0KGFwcF9zdGF0ZSAmIGFwcCkKICB7CiAgICBib29sIHRydXN0ZWQgPSBm
YWxzZTsKCiAgICBMKEYoImNoZWNraW5nICVkIHNpZ25lciAlcyBjZXJ0IHRydXN0IHNldFxu
IikgCiAgICAgICUgdmFsaWRfc2lnbmVycy5zaXplKCkgJSBzaWduYXR1cmVfdHlwZSk7CiAg
ICB0cnkKICAgICAgewogICAgICAgIGNlcnRfdmFsdWUgdjsKICAgICAgICBkZWNvZGVfYmFz
ZTY0KHZhbCwgdik7CiAgICAgICAgLy8gRklYTUU6IGxhbWUgc3RyaW5nLW1ha2VzLXRoZS1t
b2RlIGFyZ3VtZW50CiAgICAgICAgaWYgKHNpZ25hdHVyZV90eXBlID09ICJyZXZpc2lvbiIp
CiAgICAgICAgICB0cnVzdGVkID0gYXBwLmx1YS5ob29rX2dldF9yZXZpc2lvbl9jZXJ0X3Ry
dXN0KHZhbGlkX3NpZ25lcnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgaWRlbnQsIG5hbWUsIHYpOwogICAgICAgIGVsc2UgaWYg
KHNpZ25hdHVyZV90eXBlID09ICJtYW5pZmVzdCIpCiAgICAgICAgICB0cnVzdGVkID0gYXBw
Lmx1YS5ob29rX2dldF9tYW5pZmVzdF9jZXJ0X3RydXN0KHZhbGlkX3NpZ25lcnMsCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlk
ZW50LCBuYW1lLCB2KTsKICAgICAgICBlbHNlIGlmIChzaWduYXR1cmVfdHlwZSA9PSAiZmls
ZSIpCiAgICAgICAgICB0cnVzdGVkID0gYXBwLmx1YS5ob29rX2dldF9maWxlX2NlcnRfdHJ1
c3QodmFsaWRfc2lnbmVycywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBpZGVudCwgbmFtZSwgdik7CiAgICAgICAgZWxzZQogICAgICAg
ICAgSShmYWxzZSk7IC8vIHNob3VsZCBiZSBpbGxlZ2FsCiAgICAgIH0KICAgIGNhdGNoICgu
Li4pCiAgICAgIHsKICAgICAgICBXKEYoImV4Y2VwdGlvbiBpbiBzcWxpdGUgdmFsaWRfY2Vy
dHM6OmNoZWNrX3NldF90cnVzdFxuIikpOwogICAgICB9CiAgICAKICAgIGlmICh0cnVzdGVk
KQogICAgICBMKEYoInRydXN0IGZ1bmN0aW9uIGxpa2VkICVkICVzIHNpZ25lcnNcbiIpIAog
ICAgICAgICUgdmFsaWRfc2lnbmVycy5zaXplKCkgJSBzaWduYXR1cmVfdHlwZSk7CiAgICBl
bHNlCiAgICAgIEwoRigidHJ1c3QgZnVuY3Rpb24gZGlzbGlrZWQgJWQgJXMgc2lnbmVyc1xu
IikgCiAgICAgICAgJSB2YWxpZF9zaWduZXJzLnNpemUoKSAlIHNpZ25hdHVyZV90eXBlKTsK
ICAgIAogICAgcmV0dXJuIHRydXN0ZWQ7CiAgfQoKICB2b2lkIGNoZWNrX3NpbmdsZV9zaWdu
ZXIoYXBwX3N0YXRlICYgYXBwLAogICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgYXJn
YywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYXIgY29uc3QgKiogYXJndikKICB7
CiAgICB0cnkKICAgICAgewogICAgICAgIC8vIGFyZ3MgYXJlOiBoYXNoLCBpZCwgbmFtZSwg
dmFsdWUsIGtleXBhaXIsIHB1YmtleSwgc2lnbmF0dXJlCiAgICAgICAgLy8gTChGKCJlbnRy
aWVzIGFyZSBbJXNdIFslc10gWyVzXSBbJXNdIFslc10gWyVzXSBbJXNdXG4iKSAKICAgICAg
ICAvLyAgICAgICAgJSBhcmd2WzBdICUgYXJndlsxXSAlIGFyZ3ZbMl0gJSBhcmd2WzNdICUg
YXJndls0XSAlIGFyZ3ZbNV0gJSBhcmd2WzZdKTsKCiAgICAgICAgY2VydCB0bXAgPSBjZXJ0
KGhleGVuYzxpZD4oYXJndlsxXSksIAogICAgICAgICAgICAgICAgICAgICAgICBjZXJ0X25h
bWUoYXJndlsyXSksCiAgICAgICAgICAgICAgICAgICAgICAgIGJhc2U2NDxjZXJ0X3ZhbHVl
Pihhcmd2WzNdKSwKICAgICAgICAgICAgICAgICAgICAgICAgcnNhX2tleXBhaXJfaWQoYXJn
dls0XSksCiAgICAgICAgICAgICAgICAgICAgICAgIGJhc2U2NDxyc2Ffc2hhMV9zaWduYXR1
cmU+KGFyZ3ZbNl0pKTsKCiAgICAgICAgYmFzZTY0PHJzYV9wdWJfa2V5PiBwayhhcmd2WzVd
KTsKCiAgICAgICAgaWYgKGlkZW50KCkuZW1wdHkoKSkKICAgICAgICAgIGlkZW50ID0gdG1w
LmlkZW50OwogICAgICAgIGVsc2UKICAgICAgICAgIEkoaWRlbnQgPT0gdG1wLmlkZW50KTsK
CiAgICAgICAgaWYgKG5hbWUoKS5lbXB0eSgpKQogICAgICAgICAgbmFtZSA9IHRtcC5uYW1l
OwogICAgICAgIGVsc2UKICAgICAgICAgIEkobmFtZSA9PSB0bXAubmFtZSk7CgogICAgICAg
IGlmICh2YWwoKS5lbXB0eSgpKQogICAgICAgICAgdmFsID0gdG1wLnZhbHVlOwogICAgICAg
IGVsc2UKICAgICAgICAgIEkodmFsID09IHRtcC52YWx1ZSk7CgogICAgICAgIC8vICAgICAg
TChGKCJleGFtaW5pbmcgJyVzJyAlcyBjZXJ0IGZyb20gJXNcbiIpIAogICAgICAgIC8vICAg
ICAgICAlIG5hbWUgJSBzaWduYXR1cmVfdHlwZSAlIGlkZW50KTsKCiAgICAgICAgc3RyaW5n
IHR4dDsKICAgICAgICBjZXJ0X3NpZ25hYmxlX3RleHQodG1wLCB0eHQpOwogICAgICAgIGlm
IChjaGVja19zaWduYXR1cmUoYXBwLmx1YSwgdG1wLmtleSwgcGssIHR4dCwgdG1wLnNpZykp
CiAgICAgICAgICB7CiAgICAgICAgICAgIEwoRigib2sgJyVzJyAlcyBjZXJ0IGZyb20gJXNc
biIpIAogICAgICAgICAgICAgICUgbmFtZSAlIHNpZ25hdHVyZV90eXBlICUgdG1wLmtleSk7
CiAgICAgICAgICAgIHZhbGlkX3NpZ25lcnMuaW5zZXJ0KHRtcC5rZXkpOwogICAgICAgICAg
fQogICAgICAgIGVsc2UKICAgICAgICAgIHsKICAgICAgICAgICAgVyhGKCJiYWQgJyVzJyAl
cyBjZXJ0IGZyb20gJXNcbiIpIAogICAgICAgICAgICAgICUgbmFtZSAlIHNpZ25hdHVyZV90
eXBlICUgdG1wLmtleSk7CiAgICAgICAgICB9CiAgICAgIH0KICAgIGNhdGNoIChzdGQ6OmV4
Y2VwdGlvbiAmIGUpCiAgICAgIHsKICAgICAgICBXKEYoInN0ZDo6ZXhjZXB0aW9uIGluIHNx
bGl0ZSB2YWxpZF9jZXJ0czo6Y2hlY2tfc2luZ2xlX3NpZ25lcjogJXNcbiIpICUgZS53aGF0
KCkpOwogICAgICB9CiAgICBjYXRjaCAoLi4uKQogICAgICB7CiAgICAgICAgVyhGKCJ1bmtu
b3duIGV4Y2VwdGlvbiBpbiBzcWxpdGUgdmFsaWRfY2VydHM6OmNoZWNrX3NpbmdsZV9zaWdu
ZXJcbiIpKTsKICAgICAgfQogIH0KfTsKCmV4dGVybiAiQyIKewoKc3RhdGljIHZvaWQKdHJ1
c3RlZF9zdGVwX2NhbGxiYWNrKHNxbGl0ZV9mdW5jICogZm5fY3R4LCAKICAgICAgICAgICAg
ICAgICAgICAgIGludCBhcmdjLCAKICAgICAgICAgICAgICAgICAgICAgIGNoYXIgY29uc3Qg
KiogYXJndikKewogIGFwcF9zdGF0ZSAqIGFwcCA9IE5VTEw7IAogIHZhbGlkX2NlcnRzICoq
IHZwcDsKCiAgSShmbl9jdHgpOwogIEkoYXJnYyA9PSA4KTsKICBJKGFyZ3YpOwogIGZvciAo
c2l6ZV90IGkgPSAwOyBpIDwgODsgKytpKQogICAgSShhcmd2W2ldKTsKCiAgYXBwID0gc3Rh
dGljX2Nhc3Q8YXBwX3N0YXRlICo+KHNxbGl0ZV91c2VyX2RhdGEoZm5fY3R4KSk7CiAgSShh
cHApOwogIHZwcCA9IHN0YXRpY19jYXN0PHZhbGlkX2NlcnRzICoqPihzcWxpdGVfYWdncmVn
YXRlX2NvbnRleHQoZm5fY3R4LCBzaXplb2YodmFsaWRfY2VydHMgKikpKTsKICBJKHZwcCk7
CiAgaWYgKCEgKCp2cHApKQogICAgKnZwcCA9IG5ldyB2YWxpZF9jZXJ0cyhzdHJpbmcoYXJn
dlswXSkpOwogIEkoKnZwcCk7CiAgKCp2cHApLT5jaGVja19zaW5nbGVfc2lnbmVyKCphcHAs
IGFyZ2MtMSwgYXJndisxKTsgIAp9CgpzdGF0aWMgdm9pZAp0cnVzdGVkX2ZpbmFsaXplX2Nh
bGxiYWNrKHNxbGl0ZV9mdW5jICogZm5fY3R4KQp7CiAgYXBwX3N0YXRlICogYXBwID0gTlVM
TDsgCiAgdmFsaWRfY2VydHMgKiogdnBwOwogIGFwcCA9IHN0YXRpY19jYXN0PGFwcF9zdGF0
ZSAqPihzcWxpdGVfdXNlcl9kYXRhKGZuX2N0eCkpOwogIEkoYXBwKTsKICB2cHAgPSBzdGF0
aWNfY2FzdDx2YWxpZF9jZXJ0cyAqKj4oc3FsaXRlX2FnZ3JlZ2F0ZV9jb250ZXh0KGZuX2N0
eCwgc2l6ZW9mKHZhbGlkX2NlcnRzICopKSk7CgogIEkodnBwKTsKICBJKCp2cHApOwoKICBp
ZiAoKCp2cHApLT5jaGVja19zaWduZXJfdHJ1c3QoKmFwcCkpCiAgICBzcWxpdGVfc2V0X3Jl
c3VsdF9pbnQoZm5fY3R4LCAxKTsKICBlbHNlCiAgICBzcWxpdGVfc2V0X3Jlc3VsdF9pbnQo
Zm5fY3R4LCAwKTsKCiAgZGVsZXRlICgqdnBwKTsKfQp9CgoKdm9pZApkYXRhYmFzZTo6aW5z
dGFsbF9mdW5jdGlvbnMoYXBwX3N0YXRlICogYXBwKQp7CiAgLy8gcmVnaXN0ZXIgYW55IGZ1
bmN0aW9ucyB3ZSdyZSBnb2luZyB0byB1c2UKICBJKHNxbGl0ZV9jcmVhdGVfZnVuY3Rpb24o
c3FsKCksICJ1bmJhc2U2NCIsIC0xLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgJnNx
bGl0ZV91bmJhc2U2NF9mbiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIE5VTEwpID09
IDApOwoKICBJKHNxbGl0ZV9jcmVhdGVfYWdncmVnYXRlKHNxbCgpLCAidHJ1c3RlZCIsIDgs
IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJnRydXN0ZWRfc3RlcF9jYWxsYmFjaywK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICZ0cnVzdGVkX2ZpbmFsaXplX2NhbGxiYWNr
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwKSA9PSAwKTsKfQoKdm9pZApkYXRh
YmFzZTo6aW5zdGFsbF92aWV3cygpCnsKICAvLyBkZWxldGUgYW55IGV4aXN0aW5nIHZpZXdz
CiAgcmVzdWx0cyByZXM7CiAgZmV0Y2gocmVzLCBvbmVfY29sLCBhbnlfcm93cywKICAgICAg
ICAiU0VMRUNUIG5hbWUgRlJPTSBzcWxpdGVfbWFzdGVyIFdIRVJFIHR5cGU9J3ZpZXcnIik7
CiAgZm9yIChzaXplX3QgaSA9IDA7IGkgPCByZXMuc2l6ZSgpOyArK2kpCiAgICB7CiAgICAg
IGV4ZWN1dGUoIkRST1AgVklFVyAnJXEnIiwgcmVzW2ldWzBdLmNfc3RyKCkpOwogICAgfQog
IC8vIHJlZ2lzdGVyIGFueSB2aWV3cyB3ZSdyZSBnb2luZyB0byB1c2UKICBleGVjdXRlKHZp
ZXdzX2NvbnN0YW50KTsKfQoKdm9pZCAKZGF0YWJhc2U6OmdldF9oZWFkcyhiYXNlNjQ8Y2Vy
dF92YWx1ZT4gY29uc3QgJiBicmFuY2gsCiAgICAgICAgICAgICAgICAgICAgc3RkOjpzZXQ8
cmV2aXNpb25faWQ+ICYgaGVhZHMpCnsKICByZXN1bHRzIHJlczsKICBmZXRjaChyZXMsIG9u
ZV9jb2wsIGFueV9yb3dzLAogICAgICAgICJTRUxFQ1QgcGFyZW50ICIKICAgICAgICAiRlJP
TSBicmFuY2hfaGVhZHMgIgogICAgICAgICJXSEVSRSB2YWx1ZSA9ICclcSciLAogICAgICAg
IGJyYW5jaCgpLmNfc3RyKCkpOwogIGhlYWRzLmNsZWFyKCk7CiAgZm9yIChzaXplX3QgaSA9
IDA7IGkgPCByZXMuc2l6ZSgpOyArK2kpCiAgICB7CiAgICAgIGhlYWRzLmluc2VydChyZXZp
c2lvbl9pZChyZXNbaV1bMF0pKTsKICAgIH0KfQoKdm9pZCAKZGF0YWJhc2U6OmdldF9jZXJ0
cyhoZXhlbmM8aWQ+IGNvbnN0ICYgaWRlbnQsIAogICAgICAgICAgICAgICAgICAgIHZlY3Rv
cjxjZXJ0PiAmIGNlcnRzLCAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAg
ICAgICAgc3RyaW5nIGNvbnN0ICYgdGFibGUpCnsKICByZXN1bHRzIHJlczsKICBmZXRjaChy
ZXMsIDUsIGFueV9yb3dzLCAKICAgICAgICAiU0VMRUNUIGlkLCBuYW1lLCB2YWx1ZSwga2V5
cGFpciwgc2lnbmF0dXJlIEZST00gJyVxJyAiCiAgICAgICAgIldIRVJFIGlkID0gJyVxJyIs
IAogICAgICAgIHRhYmxlLmNfc3RyKCksICAKICAgICAgICBpZGVudCgpLmNfc3RyKCkpOwog
IHJlc3VsdHNfdG9fY2VydHMocmVzLCBjZXJ0cyk7Cn0KCgp2b2lkIApkYXRhYmFzZTo6Z2V0
X2NlcnRzKGNlcnRfbmFtZSBjb25zdCAmIG5hbWUsICAgICAgICAgICAKICAgICAgICAgICAg
ICAgICAgICB2ZWN0b3I8Y2VydD4gJiBjZXJ0cywKICAgICAgICAgICAgICAgICAgICBzdHJp
bmcgY29uc3QgJiB0YWJsZSkKewogIHJlc3VsdHMgcmVzOwogIGZldGNoKHJlcywgNSwgYW55
X3Jvd3MsIAogICAgICAgICJTRUxFQ1QgaWQsIG5hbWUsIHZhbHVlLCBrZXlwYWlyLCBzaWdu
YXR1cmUgIgogICAgICAgICJGUk9NICclcScgV0hFUkUgbmFtZSA9ICclcSciLCAKICAgICAg
ICB0YWJsZS5jX3N0cigpLCAgCiAgICAgICAgbmFtZSgpLmNfc3RyKCkpOwogIHJlc3VsdHNf
dG9fY2VydHMocmVzLCBjZXJ0cyk7Cn0KCgp2b2lkIApkYXRhYmFzZTo6Z2V0X2NlcnRzKGhl
eGVuYzxpZD4gY29uc3QgJiBpZGVudCwgCiAgICAgICAgICAgICAgICAgICAgY2VydF9uYW1l
IGNvbnN0ICYgbmFtZSwgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHZlY3Rvcjxj
ZXJ0PiAmIGNlcnRzLAogICAgICAgICAgICAgICAgICAgIHN0cmluZyBjb25zdCAmIHRhYmxl
KQp7CiAgcmVzdWx0cyByZXM7CiAgZmV0Y2gocmVzLCA1LCBhbnlfcm93cywgCiAgICAgICAg
IlNFTEVDVCBpZCwgbmFtZSwgdmFsdWUsIGtleXBhaXIsIHNpZ25hdHVyZSAiCiAgICAgICAg
IkZST00gJyVxJyAiCiAgICAgICAgIldIRVJFIGlkID0gJyVxJyBBTkQgbmFtZSA9ICclcSci
LCAKICAgICAgICB0YWJsZS5jX3N0cigpLCAgCiAgICAgICAgaWRlbnQoKS5jX3N0cigpLAog
ICAgICAgIG5hbWUoKS5jX3N0cigpKTsKICByZXN1bHRzX3RvX2NlcnRzKHJlcywgY2VydHMp
Owp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X2NlcnRzKGNlcnRfbmFtZSBjb25zdCAmIG5hbWUs
CiAgICAgICAgICAgICAgICAgICAgYmFzZTY0PGNlcnRfdmFsdWU+IGNvbnN0ICYgdmFsLCAK
ICAgICAgICAgICAgICAgICAgICB2ZWN0b3I8Y2VydD4gJiBjZXJ0cywKICAgICAgICAgICAg
ICAgICAgICBzdHJpbmcgY29uc3QgJiB0YWJsZSkKewogIHJlc3VsdHMgcmVzOwogIGZldGNo
KHJlcywgNSwgYW55X3Jvd3MsIAogICAgICAgICJTRUxFQ1QgaWQsIG5hbWUsIHZhbHVlLCBr
ZXlwYWlyLCBzaWduYXR1cmUgIgogICAgICAgICJGUk9NICclcScgIgogICAgICAgICJXSEVS
RSBuYW1lID0gJyVxJyBBTkQgdmFsdWUgPSAnJXEnIiwgCiAgICAgICAgdGFibGUuY19zdHIo
KSwgIAogICAgICAgIG5hbWUoKS5jX3N0cigpLAogICAgICAgIHZhbCgpLmNfc3RyKCkpOwog
IHJlc3VsdHNfdG9fY2VydHMocmVzLCBjZXJ0cyk7Cn0KCgp2b2lkIApkYXRhYmFzZTo6Z2V0
X2NlcnRzKGhleGVuYzxpZD4gY29uc3QgJiBpZGVudCwgCiAgICAgICAgICAgICAgICAgICAg
Y2VydF9uYW1lIGNvbnN0ICYgbmFtZSwgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAg
IGJhc2U2NDxjZXJ0X3ZhbHVlPiBjb25zdCAmIHZhbHVlLAogICAgICAgICAgICAgICAgICAg
IHZlY3RvcjxjZXJ0PiAmIGNlcnRzLAogICAgICAgICAgICAgICAgICAgIHN0cmluZyBjb25z
dCAmIHRhYmxlKQp7CiAgcmVzdWx0cyByZXM7CiAgZmV0Y2gocmVzLCA1LCBhbnlfcm93cywg
CiAgICAgICAgIlNFTEVDVCBpZCwgbmFtZSwgdmFsdWUsIGtleXBhaXIsIHNpZ25hdHVyZSAi
CiAgICAgICAgIkZST00gJyVxJyAiCiAgICAgICAgIldIRVJFIGlkID0gJyVxJyBBTkQgbmFt
ZSA9ICclcScgQU5EIHZhbHVlID0gJyVxJyIsIAogICAgICAgIHRhYmxlLmNfc3RyKCksICAK
ICAgICAgICBpZGVudCgpLmNfc3RyKCksCiAgICAgICAgbmFtZSgpLmNfc3RyKCksCiAgICAg
ICAgdmFsdWUoKS5jX3N0cigpKTsKICByZXN1bHRzX3RvX2NlcnRzKHJlcywgY2VydHMpOwp9
CgoKCmJvb2wgCmRhdGFiYXNlOjpyZXZpc2lvbl9jZXJ0X2V4aXN0cyhyZXZpc2lvbjxjZXJ0
PiBjb25zdCAmIGNlcnQpCnsgCiAgcmV0dXJuIGNlcnRfZXhpc3RzKGNlcnQuaW5uZXIoKSwg
InJldmlzaW9uX2NlcnRzIik7IAp9Cgpib29sIApkYXRhYmFzZTo6bWFuaWZlc3RfY2VydF9l
eGlzdHMobWFuaWZlc3Q8Y2VydD4gY29uc3QgJiBjZXJ0KQp7IAogIHJldHVybiBjZXJ0X2V4
aXN0cyhjZXJ0LmlubmVyKCksICJtYW5pZmVzdF9jZXJ0cyIpOyAKfQoKYm9vbCAKZGF0YWJh
c2U6OmZpbGVfY2VydF9leGlzdHMoZmlsZTxjZXJ0PiBjb25zdCAmIGNlcnQpCnsgCiAgcmV0
dXJuIGNlcnRfZXhpc3RzKGNlcnQuaW5uZXIoKSwgImZpbGVfY2VydHMiKTsgCn0KCnZvaWQg
CmRhdGFiYXNlOjpwdXRfbWFuaWZlc3RfY2VydChtYW5pZmVzdDxjZXJ0PiBjb25zdCAmIGNl
cnQpCnsgCiAgcHV0X2NlcnQoY2VydC5pbm5lcigpLCAibWFuaWZlc3RfY2VydHMiKTsgCn0K
CnZvaWQgCmRhdGFiYXNlOjpwdXRfcmV2aXNpb25fY2VydChyZXZpc2lvbjxjZXJ0PiBjb25z
dCAmIGNlcnQpCnsgCiAgcHV0X2NlcnQoY2VydC5pbm5lcigpLCAicmV2aXNpb25fY2VydHMi
KTsgCn0KCnZvaWQgCmRhdGFiYXNlOjpwdXRfZmlsZV9jZXJ0KGZpbGU8Y2VydD4gY29uc3Qg
JiBjZXJ0KQp7IAogIHB1dF9jZXJ0KGNlcnQuaW5uZXIoKSwgImZpbGVfY2VydHMiKTsgCn0K
CnZvaWQgCmRhdGFiYXNlOjpnZXRfZmlsZV9jZXJ0cyhjZXJ0X25hbWUgY29uc3QgJiBuYW1l
LCAKICAgICAgICAgICAgICAgICAgICAgICAgIHZlY3RvcjwgZmlsZTxjZXJ0PiA+ICYgdHMp
CnsKICB2ZWN0b3I8Y2VydD4gY2VydHM7CiAgZ2V0X2NlcnRzKG5hbWUsIGNlcnRzLCAiZmls
ZV9jZXJ0cyIpOwogIHRzLmNsZWFyKCk7CiAgY29weShjZXJ0cy5iZWdpbigpLCBjZXJ0cy5l
bmQoKSwgYmFja19pbnNlcnRlcih0cykpOyAgCn0KCnZvaWQgCmRhdGFiYXNlOjpnZXRfZmls
ZV9jZXJ0cyhmaWxlX2lkIGNvbnN0ICYgaWQsIAogICAgICAgICAgICAgICAgICAgICAgICAg
Y2VydF9uYW1lIGNvbnN0ICYgbmFtZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICB2ZWN0
b3I8IGZpbGU8Y2VydD4gPiAmIHRzKQp7CiAgdmVjdG9yPGNlcnQ+IGNlcnRzOwogIGdldF9j
ZXJ0cyhpZC5pbm5lcigpLCBuYW1lLCBjZXJ0cywgImZpbGVfY2VydHMiKTsKICB0cy5jbGVh
cigpOwogIGNvcHkoY2VydHMuYmVnaW4oKSwgY2VydHMuZW5kKCksIGJhY2tfaW5zZXJ0ZXIo
dHMpKTsgICAgCn0KCnZvaWQgCmRhdGFiYXNlOjpnZXRfZmlsZV9jZXJ0cyhjZXJ0X25hbWUg
Y29uc3QgJiBuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgYmFzZTY0PGNlcnRfdmFs
dWU+IGNvbnN0ICYgdmFsLCAKICAgICAgICAgICAgICAgICAgICAgICAgIHZlY3RvcjwgZmls
ZTxjZXJ0PiA+ICYgdHMpCnsKICB2ZWN0b3I8Y2VydD4gY2VydHM7CiAgZ2V0X2NlcnRzKG5h
bWUsIHZhbCwgY2VydHMsICJmaWxlX2NlcnRzIik7CiAgdHMuY2xlYXIoKTsKICBjb3B5KGNl
cnRzLmJlZ2luKCksIGNlcnRzLmVuZCgpLCBiYWNrX2luc2VydGVyKHRzKSk7ICAKfQoKdm9p
ZCAKZGF0YWJhc2U6OmdldF9maWxlX2NlcnRzKGZpbGVfaWQgY29uc3QgJiBpZCwgCiAgICAg
ICAgICAgICAgICAgICAgICAgICBjZXJ0X25hbWUgY29uc3QgJiBuYW1lLAogICAgICAgICAg
ICAgICAgICAgICAgICAgYmFzZTY0PGNlcnRfdmFsdWU+IGNvbnN0ICYgdmFsLCAKICAgICAg
ICAgICAgICAgICAgICAgICAgIHZlY3RvcjwgZmlsZTxjZXJ0PiA+ICYgdHMpCnsKICB2ZWN0
b3I8Y2VydD4gY2VydHM7CiAgZ2V0X2NlcnRzKGlkLmlubmVyKCksIG5hbWUsIHZhbCwgY2Vy
dHMsICJmaWxlX2NlcnRzIik7CiAgdHMuY2xlYXIoKTsKICBjb3B5KGNlcnRzLmJlZ2luKCks
IGNlcnRzLmVuZCgpLCBiYWNrX2luc2VydGVyKHRzKSk7ICAKfQoKdm9pZCAKZGF0YWJhc2U6
OmdldF9maWxlX2NlcnRzKGZpbGVfaWQgY29uc3QgJiBpZCwgCiAgICAgICAgICAgICAgICAg
ICAgICAgICB2ZWN0b3I8IGZpbGU8Y2VydD4gPiAmIHRzKQp7IAogIHZlY3RvcjxjZXJ0PiBj
ZXJ0czsKICBnZXRfY2VydHMoaWQuaW5uZXIoKSwgY2VydHMsICJmaWxlX2NlcnRzIik7IAog
IHRzLmNsZWFyKCk7CiAgY29weShjZXJ0cy5iZWdpbigpLCBjZXJ0cy5lbmQoKSwgYmFja19p
bnNlcnRlcih0cykpOwp9CgoKYm9vbCAKZGF0YWJhc2U6OmZpbGVfY2VydF9leGlzdHMoaGV4
ZW5jPGlkPiBjb25zdCAmIGhhc2gpCnsKICByZXN1bHRzIHJlczsKICB2ZWN0b3I8Y2VydD4g
Y2VydHM7CiAgZmV0Y2gocmVzLCBvbmVfY29sLCBhbnlfcm93cywgCiAgICAgICAgIlNFTEVD
VCBpZCAiCiAgICAgICAgIkZST00gZmlsZV9jZXJ0cyAiCiAgICAgICAgIldIRVJFIGhhc2gg
PSAnJXEnIiwgCiAgICAgICAgaGFzaCgpLmNfc3RyKCkpOwogIEkocmVzLnNpemUoKSA9PSAw
IHx8IHJlcy5zaXplKCkgPT0gMSk7CiAgcmV0dXJuIChyZXMuc2l6ZSgpID09IDEpOwp9Cgp2
b2lkIApkYXRhYmFzZTo6Z2V0X2ZpbGVfY2VydChoZXhlbmM8aWQ+IGNvbnN0ICYgaGFzaCwK
ICAgICAgICAgICAgICAgICAgICAgICAgZmlsZTxjZXJ0PiAmIGMpCnsKICByZXN1bHRzIHJl
czsKICB2ZWN0b3I8Y2VydD4gY2VydHM7CiAgZmV0Y2gocmVzLCA1LCBvbmVfcm93LCAKICAg
ICAgICAiU0VMRUNUIGlkLCBuYW1lLCB2YWx1ZSwga2V5cGFpciwgc2lnbmF0dXJlICIKICAg
ICAgICAiRlJPTSBmaWxlX2NlcnRzICIKICAgICAgICAiV0hFUkUgaGFzaCA9ICclcSciLCAK
ICAgICAgICBoYXNoKCkuY19zdHIoKSk7CiAgcmVzdWx0c190b19jZXJ0cyhyZXMsIGNlcnRz
KTsKICBJKGNlcnRzLnNpemUoKSA9PSAxKTsKICBjID0gZmlsZTxjZXJ0PihjZXJ0c1swXSk7
Cn0KCgoKdm9pZCAKZGF0YWJhc2U6OmdldF9yZXZpc2lvbl9jZXJ0cyhjZXJ0X25hbWUgY29u
c3QgJiBuYW1lLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlY3RvcjwgcmV2aXNp
b248Y2VydD4gPiAmIHRzKQp7CiAgdmVjdG9yPGNlcnQ+IGNlcnRzOwogIGdldF9jZXJ0cyhu
YW1lLCBjZXJ0cywgInJldmlzaW9uX2NlcnRzIik7CiAgdHMuY2xlYXIoKTsKICBjb3B5KGNl
cnRzLmJlZ2luKCksIGNlcnRzLmVuZCgpLCBiYWNrX2luc2VydGVyKHRzKSk7ICAKfQoKdm9p
ZCAKZGF0YWJhc2U6OmdldF9yZXZpc2lvbl9jZXJ0cyhyZXZpc2lvbl9pZCBjb25zdCAmIGlk
LCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlcnRfbmFtZSBjb25zdCAmIG5hbWUs
IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVjdG9yPCByZXZpc2lvbjxjZXJ0PiA+
ICYgdHMpCnsKICB2ZWN0b3I8Y2VydD4gY2VydHM7CiAgZ2V0X2NlcnRzKGlkLmlubmVyKCks
IG5hbWUsIGNlcnRzLCAicmV2aXNpb25fY2VydHMiKTsKICB0cy5jbGVhcigpOwogIGNvcHko
Y2VydHMuYmVnaW4oKSwgY2VydHMuZW5kKCksIGJhY2tfaW5zZXJ0ZXIodHMpKTsgIAp9Cgp2
b2lkIApkYXRhYmFzZTo6Z2V0X3JldmlzaW9uX2NlcnRzKHJldmlzaW9uX2lkIGNvbnN0ICYg
aWQsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VydF9uYW1lIGNvbnN0ICYgbmFt
ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhc2U2NDxjZXJ0X3ZhbHVlPiBjb25z
dCAmIHZhbCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZWN0b3I8IHJldmlzaW9u
PGNlcnQ+ID4gJiB0cykKewogIHZlY3RvcjxjZXJ0PiBjZXJ0czsKICBnZXRfY2VydHMoaWQu
aW5uZXIoKSwgbmFtZSwgdmFsLCBjZXJ0cywgInJldmlzaW9uX2NlcnRzIik7CiAgdHMuY2xl
YXIoKTsKICBjb3B5KGNlcnRzLmJlZ2luKCksIGNlcnRzLmVuZCgpLCBiYWNrX2luc2VydGVy
KHRzKSk7ICAKfQoKdm9pZCAKZGF0YWJhc2U6OmdldF9yZXZpc2lvbl9jZXJ0cyhjZXJ0X25h
bWUgY29uc3QgJiBuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFzZTY0PGNl
cnRfdmFsdWU+IGNvbnN0ICYgdmFsLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZl
Y3RvcjwgcmV2aXNpb248Y2VydD4gPiAmIHRzKQp7CiAgdmVjdG9yPGNlcnQ+IGNlcnRzOwog
IGdldF9jZXJ0cyhuYW1lLCB2YWwsIGNlcnRzLCAicmV2aXNpb25fY2VydHMiKTsKICB0cy5j
bGVhcigpOwogIGNvcHkoY2VydHMuYmVnaW4oKSwgY2VydHMuZW5kKCksIGJhY2tfaW5zZXJ0
ZXIodHMpKTsgIAp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X3JldmlzaW9uX2NlcnRzKHJldmlz
aW9uX2lkIGNvbnN0ICYgaWQsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVjdG9y
PCByZXZpc2lvbjxjZXJ0PiA+ICYgdHMpCnsgCiAgdmVjdG9yPGNlcnQ+IGNlcnRzOwogIGdl
dF9jZXJ0cyhpZC5pbm5lcigpLCBjZXJ0cywgInJldmlzaW9uX2NlcnRzIik7IAogIHRzLmNs
ZWFyKCk7CiAgY29weShjZXJ0cy5iZWdpbigpLCBjZXJ0cy5lbmQoKSwgYmFja19pbnNlcnRl
cih0cykpOwp9Cgp2b2lkIApkYXRhYmFzZTo6Z2V0X3JldmlzaW9uX2NlcnQoaGV4ZW5jPGlk
PiBjb25zdCAmIGhhc2gsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldmlzaW9uPGNl
cnQ+ICYgYykKewogIHJlc3VsdHMgcmVzOwogIHZlY3RvcjxjZXJ0PiBjZXJ0czsKICBmZXRj
aChyZXMsIDUsIG9uZV9yb3csIAogICAgICAgICJTRUxFQ1QgaWQsIG5hbWUsIHZhbHVlLCBr
ZXlwYWlyLCBzaWduYXR1cmUgIgogICAgICAgICJGUk9NIHJldmlzaW9uX2NlcnRzICIKICAg
ICAgICAiV0hFUkUgaGFzaCA9ICclcSciLCAKICAgICAgICBoYXNoKCkuY19zdHIoKSk7CiAg
cmVzdWx0c190b19jZXJ0cyhyZXMsIGNlcnRzKTsKICBJKGNlcnRzLnNpemUoKSA9PSAxKTsK
ICBjID0gcmV2aXNpb248Y2VydD4oY2VydHNbMF0pOwp9Cgpib29sIApkYXRhYmFzZTo6cmV2
aXNpb25fY2VydF9leGlzdHMoaGV4ZW5jPGlkPiBjb25zdCAmIGhhc2gpCnsKICByZXN1bHRz
IHJlczsKICB2ZWN0b3I8Y2VydD4gY2VydHM7CiAgZmV0Y2gocmVzLCBvbmVfY29sLCBhbnlf
cm93cywgCiAgICAgICAgIlNFTEVDVCBpZCAiCiAgICAgICAgIkZST00gcmV2aXNpb25fY2Vy
dHMgIgogICAgICAgICJXSEVSRSBoYXNoID0gJyVxJyIsIAogICAgICAgIGhhc2goKS5jX3N0
cigpKTsKICBJKHJlcy5zaXplKCkgPT0gMCB8fCByZXMuc2l6ZSgpID09IDEpOwogIHJldHVy
biAocmVzLnNpemUoKSA9PSAxKTsKfQoKYm9vbCAKZGF0YWJhc2U6Om1hbmlmZXN0X2NlcnRf
ZXhpc3RzKGhleGVuYzxpZD4gY29uc3QgJiBoYXNoKQp7CiAgcmVzdWx0cyByZXM7CiAgdmVj
dG9yPGNlcnQ+IGNlcnRzOwogIGZldGNoKHJlcywgb25lX2NvbCwgYW55X3Jvd3MsIAogICAg
ICAgICJTRUxFQ1QgaWQgIgogICAgICAgICJGUk9NIG1hbmlmZXN0X2NlcnRzICIKICAgICAg
ICAiV0hFUkUgaGFzaCA9ICclcSciLCAKICAgICAgICBoYXNoKCkuY19zdHIoKSk7CiAgSShy
ZXMuc2l6ZSgpID09IDAgfHwgcmVzLnNpemUoKSA9PSAxKTsKICByZXR1cm4gKHJlcy5zaXpl
KCkgPT0gMSk7Cn0KCnZvaWQgCmRhdGFiYXNlOjpnZXRfbWFuaWZlc3RfY2VydChoZXhlbmM8
aWQ+IGNvbnN0ICYgaGFzaCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hbmlmZXN0
PGNlcnQ+ICYgYykKewogIHJlc3VsdHMgcmVzOwogIHZlY3RvcjxjZXJ0PiBjZXJ0czsKICBm
ZXRjaChyZXMsIDUsIG9uZV9yb3csIAogICAgICAgICJTRUxFQ1QgaWQsIG5hbWUsIHZhbHVl
LCBrZXlwYWlyLCBzaWduYXR1cmUgIgogICAgICAgICJGUk9NIG1hbmlmZXN0X2NlcnRzICIK
ICAgICAgICAiV0hFUkUgaGFzaCA9ICclcSciLCAKICAgICAgICBoYXNoKCkuY19zdHIoKSk7
CiAgcmVzdWx0c190b19jZXJ0cyhyZXMsIGNlcnRzKTsKICBJKGNlcnRzLnNpemUoKSA9PSAx
KTsKICBjID0gbWFuaWZlc3Q8Y2VydD4oY2VydHNbMF0pOwp9Cgp2b2lkIApkYXRhYmFzZTo6
Z2V0X21hbmlmZXN0X2NlcnRzKG1hbmlmZXN0X2lkIGNvbnN0ICYgaWQsIAogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHZlY3RvcjwgbWFuaWZlc3Q8Y2VydD4gPiAmIHRzKQp7IAog
IHZlY3RvcjxjZXJ0PiBjZXJ0czsKICBnZXRfY2VydHMoaWQuaW5uZXIoKSwgY2VydHMsICJt
YW5pZmVzdF9jZXJ0cyIpOyAKICB0cy5jbGVhcigpOwogIGNvcHkoY2VydHMuYmVnaW4oKSwg
Y2VydHMuZW5kKCksIGJhY2tfaW5zZXJ0ZXIodHMpKTsKfQoKCnZvaWQgCmRhdGFiYXNlOjpn
ZXRfbWFuaWZlc3RfY2VydHMoY2VydF9uYW1lIGNvbnN0ICYgbmFtZSwgCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICB2ZWN0b3I8IG1hbmlmZXN0PGNlcnQ+ID4gJiB0cykKewogIHZl
Y3RvcjxjZXJ0PiBjZXJ0czsKICBnZXRfY2VydHMobmFtZSwgY2VydHMsICJtYW5pZmVzdF9j
ZXJ0cyIpOwogIHRzLmNsZWFyKCk7CiAgY29weShjZXJ0cy5iZWdpbigpLCBjZXJ0cy5lbmQo
KSwgYmFja19pbnNlcnRlcih0cykpOyAgCn0KCnZvaWQgCmRhdGFiYXNlOjpnZXRfbWFuaWZl
c3RfY2VydHMobWFuaWZlc3RfaWQgY29uc3QgJiBpZCwgCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgY2VydF9uYW1lIGNvbnN0ICYgbmFtZSwgCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgdmVjdG9yPCBtYW5pZmVzdDxjZXJ0PiA+ICYgdHMpCnsKICB2ZWN0b3I8Y2Vy
dD4gY2VydHM7CiAgZ2V0X2NlcnRzKGlkLmlubmVyKCksIG5hbWUsIGNlcnRzLCAibWFuaWZl
c3RfY2VydHMiKTsKICB0cy5jbGVhcigpOwogIGNvcHkoY2VydHMuYmVnaW4oKSwgY2VydHMu
ZW5kKCksIGJhY2tfaW5zZXJ0ZXIodHMpKTsgIAp9CgoKLy8gY29tcGxldGlvbnMKdm9pZCAK
ZGF0YWJhc2U6OmNvbXBsZXRlKHN0cmluZyBjb25zdCAmIHBhcnRpYWwsCiAgICAgICAgICAg
ICAgICAgICBzZXQ8cmV2aXNpb25faWQ+ICYgY29tcGxldGlvbnMpCnsKICByZXN1bHRzIHJl
czsKICBjb21wbGV0aW9ucy5jbGVhcigpOwoKICBmZXRjaChyZXMsIDEsIGFueV9yb3dzLAog
ICAgICAgICJTRUxFQ1QgaWQgRlJPTSByZXZpc2lvbnMgV0hFUkUgaWQgR0xPQiAnJXEqJyIs
CiAgICAgICAgcGFydGlhbC5jX3N0cigpKTsKCiAgZm9yIChzaXplX3QgaSA9IDA7IGkgPCBy
ZXMuc2l6ZSgpOyArK2kpCiAgICBjb21wbGV0aW9ucy5pbnNlcnQocmV2aXNpb25faWQocmVz
W2ldWzBdKSk7ICAKfQoKCnZvaWQgCmRhdGFiYXNlOjpjb21wbGV0ZShzdHJpbmcgY29uc3Qg
JiBwYXJ0aWFsLAogICAgICAgICAgICAgICAgICAgc2V0PG1hbmlmZXN0X2lkPiAmIGNvbXBs
ZXRpb25zKQp7CiAgcmVzdWx0cyByZXM7CiAgY29tcGxldGlvbnMuY2xlYXIoKTsKCiAgZmV0
Y2gocmVzLCAxLCBhbnlfcm93cywKICAgICAgICAiU0VMRUNUIGlkIEZST00gbWFuaWZlc3Rz
IFdIRVJFIGlkIEdMT0IgJyVxKiciLAogICAgICAgIHBhcnRpYWwuY19zdHIoKSk7CgogIGZv
ciAoc2l6ZV90IGkgPSAwOyBpIDwgcmVzLnNpemUoKTsgKytpKQogICAgY29tcGxldGlvbnMu
aW5zZXJ0KG1hbmlmZXN0X2lkKHJlc1tpXVswXSkpOyAgCiAgCiAgcmVzLmNsZWFyKCk7Cgog
IGZldGNoKHJlcywgMSwgYW55X3Jvd3MsCiAgICAgICAgIlNFTEVDVCBpZCBGUk9NIG1hbmlm
ZXN0X2RlbHRhcyBXSEVSRSBpZCBHTE9CICclcSonIiwKICAgICAgICBwYXJ0aWFsLmNfc3Ry
KCkpOwoKICBmb3IgKHNpemVfdCBpID0gMDsgaSA8IHJlcy5zaXplKCk7ICsraSkKICAgIGNv
bXBsZXRpb25zLmluc2VydChtYW5pZmVzdF9pZChyZXNbaV1bMF0pKTsgIAp9Cgp2b2lkIApk
YXRhYmFzZTo6Y29tcGxldGUoc3RyaW5nIGNvbnN0ICYgcGFydGlhbCwKICAgICAgICAgICAg
ICAgICAgIHNldDxmaWxlX2lkPiAmIGNvbXBsZXRpb25zKQp7CiAgcmVzdWx0cyByZXM7CiAg
Y29tcGxldGlvbnMuY2xlYXIoKTsKCiAgZmV0Y2gocmVzLCAxLCBhbnlfcm93cywKICAgICAg
ICAiU0VMRUNUIGlkIEZST00gZmlsZXMgV0hFUkUgaWQgR0xPQiAnJXEqJyIsCiAgICAgICAg
cGFydGlhbC5jX3N0cigpKTsKCiAgZm9yIChzaXplX3QgaSA9IDA7IGkgPCByZXMuc2l6ZSgp
OyArK2kpCiAgICBjb21wbGV0aW9ucy5pbnNlcnQoZmlsZV9pZChyZXNbaV1bMF0pKTsgIAog
IAogIHJlcy5jbGVhcigpOwoKICBmZXRjaChyZXMsIDEsIGFueV9yb3dzLAogICAgICAgICJT
RUxFQ1QgaWQgRlJPTSBmaWxlX2RlbHRhcyBXSEVSRSBpZCBHTE9CICclcSonIiwKICAgICAg
ICBwYXJ0aWFsLmNfc3RyKCkpOwoKICBmb3IgKHNpemVfdCBpID0gMDsgaSA8IHJlcy5zaXpl
KCk7ICsraSkKICAgIGNvbXBsZXRpb25zLmluc2VydChmaWxlX2lkKHJlc1tpXVswXSkpOyAg
Cn0KCnVzaW5nIGNvbW1hbmRzOjpzZWxlY3Rvcl90eXBlOwoKc3RhdGljIHZvaWQgc2VsZWN0
b3JfdG9fY2VydG5hbWUoc2VsZWN0b3JfdHlwZSB0eSwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgc3RyaW5nICYgcykKewogIHN3aXRjaCAodHkpCiAgICB7CiAgICBjYXNl
IGNvbW1hbmRzOjpzZWxfYXV0aG9yOgogICAgICBzID0gYXV0aG9yX2NlcnRfbmFtZTsKICAg
ICAgYnJlYWs7CiAgICBjYXNlIGNvbW1hbmRzOjpzZWxfYnJhbmNoOgogICAgICBzID0gYnJh
bmNoX2NlcnRfbmFtZTsKICAgICAgYnJlYWs7CiAgICBjYXNlIGNvbW1hbmRzOjpzZWxfZGF0
ZToKICAgICAgcyA9IGRhdGVfY2VydF9uYW1lOwogICAgICBicmVhazsKICAgIGNhc2UgY29t
bWFuZHM6OnNlbF90YWc6CiAgICAgIHMgPSB0YWdfY2VydF9uYW1lOwogICAgICBicmVhazsK
ICAgIGNhc2UgY29tbWFuZHM6OnNlbF9pZGVudDoKICAgIGNhc2UgY29tbWFuZHM6OnNlbF91
bmtub3duOgogICAgICBJKGZhbHNlKTsgLy8gZG9uJ3QgZG8gdGhpcy4KICAgICAgYnJlYWs7
CiAgICB9Cn0KCnZvaWQgZGF0YWJhc2U6OmNvbXBsZXRlKHNlbGVjdG9yX3R5cGUgdHksCiAg
ICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBjb25zdCAmIHBhcnRpYWwsCiAgICAgICAg
ICAgICAgICAgICAgICAgIHZlY3RvcjxwYWlyPHNlbGVjdG9yX3R5cGUsIHN0cmluZz4gPiBj
b25zdCAmIGxpbWl0LAogICAgICAgICAgICAgICAgICAgICAgICBzZXQ8c3RyaW5nPiAmIGNv
bXBsZXRpb25zKQp7CiAgY29tcGxldGlvbnMuY2xlYXIoKTsKCiAgLy8gc3RlcCAxOiB0aGUg
bGltaXQgaXMgdHJhbnNmb3JtZWQgaW50byBhbiBTUUwgc2VsZWN0IHN0YXRlbWVudCB3aGlj
aAogIC8vIHNlbGVjdHMgYSBzZXQgb2YgSURzIGZyb20gdGhlIG1hbmlmZXN0X2NlcnRzIHRh
YmxlIHdoaWNoIG1hdGNoIHRoZQogIC8vIGxpbWl0LiAgdGhpcyBpcyBkb25lIGJ5IGJ1aWxk
aW5nIGFuIFNRTCBzZWxlY3Qgc3RhdGVtZW50IGZvciBlYWNoIHRlcm0KICAvLyBpbiB0aGUg
bGltaXQgYW5kIHRoZW4gSU5URVJTRUNUaW5nIHRoZW0gYWxsLgoKICBzdHJpbmcgbGltID0g
IigiOwogIGJvb2wgZmlyc3RfbGltaXQgPSB0cnVlOwogIGZvciAodmVjdG9yPHBhaXI8c2Vs
ZWN0b3JfdHlwZSwgc3RyaW5nPiA+Ojpjb25zdF9pdGVyYXRvciBpID0gbGltaXQuYmVnaW4o
KTsKICAgICAgIGkgIT0gbGltaXQuZW5kKCk7ICsraSkKICAgIHsKICAgICAgaWYgKGZpcnN0
X2xpbWl0KQogICAgICAgIGZpcnN0X2xpbWl0ID0gZmFsc2U7CiAgICAgIGVsc2UKICAgICAg
ICBsaW0gKz0gIiBJTlRFUlNFQ1QgIjsKICAgICAgCiAgICAgIGlmIChpLT5maXJzdCA9PSBj
b21tYW5kczo6c2VsX2lkZW50KQogICAgICAgIHsKICAgICAgICAgIGxpbSArPSAiU0VMRUNU
IGlkIEZST00gcmV2aXNpb25fY2VydHMgIjsKICAgICAgICAgIGxpbSArPSAoRigiV0hFUkUg
aWQgR0xPQiAnJXMqJyIpIAogICAgICAgICAgICAgICAgICAlIGktPnNlY29uZCkuc3RyKCk7
CiAgICAgICAgfQogICAgICBlbHNlIGlmIChpLT5maXJzdCA9PSBjb21tYW5kczo6c2VsX3Vu
a25vd24pCiAgICAgICAgewogICAgICAgICAgbGltICs9ICJTRUxFQ1QgaWQgRlJPTSByZXZp
c2lvbl9jZXJ0cyAiOwogICAgICAgICAgbGltICs9IChGKCIgV0hFUkUgKG5hbWU9JyVzJyBP
UiBuYW1lPSclcycgT1IgbmFtZT0nJXMnKSIpCiAgICAgICAgICAgICAgICAgICUgYXV0aG9y
X2NlcnRfbmFtZSAKICAgICAgICAgICAgICAgICAgJSB0YWdfY2VydF9uYW1lIAogICAgICAg
ICAgICAgICAgICAlIGJyYW5jaF9jZXJ0X25hbWUpLnN0cigpOwogICAgICAgICAgbGltICs9
IChGKCIgQU5EIHVuYmFzZTY0KHZhbHVlKSBnbG9iICcqJXMqJyIpCiAgICAgICAgICAgICAg
ICAgICUgaS0+c2Vjb25kKS5zdHIoKTsgICAgIAogICAgICAgIH0KICAgICAgZWxzZQogICAg
ICAgIHsKICAgICAgICAgIHN0cmluZyBjZXJ0bmFtZTsKICAgICAgICAgIHNlbGVjdG9yX3Rv
X2NlcnRuYW1lKGktPmZpcnN0LCBjZXJ0bmFtZSk7CiAgICAgICAgICBsaW0gKz0gIlNFTEVD
VCBpZCBGUk9NIHJldmlzaW9uX2NlcnRzICI7CiAgICAgICAgICBsaW0gKz0gKEYoIldIRVJF
IG5hbWU9JyVzJyBBTkQgdW5iYXNlNjQodmFsdWUpIGdsb2IgJyolcyonIikKICAgICAgICAg
ICAgICAgICAgJSBjZXJ0bmFtZSAlIGktPnNlY29uZCkuc3RyKCk7CiAgICAgICAgfQogICAg
fQogIGxpbSArPSAiKSI7CiAgCiAgLy8gc3RlcCAyOiBkZXBlbmRpbmcgb24gd2hhdCB3ZSd2
ZSBiZWVuIGFza2VkIHRvIGRpc2FtYmlndWF0ZSwgd2UKICAvLyB3aWxsIGNvbXBsZXRlIGVp
dGhlciBzb21lIGlkZW50cywgb3IgY2VydCB2YWx1ZXMsIG9yICJ1bmtub3duIgogIC8vIHdo
aWNoIGdlbmVyYWxseSBtZWFucyAiYXV0aG9yLCB0YWcgb3IgYnJhbmNoIgoKICBzdHJpbmcg
cXVlcnk7CiAgaWYgKHR5ID09IGNvbW1hbmRzOjpzZWxfaWRlbnQpCiAgICB7CiAgICAgIHF1
ZXJ5ID0gKEYoIlNFTEVDVCBpZCBGUk9NICVzIikgJSBsaW0pLnN0cigpOwogICAgfQogIGVs
c2UgCiAgICB7CiAgICAgIHF1ZXJ5ID0gIlNFTEVDVCB2YWx1ZSBGUk9NIHJldmlzaW9uX2Nl
cnRzIFdIRVJFIjsKICAgICAgaWYgKHR5ID09IGNvbW1hbmRzOjpzZWxfdW5rbm93bikKICAg
ICAgICB7ICAgICAgICAgICAgICAgCiAgICAgICAgICBxdWVyeSArPSAKICAgICAgICAgICAg
KEYoIiAobmFtZT0nJXMnIE9SIG5hbWU9JyVzJyBPUiBuYW1lPSclcycpIikKICAgICAgICAg
ICAgICUgYXV0aG9yX2NlcnRfbmFtZSAKICAgICAgICAgICAgICUgdGFnX2NlcnRfbmFtZSAK
ICAgICAgICAgICAgICUgYnJhbmNoX2NlcnRfbmFtZSkuc3RyKCk7CiAgICAgICAgfQogICAg
ICBlbHNlCiAgICAgICAgewogICAgICAgICAgc3RyaW5nIGNlcnRuYW1lOwogICAgICAgICAg
c2VsZWN0b3JfdG9fY2VydG5hbWUodHksIGNlcnRuYW1lKTsKICAgICAgICAgIHF1ZXJ5ICs9
IAogICAgICAgICAgICAoRigiIChuYW1lPSclcycpIikgJSBjZXJ0bmFtZSkuc3RyKCk7CiAg
ICAgICAgfQogICAgICAgIAogICAgICBxdWVyeSArPSAoRigiIEFORCAodW5iYXNlNjQodmFs
dWUpIEdMT0IgJyolcyonKSIpICUgcGFydGlhbCkuc3RyKCk7CiAgICAgIHF1ZXJ5ICs9IChG
KCIgQU5EIChpZCBJTiAlcykiKSAlIGxpbSkuc3RyKCk7CiAgICB9CgogIHJlc3VsdHMgcmVz
OwogIGZldGNoKHJlcywgb25lX2NvbCwgYW55X3Jvd3MsIHF1ZXJ5LmNfc3RyKCkpOwogIGZv
ciAoc2l6ZV90IGkgPSAwOyBpIDwgcmVzLnNpemUoKTsgKytpKQogICAgewogICAgICBpZiAo
dHkgPT0gY29tbWFuZHM6OnNlbF9pZGVudCkKICAgICAgICBjb21wbGV0aW9ucy5pbnNlcnQo
cmVzW2ldWzBdKTsKICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgIGJhc2U2NDxkYXRh
PiByb3dfZW5jb2RlZChyZXNbaV1bMF0pOwogICAgICAgICAgZGF0YSByb3dfZGVjb2RlZDsK
ICAgICAgICAgIGRlY29kZV9iYXNlNjQocm93X2VuY29kZWQsIHJvd19kZWNvZGVkKTsKICAg
ICAgICAgIGNvbXBsZXRpb25zLmluc2VydChyb3dfZGVjb2RlZCgpKTsKICAgICAgICB9CiAg
ICB9Cn0KCgovLyBtZXJrbGUgbm9kZXMKCmJvb2wgCmRhdGFiYXNlOjptZXJrbGVfbm9kZV9l
eGlzdHMoc3RyaW5nIGNvbnN0ICYgdHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICB1dGY4IGNvbnN0ICYgY29sbGVjdGlvbiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgc2l6ZV90IGxldmVsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhleGVuYzxw
cmVmaXg+IGNvbnN0ICYgcHJlZml4KQp7CiAgcmVzdWx0cyByZXM7CiAgZmV0Y2gocmVzLCBv
bmVfY29sLCBvbmVfcm93LCAKICAgICAgICAiU0VMRUNUIENPVU5UKCopICIKICAgICAgICAi
RlJPTSBtZXJrbGVfbm9kZXMgIgogICAgICAgICJXSEVSRSB0eXBlID0gJyVxJyAiCiAgICAg
ICAgIkFORCBjb2xsZWN0aW9uID0gJyVxJyAiCiAgICAgICAgIkFORCBsZXZlbCA9ICVkICIK
ICAgICAgICAiQU5EIHByZWZpeCA9ICclcScgIiwKICAgICAgICB0eXBlLmNfc3RyKCksIGNv
bGxlY3Rpb24oKS5jX3N0cigpLCBsZXZlbCwgcHJlZml4KCkuY19zdHIoKSk7CiAgc2l6ZV90
IG5fbm9kZXMgPSBsZXhpY2FsX2Nhc3Q8c2l6ZV90PihyZXNbMF1bMF0pOwogIEkobl9ub2Rl
cyA9PSAwIHx8IG5fbm9kZXMgPT0gMSk7CiAgcmV0dXJuIG5fbm9kZXMgPT0gMTsKfQoKdm9p
ZCAKZGF0YWJhc2U6OmdldF9tZXJrbGVfbm9kZShzdHJpbmcgY29uc3QgJiB0eXBlLAogICAg
ICAgICAgICAgICAgICAgICAgICAgIHV0ZjggY29uc3QgJiBjb2xsZWN0aW9uLCAKICAgICAg
ICAgICAgICAgICAgICAgICAgICBzaXplX3QgbGV2ZWwsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgaGV4ZW5jPHByZWZpeD4gY29uc3QgJiBwcmVmaXgsCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgYmFzZTY0PG1lcmtsZT4gJiBub2RlKQp7CiAgcmVzdWx0cyByZXM7CiAgZmV0
Y2gocmVzLCBvbmVfY29sLCBvbmVfcm93LCAKICAgICAgICAiU0VMRUNUIGJvZHkgIgogICAg
ICAgICJGUk9NIG1lcmtsZV9ub2RlcyAiCiAgICAgICAgIldIRVJFIHR5cGUgPSAnJXEnICIK
ICAgICAgICAiQU5EIGNvbGxlY3Rpb24gPSAnJXEnICIKICAgICAgICAiQU5EIGxldmVsID0g
JWQgIgogICAgICAgICJBTkQgcHJlZml4ID0gJyVxJyIsCiAgICAgICAgdHlwZS5jX3N0cigp
LCBjb2xsZWN0aW9uKCkuY19zdHIoKSwgbGV2ZWwsIHByZWZpeCgpLmNfc3RyKCkpOwogIG5v
ZGUgPSByZXNbMF1bMF07Cn0KCnZvaWQgCmRhdGFiYXNlOjpwdXRfbWVya2xlX25vZGUoc3Ry
aW5nIGNvbnN0ICYgdHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICB1dGY4IGNvbnN0
ICYgY29sbGVjdGlvbiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZV90IGxldmVs
LAogICAgICAgICAgICAgICAgICAgICAgICAgIGhleGVuYzxwcmVmaXg+IGNvbnN0ICYgcHJl
Zml4LCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAg
ICAgICAgICAgICAgICAgIGJhc2U2NDxtZXJrbGU+IGNvbnN0ICYgbm9kZSkKewogIGV4ZWN1
dGUoIklOU0VSVCBPUiBSRVBMQUNFICIKICAgICAgICAgICJJTlRPIG1lcmtsZV9ub2RlcyAi
CiAgICAgICAgICAiVkFMVUVTICgnJXEnLCAnJXEnLCAlZCwgJyVxJywgJyVxJykiLAogICAg
ICAgICAgdHlwZS5jX3N0cigpLCBjb2xsZWN0aW9uKCkuY19zdHIoKSwgbGV2ZWwsIHByZWZp
eCgpLmNfc3RyKCksIG5vZGUoKS5jX3N0cigpKTsKfQoKdm9pZCAKZGF0YWJhc2U6OmVyYXNl
X21lcmtsZV9ub2RlcyhzdHJpbmcgY29uc3QgJiB0eXBlLAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHV0ZjggY29uc3QgJiBjb2xsZWN0aW9uKQp7CiAgZXhlY3V0ZSgiREVMRVRF
IEZST00gbWVya2xlX25vZGVzICIKICAgICAgICAgICJXSEVSRSB0eXBlID0gJyVxJyAiCiAg
ICAgICAgICAiQU5EIGNvbGxlY3Rpb24gPSAnJXEnIiwKICAgICAgICAgIHR5cGUuY19zdHIo
KSwgY29sbGVjdGlvbigpLmNfc3RyKCkpOwp9CgovLyB0cmFuc2FjdGlvbiBndWFyZHMKCnRy
YW5zYWN0aW9uX2d1YXJkOjp0cmFuc2FjdGlvbl9ndWFyZChkYXRhYmFzZSAmIGQpIDogY29t
bWl0dGVkKGZhbHNlKSwgZGIoZCkgCnsKICBkYi5iZWdpbl90cmFuc2FjdGlvbigpOwp9CnRy
YW5zYWN0aW9uX2d1YXJkOjp+dHJhbnNhY3Rpb25fZ3VhcmQoKQp7CiAgaWYgKGNvbW1pdHRl
ZCkKICAgIGRiLmNvbW1pdF90cmFuc2FjdGlvbigpOwogIGVsc2UKICAgIGRiLnJvbGxiYWNr
X3RyYW5zYWN0aW9uKCk7Cn0KCnZvaWQgCnRyYW5zYWN0aW9uX2d1YXJkOjpjb21taXQoKQp7
CiAgY29tbWl0dGVkID0gdHJ1ZTsKfQoK
])

UNB64(parent.b64, parent)
UNB64(left.b64, left)
UNB64(right.b64, right)
UNB64(correct.b64, correct)

AT_CHECK(cp -f parent testfile)
AT_CHECK(MONOTONE add testfile, [], [ignore], [ignore])
COMMIT(testbranch)
PARENT_SHA=`BASE_REVISION`

AT_CHECK(cp -f left testfile)
COMMIT(testbranch)

REVERT_TO($PARENT_SHA)

AT_CHECK(cp -f right testfile)
COMMIT(testbranch)

AT_CHECK(MONOTONE --branch=testbranch merge, [], [ignore], [ignore])

AT_CHECK(MONOTONE update, [], [ignore], [ignore])
AT_CHECK(cmp testfile correct)

AT_CHECK(false)

AT_CLEANUP