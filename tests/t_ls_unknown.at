#  -*- Autoconf -*-

AT_SETUP([listing unknown files in workspace])

MONOTONE_SETUP

# Buggy invariant causes failure when file with back slash in name exists
# in workspace.
AT_XFAIL_IF(test "$OSTYPE" != "msys")

AT_CHECK(MONOTONE ls missing, [0], [stdout], [ignore])
AT_CHECK(cmp /dev/null stdout, [], [ignore])

AT_CHECK(mkdir dir)
AT_DATA(dir/foo, [the foo file
])
AT_DATA(dir/bar, [the bar file
])
AT_DATA(dir/baz, [the baz file
])

AT_CHECK(MONOTONE add dir/baz, [], [ignore], [ignore])
AT_CHECK(MONOTONE --branch=testbranch commit --message='committed', [], [ignore], [ignore])

if test "$OSTYPE" != "msys"; then
AT_DATA(dir/back\\slash, [the file with a back slash in the name
])
AT_DATA(ls_foobar, [dir/back\\slash
dir/bar
dir/foo
])
else
AT_DATA(ls_foobar, [dir/bar
dir/foo
])
fi

AT_CHECK(MONOTONE ls unknown dir/ | sort, [], [stdout], [])
AT_CHECK(CANONICALISE(stdout))
AT_CHECK(cmp stdout ls_foobar, [], [ignore]) 

AT_CLEANUP
