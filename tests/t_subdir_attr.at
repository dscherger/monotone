#  -*- Autoconf -*-

AT_SETUP([attr command in subdirs])

MTN_SETUP

AT_CHECK(mkdir -p foo/bar, [], [ignore], [ignore])
AT_DATA(top, [top data
])
AT_DATA(foo/foodata, [foo data
])
AT_DATA(foo/bar/bardata, [foobar data
])

AT_CHECK(MTN add top foo, [], [ignore], [ignore])

# set attributes in directories

AT_CHECK( (cd foo; MTN attr set foodata test:test_attr true), [], [ignore], [ignore])
AT_CHECK( (cd foo/bar; MTN attr set bardata test:test_attr false), [], [ignore], [ignore])
AT_CHECK(MTN --branch=testbranch commit --message=blah-blah, [], [ignore], [ignore])
REV=`BASE_REVISION`

# see if they're right

AT_CHECK(MTN checkout --revision=$REV co-dir, [], [stdout])
AT_CHECK(grep "test:test_attr:foo/foodata:true" stdout, [], [ignore])
AT_CHECK(grep "test:test_attr:foo/bar/bardata:false" stdout, [], [ignore])

AT_CLEANUP
