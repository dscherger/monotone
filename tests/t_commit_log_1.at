# -*- Autoconf -*-

AT_SETUP([commit using _MTN/log])

MTN_SETUP

AT_DATA(commit_log.lua, [
function edit_comment(summary, user_log_file)
  return user_log_file
end
])

AT_DATA(_MTN/log, [Log entry
])

AT_DATA(input.txt, [version 0 of the file
])

AT_CHECK(MTN add input.txt, [], [ignore], [ignore])

AT_CHECK(MTN --branch=testbranch --rcfile=commit_log.lua commit, [], [ignore], [ignore])

TSHA=`BASE_REVISION`
AT_CHECK(test -f _MTN/log -a ! -s _MTN/log)
AT_CHECK(MTN ls certs $TSHA, [], [stdout], [ignore])
AT_CHECK(QGREP('Log entry' stdout), [])

AT_CLEANUP
