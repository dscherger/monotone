AT_SETUP([mtn:execute attr respects umask])
MTN_SETUP

NOT_ON_WIN32

# I don't know why this fails!  When I set umask 077 and check out
# this tree by hand, it works fine; when I run this test, though, then
# for some reason the foo file is checked out with permission 600!
AT_XFAIL_IF(true)

ADD_FILE(foo, [blah blah
])
ADD_FILE(bar, [blah blah
])
AT_CHECK(MTN attr set foo mtn:execute true)
COMMIT(testbranch)
R=`BASE_REVISION`

umask 077

# log
AT_CHECK(umask, [], [ignore], [ignore])
AT_CHECK(MTN co -r$R 077-co, [], [ignore], [ignore])
AT_CHECK(stat -c '%a' 077-co/foo, [], [700
])
AT_CHECK(stat -c '%a' 077-co/bar, [], [600
])

umask 577

# log
AT_CHECK(umask, [], [ignore], [ignore])
AT_CHECK(MTN co -r$R 577-co, [], [ignore], [ignore])
AT_CHECK(stat -c '%a' 577-co/foo, [], [200
])
AT_CHECK(stat -c '%a' 577-co/bar, [], [200
])

AT_CLEANUP
