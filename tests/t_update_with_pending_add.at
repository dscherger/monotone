#  -*- Autoconf -*-

AT_SETUP([update with pending add])
MONOTONE_SETUP

# This test relies on file-suturing
AT_XFAIL_IF(true)

ADD_FILE(file, [file
])

COMMIT(testbranch)

AT_CHECK(MONOTONE --branch testbranch co codir, [], [ignore], [ignore])

ADD_FILE(file3, [file3
])

COMMIT(testbranch)

AT_DATA(codir/file2, [file2
])

AT_CHECK(cd codir && MONOTONE add file2, [], [ignore], [ignore])
AT_CHECK(cd codir && MONOTONE update, [], [ignore], [ignore])

# make sure there are no changes in the workspace

AT_CHECK(test ! -e codir/MT/work, [], [ignore], [ignore])
AT_CHECK(cd codir && MONOTONE diff, [], [stdout], [ignore])
AT_CHECK(grep 'no changes' stdout, [], [ignore], [ignore])

AT_CLEANUP
