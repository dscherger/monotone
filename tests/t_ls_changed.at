#  -*- Autoconf -*-

AT_SETUP([listing changed files])

MTN_SETUP

AT_DATA(foo, [the foo file
])
AT_DATA(bar, [the bar file
])
AT_DATA(baz, [the baz file
])
AT_CHECK(MTN add foo bar baz, [], [ignore], [ignore])
AT_CHECK(MTN --branch=testbranch commit --message='First commit', [], [ignore], [ignore])

AT_CHECK(MTN ls changed, [], [stdout], [])
AT_CHECK(cmp stdout /dev/null, [], [ignore]) 

AT_CHECK(MTN drop foo, [], [ignore], [ignore])
AT_CHECK(MTN rename --execute bar bartender, [], [ignore], [ignore])
AT_CHECK(MTN ls changed, [], [stdout], [])
AT_CHECK(CANONICALISE(stdout))
AT_DATA(ls_foobar, [bar
foo
])
AT_CHECK(cmp stdout ls_foobar, [], [ignore]) 
AT_CHECK(MTN --branch=testbranch commit --message='Second commit', [], [ignore], [ignore])

AT_CHECK(MTN ls changed, [], [stdout], [])
AT_CHECK(cmp stdout /dev/null, [], [ignore]) 

AT_DATA(baz, [the baz file, modified
])
AT_CHECK(MTN ls changed, [], [stdout], [])
AT_CHECK(CANONICALISE(stdout))
AT_DATA(ls_baz, [baz
])
AT_CHECK(cmp stdout ls_baz, [], [ignore]) 
AT_CHECK(MTN --branch=testbranch commit --message='Third commit', [], [ignore], [ignore])

AT_CHECK(MTN ls changed, [], [stdout], [])
AT_CHECK(cmp stdout /dev/null, [], [ignore]) 

ADD_FILE(piano, [earplugs
])
AT_CHECK(mkdir guitar)
AT_CHECK(MTN add guitar, [], [ignore], [ignore])
AT_CHECK(MTN ls changed, [], [stdout], [])
AT_CHECK(CANONICALISE(stdout))
AT_DATA(ls_baz, [guitar
piano
])
AT_CHECK(cmp stdout ls_baz, [], [ignore]) 

COMMIT(testbranch)
AT_CHECK(MTN ls changed, [], [stdout], [])
AT_CHECK(cmp stdout /dev/null, [], [ignore]) 

AT_CLEANUP
