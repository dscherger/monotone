AT_SETUP([selecting headmost arbitrary certs])
MONOTONE_SETUP

ADD_FILE(testfile, [this is just a file
])
COMMIT(testbranch)
FIRST=`BASE_REVISION`

AT_DATA(testfile, [Now, this is a different file
])
COMMIT(testbranch)
SECOND=`BASE_REVISION`

AT_DATA(testfile, [And we change it a third time
])
COMMIT(testbranch)
THIRD=`BASE_REVISION`

AT_CHECK(MONOTONE cert $FIRST testcert 'value=with=equal=signs')
AT_CHECK(MONOTONE cert $SECOND testcert 'value')

# Check that a log without H: gives both the first and second commit...
AT_CHECK(MONOTONE log --revision 'c:testcert' --last=1, [0], [stdout], [ignore])
AT_CHECK(grep "Revision: $FIRST" stdout, [0], [ignore])
AT_CHECK(grep "Revision: $SECOND" stdout, [0], [ignore])

# Check that a log with H: gives only the second commit...
AT_CHECK(MONOTONE log --revision='H:c:testcert' --last=1, [0], [stdout], [stderr])
AT_CHECK(grep "Revision: $FIRST" stdout, [1], [ignore])
AT_CHECK(grep "Revision: $SECOND" stdout, [0], [ignore])
# Note that if the third revision is in the log, something else is wrong...
# There is really no case for this last test, just paranoia.
AT_CHECK(grep $THIRD stdout, [1], [ignore], [ignore])

AT_CLEANUP
