AT_SETUP([log hides deleted/renamed files])

# This test checks that 'mtn log' of deleted and renamed files shows
# nothing in a further revision, as they are not applicable any more.

MTN_SETUP

ADD_FILE(foo, [foo
])
AT_CHECK(MTN --branch=testbranch commit --message "Addition of foo.",
         [], [ignore], [ignore])

ADD_FILE(bar, [bar
])
AT_CHECK(MTN --branch=testbranch commit --message "Addition of bar.",
         [], [ignore], [ignore])

ADD_FILE(baz, [baz
])
AT_CHECK(MTN --branch=testbranch commit --message "Addition of baz.",
         [], [ignore], [ignore])

AT_CHECK(MTN drop bar baz, [], [ignore], [ignore])
COMMIT(testbranch)
rm -f bar baz

mv foo bar
AT_CHECK(MTN rename foo bar, [], [ignore], [ignore])
COMMIT(testbranch)

AT_CHECK(MTN log foo, [1], [], [ignore])

AT_CHECK(MTN log baz, [1], [], [ignore])

AT_CHECK(MTN log bar | grep "^Addition of @<:@a-z@:>@@<:@a-z@:>@@<:@a-z@:>@.$",
[], [Addition of foo.
], [ignore])

AT_CHECK(MTN log | grep "^Addition of @<:@a-z@:>@@<:@a-z@:>@@<:@a-z@:>@.$",
[],
[Addition of baz.
Addition of bar.
Addition of foo.
], [ignore])

AT_CLEANUP
