#  -*- Autoconf -*-

AT_SETUP([modification of an empty file])

MONOTONE_SETUP

# First of all, add an empty file.
AT_DATA(foo1, [])
AT_CHECK(MONOTONE add foo1, [], [ignore], [ignore])
AT_CHECK(MONOTONE --branch=testbranch commit --message blah,
         [], [ignore], [ignore])

# Add some contents to the previously added file.
AT_DATA(foo1, [Some contents.
])
AT_CHECK(MONOTONE --branch=testbranch commit --message blah,
         [], [ignore], [ignore])

REV=`BASE_REVISION`

# Verify that the latest revision contains a patch, rather than a delete/add
# sequence (as reported in bug #9964).

AT_CHECK(MONOTONE automate get_revision $REV,
         [], [stdout], [ignore])

AT_CHECK(grep '^patch "foo1"$' stdout, [], [ignore], [ignore])
AT_CHECK(grep 'add' stdout, [1], [ignore], [ignore])
AT_CHECK(grep 'delete' stdout, [1], [ignore], [ignore])

AT_CLEANUP
