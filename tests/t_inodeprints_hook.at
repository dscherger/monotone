AT_SETUP([use_inodeprints hook])
MTN_SETUP

AT_DATA(on.lua, [
function use_inodeprints()
  return true
end
])

AT_DATA(off.lua, [
function use_inodeprints()
  return false
end
])

AT_CHECK(test ! -e _MTN/inodeprints)
ADD_FILE(testfile, [blah blah
])
COMMIT(testbranch)
REV=`BASE_REVISION`

AT_CHECK(MTN setup --branch=testbranch setup_default, [], [ignore], [ignore])
AT_CHECK(test ! -e setup_default/_MTN/inodeprints)
AT_CHECK(MTN checkout --revision=$REV co_default, [], [ignore], [ignore])
AT_CHECK(test ! -e co_default/_MTN/inodeprints)

AT_CHECK(MTN --rcfile=off.lua setup --branch=testbranch setup_off, [], [ignore], [ignore])
AT_CHECK(test ! -e setup_off/_MTN/inodeprints)
AT_CHECK(MTN --rcfile=off.lua checkout --revision=$REV co_off, [], [ignore], [ignore])
AT_CHECK(test ! -e co_off/_MTN/inodeprints)

AT_CHECK(MTN --rcfile=on.lua setup --branch=testbranch setup_on, [], [ignore], [ignore])
AT_CHECK(test -e setup_on/_MTN/inodeprints)
AT_CHECK(MTN --rcfile=on.lua checkout --revision=$REV co_on, [], [ignore], [ignore])
AT_CHECK(test -e co_on/_MTN/inodeprints)
AT_CHECK(test -s co_on/_MTN/inodeprints)

AT_CLEANUP
