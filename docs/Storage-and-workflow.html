<html lang="en">
<head><link type="text/css" rel="stylesheet" href="texinfo.css" />
<title>Storage and workflow - monotone documentation</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="monotone documentation">
<meta name="generator" content="makeinfo 4.8">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Concepts.html#Concepts" title="Concepts">
<link rel="prev" href="Certificates.html#Certificates" title="Certificates">
<link rel="next" href="Forks-and-merges.html#Forks-and-merges" title="Forks and merges">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<p>
<a name="Storage-and-workflow"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="Forks-and-merges.html#Forks-and-merges">Forks and merges</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Certificates.html#Certificates">Certificates</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Concepts.html#Concepts">Concepts</a>
<hr>
</div>

<h3 class="section">1.5 Storage and workflow</h3>

<p>Monotone moves information in and out of four different types of
storage:

     <ul>
<li>a <i>keystore</i> in your home directory
<li>a <i>workspace</i> in the local file system
<li>a <i>local database</i> in the local file system
<li>a <i>remote database</i> elsewhere on the internet
</ul>

<p>The <dfn>keystore</dfn> is a directory <samp><span class="file">.monotone/keys</span></samp> in your home directory
which contains copies of all your private keys. Each key is stored in a file
whose name is the key identifier with some characters converted to underscores. 
When you use a key to sign a cert, the public half of that key is copied into
your local database along with the cert.

<p>All information passes <em>through</em> your local database, en route to
some other destination. For example, when changes are made in a
workspace, you may save those changes to your database, and later
you may synchronize your database with someone else's. Monotone will
not move information directly between a workspace and a remote
database, or between workspaces. Your local database is always
the &ldquo;switching point&rdquo; for communication.

<div class="block-image"><img src="figures/general-workflow.png" alt="figures/general-workflow.png"></div>

<p>A <dfn>workspace</dfn> is a tree of files in your file system, arranged
according to the list of file paths and IDs in a particular
manifest. A special directory called <samp><span class="file">_MTN</span></samp> exists in the root of
any workspace. Monotone keeps some special files in the <samp><span class="file">_MTN</span></samp>
directory, in order to track changes you make to your workspace.  If
you ever want to know if a directory is a monotone workspace, just
look for this <samp><span class="file">_MTN</span></samp> directory.

<p>Aside from the special <samp><span class="file">_MTN</span></samp> directory, a workspace is just a
normal tree of files. You can directly edit the files in a workspace
using a plain text editor or other program; monotone will
automatically notice when you make any changes. If you wish to add
files, remove files, or move files within your workspace, you must
tell monotone explicitly what you are doing, as these actions cannot
be deduced.

<p>If you do not yet have a workspace, you can <dfn>check out</dfn> a
workspace from a database, or construct one from scratch and
<dfn>add</dfn> it into a database. As you work, you will occasionally
<dfn>commit</dfn> changes you have made in a workspace to a database,
and <dfn>update</dfn> a workspace to receive changes that have arrived
in a database. Committing and updating take place purely between a
database and a workspace; the network is not involved.

<div class="block-image"><img src="figures/local-workflow.png" alt="figures/local-workflow.png"></div>

<p>A <dfn>database</dfn> is a single, regular file. You can copy or back it up
using standard methods. Typically you keep a database in your home
directory. Databases are portable between different machine types. You
can have multiple databases and divide your work between them, or keep
everything in a single database if you prefer. You can dump portions of
your database out as text, and read them back into other databases, or
send them to your friends.  Underneath, databases are accessed using a
standard, robust data manager, which makes using even very large
databases efficient.  In dire emergencies, you can directly examine and
manipulate a database using a simple SQL interface.

<p>A database contains many files, manifests, revisions, and
certificates, some of which are not immediately of interest, some of
which may be unwanted or even false. It is a collection of information
received from network servers, workspaces, and other
databases. You can inspect and modify your databases without affecting
your workspaces, and vice-versa.

<p>Monotone knows how to exchange information in your database with other
remote databases, using an interactive protocol called <dfn>netsync</dfn>. 
It supports three modes of exchange: pushing, pulling, and
synchronizing. A <dfn>pull</dfn> operation copies data from a remote
database to your local database. A <dfn>push</dfn> operation copies data
from your local database to a remote database. A <dfn>sync</dfn> operation
copies data both directions. In each case, only the data missing from
the destination is copied. The netsync protocol calculates the data to
send &ldquo;on the fly&rdquo; by exchanging partial hash values of each
database.

<div class="block-image"><img src="figures/network-workflow.png" alt="figures/network-workflow.png"></div>

<p>In general, work flow with monotone involves 3 distinct stages:

     <ul>
<li>When you <i>commit</i> changes from your workspace to your database,
your database stores the changes but does not communicate with the
network. Your commits happen immediately, without consulting any other
party, and do not require network connectivity.

     <li>When you are ready to <i>exchange</i> work with someone else, you can
push, pull, or sync with other databases on the network. When you talk
to other servers on the network, your database may change, but your
workspace will not. In fact, you do not need a workspace at all
when exchanging work.

     <li>When you <i>update</i> your workspace, some (but not all) of the
changes which your database received from the network are applied to
your workspace. The network is not consulted during updates. 
</ul>

<p>The last stage of workflow is worth clarifying: monotone does
<em>not</em> blindly apply all changes it receives from a remote
database to your workspace.  Doing so would be very dangerous,
because remote databases are not always trustworthy systems. Rather,
monotone evaluates the certificates it has received along with the
changes, and decides which particular changes are safe and desirable
to apply to your workspace.

<p>You can always adjust the criteria monotone uses to judge the
trustworthiness and desirability of changes in your database. But keep
in mind that it always uses <em>some</em> criteria; receiving changes
from a remote server is a <em>different</em> activity than applying
changes to a workspace. Sometimes you may receive changes which
monotone judges to be untrusted or bad; such changes may stay in your
database but will <em>not</em> be applied to your workspace.

<p>Remote databases, in other words, are just untrusted &ldquo;buckets&rdquo; of
data, which you can trade with promiscuously. There is no trust
implied in communication.

</body></html>

