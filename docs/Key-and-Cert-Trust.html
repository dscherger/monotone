<html lang="en">
<head><link type="text/css" rel="stylesheet" href="texinfo.css" />
<title>Key and Cert Trust - monotone documentation</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="monotone documentation">
<meta name="generator" content="makeinfo 4.8">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Command-Reference.html#Command-Reference" title="Command Reference">
<link rel="prev" href="Informative.html#Informative" title="Informative">
<link rel="next" href="Certificate.html#Certificate" title="Certificate">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<p>
<a name="Key-and-Cert-Trust"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="Certificate.html#Certificate">Certificate</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Informative.html#Informative">Informative</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Command-Reference.html#Command-Reference">Command Reference</a>
<hr>
</div>

<h3 class="section">5.5 Key and Cert Trust</h3>

     <dl>
<dt><samp><span class="command">mtn genkey </span><var>keyid</var></samp><a name="index-mtn-genkey-_0040var_007bkeyid_007d-103"></a><dd>
This command generates an <span class="sc">rsa</span> public/private key pair, using a
system random number generator, and stores it in your keystore under
the key name <var>keyid</var>.

     <p>The private half of the key is stored in an encrypted form, so that anyone
who can read your keystore cannot extract your private key and use it. 
You must provide a passphrase for your key when it is generated, which is used
to determine the encryption key. In the future you will need to enter this
passphrase again each time you sign a certificate, which happens every
time you <samp><span class="command">commit</span></samp> to your database. You can tell monotone to
automatically use a certain passphrase for a given key using the
<code>get_passphrase(</code><var>keypair_id</var><code>)</code>, but this significantly
increases the risk of a key compromise on your local computer. Be
careful using this hook.

     <p>The public key is stored in the database; the public and private keys
are stored in the keystore. This allows copying the database without
copying the private key.

     <p>The location of the keystore is specified by the <samp><span class="option">--keydir</span></samp>
option; it defaults to the value stored in <samp><span class="file">_MTN/options</span></samp> for
commands executed in a workspace, or to
the system default (<samp><span class="file">~/.monotone/keys</span></samp> on Unix and Cygwin,
<samp><span class="file">%APPDATA%/monotone/keys</span></samp> on native Win32).

     <br><dt><samp><span class="command">mtn dropkey </span><var>keyid</var></samp><a name="index-mtn-dropkey-_0040var_007bkeyid_007d-104"></a><dd>
This command drops the public and/or private key. If both exist, both
are dropped, if only one exists, it is dropped. This command should
be used with caution as changes are irreversible without a backup of
the key(s) that were dropped.

     <br><dt><samp><span class="command">mtn passphrase </span><var>id</var></samp><a name="index-mtn-passphrase-_0040var_007bid_007d-105"></a><dd>
This command lets you change the passphrase of the private half of the
key <var>id</var>.

     <br><dt><samp><span class="command">mtn trusted </span><var>id</var> <var>certname</var> <var>certval</var> <var>signers</var></samp><a name="index-mtn-trusted-_0040var_007bid_007d-_0040var_007bcertname_007d-_0040var_007bcertval_007d-_0040var_007bsigners_007d-106"></a><dd>
This command lets you test your revision trust hook
<code>get_revision_cert_trust</code> (see <a href="Hook-Reference.html#Hook-Reference">Hook Reference</a>).  You pass it
a revision ID, a certificate name, a certificate value, and one or more
key IDs, and it will tell you whether, under your current settings,
Monotone would trust a cert on that revision with that value signed by
those keys.

     <br><dt><samp><span class="command">mtn ssh_agent_add</span></samp><a name="index-mtn-ssh_005fagent_005fadd-107"></a><dd>
This command will add your monotone keys to your current ssh-agent session. 
You will be asked for the passphrase for each of your monotone private keys
and they will be added to the ssh-agent. Once this is done you should be able
to type <em>ssh-add -l</em> and see your monotone key listed. When you
subsequently use these keys through monotone it will use ssh-agent for signing
without asking your for your passphrase.

     <p>This command is mainly for use in a session script as monotone will automatically
add your keys to ssh-agent on first use if it is available. For example the
following two examples are equivalent:

     <pre class="smallexample">          $ mtn ssh_agent_add
          enter passphrase for key ID [user@example.com]:
          $ mtn ci -m"Changed foo to bar"
          $ mtn push -k user@example.com
     </pre>
     <pre class="smallexample">          $ mtn ci -m"Changed foo to bar"
          enter passphrase for key ID [user@example.com]:
          $ mtn push -k user@example.com
     </pre>
     <p>In the second example, monotone automatically added the key to ssh-agent, making
entering the passphrase not needed during the push.

     <br><dt><samp><span class="command">mtn ssh_agent_export </span><var>filename</var></samp><a name="index-mtn-ssh_005fagent_005fexport-_0040var_007bfilename_007d-108"></a><dd>
This command will export your private key in a format that ssh-agent
can read (PKCS8, PEM). You will be asked for your current key's password
and a new password to encrypt the key with. The key will be printed to
stdout. Once you have put this key in a file simply add it to ssh-agent
and you will only have to enter your key password once as ssh-agent
will cache the key for you.

     <pre class="smallexample">          $ mtn ssh_agent_export ~/.ssh/id_monotone
          enter passphrase for key ID [user@example.com]:
          enter new passphrase for key ID [user@example.com]:
          confirm passphrase for key ID [user@example.com]:
          $ chmod 600 ~/.ssh/id_monotone
          $ ssh-agent /bin/bash
          $ ssh-add ~/.ssh/id_monotone
          Enter passphrase for /home/user/.ssh/id_monotone:
          Identity added: /home/user/.ssh/id_monotone (/home/user/.ssh/id_monotone)
          $ mtn ci -m"Changed foo to bar"
          $ mtn push -k user@example.com
     </pre>
     <p>You can also use the <samp><span class="option">--ssh-sign</span></samp> option to control whether ssh-agent will
be used for signing. If set to <em>yes</em>, ssh-agent will be used to sign. If your
key has not been added to ssh-agent monotone will fall back to its internal signing
code and ask you for your password. If set to <em>only</em>, monotone will sign only
with ssh-agent. If set to <em>no</em>, monotone will always use its internal signing
code even if ssh-agent is running and has your monotone key loaded. If set to
<em>check</em>, monotone will sign with both ssh-agent (if your key is loaded into
it) and monotone's internal signing code, then compare the results. <em>check</em>
will be removed at some future time as it is meant only for testing and will not
work with all signing algorithms.

</dl>

   </body></html>

